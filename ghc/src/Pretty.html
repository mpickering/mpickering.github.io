<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">{-
*********************************************************************************
*                                                                               *
*       John Hughes's and Simon Peyton Jones's Pretty Printer Combinators       *
*                                                                               *
*               based on &quot;The Design of a Pretty-printing Library&quot;              *
*               in Advanced Functional Programming,                             *
*               Johan Jeuring and Erik Meijer (eds), LNCS 925                   *
*               http://www.cs.chalmers.se/~rjmh/Papers/pretty.ps                *
*                                                                               *
*               Heavily modified by Simon Peyton Jones, Dec 96                  *
*                                                                               *
*********************************************************************************

Version 3.0     28 May 1997
  * Cured massive performance bug.  If you write

        foldl &lt;&gt; empty (map (text.show) [1..10000])

    you get quadratic behaviour with V2.0.  Why?  For just the same reason as you get
    quadratic behaviour with left-associated (++) chains.

    This is really bad news.  One thing a pretty-printer abstraction should
    certainly guarantee is insensivity to associativity.  It matters: suddenly
    GHC's compilation times went up by a factor of 100 when I switched to the
    new pretty printer.

    I fixed it with a bit of a hack (because I wanted to get GHC back on the
    road).  I added two new constructors to the Doc type, Above and Beside:

         &lt;&gt; = Beside
         $$ = Above

    Then, where I need to get to a &quot;TextBeside&quot; or &quot;NilAbove&quot; form I &quot;force&quot;
    the Doc to squeeze out these suspended calls to Beside and Above; but in so
    doing I re-associate. It's quite simple, but I'm not satisfied that I've done
    the best possible job.  I'll send you the code if you are interested.

  * Added new exports:
        punctuate, hang
        int, integer, float, double, rational,
        lparen, rparen, lbrack, rbrack, lbrace, rbrace,

  * fullRender's type signature has changed.  Rather than producing a string it
    now takes an extra couple of arguments that tells it how to glue fragments
    of output together:

        fullRender :: Mode
                   -&gt; Int                       -- Line length
                   -&gt; Float                     -- Ribbons per line
                   -&gt; (TextDetails -&gt; a -&gt; a)   -- What to do with text
                   -&gt; a                         -- What to do at the end
                   -&gt; Doc
                   -&gt; a                         -- Result

    The &quot;fragments&quot; are encapsulated in the TextDetails data type:
        data TextDetails = Chr  Char
                         | Str  String
                         | PStr FastString

    The Chr and Str constructors are obvious enough.  The PStr constructor has a packed
    string (FastString) inside it.  It's generated by using the new &quot;ptext&quot; export.

    An advantage of this new setup is that you can get the renderer to do output
    directly (by passing in a function of type (TextDetails -&gt; IO () -&gt; IO ()),
    rather than producing a string that you then print.


Version 2.0     24 April 1997
  * Made empty into a left unit for &lt;&gt; as well as a right unit;
    it is also now true that
        nest k empty = empty
    which wasn't true before.

  * Fixed an obscure bug in sep that occasionally gave very weird behaviour

  * Added $+$

  * Corrected and tidied up the laws and invariants

======================================================================
Relative to John's original paper, there are the following new features:

1.  There's an empty document, &quot;empty&quot;.  It's a left and right unit for
    both &lt;&gt; and $$, and anywhere in the argument list for
    sep, hcat, hsep, vcat, fcat etc.

    It is Really Useful in practice.

2.  There is a paragraph-fill combinator, fsep, that's much like sep,
    only it keeps fitting things on one line until it can't fit any more.

3.  Some random useful extra combinators are provided.
        &lt;+&gt; puts its arguments beside each other with a space between them,
            unless either argument is empty in which case it returns the other


        hcat is a list version of &lt;&gt;
        hsep is a list version of &lt;+&gt;
        vcat is a list version of $$

        sep (separate) is either like hsep or like vcat, depending on what fits

        cat  is behaves like sep,  but it uses &lt;&gt; for horizontal conposition
        fcat is behaves like fsep, but it uses &lt;&gt; for horizontal conposition

        These new ones do the obvious things:
                char, semi, comma, colon, space,
                parens, brackets, braces,
                quotes, quote, doubleQuotes

4.      The &quot;above&quot; combinator, $$, now overlaps its two arguments if the
        last line of the top argument stops before the first line of the second begins.
        For example:  text &quot;hi&quot; $$ nest 5 &quot;there&quot;
        lays out as
                        hi   there
        rather than
                        hi
                             there

        There are two places this is really useful

        a) When making labelled blocks, like this:
                Left -&gt;   code for left
                Right -&gt;  code for right
                LongLongLongLabel -&gt;
                          code for longlonglonglabel
           The block is on the same line as the label if the label is
           short, but on the next line otherwise.

        b) When laying out lists like this:
                [ first
                , second
                , third
                ]
           which some people like.  But if the list fits on one line
           you want [first, second, third].  You can't do this with
           John's original combinators, but it's quite easy with the
           new $$.

        The combinator $+$ gives the original &quot;never-overlap&quot; behaviour.

5.      Several different renderers are provided:
                * a standard one
                * one that uses cut-marks to avoid deeply-nested documents
                        simply piling up in the right-hand margin
                * one that ignores indentation (fewer chars output; good for machines)
                * one that ignores indentation and newlines (ditto, only more so)

6.      Numerous implementation tidy-ups
        Use of unboxed data types to speed up the implementation
-}</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-pragma">{-# LANGUAGE BangPatterns, CPP, MagicHash #-}</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Pretty</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-159"></a><span>        </span><span class="hs-comment">-- * The document type</span><span>
</span><a name="line-160"></a><span>        </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#TextDetails"><span class="hs-identifier hs-type">TextDetails</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-161"></a><span>
</span><a name="line-162"></a><span>        </span><span class="hs-comment">-- * Constructing documents</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span>        </span><span class="hs-comment">-- ** Converting values into documents</span><span>
</span><a name="line-165"></a><span>        </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#text"><span class="hs-identifier hs-var">text</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#ftext"><span class="hs-identifier hs-var">ftext</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#ptext"><span class="hs-identifier hs-var">ptext</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#ztext"><span class="hs-identifier hs-var">ztext</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#sizedText"><span class="hs-identifier hs-var">sizedText</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#zeroWidthText"><span class="hs-identifier hs-var">zeroWidthText</span></a><span class="hs-special">,</span><span>
</span><a name="line-166"></a><span>        </span><a href="Pretty.html#int"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#integer"><span class="hs-identifier hs-var">integer</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#float"><span class="hs-identifier hs-var">float</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#double"><span class="hs-identifier hs-var">double</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#rational"><span class="hs-identifier hs-var">rational</span></a><span class="hs-special">,</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span>        </span><span class="hs-comment">-- ** Simple derived documents</span><span>
</span><a name="line-169"></a><span>        </span><a href="Pretty.html#semi"><span class="hs-identifier hs-var">semi</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#comma"><span class="hs-identifier hs-var">comma</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#space"><span class="hs-identifier hs-var">space</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#equals"><span class="hs-identifier hs-var">equals</span></a><span class="hs-special">,</span><span>
</span><a name="line-170"></a><span>        </span><a href="Pretty.html#lparen"><span class="hs-identifier hs-var">lparen</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#rparen"><span class="hs-identifier hs-var">rparen</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#lbrack"><span class="hs-identifier hs-var">lbrack</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#rbrack"><span class="hs-identifier hs-var">rbrack</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#lbrace"><span class="hs-identifier hs-var">lbrace</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#rbrace"><span class="hs-identifier hs-var">rbrace</span></a><span class="hs-special">,</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>        </span><span class="hs-comment">-- ** Wrapping documents in delimiters</span><span>
</span><a name="line-173"></a><span>        </span><a href="Pretty.html#parens"><span class="hs-identifier hs-var">parens</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#braces"><span class="hs-identifier hs-var">braces</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#quote"><span class="hs-identifier hs-var">quote</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#doubleQuotes"><span class="hs-identifier hs-var">doubleQuotes</span></a><span class="hs-special">,</span><span>
</span><a name="line-174"></a><span>        </span><a href="Pretty.html#maybeParens"><span class="hs-identifier hs-var">maybeParens</span></a><span class="hs-special">,</span><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span>        </span><span class="hs-comment">-- ** Combining documents</span><span>
</span><a name="line-177"></a><span>        </span><a href="Pretty.html#empty"><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">,</span><span>
</span><a name="line-178"></a><span>        </span><span class="hs-special">(</span><a href="Pretty.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Pretty.html#hcat"><span class="hs-identifier hs-var">hcat</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span class="hs-special">,</span><span>
</span><a name="line-179"></a><span>        </span><span class="hs-special">(</span><a href="Pretty.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#%24%2B%24"><span class="hs-operator hs-var">$+$</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Pretty.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span class="hs-special">,</span><span>
</span><a name="line-180"></a><span>        </span><a href="Pretty.html#sep"><span class="hs-identifier hs-var">sep</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#cat"><span class="hs-identifier hs-var">cat</span></a><span class="hs-special">,</span><span>
</span><a name="line-181"></a><span>        </span><a href="Pretty.html#fsep"><span class="hs-identifier hs-var">fsep</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#fcat"><span class="hs-identifier hs-var">fcat</span></a><span class="hs-special">,</span><span>
</span><a name="line-182"></a><span>        </span><a href="Pretty.html#nest"><span class="hs-identifier hs-var">nest</span></a><span class="hs-special">,</span><span>
</span><a name="line-183"></a><span>        </span><a href="Pretty.html#hang"><span class="hs-identifier hs-var">hang</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#hangNotEmpty"><span class="hs-identifier hs-var">hangNotEmpty</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span class="hs-special">,</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>        </span><span class="hs-comment">-- * Predicates on documents</span><span>
</span><a name="line-186"></a><span>        </span><a href="Pretty.html#isEmpty"><span class="hs-identifier hs-var">isEmpty</span></a><span class="hs-special">,</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span>        </span><span class="hs-comment">-- * Rendering documents</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span>        </span><span class="hs-comment">-- ** Rendering with a particular style</span><span>
</span><a name="line-191"></a><span>        </span><a href="Pretty.html#Style"><span class="hs-identifier hs-type">Style</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-192"></a><span>        </span><a href="Pretty.html#style"><span class="hs-identifier hs-var">style</span></a><span class="hs-special">,</span><span>
</span><a name="line-193"></a><span>        </span><a href="Pretty.html#renderStyle"><span class="hs-identifier hs-var">renderStyle</span></a><span class="hs-special">,</span><span>
</span><a name="line-194"></a><span>        </span><a href="Pretty.html#Mode"><span class="hs-identifier hs-type">Mode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span>        </span><span class="hs-comment">-- ** General rendering</span><span>
</span><a name="line-197"></a><span>        </span><a href="Pretty.html#fullRender"><span class="hs-identifier hs-var">fullRender</span></a><span class="hs-special">,</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span>        </span><span class="hs-comment">-- ** GHC-specific rendering</span><span>
</span><a name="line-200"></a><span>        </span><a href="Pretty.html#printDoc"><span class="hs-identifier hs-var">printDoc</span></a><span class="hs-special">,</span><span> </span><a href="Pretty.html#printDoc_"><span class="hs-identifier hs-var">printDoc_</span></a><span class="hs-special">,</span><span>
</span><a name="line-201"></a><span>        </span><a href="Pretty.html#bufLeftRender"><span class="hs-identifier hs-var">bufLeftRender</span></a><span> </span><span class="hs-comment">-- performance hack</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-keyword">import</span><span> </span><a href="BufWrite.html"><span class="hs-identifier">BufWrite</span></a><span>
</span><a name="line-206"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-207"></a><span class="hs-keyword">import</span><span> </span><a href="Panic.html"><span class="hs-identifier">Panic</span></a><span>
</span><a name="line-208"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/System.IO.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span></a><span>
</span><a name="line-209"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Prelude.html"><span class="hs-identifier">Prelude</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-comment">--for a RULES</span><span>
</span><a name="line-212"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">Base</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">unpackCString</span><span class="hs-operator hs-var">#</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Ptr.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">Ptr</span></a><span>  </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Ptr.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-comment">-- Don't import Util( assertPanic ) because it makes a loop in the module structure</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- The Doc calculus</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-comment">{-
Laws for $$
~~~~~~~~~~~
&lt;a1&gt;    (x $$ y) $$ z   = x $$ (y $$ z)
&lt;a2&gt;    empty $$ x      = x
&lt;a3&gt;    x $$ empty      = x

        ...ditto $+$...

Laws for &lt;&gt;
~~~~~~~~~~~
&lt;b1&gt;    (x &lt;&gt; y) &lt;&gt; z   = x &lt;&gt; (y &lt;&gt; z)
&lt;b2&gt;    empty &lt;&gt; x      = empty
&lt;b3&gt;    x &lt;&gt; empty      = x

        ...ditto &lt;+&gt;...

Laws for text
~~~~~~~~~~~~~
&lt;t1&gt;    text s &lt;&gt; text t        = text (s++t)
&lt;t2&gt;    text &quot;&quot; &lt;&gt; x            = x, if x non-empty

** because of law n6, t2 only holds if x doesn't
** start with `nest'.


Laws for nest
~~~~~~~~~~~~~
&lt;n1&gt;    nest 0 x                = x
&lt;n2&gt;    nest k (nest k' x)      = nest (k+k') x
&lt;n3&gt;    nest k (x &lt;&gt; y)         = nest k x &lt;&gt; nest k y
&lt;n4&gt;    nest k (x $$ y)         = nest k x $$ nest k y
&lt;n5&gt;    nest k empty            = empty
&lt;n6&gt;    x &lt;&gt; nest k y           = x &lt;&gt; y, if x non-empty

** Note the side condition on &lt;n6&gt;!  It is this that
** makes it OK for empty to be a left unit for &lt;&gt;.

Miscellaneous
~~~~~~~~~~~~~
&lt;m1&gt;    (text s &lt;&gt; x) $$ y = text s &lt;&gt; ((text &quot;&quot; &lt;&gt; x) $$
                                         nest (-length s) y)

&lt;m2&gt;    (x $$ y) &lt;&gt; z = x $$ (y &lt;&gt; z)
        if y non-empty


Laws for list versions
~~~~~~~~~~~~~~~~~~~~~~
&lt;l1&gt;    sep (ps++[empty]++qs)   = sep (ps ++ qs)
        ...ditto hsep, hcat, vcat, fill...

&lt;l2&gt;    nest k (sep ps) = sep (map (nest k) ps)
        ...ditto hsep, hcat, vcat, fill...

Laws for oneLiner
~~~~~~~~~~~~~~~~~
&lt;o1&gt;    oneLiner (nest k p) = nest k (oneLiner p)
&lt;o2&gt;    oneLiner (x &lt;&gt; y)   = oneLiner x &lt;&gt; oneLiner y

You might think that the following verion of &lt;m1&gt; would
be neater:

&lt;3 NO&gt;  (text s &lt;&gt; x) $$ y = text s &lt;&gt; ((empty &lt;&gt; x)) $$
                                         nest (-length s) y)

But it doesn't work, for if x=empty, we would have

        text s $$ y = text s &lt;&gt; (empty $$ nest (-length s) y)
                    = text s &lt;&gt; nest (-length s) y
-}</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- Operator fixity</span><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">6</span><span> </span><span class="hs-operator">&lt;&gt;</span><span>
</span><a name="line-297"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">6</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span>
</span><a name="line-298"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">5</span><span> </span><span class="hs-operator">$$</span><span class="hs-special">,</span><span> </span><span class="hs-operator">$+$</span><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- The Doc data type</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">-- | The abstract type of documents.</span><span>
</span><a name="line-305"></a><span class="hs-comment">-- A Doc represents a *set* of layouts. A Doc with</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- no occurrences of Union or NoDoc represents just one layout.</span><span>
</span><a name="line-307"></a><span class="hs-keyword">data</span><span> </span><a name="Doc"><a href="Pretty.html#Doc"><span class="hs-identifier">Doc</span></a></a><span>
</span><a name="line-308"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Empty"><a href="Pretty.html#Empty"><span class="hs-identifier">Empty</span></a></a><span>                                            </span><span class="hs-comment">-- empty</span><span>
</span><a name="line-309"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="NilAbove"><a href="Pretty.html#NilAbove"><span class="hs-identifier">NilAbove</span></a></a><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span>                                     </span><span class="hs-comment">-- text &quot;&quot; $$ x</span><span>
</span><a name="line-310"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TextBeside"><a href="Pretty.html#TextBeside"><span class="hs-identifier">TextBeside</span></a></a><span> </span><span class="hs-glyph">!</span><a href="Pretty.html#TextDetails"><span class="hs-identifier hs-type">TextDetails</span></a><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span>  </span><span class="hs-comment">-- text s &lt;&gt; x</span><span>
</span><a name="line-311"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Nest"><a href="Pretty.html#Nest"><span class="hs-identifier">Nest</span></a></a><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span>                     </span><span class="hs-comment">-- nest k x</span><span>
</span><a name="line-312"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Union"><a href="Pretty.html#Union"><span class="hs-identifier">Union</span></a></a><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span>                                    </span><span class="hs-comment">-- ul `union` ur</span><span>
</span><a name="line-313"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="NoDoc"><a href="Pretty.html#NoDoc"><span class="hs-identifier">NoDoc</span></a></a><span>                                            </span><span class="hs-comment">-- The empty set of documents</span><span>
</span><a name="line-314"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Beside"><a href="Pretty.html#Beside"><span class="hs-identifier">Beside</span></a></a><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span>                              </span><span class="hs-comment">-- True &lt;=&gt; space between</span><span>
</span><a name="line-315"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Above"><a href="Pretty.html#Above"><span class="hs-identifier">Above</span></a></a><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span>                               </span><span class="hs-comment">-- True &lt;=&gt; never overlap</span><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span class="hs-comment">{-
Here are the invariants:

1) The argument of NilAbove is never Empty. Therefore
   a NilAbove occupies at least two lines.

2) The argument of @TextBeside@ is never @Nest@.

3) The layouts of the two arguments of @Union@ both flatten to the same
   string.

4) The arguments of @Union@ are either @TextBeside@, or @NilAbove@.

5) A @NoDoc@ may only appear on the first line of the left argument of an
   union. Therefore, the right argument of an union can never be equivalent
   to the empty set (@NoDoc@).

6) An empty document is always represented by @Empty@.  It can't be
   hidden inside a @Nest@, or a @Union@ of two @Empty@s.

7) The first line of every layout in the left argument of @Union@ is
   longer than the first line of any layout in the right argument.
   (1) ensures that the left argument has a first line.  In view of
   (3), this invariant means that the right argument must have at
   least two lines.

Notice the difference between
   * NoDoc (no documents)
   * Empty (one empty document; no height and no width)
   * text &quot;&quot; (a document containing the empty string;
              one line high, but has no width)
-}</span><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span>
</span><a name="line-351"></a><span class="hs-comment">-- | RDoc is a &quot;reduced GDoc&quot;, guaranteed not to have a top-level Above or Beside.</span><span>
</span><a name="line-352"></a><span class="hs-keyword">type</span><span> </span><a name="RDoc"><a href="Pretty.html#RDoc"><span class="hs-identifier">RDoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">-- | The TextDetails data type</span><span>
</span><a name="line-355"></a><span class="hs-comment">--</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- A TextDetails represents a fragment of text that will be</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- output at some point.</span><span>
</span><a name="line-358"></a><span class="hs-keyword">data</span><span> </span><a name="TextDetails"><a href="Pretty.html#TextDetails"><span class="hs-identifier">TextDetails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Chr"><a href="Pretty.html#Chr"><span class="hs-identifier">Chr</span></a></a><span>  </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-comment">-- ^ A single Char fragment</span><span>
</span><a name="line-359"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a name="Str"><a href="Pretty.html#Str"><span class="hs-identifier">Str</span></a></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-comment">-- ^ A whole String fragment</span><span>
</span><a name="line-360"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a name="PStr"><a href="Pretty.html#PStr"><span class="hs-identifier">PStr</span></a></a><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>                      </span><span class="hs-comment">-- a hashed string</span><span>
</span><a name="line-361"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a name="ZStr"><a href="Pretty.html#ZStr"><span class="hs-identifier">ZStr</span></a></a><span> </span><a href="FastString.html#FastZString"><span class="hs-identifier hs-type">FastZString</span></a><span>                     </span><span class="hs-comment">-- a z-encoded string</span><span>
</span><a name="line-362"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a name="LStr"><a href="Pretty.html#LStr"><span class="hs-identifier">LStr</span></a></a><span> </span><span class="hs-pragma">{-# UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><a href="FastString.html#LitString"><span class="hs-identifier hs-type">LitString</span></a><span> </span><span class="hs-pragma">{-#UNPACK #-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-363"></a><span>                   </span><span class="hs-comment">-- a '\0'-terminated array of bytes</span><span>
</span><a name="line-364"></a><span>
</span><a name="line-365"></a><span class="hs-keyword">instance</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-366"></a><span>  </span><a name="local-1912608565"><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#showsPrec"><span class="hs-identifier">showsPrec</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627463602"><a href="#local-1627463602"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-1627463603"><a href="#local-1627463603"><span class="hs-identifier">cont</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#fullRender"><span class="hs-identifier hs-var">fullRender</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mode</span><span> </span><a href="Pretty.html#style"><span class="hs-identifier hs-var">style</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">lineLength</span><span> </span><a href="Pretty.html#style"><span class="hs-identifier hs-var">style</span></a><span class="hs-special">)</span><span>
</span><a name="line-367"></a><span>                                    </span><span class="hs-special">(</span><span class="hs-identifier">ribbonsPerLine</span><span> </span><a href="Pretty.html#style"><span class="hs-identifier hs-var">style</span></a><span class="hs-special">)</span><span>
</span><a name="line-368"></a><span>                                    </span><a href="Pretty.html#txtPrinter"><span class="hs-identifier hs-var">txtPrinter</span></a><span> </span><a href="#local-1627463603"><span class="hs-identifier hs-var">cont</span></a><span> </span><a href="#local-1627463602"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- Values and Predicates on GDocs and TextDetails</span><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><span class="hs-comment">-- | A document of height and width 1, containing a literal character.</span><span>
</span><a name="line-375"></a><span class="hs-identifier">char</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span>
</span><a name="line-376"></a><a name="char"><a href="Pretty.html#char"><span class="hs-identifier">char</span></a></a><span> </span><a name="local-1627463168"><a href="#local-1627463168"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">textBeside_</span></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Chr"><span class="hs-identifier hs-var">Chr</span></a><span> </span><a href="#local-1627463168"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-comment">-- | A document of height 1 containing a literal string.</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- 'text' satisfies the following laws:</span><span>
</span><a name="line-380"></a><span class="hs-comment">--</span><span>
</span><a name="line-381"></a><span class="hs-comment">-- * @'text' s '&lt;&gt;' 'text' t = 'text' (s'++'t)@</span><span>
</span><a name="line-382"></a><span class="hs-comment">--</span><span>
</span><a name="line-383"></a><span class="hs-comment">-- * @'text' \&quot;\&quot; '&lt;&gt;' x = x@, if @x@ non-empty</span><span>
</span><a name="line-384"></a><span class="hs-comment">--</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- The side condition on the last law is necessary because @'text' \&quot;\&quot;@</span><span>
</span><a name="line-386"></a><span class="hs-comment">-- has height 1, while 'empty' has no height.</span><span>
</span><a name="line-387"></a><span class="hs-identifier">text</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span>
</span><a name="line-388"></a><a name="text"><a href="Pretty.html#text"><span class="hs-identifier">text</span></a></a><span> </span><a name="local-1627463169"><a href="#local-1627463169"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-1627463169"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><a name="local-1627463170"><a href="#local-1627463170"><span class="hs-identifier">sl</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">textBeside_</span></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Str"><span class="hs-identifier hs-var">Str</span></a><span> </span><a href="#local-1627463169"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>  </span><a href="#local-1627463170"><span class="hs-identifier hs-var">sl</span></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span class="hs-special">}</span><span>
</span><a name="line-389"></a><span class="hs-pragma">{-# NOINLINE [0] text #-}</span><span>   </span><span class="hs-comment">-- Give the RULE a chance to fire</span><span>
</span><a name="line-390"></a><span>                            </span><span class="hs-comment">-- It must wait till after phase 1 when</span><span>
</span><a name="line-391"></a><span>                            </span><span class="hs-comment">-- the unpackCString first is manifested</span><span>
</span><a name="line-392"></a><span>
</span><a name="line-393"></a><span class="hs-comment">-- RULE that turns (text &quot;abc&quot;) into (ptext (A# &quot;abc&quot;#)) to avoid the</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- intermediate packing/unpacking of the string.</span><span>
</span><a name="line-395"></a><span class="hs-pragma">{-# RULES
  &quot;text/str&quot; forall a. text (unpackCString# a) = ptext (Ptr a)
 #-}</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-identifier">ftext</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FastString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-400"></a><span class="hs-identifier">ftext</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">lengthFS</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">sl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PStr</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">Empty</span><span class="hs-special">}</span><span>
</span><a name="line-401"></a><span>
</span><a name="line-402"></a><span class="hs-identifier">ptext</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">LitString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-403"></a><span class="hs-identifier">ptext</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">lengthLS</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">sl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LStr</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">Empty</span><span class="hs-special">}</span><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span class="hs-identifier">ztext</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FastZString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-406"></a><span class="hs-identifier">ztext</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">lengthFZS</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">sl</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ZStr</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">Empty</span><span class="hs-special">}</span><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><span class="hs-comment">-- | Some text with any width. (@text s = sizedText (length s) s@)</span><span>
</span><a name="line-409"></a><span class="hs-identifier">sizedText</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-410"></a><span class="hs-identifier">sizedText</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Str</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">Empty</span><span>
</span><a name="line-411"></a><span>
</span><a name="line-412"></a><span class="hs-comment">-- | Some text, but without any width. Use for non-printing text</span><span>
</span><a name="line-413"></a><span class="hs-comment">-- such as a HTML or Latex tags</span><span>
</span><a name="line-414"></a><span class="hs-identifier">zeroWidthText</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-415"></a><span class="hs-identifier">zeroWidthText</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sizedText</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-comment">-- | The empty document, with no height and no width.</span><span>
</span><a name="line-418"></a><span class="hs-comment">-- 'empty' is the identity for '&lt;&gt;', '&lt;+&gt;', '$$' and '$+$', and anywhere</span><span>
</span><a name="line-419"></a><span class="hs-comment">-- in the argument list for 'sep', 'hcat', 'hsep', 'vcat', 'fcat' etc.</span><span>
</span><a name="line-420"></a><span class="hs-identifier">empty</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-421"></a><span class="hs-identifier">empty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Empty</span><span>
</span><a name="line-422"></a><span>
</span><a name="line-423"></a><span class="hs-comment">-- | Returns 'True' if the document is empty</span><span>
</span><a name="line-424"></a><span class="hs-identifier">isEmpty</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-425"></a><span class="hs-identifier">isEmpty</span><span> </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-426"></a><a name="isEmpty"><a href="Pretty.html#isEmpty"><span class="hs-identifier">isEmpty</span></a></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">_</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span class="hs-comment">-- | Produce spacing for indenting the amount specified.</span><span>
</span><a name="line-429"></a><span class="hs-comment">--</span><span>
</span><a name="line-430"></a><span class="hs-comment">-- an old version inserted tabs being 8 columns apart in the output.</span><span>
</span><a name="line-431"></a><span class="hs-identifier">spaces</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">String</span><span>
</span><a name="line-432"></a><span class="hs-identifier">spaces</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">replicate</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-char">' '</span><span>
</span><a name="line-433"></a><span>
</span><a name="line-434"></a><span class="hs-comment">{-
Q: What is the reason for negative indentation (i.e. argument to indent
   is &lt; 0) ?

A:
This indicates an error in the library client's code.
If we compose a &lt;&gt; b, and the first line of b is more indented than some
other lines of b, the law &lt;n6&gt; (&lt;&gt; eats nests) may cause the pretty
printer to produce an invalid layout:

doc       |0123345
------------------
d1        |a...|
d2        |...b|
          |c...|

d1&lt;&gt;d2    |ab..|
         c|....|

Consider a &lt;&gt; b, let `s' be the length of the last line of `a', `k' the
indentation of the first line of b, and `k0' the indentation of the
left-most line b_i of b.

The produced layout will have negative indentation if `k - k0 &gt; s', as
the first line of b will be put on the (s+1)th column, effectively
translating b horizontally by (k-s). Now if the i^th line of b has an
indentation k0 &lt; (k-s), it is translated out-of-page, causing
`negative indentation'.
-}</span><span>
</span><a name="line-463"></a><span>
</span><a name="line-464"></a><span>
</span><a name="line-465"></a><span class="hs-identifier">semi</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-comment">-- ^ A ';' character</span><span>
</span><a name="line-466"></a><span class="hs-identifier">comma</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ A ',' character</span><span>
</span><a name="line-467"></a><span class="hs-identifier">colon</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ A ':' character</span><span>
</span><a name="line-468"></a><span class="hs-identifier">space</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ A space character</span><span>
</span><a name="line-469"></a><span class="hs-identifier">equals</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ A '=' character</span><span>
</span><a name="line-470"></a><span class="hs-identifier">lparen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ A '(' character</span><span>
</span><a name="line-471"></a><span class="hs-identifier">rparen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ A ')' character</span><span>
</span><a name="line-472"></a><span class="hs-identifier">lbrack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ A '[' character</span><span>
</span><a name="line-473"></a><span class="hs-identifier">rbrack</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ A ']' character</span><span>
</span><a name="line-474"></a><span class="hs-identifier">lbrace</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ A '{' character</span><span>
</span><a name="line-475"></a><span class="hs-identifier">rbrace</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ A '}' character</span><span>
</span><a name="line-476"></a><span class="hs-identifier">semi</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">char</span><span> </span><span class="hs-char">';'</span><span>
</span><a name="line-477"></a><span class="hs-identifier">comma</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">','</span><span>
</span><a name="line-478"></a><a name="comma"><a href="Pretty.html#comma"><span class="hs-identifier">colon</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">':'</span><span>
</span><a name="line-479"></a><a name="colon"><a href="Pretty.html#colon"><span class="hs-identifier">space</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">' '</span><span>
</span><a name="line-480"></a><span class="hs-identifier">equals</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'='</span><span>
</span><a name="line-481"></a><a name="equals"><a href="Pretty.html#equals"><span class="hs-identifier">lparen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'('</span><span>
</span><a name="line-482"></a><a name="lparen"><a href="Pretty.html#lparen"><span class="hs-identifier">rparen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">')'</span><span>
</span><a name="line-483"></a><a name="rparen"><a href="Pretty.html#rparen"><span class="hs-identifier">lbrack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'['</span><span>
</span><a name="line-484"></a><a name="lbrack"><a href="Pretty.html#lbrack"><span class="hs-identifier">rbrack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">']'</span><span>
</span><a name="line-485"></a><a name="rbrack"><a href="Pretty.html#rbrack"><span class="hs-identifier">lbrace</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'{'</span><span>
</span><a name="line-486"></a><a name="lbrace"><a href="Pretty.html#lbrace"><span class="hs-identifier">rbrace</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'}'</span><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span class="hs-identifier">spaceText</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nlText</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TextDetails</span><span>
</span><a name="line-489"></a><span class="hs-identifier">spaceText</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Chr</span><span> </span><span class="hs-char">' '</span><span>
</span><a name="line-490"></a><a name="spaceText"><a href="Pretty.html#spaceText"><span class="hs-identifier">nlText</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#Chr"><span class="hs-identifier hs-var">Chr</span></a><span> </span><span class="hs-char">'\n'</span><span>
</span><a name="line-491"></a><span>
</span><a name="line-492"></a><span class="hs-identifier">int</span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-comment">-- ^ @int n = text (show n)@</span><span>
</span><a name="line-493"></a><span class="hs-identifier">integer</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Integer</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ @integer n = text (show n)@</span><span>
</span><a name="line-494"></a><span class="hs-identifier">float</span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Float</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ @float n = text (show n)@</span><span>
</span><a name="line-495"></a><span class="hs-identifier">double</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Double</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ @double n = text (show n)@</span><span>
</span><a name="line-496"></a><span class="hs-identifier">rational</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ @rational n = text (show n)@</span><span>
</span><a name="line-497"></a><span class="hs-identifier">int</span><span>      </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Real.html#Rational"><span class="hs-identifier hs-type">text</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">show</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-498"></a><span class="hs-identifier">integer</span><span>  </span><a name="local-1627463180"><a href="#local-1627463180"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-1627463180"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-499"></a><a name="integer"><a href="Pretty.html#integer"><span class="hs-identifier">float</span></a></a><span>    </span><a name="local-1627463181"><a href="#local-1627463181"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-1627463181"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-500"></a><span class="hs-identifier">double</span><span>   </span><a name="local-1627463182"><a href="#local-1627463182"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-1627463182"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-501"></a><span class="hs-identifier">rational</span><span> </span><a name="local-1627463183"><a href="#local-1627463183"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-1627463183"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-502"></a><span>
</span><a name="line-503"></a><span class="hs-identifier">parens</span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-comment">-- ^ Wrap document in @(...)@</span><span>
</span><a name="line-504"></a><span class="hs-identifier">brackets</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ Wrap document in @[...]@</span><span>
</span><a name="line-505"></a><span class="hs-identifier">braces</span><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ Wrap document in @{...}@</span><span>
</span><a name="line-506"></a><span class="hs-identifier">quotes</span><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ Wrap document in @\'...\'@</span><span>
</span><a name="line-507"></a><span class="hs-identifier">quote</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span>
</span><a name="line-508"></a><span class="hs-identifier">doubleQuotes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-comment">-- ^ Wrap document in @\&quot;...\&quot;@</span><span>
</span><a name="line-509"></a><span class="hs-identifier">quotes</span><span> </span><span class="hs-identifier">p</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">char</span><span> </span><span class="hs-char">'`'</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">char</span><span> </span><span class="hs-char">'\''</span><span>
</span><a name="line-510"></a><a name="quotes"><a href="Pretty.html#quotes"><span class="hs-identifier">quote</span></a></a><span> </span><span class="hs-identifier">p</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'\''</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-511"></a><span class="hs-identifier">doubleQuotes</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'&quot;'</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">char</span><span> </span><span class="hs-char">'&quot;'</span><span>
</span><a name="line-512"></a><a name="doubleQuotes"><a href="Pretty.html#doubleQuotes"><span class="hs-identifier">parens</span></a></a><span> </span><a name="doubleQuotes"><a href="Pretty.html#doubleQuotes"><span class="hs-identifier">p</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'('</span><span> </span><a href="Pretty.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="#local-1627463187"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Pretty.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">')'</span><span>
</span><a name="line-513"></a><span class="hs-identifier">brackets</span><span> </span><span class="hs-identifier">p</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'['</span><span> </span><a href="Pretty.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="#local-1627463188"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Pretty.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">']'</span><span>
</span><a name="line-514"></a><a name="brackets"><a href="Pretty.html#brackets"><span class="hs-identifier">braces</span></a></a><span> </span><a name="brackets"><a href="Pretty.html#brackets"><span class="hs-identifier">p</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'{'</span><span> </span><a href="Pretty.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="#local-1627463189"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Pretty.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Pretty.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'}'</span><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span class="hs-comment">-- | Apply 'parens' to 'Doc' if boolean is true.</span><span>
</span><a name="line-517"></a><span class="hs-identifier">maybeParens</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-518"></a><span class="hs-identifier">maybeParens</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">id</span><span>
</span><a name="line-519"></a><a name="maybeParens"><a href="Pretty.html#maybeParens"><span class="hs-identifier">maybeParens</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">parens</span><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-522"></a><span class="hs-comment">-- Structural operations on GDocs</span><span>
</span><a name="line-523"></a><span>
</span><a name="line-524"></a><span class="hs-comment">-- | Perform some simplification of a built up @GDoc@.</span><span>
</span><a name="line-525"></a><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-526"></a><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-identifier">p</span><span> </span><a href="Pretty.html#RDoc"><span class="hs-identifier hs-type">g</span></a><span> </span><a href="Pretty.html#RDoc"><span class="hs-identifier hs-type">q</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>
</span><a name="line-527"></a><a name="reduceDoc"><a href="Pretty.html#reduceDoc"><span class="hs-identifier">reduceDoc</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Beside"><span class="hs-identifier hs-var">Above</span></a><span>  </span><a name="local-1627463191"><a href="#local-1627463191"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627463192"><a href="#local-1627463192"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627463193"><a href="#local-1627463193"><span class="hs-identifier">q</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#beside"><span class="hs-identifier hs-var">above</span></a><span>  </span><a href="#local-1627463191"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627463192"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#reduceDoc"><span class="hs-identifier hs-var">reduceDoc</span></a><span> </span><a href="#local-1627463193"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span>
</span><a name="line-528"></a><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">p</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#above"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span class="hs-comment">-- | List version of '&lt;&gt;'.</span><span>
</span><a name="line-531"></a><span class="hs-identifier">hcat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-532"></a><span class="hs-identifier">hcat</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">reduceAB</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">beside_'</span><span> </span><span class="hs-identifier">False</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">empty</span><span>
</span><a name="line-533"></a><span>
</span><a name="line-534"></a><span class="hs-comment">-- | List version of '&lt;+&gt;'.</span><span>
</span><a name="line-535"></a><span class="hs-identifier">hsep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-536"></a><span class="hs-identifier">hsep</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">reduceAB</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">beside_'</span><span> </span><span class="hs-identifier">True</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">empty</span><span>
</span><a name="line-537"></a><span>
</span><a name="line-538"></a><span class="hs-comment">-- | List version of '$$'.</span><span>
</span><a name="line-539"></a><span class="hs-identifier">vcat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-540"></a><span class="hs-identifier">vcat</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">reduceAB</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">above_'</span><span> </span><span class="hs-identifier">False</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">empty</span><span>
</span><a name="line-541"></a><span>
</span><a name="line-542"></a><span class="hs-comment">-- | Nest (or indent) a document by a given number of positions</span><span>
</span><a name="line-543"></a><span class="hs-comment">-- (which may also be negative).  'nest' satisfies the laws:</span><span>
</span><a name="line-544"></a><span class="hs-comment">--</span><span>
</span><a name="line-545"></a><span class="hs-comment">-- * @'nest' 0 x = x@</span><span>
</span><a name="line-546"></a><span class="hs-comment">--</span><span>
</span><a name="line-547"></a><span class="hs-comment">-- * @'nest' k ('nest' k' x) = 'nest' (k+k') x@</span><span>
</span><a name="line-548"></a><span class="hs-comment">--</span><span>
</span><a name="line-549"></a><span class="hs-comment">-- * @'nest' k (x '&lt;&gt;' y) = 'nest' k z '&lt;&gt;' 'nest' k y@</span><span>
</span><a name="line-550"></a><span class="hs-comment">--</span><span>
</span><a name="line-551"></a><span class="hs-comment">-- * @'nest' k (x '$$' y) = 'nest' k x '$$' 'nest' k y@</span><span>
</span><a name="line-552"></a><span class="hs-comment">--</span><span>
</span><a name="line-553"></a><span class="hs-comment">-- * @'nest' k 'empty' = 'empty'@</span><span>
</span><a name="line-554"></a><span class="hs-comment">--</span><span>
</span><a name="line-555"></a><span class="hs-comment">-- * @x '&lt;&gt;' 'nest' k y = x '&lt;&gt;' y@, if @x@ non-empty</span><span>
</span><a name="line-556"></a><span class="hs-comment">--</span><span>
</span><a name="line-557"></a><span class="hs-comment">-- The side condition on the last law is needed because</span><span>
</span><a name="line-558"></a><span class="hs-comment">-- 'empty' is a left identity for '&lt;&gt;'.</span><span>
</span><a name="line-559"></a><span class="hs-identifier">nest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-560"></a><span class="hs-identifier">nest</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mkNest</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-561"></a><span>
</span><a name="line-562"></a><span class="hs-comment">-- | @hang d1 n d2 = sep [d1, nest n d2]@</span><span>
</span><a name="line-563"></a><span class="hs-identifier">hang</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-564"></a><span class="hs-identifier">hang</span><span> </span><span class="hs-identifier">d1</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-identifier">d2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">sep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">d1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nest</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-identifier">d2</span><span class="hs-special">]</span><span>
</span><a name="line-565"></a><span>
</span><a name="line-566"></a><span class="hs-comment">-- | Apply 'hang' to the arguments if the first 'Doc' is not empty.</span><span>
</span><a name="line-567"></a><span class="hs-identifier">hangNotEmpty</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-568"></a><span class="hs-identifier">hangNotEmpty</span><span> </span><span class="hs-identifier">d1</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-identifier">d2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">isEmpty</span><span> </span><span class="hs-identifier">d1</span><span>
</span><a name="line-569"></a><span>                       </span><span class="hs-keyword">then</span><span> </span><a href="Pretty.html#isEmpty"><span class="hs-identifier hs-var">d2</span></a><span>
</span><a name="line-570"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">hang</span><span> </span><span class="hs-identifier">d1</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">d2</span><span>
</span><a name="line-571"></a><span>
</span><a name="line-572"></a><span class="hs-comment">-- | @punctuate p [d1, ... dn] = [d1 \&lt;&gt; p, d2 \&lt;&gt; p, ... dn-1 \&lt;&gt; p, dn]@</span><span>
</span><a name="line-573"></a><span class="hs-identifier">punctuate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span>
</span><a name="line-574"></a><span class="hs-identifier">punctuate</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-575"></a><a name="punctuate"><a href="Pretty.html#punctuate"><span class="hs-identifier">punctuate</span></a></a><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">x</span><span class="hs-glyph">:</span><span class="hs-identifier">xs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">xs</span><span>
</span><a name="line-576"></a><span>                   </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">y</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">y</span><span class="hs-special">]</span><span>
</span><a name="line-577"></a><span>                         </span><a name="local-1627463209"><a href="#local-1627463209"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627463210"><a href="#local-1627463210"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">z</span><span class="hs-glyph">:</span><span class="hs-identifier">zs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627463210"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">z</span><span> </span><span class="hs-identifier">zs</span><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span class="hs-comment">-- mkNest checks for Nest's invariant that it doesn't have an Empty inside it</span><span>
</span><a name="line-580"></a><span class="hs-identifier">mkNest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-581"></a><span class="hs-identifier">mkNest</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-582"></a><a name="mkNest"><a href="Pretty.html#mkNest"><span class="hs-identifier">mkNest</span></a></a><span> </span><a name="local-1627463214"><a href="#local-1627463214"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Nest</span><span> </span><span class="hs-identifier hs-var">k1</span><span> </span><span class="hs-identifier hs-var">p</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Err.html#undefined"><span class="hs-identifier hs-var">mkNest</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Err.html#undefined"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">k1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-583"></a><span class="hs-identifier">mkNest</span><span> </span><a name="local-1627463215"><a href="#local-1627463215"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">NoDoc</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#mkNest"><span class="hs-identifier hs-var">NoDoc</span></a><span>
</span><a name="line-584"></a><span class="hs-identifier">mkNest</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">Empty</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-585"></a><span class="hs-identifier">mkNest</span><span> </span><span class="hs-number">0</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">p</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-586"></a><span class="hs-identifier">mkNest</span><span> </span><span class="hs-identifier">k</span><span> </span><a name="local-1627463218"><a href="#local-1627463218"><span class="hs-identifier">p</span></a></a><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nest_</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-587"></a><span>
</span><a name="line-588"></a><span class="hs-comment">-- mkUnion checks for an empty document</span><span>
</span><a name="line-589"></a><span class="hs-identifier">mkUnion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-590"></a><span class="hs-identifier">mkUnion</span><span> </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Empty</span><span>
</span><a name="line-591"></a><a name="mkUnion"><a href="Pretty.html#mkUnion"><span class="hs-identifier">mkUnion</span></a></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">q</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">union_</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-592"></a><span>
</span><a name="line-593"></a><span class="hs-identifier">beside_'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-594"></a><span class="hs-identifier">beside_'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">p</span></a><span>
</span><a name="line-595"></a><a name="beside_%27"><a href="Pretty.html#beside_%27"><span class="hs-identifier">beside_'</span></a></a><span> </span><span class="hs-identifier">g</span><span> </span><a name="local-1627463223"><a href="#local-1627463223"><span class="hs-identifier">p</span></a></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">q</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Beside</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-596"></a><span>
</span><a name="line-597"></a><span class="hs-identifier">above_'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-598"></a><span class="hs-identifier">above_'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">p</span></a><span>
</span><a name="line-599"></a><a name="above_%27"><a href="Pretty.html#above_%27"><span class="hs-identifier">above_'</span></a></a><span> </span><span class="hs-identifier">g</span><span> </span><a name="local-1627463227"><a href="#local-1627463227"><span class="hs-identifier">p</span></a></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">q</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Above</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-600"></a><span>
</span><a name="line-601"></a><span class="hs-identifier">reduceAB</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-602"></a><span class="hs-identifier">reduceAB</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Above</span><span>  </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-603"></a><a name="reduceAB"><a href="Pretty.html#reduceAB"><span class="hs-identifier">reduceAB</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627463231"><a href="#local-1627463231"><span class="hs-identifier">q</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463231"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-604"></a><span class="hs-identifier">reduceAB</span><span> </span><span class="hs-identifier">doc</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">doc</span><span>
</span><a name="line-605"></a><span>
</span><a name="line-606"></a><span class="hs-identifier">nilAbove_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-607"></a><span class="hs-identifier">nilAbove_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">NilAbove</span><span>
</span><a name="line-608"></a><span>
</span><a name="line-609"></a><span class="hs-comment">-- Arg of a TextBeside is always an RDoc</span><span>
</span><a name="line-610"></a><span class="hs-identifier">textBeside_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TextDetails</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-611"></a><span class="hs-identifier">textBeside_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TextBeside</span><span>
</span><a name="line-612"></a><span>
</span><a name="line-613"></a><span class="hs-identifier">nest_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-614"></a><span class="hs-identifier">nest_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Nest</span><span>
</span><a name="line-615"></a><span>
</span><a name="line-616"></a><span class="hs-identifier">union_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-617"></a><span class="hs-identifier">union_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Union</span><span>
</span><a name="line-618"></a><span>
</span><a name="line-619"></a><span>
</span><a name="line-620"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-621"></a><span class="hs-comment">-- Vertical composition @$$@</span><span>
</span><a name="line-622"></a><span>
</span><a name="line-623"></a><span class="hs-comment">-- | Above, except that if the last line of the first argument stops</span><span>
</span><a name="line-624"></a><span class="hs-comment">-- at least one position before the first line of the second begins,</span><span>
</span><a name="line-625"></a><span class="hs-comment">-- these two lines are overlapped.  For example:</span><span>
</span><a name="line-626"></a><span class="hs-comment">--</span><span>
</span><a name="line-627"></a><span class="hs-comment">-- &gt;    text &quot;hi&quot; $$ nest 5 (text &quot;there&quot;)</span><span>
</span><a name="line-628"></a><span class="hs-comment">--</span><span>
</span><a name="line-629"></a><span class="hs-comment">-- lays out as</span><span>
</span><a name="line-630"></a><span class="hs-comment">--</span><span>
</span><a name="line-631"></a><span class="hs-comment">-- &gt;    hi   there</span><span>
</span><a name="line-632"></a><span class="hs-comment">--</span><span>
</span><a name="line-633"></a><span class="hs-comment">-- rather than</span><span>
</span><a name="line-634"></a><span class="hs-comment">--</span><span>
</span><a name="line-635"></a><span class="hs-comment">-- &gt;    hi</span><span>
</span><a name="line-636"></a><span class="hs-comment">-- &gt;         there</span><span>
</span><a name="line-637"></a><span class="hs-comment">--</span><span>
</span><a name="line-638"></a><span class="hs-comment">-- '$$' is associative, with identity 'empty', and also satisfies</span><span>
</span><a name="line-639"></a><span class="hs-comment">--</span><span>
</span><a name="line-640"></a><span class="hs-comment">-- * @(x '$$' y) '&lt;&gt;' z = x '$$' (y '&lt;&gt;' z)@, if @y@ non-empty.</span><span>
</span><a name="line-641"></a><span class="hs-comment">--</span><span>
</span><a name="line-642"></a><span class="hs-special">(</span><span class="hs-operator">$$</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-643"></a><span class="hs-identifier">p</span><span> </span><span class="hs-operator">$$</span><span>  </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">above_</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-644"></a><span>
</span><a name="line-645"></a><span class="hs-comment">-- | Above, with no overlapping.</span><span>
</span><a name="line-646"></a><span class="hs-comment">-- '$+$' is associative, with identity 'empty'.</span><span>
</span><a name="line-647"></a><span class="hs-special">(</span><span class="hs-operator">$+$</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-648"></a><span class="hs-identifier">p</span><span> </span><span class="hs-operator">$+$</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">above_</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-identifier">True</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">q</span></a><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span class="hs-identifier">above_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-651"></a><span class="hs-identifier">above_</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">p</span><span>
</span><a name="line-652"></a><a name="above_"><a href="Pretty.html#above_"><span class="hs-identifier">above_</span></a></a><span> </span><span class="hs-identifier">Empty</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463238"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-653"></a><span class="hs-identifier">above_</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">q</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Above</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-654"></a><span>
</span><a name="line-655"></a><span class="hs-identifier">above</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-656"></a><span class="hs-identifier">above</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Above</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">g1</span><span> </span><span class="hs-identifier hs-type">q1</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">g2</span><span> </span><a href="Pretty.html#RDoc"><span class="hs-identifier hs-type">q2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">above</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">g1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">above</span><span> </span><span class="hs-identifier">q1</span><span> </span><span class="hs-identifier">g2</span><span> </span><span class="hs-identifier">q2</span><span class="hs-special">)</span><span>
</span><a name="line-657"></a><a name="above"><a href="Pretty.html#above"><span class="hs-identifier">above</span></a></a><span> </span><span class="hs-identifier">p</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><a name="local-1627463246"><a href="#local-1627463246"><span class="hs-identifier">g</span></a></a><span>  </span><a name="local-1627463247"><a href="#local-1627463247"><span class="hs-identifier">q</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><a href="#local-1627463246"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627463247"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>
</span><a name="line-658"></a><span class="hs-identifier">above</span><span> </span><a name="local-1627463248"><a href="#local-1627463248"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">g</span><span> </span><a href="Pretty.html#Beside"><span class="hs-identifier hs-var">q</span></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#aboveNest"><span class="hs-identifier hs-var">aboveNest</span></a><span> </span><span class="hs-identifier">p</span><span>             </span><a href="#local-1627463249"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#reduceDoc"><span class="hs-identifier hs-var">reduceDoc</span></a><span> </span><a href="#local-1627463250"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span>
</span><a name="line-659"></a><span>
</span><a name="line-660"></a><span class="hs-comment">-- Specfication: aboveNest p g k q = p $g$ (nest k q)</span><span>
</span><a name="line-661"></a><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-662"></a><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-identifier hs-type">_</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Pretty.html#RDoc"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-663"></a><a name="aboveNest"><a href="Pretty.html#aboveNest"><span class="hs-identifier">aboveNest</span></a></a><span> </span><span class="hs-identifier">NoDoc</span><span>               </span><span class="hs-identifier">_</span><span> </span><a name="local-1627463254"><a href="#local-1627463254"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">NoDoc</span><span>
</span><a name="line-664"></a><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">Union</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">p2</span><span class="hs-special">)</span><span>     </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-identifier">p1</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">union_</span><span class="hs-special">`</span><span>
</span><a name="line-665"></a><span>                                      </span><a href="Pretty.html#aboveNest"><span class="hs-identifier hs-var">aboveNest</span></a><span> </span><a href="#local-1627463255"><span class="hs-identifier hs-var">p2</span></a><span> </span><a href="#local-1627463257"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627463258"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1627463259"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-identifier">Empty</span><span>               </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mkNest</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-668"></a><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">Nest</span></a><span> </span><span class="hs-identifier">k1</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>         </span><span class="hs-identifier">g</span><span> </span><a name="local-1627463260"><a href="#local-1627463260"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627463261"><a href="#local-1627463261"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#mkNest"><span class="hs-identifier hs-var">nest_</span></a><span> </span><span class="hs-identifier">k1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">k1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>
</span><a name="line-669"></a><span>                                  </span><span class="hs-comment">-- p can't be Empty, so no need for mkNest</span><span>
</span><a name="line-670"></a><span>
</span><a name="line-671"></a><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>        </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nilAbove_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>
</span><a name="line-672"></a><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><a name="local-1627463268"><a href="#local-1627463268"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627463269"><a href="#local-1627463269"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627463270"><a href="#local-1627463270"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><a href="Pretty.html#aboveNest"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="Pretty.html#aboveNest"><span class="hs-identifier hs-var">sl</span></a><span> </span><span class="hs-identifier">rest</span><span>
</span><a name="line-673"></a><span>                                    </span><span class="hs-keyword">where</span><span>
</span><a name="line-674"></a><span>                                      </span><span class="hs-glyph">!</span><span class="hs-identifier">k1</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">sl</span><span>
</span><a name="line-675"></a><span>                                      </span><span class="hs-identifier">rest</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627463272"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-676"></a><span>                                                </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">nilAboveNest</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">k1</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-677"></a><span>                                                </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">_</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#nilAboveNest"><span class="hs-identifier hs-var">aboveNest</span></a><span>  </span><a href="Pretty.html#nilAboveNest"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627463274"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627463277"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-1627463276"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-678"></a><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Above</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;aboveNest Above&quot;</span><span>
</span><a name="line-679"></a><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;aboveNest Beside&quot;</span><span>
</span><a name="line-680"></a><span>
</span><a name="line-681"></a><span class="hs-comment">-- Specification: text s &lt;&gt; nilaboveNest g k q</span><span>
</span><a name="line-682"></a><span class="hs-comment">--              = text s &lt;&gt; (text &quot;&quot; $g$ nest k q)</span><span>
</span><a name="line-683"></a><span class="hs-identifier">nilAboveNest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-684"></a><span class="hs-identifier">nilAboveNest</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier hs-type">_</span><span>           </span><span class="hs-glyph">|</span><span> </span><a href="Pretty.html#RDoc"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-685"></a><a name="nilAboveNest"><a href="Pretty.html#nilAboveNest"><span class="hs-identifier">nilAboveNest</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627463279"><a href="#local-1627463279"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">Empty</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Empty</span><span>
</span><a name="line-686"></a><span>                               </span><span class="hs-comment">-- Here's why the &quot;text s &lt;&gt;&quot; is in the spec!</span><span>
</span><a name="line-687"></a><span class="hs-identifier">nilAboveNest</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Nest</span><span> </span><span class="hs-identifier">k1</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nilAboveNest</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">k</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">k1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-688"></a><span class="hs-identifier">nilAboveNest</span><span> </span><a name="local-1627463280"><a href="#local-1627463280"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627463281"><a href="#local-1627463281"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">q</span><span>           </span><span class="hs-glyph">|</span><span> </span><a href="Pretty.html#nilAboveNest"><span class="hs-identifier hs-var">not</span></a><span> </span><a href="Pretty.html#nilAboveNest"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="Pretty.html#nilAboveNest"><span class="hs-operator hs-var">&amp;&amp;</span></a><span> </span><a href="Pretty.html#nilAboveNest"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="Pretty.html#nilAboveNest"><span class="hs-operator hs-var">&gt;</span></a><span> </span><span class="hs-number">0</span><span>      </span><span class="hs-comment">-- No newline if no overlap</span><span>
</span><a name="line-689"></a><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Str</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">spaces</span><span> </span><span class="hs-identifier">k</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-690"></a><span>                             </span><span class="hs-glyph">|</span><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">otherwise</span></a><span>           </span><span class="hs-comment">-- Put them really above</span><span>
</span><a name="line-691"></a><span>                             </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">nilAbove_</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkNest</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>
</span><a name="line-692"></a><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-695"></a><span class="hs-comment">-- Horizontal composition @&lt;&gt;@</span><span>
</span><a name="line-696"></a><span>
</span><a name="line-697"></a><span class="hs-comment">-- We intentionally avoid Data.Monoid.(&lt;&gt;) here due to interactions of</span><span>
</span><a name="line-698"></a><span class="hs-comment">-- Data.Monoid.(&lt;&gt;) and (&lt;+&gt;).  See</span><span>
</span><a name="line-699"></a><span class="hs-comment">-- http://www.haskell.org/pipermail/libraries/2011-November/017066.html</span><span>
</span><a name="line-700"></a><span>
</span><a name="line-701"></a><span class="hs-comment">-- | Beside.</span><span>
</span><a name="line-702"></a><span class="hs-comment">-- '&lt;&gt;' is associative, with identity 'empty'.</span><span>
</span><a name="line-703"></a><span class="hs-special">(</span><span class="hs-operator">&lt;&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-704"></a><span class="hs-identifier">p</span><span> </span><span class="hs-operator">&lt;&gt;</span><span>  </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">beside_</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-705"></a><span>
</span><a name="line-706"></a><span class="hs-comment">-- | Beside, separated by space, unless one of the arguments is 'empty'.</span><span>
</span><a name="line-707"></a><span class="hs-comment">-- '&lt;+&gt;' is associative, with identity 'empty'.</span><span>
</span><a name="line-708"></a><span class="hs-special">(</span><span class="hs-operator">&lt;+&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-709"></a><span class="hs-identifier">p</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">beside_</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-identifier">True</span><span>  </span><span class="hs-identifier">q</span><span>
</span><a name="line-710"></a><span>
</span><a name="line-711"></a><span class="hs-identifier">beside_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-712"></a><span class="hs-identifier">beside_</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">p</span><span>
</span><a name="line-713"></a><a name="beside_"><a href="Pretty.html#beside_"><span class="hs-identifier">beside_</span></a></a><span> </span><span class="hs-identifier">Empty</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463291"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-714"></a><span class="hs-identifier">beside_</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">q</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Beside</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-715"></a><span>
</span><a name="line-716"></a><span class="hs-comment">-- Specification: beside g p q = p &lt;g&gt; q</span><span>
</span><a name="line-717"></a><span class="hs-identifier">beside</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-718"></a><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">NoDoc</span><span>               </span><a href="Pretty.html#RDoc"><span class="hs-identifier hs-type">_</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">NoDoc</span><span>
</span><a name="line-719"></a><a name="beside"><a href="Pretty.html#beside"><span class="hs-identifier">beside</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">Union</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">p2</span><span class="hs-special">)</span><span>     </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">p1</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">union_</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">p2</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-720"></a><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">Empty</span><span>               </span><a name="local-1627463298"><a href="#local-1627463298"><span class="hs-identifier">_</span></a></a><span> </span><a name="local-1627463299"><a href="#local-1627463299"><span class="hs-identifier">q</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#beside"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-721"></a><span class="hs-identifier">beside</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">Nest</span></a><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>          </span><span class="hs-identifier">g</span><span> </span><a name="local-1627463300"><a href="#local-1627463300"><span class="hs-identifier">q</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nest_</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-722"></a><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">p</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-identifier">p1</span><span> </span><span class="hs-identifier">g1</span><span> </span><span class="hs-identifier">q1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">g2</span><span> </span><span class="hs-identifier">q2</span><span>
</span><a name="line-723"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="Pretty.html#Beside"><span class="hs-identifier hs-var">g1</span></a><span> </span><a href="Pretty.html#Beside"><span class="hs-operator hs-var">==</span></a><span> </span><a name="local-1627463306"><a href="#local-1627463306"><span class="hs-identifier">g2</span></a></a><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">p1</span><span> </span><span class="hs-identifier">g1</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">q1</span><span> </span><span class="hs-identifier">g2</span><span> </span><span class="hs-identifier">q2</span><span>
</span><a name="line-724"></a><span>         </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#beside"><span class="hs-identifier hs-var">beside</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><a href="Pretty.html#beside"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">g2</span><span> </span><span class="hs-identifier">q2</span><span>
</span><a name="line-725"></a><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">p</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">Above</span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a href="Pretty.html#beside"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-726"></a><span class="hs-identifier">beside</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>        </span><a name="local-1627463312"><a href="#local-1627463312"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627463313"><a href="#local-1627463313"><span class="hs-identifier">q</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nilAbove_</span><span> </span><a href="Pretty.html#reduceDoc"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-identifier">beside</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">g</span><span> </span><a href="Pretty.html#beside"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-727"></a><span class="hs-identifier">beside</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><a name="local-1627463316"><a href="#local-1627463316"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627463317"><a href="#local-1627463317"><span class="hs-identifier">q</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><span class="hs-identifier">s</span><span> </span><a href="Pretty.html#beside"><span class="hs-identifier hs-var">sl</span></a><span> </span><a href="Pretty.html#beside"><span class="hs-operator hs-var">$!</span></a><span> </span><span class="hs-identifier">rest</span><span>
</span><a name="line-728"></a><span>                               </span><span class="hs-keyword">where</span><span>
</span><a name="line-729"></a><span>                                  </span><span class="hs-identifier">rest</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-730"></a><span>                                           </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">nilBeside</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-731"></a><span>                                           </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">_</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#nilBeside"><span class="hs-identifier hs-var">beside</span></a><span> </span><a href="Pretty.html#nilBeside"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">q</span><span>
</span><a name="line-732"></a><span>
</span><a name="line-733"></a><span class="hs-comment">-- Specification: text &quot;&quot; &lt;&gt; nilBeside g p</span><span>
</span><a name="line-734"></a><span class="hs-comment">--              = text &quot;&quot; &lt;g&gt; p</span><span>
</span><a name="line-735"></a><span class="hs-identifier">nilBeside</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-736"></a><span class="hs-identifier">nilBeside</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">Empty</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-comment">-- Hence the text &quot;&quot; in the spec</span><span>
</span><a name="line-737"></a><a name="nilBeside"><a href="Pretty.html#nilBeside"><span class="hs-identifier">nilBeside</span></a></a><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">Nest</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nilBeside</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-738"></a><span class="hs-identifier">nilBeside</span><span> </span><a name="local-1627463324"><a href="#local-1627463324"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Pretty.html#Nest"><span class="hs-identifier hs-var">g</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><span class="hs-identifier">spaceText</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-739"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-740"></a><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-743"></a><span class="hs-comment">-- Separate, @sep@</span><span>
</span><a name="line-744"></a><span>
</span><a name="line-745"></a><span class="hs-comment">-- Specification: sep ps  = oneLiner (hsep ps)</span><span>
</span><a name="line-746"></a><span class="hs-comment">--                         `union`</span><span>
</span><a name="line-747"></a><span class="hs-comment">--                          vcat ps</span><span>
</span><a name="line-748"></a><span>
</span><a name="line-749"></a><span class="hs-comment">-- | Either 'hsep' or 'vcat'.</span><span>
</span><a name="line-750"></a><span class="hs-identifier">sep</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-751"></a><span class="hs-identifier">sep</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sepX</span><span> </span><span class="hs-identifier">True</span><span>   </span><span class="hs-comment">-- Separate with spaces</span><span>
</span><a name="line-752"></a><span>
</span><a name="line-753"></a><span class="hs-comment">-- | Either 'hcat' or 'vcat'.</span><span>
</span><a name="line-754"></a><span class="hs-identifier">cat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-755"></a><span class="hs-identifier">cat</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sepX</span><span> </span><span class="hs-identifier">False</span><span>  </span><span class="hs-comment">-- Don't</span><span>
</span><a name="line-756"></a><span>
</span><a name="line-757"></a><span class="hs-identifier">sepX</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-758"></a><span class="hs-identifier">sepX</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">empty</span><span>
</span><a name="line-759"></a><a name="sepX"><a href="Pretty.html#sepX"><span class="hs-identifier">sepX</span></a></a><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">p</span><span class="hs-glyph">:</span><span class="hs-identifier">ps</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#empty"><span class="hs-identifier hs-var">sep1</span></a><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">ps</span><span>
</span><a name="line-760"></a><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span class="hs-comment">-- Specification: sep1 g k ys = sep (x : map (nest k) ys)</span><span>
</span><a name="line-763"></a><span class="hs-comment">--                            = oneLiner (x &lt;g&gt; nest k (hsep ys))</span><span>
</span><a name="line-764"></a><span class="hs-comment">--                              `union` x $$ nest k (vcat ys)</span><span>
</span><a name="line-765"></a><span class="hs-identifier">sep1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-766"></a><span class="hs-identifier">sep1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-767"></a><a name="sep1"><a href="Pretty.html#sep1"><span class="hs-identifier">sep1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">NoDoc</span><span>               </span><a name="local-1627463331"><a href="#local-1627463331"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">NoDoc</span><span>
</span><a name="line-768"></a><span class="hs-identifier">sep1</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">Union</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>       </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">ys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">sep1</span></a><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">ys</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">union_</span><span class="hs-special">`</span><span>
</span><a name="line-769"></a><span>                                  </span><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-identifier">False</span><span> </span><a href="Pretty.html#union_"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">vcat</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-770"></a><span>
</span><a name="line-771"></a><span class="hs-identifier">sep1</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">Empty</span><span>               </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">ys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mkNest</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sepX</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span>
</span><a name="line-772"></a><span class="hs-identifier">sep1</span><span> </span><a name="local-1627463337"><a href="#local-1627463337"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">Nest</span></a><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>          </span><a name="local-1627463338"><a href="#local-1627463338"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627463339"><a href="#local-1627463339"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#mkNest"><span class="hs-identifier hs-var">nest_</span></a><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sep1</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span>
</span><a name="line-773"></a><span>
</span><a name="line-774"></a><span class="hs-identifier">sep1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>        </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">ys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nilAbove_</span><span>
</span><a name="line-775"></a><span>                                  </span><span class="hs-special">(</span><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">vcat</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-776"></a><span class="hs-identifier">sep1</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">ys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier hs-var">sl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sepNB</span><span> </span><a href="Pretty.html#reduceDoc"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="Pretty.html#reduceDoc"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#reduceDoc"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="Pretty.html#vcat"><span class="hs-identifier hs-var">sl</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span class="hs-identifier">sep1</span><span> </span><a name="local-1627463348"><a href="#local-1627463348"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">Above</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><a name="local-1627463352"><a href="#local-1627463352"><span class="hs-identifier">_</span></a></a><span> </span><a name="local-1627463353"><a href="#local-1627463353"><span class="hs-identifier">_</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;sep1 Above&quot;</span><span>
</span><a name="line-778"></a><span class="hs-identifier">sep1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;sep1 Beside&quot;</span><span>
</span><a name="line-779"></a><span>
</span><a name="line-780"></a><span class="hs-comment">-- Specification: sepNB p k ys = sep1 (text &quot;&quot; &lt;&gt; p) k ys</span><span>
</span><a name="line-781"></a><span class="hs-comment">-- Called when we have already found some text in the first item</span><span>
</span><a name="line-782"></a><span class="hs-comment">-- We have to eat up nests</span><span>
</span><a name="line-783"></a><span class="hs-identifier">sepNB</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-784"></a><span class="hs-identifier">sepNB</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Nest</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-785"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sepNB</span><span> </span><a href="Pretty.html#Nest"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="Pretty.html#Nest"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">ys</span><span> </span><span class="hs-comment">-- Never triggered, because of invariant (2)</span><span>
</span><a name="line-786"></a><span class="hs-identifier">sepNB</span><span> </span><a href="Pretty.html#sepNB"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-identifier">Empty</span><span> </span><a href="#local-1627463356"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1627463357"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-787"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">oneLiner</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nilBeside</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">rest</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mkUnion</span><span class="hs-special">`</span><span>
</span><a name="line-788"></a><span>    </span><span class="hs-comment">-- XXX: TODO: PRETTY: Used to use True here (but GHC used False...)</span><span>
</span><a name="line-789"></a><span>    </span><span class="hs-identifier">nilAboveNest</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">vcat</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-790"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-791"></a><span>    </span><span class="hs-identifier">rest</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">g</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsep</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-792"></a><span>         </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#hsep"><span class="hs-identifier hs-var">hcat</span></a><span> </span><a href="#local-1627463360"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-793"></a><span class="hs-identifier">sepNB</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">k</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-794"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sep1</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">p</span><span> </span><a name="local-1627463365"><a href="#local-1627463365"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-795"></a><span>
</span><a name="line-796"></a><span>
</span><a name="line-797"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-798"></a><span class="hs-comment">-- @fill@</span><span>
</span><a name="line-799"></a><span>
</span><a name="line-800"></a><span class="hs-comment">-- | \&quot;Paragraph fill\&quot; version of 'cat'.</span><span>
</span><a name="line-801"></a><span class="hs-identifier">fcat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-802"></a><span class="hs-identifier">fcat</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fill</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-803"></a><span>
</span><a name="line-804"></a><span class="hs-comment">-- | \&quot;Paragraph fill\&quot; version of 'sep'.</span><span>
</span><a name="line-805"></a><span class="hs-identifier">fsep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-806"></a><span class="hs-identifier">fsep</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fill</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span class="hs-comment">-- Specification:</span><span>
</span><a name="line-809"></a><span class="hs-comment">--</span><span>
</span><a name="line-810"></a><span class="hs-comment">-- fill g docs = fillIndent 0 docs</span><span>
</span><a name="line-811"></a><span class="hs-comment">--</span><span>
</span><a name="line-812"></a><span class="hs-comment">-- fillIndent k [] = []</span><span>
</span><a name="line-813"></a><span class="hs-comment">-- fillIndent k [p] = p</span><span>
</span><a name="line-814"></a><span class="hs-comment">-- fillIndent k (p1:p2:ps) =</span><span>
</span><a name="line-815"></a><span class="hs-comment">--    oneLiner p1 &lt;g&gt; fillIndent (k + length p1 + g ? 1 : 0)</span><span>
</span><a name="line-816"></a><span class="hs-comment">--                               (remove_nests (oneLiner p2) : ps)</span><span>
</span><a name="line-817"></a><span class="hs-comment">--     `Union`</span><span>
</span><a name="line-818"></a><span class="hs-comment">--    (p1 $*$ nest (-k) (fillIndent 0 ps))</span><span>
</span><a name="line-819"></a><span class="hs-comment">--</span><span>
</span><a name="line-820"></a><span class="hs-comment">-- $*$ is defined for layouts (not Docs) as</span><span>
</span><a name="line-821"></a><span class="hs-comment">-- layout1 $*$ layout2 | hasMoreThanOneLine layout1 = layout1 $$ layout2</span><span>
</span><a name="line-822"></a><span class="hs-comment">--                     | otherwise                  = layout1 $+$ layout2</span><span>
</span><a name="line-823"></a><span>
</span><a name="line-824"></a><span class="hs-identifier">fill</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-825"></a><span class="hs-identifier">fill</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">empty</span><span>
</span><a name="line-826"></a><a name="fill"><a href="Pretty.html#fill"><span class="hs-identifier">fill</span></a></a><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">p</span><span class="hs-glyph">:</span><span class="hs-identifier">ps</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#empty"><span class="hs-identifier hs-var">fill1</span></a><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">ps</span><span>
</span><a name="line-827"></a><span>
</span><a name="line-828"></a><span class="hs-identifier">fill1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-829"></a><span class="hs-identifier">fill1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-830"></a><a name="fill1"><a href="Pretty.html#fill1"><span class="hs-identifier">fill1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">NoDoc</span><span>               </span><a name="local-1627463369"><a href="#local-1627463369"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">NoDoc</span><span>
</span><a name="line-831"></a><span class="hs-identifier">fill1</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">Union</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>       </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">ys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">fill1</span></a><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">ys</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">union_</span><span class="hs-special">`</span><span>
</span><a name="line-832"></a><span>                                   </span><span class="hs-identifier">aboveNest</span><span> </span><a href="#local-1627463373"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-identifier">False</span><span> </span><a href="Pretty.html#union_"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">fill</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span>
</span><a name="line-833"></a><span class="hs-identifier">fill1</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">Empty</span><span>               </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">ys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#aboveNest"><span class="hs-identifier hs-var">mkNest</span></a><span> </span><a href="Pretty.html#aboveNest"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">fill</span><span> </span><span class="hs-identifier hs-var">g</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span>
</span><a name="line-834"></a><span class="hs-identifier">fill1</span><span> </span><a name="local-1627463375"><a href="#local-1627463375"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">Nest</span></a><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>          </span><a name="local-1627463376"><a href="#local-1627463376"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627463377"><a href="#local-1627463377"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#mkNest"><span class="hs-identifier hs-var">nest_</span></a><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fill1</span><span> </span><a href="#local-1627463375"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627463377"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span>
</span><a name="line-835"></a><span class="hs-identifier">fill1</span><span> </span><a name="local-1627463378"><a href="#local-1627463378"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>        </span><a name="local-1627463381"><a href="#local-1627463381"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627463382"><a href="#local-1627463382"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nilAbove_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">aboveNest</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fill</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-836"></a><span class="hs-identifier">fill1</span><span> </span><a name="local-1627463383"><a href="#local-1627463383"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><a name="local-1627463385"><a href="#local-1627463385"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627463386"><a href="#local-1627463386"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><a href="Pretty.html#aboveNest"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="Pretty.html#aboveNest"><span class="hs-identifier hs-var">sl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">fillNB</span><span> </span><span class="hs-identifier hs-var">g</span><span> </span><span class="hs-identifier hs-var">p</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">-</span><span> </span><a href="Pretty.html#fill"><span class="hs-identifier hs-var">sl</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span>
</span><a name="line-837"></a><span class="hs-identifier">fill1</span><span> </span><a name="local-1627463387"><a href="#local-1627463387"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">Above</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><a name="local-1627463391"><a href="#local-1627463391"><span class="hs-identifier">_</span></a></a><span> </span><a name="local-1627463392"><a href="#local-1627463392"><span class="hs-identifier">_</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;fill1 Above&quot;</span><span>
</span><a name="line-838"></a><span class="hs-identifier">fill1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;fill1 Beside&quot;</span><span>
</span><a name="line-839"></a><span>
</span><a name="line-840"></a><span class="hs-identifier">fillNB</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-841"></a><span class="hs-identifier">fillNB</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>           </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-842"></a><a name="fillNB"><a href="Pretty.html#fillNB"><span class="hs-identifier">fillNB</span></a></a><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Nest</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>  </span><a name="local-1627463393"><a href="#local-1627463393"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">ys</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fillNB</span><span> </span><span class="hs-identifier hs-var">g</span><span> </span><span class="hs-identifier hs-var">p</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-843"></a><span>                              </span><span class="hs-comment">-- Never triggered, because of invariant (2)</span><span>
</span><a name="line-844"></a><span class="hs-identifier">fillNB</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Empty</span><span>
</span><a name="line-845"></a><span class="hs-identifier">fillNB</span><span> </span><span class="hs-identifier">g</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Empty</span><span class="hs-glyph">:</span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fillNB</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">Empty</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-846"></a><span class="hs-identifier">fillNB</span><span> </span><a name="local-1627463398"><a href="#local-1627463398"><span class="hs-identifier">g</span></a></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">Empty</span></a><span> </span><a name="local-1627463399"><a href="#local-1627463399"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">:</span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fillNBE</span><span> </span><span class="hs-identifier">g</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-847"></a><span class="hs-identifier">fillNB</span><span> </span><a name="local-1627463401"><a href="#local-1627463401"><span class="hs-identifier">g</span></a></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-identifier">ys</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#fillNBE"><span class="hs-identifier hs-var">fill1</span></a><span> </span><a href="Pretty.html#fillNBE"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627463401"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627463402"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-848"></a><span>
</span><a name="line-849"></a><span>
</span><a name="line-850"></a><span class="hs-identifier">fillNBE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Doc</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-851"></a><span class="hs-identifier">fillNBE</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier hs-type">y</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-852"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nilBeside</span><span> </span><a name="local-1627463412"><a href="#local-1627463412"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">fill1</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">elideNest</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">oneLiner</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">reduceDoc</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">y</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">k'</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span>
</span><a name="line-853"></a><span>    </span><span class="hs-comment">-- XXX: TODO: PRETTY: Used to use True here (but GHC used False...)</span><span>
</span><a name="line-854"></a><span>    </span><span class="hs-special">`</span><span class="hs-identifier">mkUnion</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">nilAboveNest</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fill</span><span> </span><span class="hs-identifier">g</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">y</span><span class="hs-glyph">:</span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-855"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a href="Pretty.html#mkUnion"><span class="hs-identifier hs-var">k'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Pretty.html#nilAboveNest"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Pretty.html#nilAboveNest"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">k</span><span>
</span><a name="line-856"></a><span>
</span><a name="line-857"></a><span class="hs-identifier">elideNest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-858"></a><span class="hs-identifier">elideNest</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Nest</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">d</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">d</span><span>
</span><a name="line-859"></a><a name="elideNest"><a href="Pretty.html#elideNest"><span class="hs-identifier">elideNest</span></a></a><span> </span><span class="hs-identifier">d</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463414"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-860"></a><span>
</span><a name="line-861"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-862"></a><span class="hs-comment">-- Selecting the best layout</span><span>
</span><a name="line-863"></a><span>
</span><a name="line-864"></a><span class="hs-identifier">best</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span>   </span><span class="hs-comment">-- Line length</span><span>
</span><a name="line-865"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>   </span><span class="hs-comment">-- Ribbon length</span><span>
</span><a name="line-866"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">RDoc</span><span>
</span><a name="line-867"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#RDoc"><span class="hs-identifier hs-type">RDoc</span></a><span>  </span><span class="hs-comment">-- No unions in here!</span><span>
</span><a name="line-868"></a><span class="hs-identifier">best</span><span> </span><span class="hs-identifier">w0</span><span> </span><a href="Pretty.html#RDoc"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">get</span><span> </span><span class="hs-identifier">w0</span><span>
</span><a name="line-869"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-870"></a><span>    </span><span class="hs-identifier">get</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span>          </span><span class="hs-comment">-- (Remaining) width of line</span><span>
</span><a name="line-871"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-872"></a><span>    </span><span class="hs-identifier">get</span><span> </span><span class="hs-identifier">w</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">w</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-873"></a><span>    </span><a name="local-1627463418"><a href="#local-1627463418"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-1627463420"><a href="#local-1627463420"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">Empty</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Err.html#undefined"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-874"></a><span>    </span><span class="hs-identifier">get</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">NoDoc</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">NoDoc</span></a><span>
</span><a name="line-875"></a><span>    </span><span class="hs-identifier">get</span><span> </span><span class="hs-identifier">w</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nilAbove_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">get</span><span> </span><span class="hs-identifier">w</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-876"></a><span>    </span><span class="hs-identifier">get</span><span> </span><a name="local-1627463421"><a href="#local-1627463421"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><a href="#local-1627463418"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">get1</span><span> </span><span class="hs-identifier">w</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-877"></a><span>    </span><span class="hs-identifier">get</span><span> </span><a name="local-1627463423"><a href="#local-1627463423"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">Nest</span></a><span> </span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">nest_</span></a><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">get</span><span> </span><span class="hs-special">(</span><a href="#local-1627463425"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-1627463419"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627463419"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-878"></a><span>    </span><span class="hs-identifier">get</span><span> </span><a name="local-1627463427"><a href="#local-1627463427"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Nest"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">Union</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nicest</span><span> </span><span class="hs-identifier">w</span><span> </span><a href="#local-1627463418"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">get</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Num.html#-"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-1627463428"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">get</span><span> </span><span class="hs-identifier">w</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>
</span><a name="line-879"></a><span>    </span><span class="hs-identifier">get</span><span> </span><a name="local-1627463430"><a href="#local-1627463430"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Above</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#nicest"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;best get Above&quot;</span><span>
</span><a name="line-880"></a><span>    </span><span class="hs-identifier">get</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;best get Beside&quot;</span><span>
</span><a name="line-881"></a><span>
</span><a name="line-882"></a><span>    </span><span class="hs-identifier">get1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span>         </span><span class="hs-comment">-- (Remaining) width of line</span><span>
</span><a name="line-883"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>         </span><span class="hs-comment">-- Amount of first line already eaten up</span><span>
</span><a name="line-884"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Doc</span><span>         </span><span class="hs-comment">-- This is an argument to TextBeside =&gt; eat Nests</span><span>
</span><a name="line-885"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span>         </span><span class="hs-comment">-- No unions in here!</span><span>
</span><a name="line-886"></a><span>
</span><a name="line-887"></a><span>    </span><span class="hs-identifier">get1</span><span> </span><span class="hs-identifier">w</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">w</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">False</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-888"></a><span>    </span><a name="local-1627463419"><a href="#local-1627463419"><span class="hs-identifier">get1</span></a></a><span> </span><a name="local-1627463433"><a href="#local-1627463433"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">Empty</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Err.html#undefined"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-889"></a><span>    </span><span class="hs-identifier">get1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">NoDoc</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">NoDoc</span></a><span>
</span><a name="line-890"></a><span>    </span><span class="hs-identifier">get1</span><span> </span><span class="hs-identifier">w</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nilAbove_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">get</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">w</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">sl</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-891"></a><span>    </span><span class="hs-identifier">get1</span><span> </span><a name="local-1627463434"><a href="#local-1627463434"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-1627463435"><a href="#local-1627463435"><span class="hs-identifier">sl</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">t</span><span> </span><span class="hs-identifier">tl</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><a href="#local-1627463418"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-identifier">tl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">get1</span><span> </span><span class="hs-identifier">w</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sl</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">tl</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-892"></a><span>    </span><span class="hs-identifier">get1</span><span> </span><a name="local-1627463437"><a href="#local-1627463437"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-1627463438"><a href="#local-1627463438"><span class="hs-identifier">sl</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">Nest</span></a><span> </span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">get1</span></a><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">sl</span></a><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-893"></a><span>    </span><span class="hs-identifier">get1</span><span> </span><a name="local-1627463442"><a href="#local-1627463442"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-1627463443"><a href="#local-1627463443"><span class="hs-identifier">sl</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Nest"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">Union</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nicest1</span><span> </span><a href="#local-1627463443"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-1627463444"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">get1</span><span> </span><span class="hs-identifier">w</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-894"></a><span>                                                   </span><span class="hs-special">(</span><a href="#local-1627463419"><span class="hs-identifier hs-var">get1</span></a><span> </span><a href="#local-1627463445"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-1627463446"><span class="hs-identifier hs-var">sl</span></a><span> </span><a href="#local-1627463447"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span>
</span><a name="line-895"></a><span>    </span><span class="hs-identifier">get1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">Above</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;best get1 Above&quot;</span><span>
</span><a name="line-896"></a><span>    </span><span class="hs-identifier">get1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;best get1 Beside&quot;</span><span>
</span><a name="line-897"></a><span>
</span><a name="line-898"></a><span class="hs-identifier">nicest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-899"></a><span class="hs-identifier">nicest</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">w</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">r</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nicest1</span><span> </span><span class="hs-identifier">w</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-900"></a><span>
</span><a name="line-901"></a><span class="hs-identifier">nicest1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-902"></a><span class="hs-identifier">nicest1</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">w</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">r</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier hs-type">p</span><span> </span><span class="hs-identifier hs-type">q</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">fits</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">w</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">min</span><span class="hs-special">`</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">sl</span><span class="hs-special">)</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-903"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463454"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-904"></a><span>
</span><a name="line-905"></a><span class="hs-identifier">fits</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span>  </span><span class="hs-comment">-- Space available</span><span>
</span><a name="line-906"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Doc</span><span>
</span><a name="line-907"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-comment">-- True if *first line* of Doc fits in space available</span><span>
</span><a name="line-908"></a><span class="hs-identifier">fits</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-type">n</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-number">0</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-909"></a><a name="fits"><a href="Pretty.html#fits"><span class="hs-identifier">fits</span></a></a><span> </span><a name="local-1627463456"><a href="#local-1627463456"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">NoDoc</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-910"></a><span class="hs-identifier">fits</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">Empty</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-911"></a><span class="hs-identifier">fits</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-912"></a><span class="hs-identifier">fits</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fits</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">sl</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-913"></a><span class="hs-identifier">fits</span><span> </span><a name="local-1627463457"><a href="#local-1627463457"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">Above</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;fits Above&quot;</span><span>
</span><a name="line-914"></a><span class="hs-identifier">fits</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;fits Beside&quot;</span><span>
</span><a name="line-915"></a><span class="hs-identifier">fits</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#Beside"><span class="hs-identifier hs-var">Union</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;fits Union&quot;</span><span>
</span><a name="line-916"></a><span class="hs-identifier">fits</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#Union"><span class="hs-identifier hs-var">Nest</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;fits Nest&quot;</span><span>
</span><a name="line-917"></a><span>
</span><a name="line-918"></a><span class="hs-comment">-- | @first@ returns its first argument if it is non-empty, otherwise its second.</span><span>
</span><a name="line-919"></a><span class="hs-identifier">first</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-920"></a><span class="hs-identifier">first</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">nonEmptySet</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-comment">-- unused, because (get OneLineMode) is unused</span><span>
</span><a name="line-921"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="Pretty.html#nonEmptySet"><span class="hs-identifier hs-var">otherwise</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463460"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-922"></a><span>
</span><a name="line-923"></a><span class="hs-identifier">nonEmptySet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-924"></a><span class="hs-identifier">nonEmptySet</span><span> </span><span class="hs-identifier">NoDoc</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-925"></a><a name="nonEmptySet"><a href="Pretty.html#nonEmptySet"><span class="hs-identifier">nonEmptySet</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">Union</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-926"></a><span class="hs-identifier">nonEmptySet</span><span> </span><span class="hs-identifier">Empty</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-927"></a><span class="hs-identifier">nonEmptySet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-928"></a><span class="hs-identifier">nonEmptySet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nonEmptySet</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-929"></a><span class="hs-identifier">nonEmptySet</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">Nest</span></a><span> </span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#nonEmptySet"><span class="hs-identifier hs-var">nonEmptySet</span></a><span> </span><a href="#local-1627463462"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-930"></a><span class="hs-identifier">nonEmptySet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Above</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#nonEmptySet"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;nonEmptySet Above&quot;</span><span>
</span><a name="line-931"></a><span class="hs-identifier">nonEmptySet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;nonEmptySet Beside&quot;</span><span>
</span><a name="line-932"></a><span>
</span><a name="line-933"></a><span class="hs-comment">-- @oneLiner@ returns the one-line members of the given set of @GDoc@s.</span><span>
</span><a name="line-934"></a><span class="hs-identifier">oneLiner</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-935"></a><span class="hs-identifier">oneLiner</span><span> </span><span class="hs-identifier">NoDoc</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">NoDoc</span><span>
</span><a name="line-936"></a><a name="oneLiner"><a href="Pretty.html#oneLiner"><span class="hs-identifier">oneLiner</span></a></a><span> </span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">Empty</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#NoDoc"><span class="hs-identifier hs-var">Empty</span></a><span>
</span><a name="line-937"></a><span class="hs-identifier">oneLiner</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#Empty"><span class="hs-identifier hs-var">NoDoc</span></a><span>
</span><a name="line-938"></a><span class="hs-identifier">oneLiner</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">textBeside_</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">oneLiner</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-939"></a><span class="hs-identifier">oneLiner</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">Nest</span></a><span> </span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">nest_</span></a><span> </span><a href="Pretty.html#textBeside_"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">oneLiner</span><span> </span><a href="Pretty.html#oneLiner"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-940"></a><span class="hs-identifier">oneLiner</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#Nest"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">Union</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">oneLiner</span><span> </span><a href="Pretty.html#oneLiner"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-941"></a><span class="hs-identifier">oneLiner</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Above</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#oneLiner"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;oneLiner Above&quot;</span><span>
</span><a name="line-942"></a><span class="hs-identifier">oneLiner</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;oneLiner Beside&quot;</span><span>
</span><a name="line-943"></a><span>
</span><a name="line-944"></a><span>
</span><a name="line-945"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-946"></a><span class="hs-comment">-- Rendering</span><span>
</span><a name="line-947"></a><span>
</span><a name="line-948"></a><span class="hs-comment">-- | A rendering style.</span><span>
</span><a name="line-949"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">Style</span><span>
</span><a name="line-950"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Style</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mode</span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Mode</span><span>  </span><span class="hs-comment">-- ^ The rendering mode</span><span>
</span><a name="line-951"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lineLength</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Pretty.html#Mode"><span class="hs-identifier hs-type">Int</span></a><span>   </span><span class="hs-comment">-- ^ Length of line, in chars</span><span>
</span><a name="line-952"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ribbonsPerLine</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Float</span><span> </span><span class="hs-comment">-- ^ Ratio of line length to ribbon length</span><span>
</span><a name="line-953"></a><span>          </span><span class="hs-special">}</span><span>
</span><a name="line-954"></a><span>
</span><a name="line-955"></a><span class="hs-comment">-- | The default style (@mode=PageMode, lineLength=100, ribbonsPerLine=1.5@).</span><span>
</span><a name="line-956"></a><span class="hs-identifier">style</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Style</span><span>
</span><a name="line-957"></a><span class="hs-identifier">style</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Style</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lineLength</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">100</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ribbonsPerLine</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1.5</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mode</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PageMode</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-958"></a><span>
</span><a name="line-959"></a><span class="hs-comment">-- | Rendering mode.</span><span>
</span><a name="line-960"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">Mode</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PageMode</span><span>     </span><span class="hs-comment">-- ^ Normal</span><span>
</span><a name="line-961"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ZigZagMode</span><span>   </span><span class="hs-comment">-- ^ With zig-zag cuts</span><span>
</span><a name="line-962"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a name="ZigZagMode"><a href="Pretty.html#ZigZagMode"><span class="hs-identifier">LeftMode</span></a></a><span>     </span><span class="hs-comment">-- ^ No indentation, infinitely long lines</span><span>
</span><a name="line-963"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">OneLineMode</span><span>  </span><span class="hs-comment">-- ^ All on one line</span><span>
</span><a name="line-964"></a><span>
</span><a name="line-965"></a><span class="hs-comment">-- | Render the @Doc@ to a String using the given @Style@.</span><span>
</span><a name="line-966"></a><span class="hs-identifier">renderStyle</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Style</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">String</span><span>
</span><a name="line-967"></a><span class="hs-identifier">renderStyle</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fullRender</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mode</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">lineLength</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ribbonsPerLine</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span>
</span><a name="line-968"></a><span>                </span><a href="Pretty.html#fullRender"><span class="hs-identifier hs-var">txtPrinter</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-969"></a><span>
</span><a name="line-970"></a><span class="hs-comment">-- | Default TextDetails printer</span><span>
</span><a name="line-971"></a><span class="hs-identifier">txtPrinter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TextDetails</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">String</span><span>
</span><a name="line-972"></a><span class="hs-identifier">txtPrinter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Chr</span><span> </span><a href="Pretty.html#TextDetails"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>   </span><a href="Pretty.html#TextDetails"><span class="hs-identifier hs-type">s</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">c</span><span class="hs-glyph">:</span><span class="hs-identifier">s</span><span>
</span><a name="line-973"></a><a name="txtPrinter"><a href="Pretty.html#txtPrinter"><span class="hs-identifier">txtPrinter</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Chr"><span class="hs-identifier hs-var">Str</span></a><span> </span><span class="hs-identifier">s1</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">s2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">s2</span><span>
</span><a name="line-974"></a><span class="hs-identifier">txtPrinter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PStr</span><span> </span><span class="hs-identifier">s1</span><span class="hs-special">)</span><span> </span><a name="local-1627463474"><a href="#local-1627463474"><span class="hs-identifier">s2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unpackFS</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">s2</span><span>
</span><a name="line-975"></a><span class="hs-identifier">txtPrinter</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#PStr"><span class="hs-identifier hs-var">ZStr</span></a><span> </span><a name="local-1627463475"><a href="#local-1627463475"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627463476"><a href="#local-1627463476"><span class="hs-identifier">s2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#unpackFS"><span class="hs-identifier hs-var">zString</span></a><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">s2</span><span>
</span><a name="line-976"></a><span class="hs-identifier">txtPrinter</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#ZStr"><span class="hs-identifier hs-var">LStr</span></a><span> </span><a name="local-1627463477"><a href="#local-1627463477"><span class="hs-identifier">s1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">s2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unpackLitString</span><span> </span><span class="hs-identifier">s1</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">s2</span><span>
</span><a name="line-977"></a><span>
</span><a name="line-978"></a><span class="hs-comment">-- | The general rendering interface.</span><span>
</span><a name="line-979"></a><span class="hs-identifier">fullRender</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Mode</span><span>                     </span><span class="hs-comment">-- ^ Rendering mode</span><span>
</span><a name="line-980"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Mode"><span class="hs-identifier hs-type">Int</span></a><span>                      </span><span class="hs-comment">-- ^ Line length</span><span>
</span><a name="line-981"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Float</span><span>                    </span><span class="hs-comment">-- ^ Ribbons per line</span><span>
</span><a name="line-982"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextDetails</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ What to do with text</span><span>
</span><a name="line-983"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span>                        </span><span class="hs-comment">-- ^ What to do at the end</span><span>
</span><a name="line-984"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>                      </span><span class="hs-comment">-- ^ The document</span><span>
</span><a name="line-985"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">a</span></a><span>                        </span><span class="hs-comment">-- ^ Result</span><span>
</span><a name="line-986"></a><span class="hs-identifier">fullRender</span><span> </span><span class="hs-identifier">OneLineMode</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">txt</span><span> </span><span class="hs-identifier">end</span><span> </span><span class="hs-identifier">doc</span><span>
</span><a name="line-987"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">easyDisplay</span><span> </span><span class="hs-identifier">spaceText</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627463481"><a href="#local-1627463481"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">y</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-1627463483"><a href="#local-1627463483"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">txt</span><span> </span><span class="hs-identifier">end</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">doc</span><span class="hs-special">)</span><span>
</span><a name="line-988"></a><span class="hs-identifier">fullRender</span><span> </span><span class="hs-identifier">LeftMode</span><span>    </span><a href="Pretty.html#spaceText"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">txt</span><span> </span><span class="hs-identifier">end</span><span> </span><span class="hs-identifier">doc</span><span>
</span><a name="line-989"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">easyDisplay</span><span> </span><span class="hs-identifier">nlText</span><span> </span><span class="hs-identifier">first</span><span> </span><span class="hs-identifier">txt</span><span> </span><span class="hs-identifier">end</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">doc</span><span class="hs-special">)</span><span>
</span><a name="line-990"></a><span>
</span><a name="line-991"></a><span class="hs-identifier">fullRender</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-identifier">lineLen</span><span> </span><span class="hs-identifier">ribbons</span><span> </span><span class="hs-identifier">txt</span><span> </span><span class="hs-identifier">rest</span><span> </span><span class="hs-identifier">doc</span><span>
</span><a name="line-992"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">display</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-identifier">lineLen</span><span> </span><span class="hs-identifier">ribbonLen</span><span> </span><span class="hs-identifier">txt</span><span> </span><span class="hs-identifier">rest</span><span> </span><span class="hs-identifier">doc'</span><span>
</span><a name="line-993"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-994"></a><span>    </span><span class="hs-identifier">doc'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">best</span><span> </span><span class="hs-identifier">bestLineLen</span><span> </span><span class="hs-identifier">ribbonLen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">doc</span><span class="hs-special">)</span><span>
</span><a name="line-995"></a><span>
</span><a name="line-996"></a><span>    </span><span class="hs-identifier">bestLineLen</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ribbonLen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span>
</span><a name="line-997"></a><span>    </span><span class="hs-identifier">ribbonLen</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">round</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">lineLen</span><span> </span><span class="hs-operator">/</span><span> </span><span class="hs-identifier">ribbons</span><span class="hs-special">)</span><span>
</span><a name="line-998"></a><span>    </span><span class="hs-identifier">bestLineLen</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-999"></a><span>                      </span><span class="hs-identifier">ZigZagMode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">maxBound</span><span>
</span><a name="line-1000"></a><span>                      </span><a href="Pretty.html#ZigZagMode"><span class="hs-identifier hs-var">_</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Enum.html#maxBound"><span class="hs-identifier hs-var">lineLen</span></a><span>
</span><a name="line-1001"></a><span>
</span><a name="line-1002"></a><span class="hs-identifier">easyDisplay</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TextDetails</span><span>
</span><a name="line-1003"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#TextDetails"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span class="hs-special">)</span><span>
</span><a name="line-1004"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextDetails</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-1005"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-1006"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span>
</span><a name="line-1007"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1008"></a><span class="hs-identifier">easyDisplay</span><span> </span><span class="hs-identifier">nlSpaceText</span><span> </span><span class="hs-identifier">choose</span><span> </span><span class="hs-identifier">txt</span><span> </span><span class="hs-identifier">end</span><span>
</span><a name="line-1009"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="easyDisplay"><a href="Pretty.html#easyDisplay"><span class="hs-identifier">lay</span></a></a><span>
</span><a name="line-1010"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1011"></a><span>    </span><span class="hs-identifier">lay</span><span> </span><span class="hs-identifier">NoDoc</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;easyDisplay: NoDoc&quot;</span><span>
</span><a name="line-1012"></a><span>    </span><a name="local-1627463501"><a href="#local-1627463501"><span class="hs-identifier">lay</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Union</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">lay</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">choose</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>
</span><a name="line-1013"></a><span>    </span><span class="hs-identifier">lay</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#Union"><span class="hs-identifier hs-var">Nest</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463501"><span class="hs-identifier hs-var">lay</span></a><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1014"></a><span>    </span><span class="hs-identifier">lay</span><span> </span><span class="hs-identifier">Empty</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463501"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-1015"></a><span>    </span><span class="hs-identifier">lay</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nlSpaceText</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">txt</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">lay</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1016"></a><span>    </span><span class="hs-identifier">lay</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463497"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">`</span><a href="#local-1627463497"><span class="hs-identifier hs-var">txt</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627463497"><span class="hs-identifier hs-var">lay</span></a><span> </span><a href="#local-1627463499"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1017"></a><span>    </span><span class="hs-identifier">lay</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">Above</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;easyDisplay Above&quot;</span><span>
</span><a name="line-1018"></a><span>    </span><span class="hs-identifier">lay</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;easyDisplay Beside&quot;</span><span>
</span><a name="line-1019"></a><span>
</span><a name="line-1020"></a><span class="hs-identifier">display</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Mode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextDetails</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-1021"></a><span class="hs-identifier">display</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">page_width</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">ribbon_width</span><span> </span><a href="Pretty.html#TextDetails"><span class="hs-identifier hs-type">txt</span></a><span> </span><a href="Pretty.html#TextDetails"><span class="hs-identifier hs-type">end</span></a><span> </span><span class="hs-identifier">doc</span><span>
</span><a name="line-1022"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">page_width</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">ribbon_width</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gap_width</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1023"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627463509"><span class="hs-identifier hs-var">gap_width</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">quot</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">shift</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1024"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-1025"></a><span>        </span><span class="hs-identifier">lay</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-1026"></a><span>        </span><a name="local-1627463516"><a href="#local-1627463516"><span class="hs-identifier">lay</span></a></a><span> </span><a name="local-1627463520"><a href="#local-1627463520"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Nest</span><span> </span><span class="hs-identifier">k1</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">lay</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">k</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier hs-var">k1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1027"></a><span>        </span><span class="hs-identifier">lay</span><span> </span><a name="local-1627463521"><a href="#local-1627463521"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">Empty</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463516"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-1028"></a><span>        </span><span class="hs-identifier">lay</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nlText</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">txt</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">lay</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1029"></a><span>        </span><span class="hs-identifier">lay</span><span> </span><a name="local-1627463524"><a href="#local-1627463524"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><a href="Pretty.html#nlText"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1030"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1031"></a><span>                    </span><span class="hs-identifier">ZigZagMode</span><span> </span><span class="hs-glyph">|</span><span>  </span><span class="hs-identifier">k</span><span> </span><span class="hs-operator">&gt;=</span><span> </span><span class="hs-identifier">gap_width</span><span>
</span><a name="line-1032"></a><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">nlText</span><span> </span><span class="hs-special">`</span><a href="#local-1627463514"><span class="hs-identifier hs-var">txt</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1033"></a><span>                                  </span><a href="Pretty.html#nlText"><span class="hs-identifier hs-var">Str</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">replicate</span><span> </span><span class="hs-identifier">shift</span><span> </span><span class="hs-char">'/'</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">txt</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1034"></a><span>                                  </span><span class="hs-identifier">nlText</span><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#replicate"><span class="hs-identifier hs-var">txt</span></a><span class="hs-special">`</span><span>
</span><a name="line-1035"></a><span>                                  </span><a href="Pretty.html#nlText"><span class="hs-identifier hs-var">lay1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">k</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">shift</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1036"></a><span>
</span><a name="line-1037"></a><span>                               </span><span class="hs-glyph">|</span><span>  </span><span class="hs-identifier">k</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1038"></a><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">nlText</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">txt</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1039"></a><span>                                  </span><a href="Pretty.html#nlText"><span class="hs-identifier hs-var">Str</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">replicate</span><span> </span><span class="hs-identifier">shift</span><span> </span><span class="hs-char">'\\'</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">txt</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1040"></a><span>                                  </span><span class="hs-identifier">nlText</span><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#replicate"><span class="hs-identifier hs-var">txt</span></a><span class="hs-special">`</span><span>
</span><a name="line-1041"></a><span>                                  </span><a href="Pretty.html#nlText"><span class="hs-identifier hs-var">lay1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">k</span><span> </span><a href="#local-1627463511"><span class="hs-operator hs-var">+</span></a><span> </span><span class="hs-identifier">shift</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1042"></a><span>
</span><a name="line-1043"></a><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">lay1</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1044"></a><span>        </span><span class="hs-identifier">lay</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Above</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;display lay Above&quot;</span><span>
</span><a name="line-1045"></a><span>        </span><span class="hs-identifier">lay</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;display lay Beside&quot;</span><span>
</span><a name="line-1046"></a><span>        </span><span class="hs-identifier">lay</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">NoDoc</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;display lay NoDoc&quot;</span><span>
</span><a name="line-1047"></a><span>        </span><span class="hs-identifier">lay</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Union</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;display lay Union&quot;</span><span>
</span><a name="line-1048"></a><span>
</span><a name="line-1049"></a><span>        </span><span class="hs-identifier">lay1</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">sl</span><span>
</span><a name="line-1050"></a><span>                             </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">indent</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">(</span><a href="#local-1627463532"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">txt</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">lay2</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><a name="line-1051"></a><span>
</span><a name="line-1052"></a><span>        </span><span class="hs-identifier">lay2</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">False</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-1053"></a><span>        </span><a name="local-1627463518"><a href="#local-1627463518"><span class="hs-identifier">lay2</span></a></a><span> </span><a name="local-1627463535"><a href="#local-1627463535"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier hs-var">p</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Err.html#undefined"><span class="hs-identifier hs-var">nlText</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">txt</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">lay</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1054"></a><span>        </span><span class="hs-identifier">lay2</span><span> </span><a name="local-1627463536"><a href="#local-1627463536"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">sl</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#nlText"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">`</span><a href="Pretty.html#nlText"><span class="hs-identifier hs-var">txt</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627463511"><span class="hs-identifier hs-var">lay2</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627463516"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-identifier">sl</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1055"></a><span>        </span><span class="hs-identifier">lay2</span><span> </span><a name="local-1627463538"><a href="#local-1627463538"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">Nest</span></a><span> </span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="Pretty.html#TextBeside"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">lay2</span><span> </span><a href="#local-1627463511"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1056"></a><span>        </span><span class="hs-identifier">lay2</span><span> </span><a name="local-1627463542"><a href="#local-1627463542"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">Empty</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463518"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-1057"></a><span>        </span><span class="hs-identifier">lay2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Above</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;display lay2 Above&quot;</span><span>
</span><a name="line-1058"></a><span>        </span><span class="hs-identifier">lay2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Beside</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;display lay2 Beside&quot;</span><span>
</span><a name="line-1059"></a><span>        </span><span class="hs-identifier">lay2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">NoDoc</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;display lay2 NoDoc&quot;</span><span>
</span><a name="line-1060"></a><span>        </span><span class="hs-identifier">lay2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Union</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Pretty.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;display lay2 Union&quot;</span><span>
</span><a name="line-1061"></a><span>
</span><a name="line-1062"></a><span>        </span><span class="hs-comment">-- optimise long indentations using LitString chunks of 8 spaces</span><span>
</span><a name="line-1063"></a><span>        </span><span class="hs-identifier">indent</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">&gt;=</span><span> </span><span class="hs-number">8</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">LStr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sLit</span><span> </span><span class="hs-string">&quot;        &quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">txt</span><span class="hs-special">`</span><span>
</span><a name="line-1064"></a><span>                                  </span><span class="hs-identifier">indent</span><span> </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">r</span><span>
</span><a name="line-1065"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627463519"><span class="hs-identifier hs-var">Str</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">spaces</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">txt</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">r</span><span>
</span><a name="line-1066"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-1067"></a><span>    </span><span class="hs-identifier">lay</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">doc</span><span>
</span><a name="line-1068"></a><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1069"></a><span>
</span><a name="line-1070"></a><span class="hs-identifier">printDoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Mode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1071"></a><span class="hs-comment">-- printDoc adds a newline to the end</span><span>
</span><a name="line-1072"></a><span class="hs-identifier">printDoc</span><span> </span><span class="hs-identifier">mode</span><span> </span><span class="hs-identifier">cols</span><span> </span><span class="hs-identifier">hdl</span><span> </span><span class="hs-identifier">doc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">printDoc_</span><span> </span><span class="hs-identifier">mode</span><span> </span><span class="hs-identifier">cols</span><span> </span><span class="hs-identifier">hdl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">doc</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1073"></a><span>
</span><a name="line-1074"></a><span class="hs-identifier">printDoc_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Mode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1075"></a><span class="hs-comment">-- printDoc_ does not add a newline at the end, so that</span><span>
</span><a name="line-1076"></a><span class="hs-comment">-- successive calls can output stuff on the same line</span><span>
</span><a name="line-1077"></a><span class="hs-comment">-- Rather like putStr vs putStrLn</span><span>
</span><a name="line-1078"></a><span class="hs-identifier">printDoc_</span><span> </span><span class="hs-identifier">LeftMode</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">hdl</span><span> </span><span class="hs-identifier">doc</span><span>
</span><a name="line-1079"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">printLeftRender</span><span> </span><a name="local-1627463551"><a href="#local-1627463551"><span class="hs-identifier">hdl</span></a></a><span> </span><span class="hs-identifier">doc</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">hFlush</span><span> </span><span class="hs-identifier">hdl</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1080"></a><span class="hs-identifier">printDoc_</span><span> </span><a href="Pretty.html#printLeftRender"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="Pretty.html#printLeftRender"><span class="hs-identifier hs-var">pprCols</span></a><span> </span><span class="hs-identifier">hdl</span><span> </span><span class="hs-identifier">doc</span><span>
</span><a name="line-1081"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fullRender</span><span> </span><span class="hs-identifier">mode</span><span> </span><span class="hs-identifier">pprCols</span><span> </span><span class="hs-number">1.5</span><span> </span><span class="hs-identifier">put</span><span> </span><span class="hs-identifier">done</span><span> </span><span class="hs-identifier">doc</span><span> </span><span class="hs-special">;</span><span>
</span><a name="line-1082"></a><span>         </span><a href="Pretty.html#fullRender"><span class="hs-identifier hs-var">hFlush</span></a><span> </span><a href="Pretty.html#fullRender"><span class="hs-identifier hs-var">hdl</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1083"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1084"></a><span>    </span><span class="hs-identifier">put</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Chr</span><span> </span><span class="hs-identifier">c</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">next</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hPutChar</span><span> </span><span class="hs-identifier">hdl</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">next</span><span>
</span><a name="line-1085"></a><span>    </span><a name="local-1627463556"><a href="#local-1627463556"><span class="hs-identifier">put</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Chr"><span class="hs-identifier hs-var">Str</span></a><span> </span><a name="local-1627463558"><a href="#local-1627463558"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>  </span><a name="local-1627463559"><a href="#local-1627463559"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Text.html#hPutChar"><span class="hs-identifier hs-var">hPutStr</span></a><span>  </span><a href="#local-1627463554"><span class="hs-identifier hs-var">hdl</span></a><span> </span><a href="#local-1627463558"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a><span> </span><a href="#local-1627463559"><span class="hs-identifier hs-var">next</span></a><span>
</span><a name="line-1086"></a><span>    </span><span class="hs-identifier">put</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PStr</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><a name="local-1627463561"><a href="#local-1627463561"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Text.html#hPutStr"><span class="hs-identifier hs-var">hPutStr</span></a><span>  </span><a href="#local-1627463554"><span class="hs-identifier hs-var">hdl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unpackFS</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">next</span><span>
</span><a name="line-1087"></a><span>                        </span><span class="hs-comment">-- NB. not hPutFS, we want this to go through</span><span>
</span><a name="line-1088"></a><span>                        </span><span class="hs-comment">-- the I/O library's encoding layer. (#3398)</span><span>
</span><a name="line-1089"></a><span>    </span><span class="hs-identifier">put</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ZStr</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">next</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hPutFZS</span><span>  </span><span class="hs-identifier">hdl</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">next</span><span>
</span><a name="line-1090"></a><span>    </span><span class="hs-identifier">put</span><span> </span><span class="hs-special">(</span><a href="Pretty.html#ZStr"><span class="hs-identifier hs-var">LStr</span></a><span> </span><a name="local-1627463564"><a href="#local-1627463564"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">next</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hPutLitString</span><span> </span><span class="hs-identifier">hdl</span><span> </span><a href="#local-1627463565"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">next</span><span>
</span><a name="line-1091"></a><span>
</span><a name="line-1092"></a><span>    </span><span class="hs-identifier">done</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- hPutChar hdl '\n'</span><span>
</span><a name="line-1093"></a><span>
</span><a name="line-1094"></a><span>  </span><span class="hs-comment">-- some versions of hPutBuf will barf if the length is zero</span><span>
</span><a name="line-1095"></a><span class="hs-identifier">hPutLitString</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1096"></a><span class="hs-identifier">hPutLitString</span><span> </span><span class="hs-identifier">handle</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1097"></a><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1098"></a><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">hPutBuf</span><span> </span><span class="hs-identifier">handle</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">l</span><span>
</span><a name="line-1099"></a><span>
</span><a name="line-1100"></a><span class="hs-comment">-- Printing output in LeftMode is performance critical: it's used when</span><span>
</span><a name="line-1101"></a><span class="hs-comment">-- dumping C and assembly output, so we allow ourselves a few dirty</span><span>
</span><a name="line-1102"></a><span class="hs-comment">-- hacks:</span><span>
</span><a name="line-1103"></a><span class="hs-comment">--</span><span>
</span><a name="line-1104"></a><span class="hs-comment">-- (1) we specialise fullRender for LeftMode with IO output.</span><span>
</span><a name="line-1105"></a><span class="hs-comment">--</span><span>
</span><a name="line-1106"></a><span class="hs-comment">-- (2) we add a layer of buffering on top of Handles.  Handles</span><span>
</span><a name="line-1107"></a><span class="hs-comment">--     don't perform well with lots of hPutChars, which is mostly</span><span>
</span><a name="line-1108"></a><span class="hs-comment">--     what we're doing here, because Handles have to be thread-safe</span><span>
</span><a name="line-1109"></a><span class="hs-comment">--     and async exception-safe.  We only have a single thread and don't</span><span>
</span><a name="line-1110"></a><span class="hs-comment">--     care about exceptions, so we add a layer of fast buffering</span><span>
</span><a name="line-1111"></a><span class="hs-comment">--     over the Handle interface.</span><span>
</span><a name="line-1112"></a><span class="hs-comment">--</span><span>
</span><a name="line-1113"></a><span class="hs-comment">-- (3) a few hacks in layLeft below to convince GHC to generate the right</span><span>
</span><a name="line-1114"></a><span class="hs-comment">--     code.</span><span>
</span><a name="line-1115"></a><span>
</span><a name="line-1116"></a><span class="hs-identifier">printLeftRender</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1117"></a><span class="hs-identifier">printLeftRender</span><span> </span><span class="hs-identifier">hdl</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Handle.Types.html#Handle"><span class="hs-identifier hs-type">doc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1118"></a><span>  </span><a name="printLeftRender"><a href="Pretty.html#printLeftRender"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newBufHandle</span><span> </span><a name="local-1627463573"><a href="#local-1627463573"><span class="hs-identifier">hdl</span></a></a><span>
</span><a name="line-1119"></a><span>  </span><span class="hs-identifier">bufLeftRender</span><span> </span><a href="BufWrite.html#newBufHandle"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-identifier">doc</span><span>
</span><a name="line-1120"></a><span>  </span><a href="Pretty.html#bufLeftRender"><span class="hs-identifier hs-var">bFlush</span></a><span> </span><a href="Pretty.html#bufLeftRender"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1121"></a><span>
</span><a name="line-1122"></a><span class="hs-identifier">bufLeftRender</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">BufHandle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1123"></a><span class="hs-identifier">bufLeftRender</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">doc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">layLeft</span><span> </span><a href="Pretty.html#Doc"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">reduceDoc</span><span> </span><span class="hs-identifier">doc</span><span class="hs-special">)</span><span>
</span><a name="line-1124"></a><span>
</span><a name="line-1125"></a><span class="hs-comment">-- HACK ALERT!  the &quot;return () &gt;&gt;&quot; below convinces GHC to eta-expand</span><span>
</span><a name="line-1126"></a><span class="hs-comment">-- this function with the IO state lambda.  Otherwise we end up with</span><span>
</span><a name="line-1127"></a><span class="hs-comment">-- closures in all the case branches.</span><span>
</span><a name="line-1128"></a><span class="hs-identifier">layLeft</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">BufHandle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Doc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1129"></a><span class="hs-identifier">layLeft</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="BufWrite.html#BufHandle"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-special">`</span><a href="BufWrite.html#BufHandle"><span class="hs-identifier hs-type">seq</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">False</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span> </span><span class="hs-comment">-- make it strict in b</span><span>
</span><a name="line-1130"></a><a name="layLeft"><a href="Pretty.html#layLeft"><span class="hs-identifier">layLeft</span></a></a><span> </span><a name="local-1627463577"><a href="#local-1627463577"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">NoDoc</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Err.html#undefined"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;layLeft: NoDoc&quot;</span><span>
</span><a name="line-1131"></a><span class="hs-identifier">layLeft</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Union</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">layLeft</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">first</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">q</span><span class="hs-special">)</span><span>
</span><a name="line-1132"></a><span class="hs-identifier">layLeft</span><span> </span><a name="local-1627463578"><a href="#local-1627463578"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Union"><span class="hs-identifier hs-var">Nest</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a><span> </span><a href="Pretty.html#layLeft"><span class="hs-identifier hs-var">layLeft</span></a><span> </span><a href="#local-1627463578"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1133"></a><span class="hs-identifier">layLeft</span><span> </span><a name="local-1627463581"><a href="#local-1627463581"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-identifier">Empty</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bPutChar</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-char">'\n'</span><span>
</span><a name="line-1134"></a><span class="hs-identifier">layLeft</span><span> </span><a name="local-1627463583"><a href="#local-1627463583"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">NilAbove</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="BufWrite.html#bPutChar"><span class="hs-identifier hs-var">bPutChar</span></a><span> </span><a href="#local-1627463583"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-char">'\n'</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">layLeft</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1135"></a><span class="hs-identifier">layLeft</span><span> </span><a name="local-1627463584"><a href="#local-1627463584"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">TextBeside</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="BufWrite.html#bPutChar"><span class="hs-identifier hs-var">put</span></a><span> </span><a href="BufWrite.html#bPutChar"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="BufWrite.html#bPutChar"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">layLeft</span><span> </span><a href="Pretty.html#layLeft"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Pretty.html#layLeft"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1136"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1137"></a><span>    </span><span class="hs-identifier">put</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">undefined</span><span>
</span><a name="line-1138"></a><span>    </span><a name="local-1627463589"><a href="#local-1627463589"><span class="hs-identifier">put</span></a></a><span> </span><a name="local-1627463590"><a href="#local-1627463590"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">Chr</span><span> </span><span class="hs-identifier">c</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bPutChar</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Err.html#undefined"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Err.html#undefined"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1139"></a><span>    </span><span class="hs-identifier">put</span><span> </span><a name="local-1627463591"><a href="#local-1627463591"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#Chr"><span class="hs-identifier hs-var">Str</span></a><span> </span><a name="local-1627463592"><a href="#local-1627463592"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="BufWrite.html#bPutChar"><span class="hs-identifier hs-var">bPutStr</span></a><span>  </span><a href="#local-1627463591"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-1627463592"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1140"></a><span>    </span><span class="hs-identifier">put</span><span> </span><a name="local-1627463593"><a href="#local-1627463593"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">PStr</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="BufWrite.html#bPutStr"><span class="hs-identifier hs-var">bPutFS</span></a><span>   </span><a href="#local-1627463593"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-1627463594"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1141"></a><span>    </span><span class="hs-identifier">put</span><span> </span><a name="local-1627463595"><a href="#local-1627463595"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#PStr"><span class="hs-identifier hs-var">ZStr</span></a><span> </span><a name="local-1627463596"><a href="#local-1627463596"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bPutFZS</span><span>  </span><a href="#local-1627463595"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-1627463596"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1142"></a><span>    </span><span class="hs-identifier">put</span><span> </span><a name="local-1627463597"><a href="#local-1627463597"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-special">(</span><a href="Pretty.html#ZStr"><span class="hs-identifier hs-var">LStr</span></a><span> </span><a name="local-1627463598"><a href="#local-1627463598"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bPutLitString</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">l</span><span>
</span><a name="line-1143"></a><span class="hs-identifier">layLeft</span><span> </span><a name="local-1627463599"><a href="#local-1627463599"><span class="hs-identifier">_</span></a></a><span> </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="BufWrite.html#bPutLitString"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;layLeft: Unhandled case&quot;</span><span>
</span><a name="line-1144"></a><span>
</span><a name="line-1145"></a><span class="hs-comment">-- Define error=panic, for easier comparison with libraries/pretty.</span><span>
</span><a name="line-1146"></a><span class="hs-identifier">error</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-1147"></a><span class="hs-identifier">error</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">panic</span><span>
</span><a name="line-1148"></a></pre></body></html>