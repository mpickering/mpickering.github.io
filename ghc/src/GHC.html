<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, NondecreasingIndentation, ScopedTypeVariables #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-4"></a><span class="hs-comment">--</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- (c) The University of Glasgow, 2005-2012</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- The GHC API</span><span>
</span><a name="line-8"></a><span class="hs-comment">--</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-12"></a><span>        </span><span class="hs-comment">-- * Initialisation</span><span>
</span><a name="line-13"></a><span>        </span><a href="GHC.html#defaultErrorHandler"><span class="hs-identifier hs-var">defaultErrorHandler</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="GHC.html#defaultCleanupHandler"><span class="hs-identifier hs-var">defaultCleanupHandler</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="ErrUtils.html#prettyPrintGhcErrors"><span class="hs-identifier hs-var">prettyPrintGhcErrors</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>        </span><span class="hs-comment">-- * GHC Monad</span><span>
</span><a name="line-18"></a><span>        </span><a href="GhcMonad.html#Ghc"><span class="hs-identifier hs-type">Ghc</span></a><span class="hs-special">,</span><span> </span><a href="GhcMonad.html#GhcT"><span class="hs-identifier hs-type">GhcT</span></a><span class="hs-special">,</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="GHC.html#runGhc"><span class="hs-identifier hs-var">runGhc</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#runGhcT"><span class="hs-identifier hs-var">runGhcT</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#initGhcMonad"><span class="hs-identifier hs-var">initGhcMonad</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>        </span><a href="Exception.html#gcatch"><span class="hs-identifier hs-var">gcatch</span></a><span class="hs-special">,</span><span> </span><a href="Exception.html#gbracket"><span class="hs-identifier hs-var">gbracket</span></a><span class="hs-special">,</span><span> </span><a href="Exception.html#gfinally"><span class="hs-identifier hs-var">gfinally</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="GhcMonad.html#printException"><span class="hs-identifier hs-var">printException</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="HscTypes.html#handleSourceError"><span class="hs-identifier hs-var">handleSourceError</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="GHC.html#needsTemplateHaskell"><span class="hs-identifier hs-var">needsTemplateHaskell</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>        </span><span class="hs-comment">-- * Flags and settings</span><span>
</span><a name="line-26"></a><span>        </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#GeneralFlag"><span class="hs-identifier hs-type">GeneralFlag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="ErrUtils.html#Severity"><span class="hs-identifier hs-type">Severity</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#HscTarget"><span class="hs-identifier hs-type">HscTarget</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>        </span><a href="DynFlags.html#GhcMode"><span class="hs-identifier hs-type">GhcMode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#GhcLink"><span class="hs-identifier hs-type">GhcLink</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DynFlags.html#defaultObjectTarget"><span class="hs-identifier hs-var">defaultObjectTarget</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="GHC.html#parseDynamicFlags"><span class="hs-identifier hs-var">parseDynamicFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="GhcMonad.html#getSessionDynFlags"><span class="hs-identifier hs-var">getSessionDynFlags</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#setSessionDynFlags"><span class="hs-identifier hs-var">setSessionDynFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>        </span><a href="GHC.html#getProgramDynFlags"><span class="hs-identifier hs-var">getProgramDynFlags</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#setProgramDynFlags"><span class="hs-identifier hs-var">setProgramDynFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>        </span><a href="GHC.html#getInteractiveDynFlags"><span class="hs-identifier hs-var">getInteractiveDynFlags</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#setInteractiveDynFlags"><span class="hs-identifier hs-var">setInteractiveDynFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="StaticFlags.html#parseStaticFlags"><span class="hs-identifier hs-var">parseStaticFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>        </span><span class="hs-comment">-- * Targets</span><span>
</span><a name="line-35"></a><span>        </span><a href="HscTypes.html#Target"><span class="hs-identifier hs-type">Target</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#TargetId"><span class="hs-identifier hs-type">TargetId</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DriverPhases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="GHC.html#setTargets"><span class="hs-identifier hs-var">setTargets</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="GHC.html#getTargets"><span class="hs-identifier hs-var">getTargets</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="GHC.html#addTarget"><span class="hs-identifier hs-var">addTarget</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>        </span><a href="GHC.html#removeTarget"><span class="hs-identifier hs-var">removeTarget</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>        </span><a href="GHC.html#guessTarget"><span class="hs-identifier hs-var">guessTarget</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>        </span><span class="hs-comment">-- * Loading\/compiling the program</span><span>
</span><a name="line-43"></a><span>        </span><a href="GhcMake.html#depanal"><span class="hs-identifier hs-var">depanal</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><a href="GhcMake.html#load"><span class="hs-identifier hs-var">load</span></a><span class="hs-special">,</span><span> </span><a href="GhcMake.html#LoadHowMuch"><span class="hs-identifier hs-type">LoadHowMuch</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#InteractiveImport"><span class="hs-identifier hs-type">InteractiveImport</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>        </span><a href="BasicTypes.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#succeeded"><span class="hs-identifier hs-var">succeeded</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#failed"><span class="hs-identifier hs-var">failed</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>        </span><a href="GhcMonad.html#defaultWarnErrLogger"><span class="hs-identifier hs-var">defaultWarnErrLogger</span></a><span class="hs-special">,</span><span> </span><a href="GhcMonad.html#WarnErrLogger"><span class="hs-identifier hs-type">WarnErrLogger</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>        </span><a href="GHC.html#workingDirectoryChanged"><span class="hs-identifier hs-var">workingDirectoryChanged</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="GHC.html#parseModule"><span class="hs-identifier hs-var">parseModule</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#typecheckModule"><span class="hs-identifier hs-var">typecheckModule</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#desugarModule"><span class="hs-identifier hs-var">desugarModule</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#loadModule"><span class="hs-identifier hs-var">loadModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>        </span><a href="GHC.html#ParsedModule"><span class="hs-identifier hs-type">ParsedModule</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="GHC.html#TypecheckedModule"><span class="hs-identifier hs-type">TypecheckedModule</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="GHC.html#DesugaredModule"><span class="hs-identifier hs-type">DesugaredModule</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>        </span><a href="GHC.html#TypecheckedSource"><span class="hs-identifier hs-type">TypecheckedSource</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#ParsedSource"><span class="hs-identifier hs-type">ParsedSource</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#RenamedSource"><span class="hs-identifier hs-type">RenamedSource</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ditto</span><span>
</span><a name="line-51"></a><span>        </span><a href="GHC.html#TypecheckedMod"><span class="hs-identifier hs-type">TypecheckedMod</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#ParsedMod"><span class="hs-identifier hs-type">ParsedMod</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>        </span><a href="GHC.html#moduleInfo"><span class="hs-identifier hs-var">moduleInfo</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#renamedSource"><span class="hs-identifier hs-var">renamedSource</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#typecheckedSource"><span class="hs-identifier hs-var">typecheckedSource</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>        </span><a href="GHC.html#parsedSource"><span class="hs-identifier hs-var">parsedSource</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#coreModule"><span class="hs-identifier hs-var">coreModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span>        </span><span class="hs-comment">-- ** Compiling to Core</span><span>
</span><a name="line-56"></a><span>        </span><a href="GHC.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>        </span><a href="GHC.html#compileToCoreModule"><span class="hs-identifier hs-var">compileToCoreModule</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#compileToCoreSimplified"><span class="hs-identifier hs-var">compileToCoreSimplified</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>        </span><span class="hs-comment">-- * Inspecting the module structure of the program</span><span>
</span><a name="line-60"></a><span>        </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>        </span><a href="GHC.html#getModSummary"><span class="hs-identifier hs-var">getModSummary</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>        </span><a href="GHC.html#getModuleGraph"><span class="hs-identifier hs-var">getModuleGraph</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>        </span><a href="GHC.html#isLoaded"><span class="hs-identifier hs-var">isLoaded</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>        </span><a href="GhcMake.html#topSortModuleGraph"><span class="hs-identifier hs-var">topSortModuleGraph</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span>        </span><span class="hs-comment">-- * Inspecting modules</span><span>
</span><a name="line-67"></a><span>        </span><a href="GHC.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>        </span><a href="GHC.html#getModuleInfo"><span class="hs-identifier hs-var">getModuleInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>        </span><a href="GHC.html#modInfoTyThings"><span class="hs-identifier hs-var">modInfoTyThings</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>        </span><a href="GHC.html#modInfoTopLevelScope"><span class="hs-identifier hs-var">modInfoTopLevelScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>        </span><a href="GHC.html#modInfoExports"><span class="hs-identifier hs-var">modInfoExports</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>        </span><a href="GHC.html#modInfoExportsWithSelectors"><span class="hs-identifier hs-var">modInfoExportsWithSelectors</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>        </span><a href="GHC.html#modInfoInstances"><span class="hs-identifier hs-var">modInfoInstances</span></a><span class="hs-special">,</span><span>
</span><a name="line-74"></a><span>        </span><a href="GHC.html#modInfoIsExportedName"><span class="hs-identifier hs-var">modInfoIsExportedName</span></a><span class="hs-special">,</span><span>
</span><a name="line-75"></a><span>        </span><a href="GHC.html#modInfoLookupName"><span class="hs-identifier hs-var">modInfoLookupName</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>        </span><a href="GHC.html#modInfoIface"><span class="hs-identifier hs-var">modInfoIface</span></a><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>        </span><a href="GHC.html#modInfoSafe"><span class="hs-identifier hs-var">modInfoSafe</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>        </span><a href="GHC.html#lookupGlobalName"><span class="hs-identifier hs-var">lookupGlobalName</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>        </span><a href="GHC.html#findGlobalAnns"><span class="hs-identifier hs-var">findGlobalAnns</span></a><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>        </span><a href="GHC.html#mkPrintUnqualifiedForModule"><span class="hs-identifier hs-var">mkPrintUnqualifiedForModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-81"></a><span>        </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>        </span><a href="DynFlags.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span>        </span><span class="hs-comment">-- * Querying the environment</span><span>
</span><a name="line-85"></a><span>        </span><span class="hs-comment">-- packageDbModules,</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span>        </span><span class="hs-comment">-- * Printing</span><span>
</span><a name="line-88"></a><span>        </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#alwaysQualify"><span class="hs-identifier hs-var">alwaysQualify</span></a><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span>        </span><span class="hs-comment">-- * Interactive evaluation</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-93"></a><span>        </span><span class="hs-comment">-- ** Executing statements</span><span>
</span><a name="line-94"></a><span>        </span><a href="InteractiveEval.html#execStmt"><span class="hs-identifier hs-var">execStmt</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEvalTypes.html#ExecOptions"><span class="hs-identifier hs-type">ExecOptions</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#execOptions"><span class="hs-identifier hs-var">execOptions</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEvalTypes.html#ExecResult"><span class="hs-identifier hs-type">ExecResult</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>        </span><a href="InteractiveEval.html#resumeExec"><span class="hs-identifier hs-var">resumeExec</span></a><span class="hs-special">,</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>        </span><span class="hs-comment">-- ** Adding new declarations</span><span>
</span><a name="line-98"></a><span>        </span><a href="InteractiveEval.html#runDecls"><span class="hs-identifier hs-var">runDecls</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#runDeclsWithLocation"><span class="hs-identifier hs-var">runDeclsWithLocation</span></a><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span>        </span><span class="hs-comment">-- ** Get/set the current context</span><span>
</span><a name="line-101"></a><span>        </span><a href="InteractiveEval.html#parseImportDecl"><span class="hs-identifier hs-var">parseImportDecl</span></a><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>        </span><a href="InteractiveEval.html#setContext"><span class="hs-identifier hs-var">setContext</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#getContext"><span class="hs-identifier hs-var">getContext</span></a><span class="hs-special">,</span><span>
</span><a name="line-103"></a><span>        </span><a href="GHC.html#setGHCiMonad"><span class="hs-identifier hs-var">setGHCiMonad</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#getGHCiMonad"><span class="hs-identifier hs-var">getGHCiMonad</span></a><span class="hs-special">,</span><span>
</span><a name="line-104"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-105"></a><span>        </span><span class="hs-comment">-- ** Inspecting the current context</span><span>
</span><a name="line-106"></a><span>        </span><a href="GHC.html#getBindings"><span class="hs-identifier hs-var">getBindings</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#getInsts"><span class="hs-identifier hs-var">getInsts</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#getPrintUnqual"><span class="hs-identifier hs-var">getPrintUnqual</span></a><span class="hs-special">,</span><span>
</span><a name="line-107"></a><span>        </span><a href="GHC.html#findModule"><span class="hs-identifier hs-var">findModule</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#lookupModule"><span class="hs-identifier hs-var">lookupModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-108"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-109"></a><span>        </span><a href="GHC.html#isModuleTrusted"><span class="hs-identifier hs-var">isModuleTrusted</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#moduleTrustReqs"><span class="hs-identifier hs-var">moduleTrustReqs</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>        </span><a href="InteractiveEval.html#getNamesInScope"><span class="hs-identifier hs-var">getNamesInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-111"></a><span>        </span><a href="InteractiveEval.html#getRdrNamesInScope"><span class="hs-identifier hs-var">getRdrNamesInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-112"></a><span>        </span><a href="GHC.html#getGRE"><span class="hs-identifier hs-var">getGRE</span></a><span class="hs-special">,</span><span>
</span><a name="line-113"></a><span>        </span><a href="InteractiveEval.html#moduleIsInterpreted"><span class="hs-identifier hs-var">moduleIsInterpreted</span></a><span class="hs-special">,</span><span>
</span><a name="line-114"></a><span>        </span><a href="InteractiveEval.html#getInfo"><span class="hs-identifier hs-var">getInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-115"></a><span>        </span><a href="InteractiveEval.html#showModule"><span class="hs-identifier hs-var">showModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-116"></a><span>        </span><a href="InteractiveEval.html#isModuleInterpreted"><span class="hs-identifier hs-var">isModuleInterpreted</span></a><span class="hs-special">,</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span>        </span><span class="hs-comment">-- ** Inspecting types and kinds</span><span>
</span><a name="line-119"></a><span>        </span><a href="InteractiveEval.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span class="hs-special">,</span><span>
</span><a name="line-120"></a><span>        </span><a href="InteractiveEval.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>        </span><span class="hs-comment">-- ** Looking up a Name</span><span>
</span><a name="line-123"></a><span>        </span><a href="InteractiveEval.html#parseName"><span class="hs-identifier hs-var">parseName</span></a><span class="hs-special">,</span><span>
</span><a name="line-124"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-125"></a><span>        </span><a href="GHC.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a><span class="hs-special">,</span><span>
</span><a name="line-126"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-127"></a><span>        </span><span class="hs-comment">-- ** Compiling expressions</span><span>
</span><a name="line-128"></a><span>        </span><a href="../ghci-8.1/src/%{MODULE/./-}.html#%{NAME}/GHCi.RemoteTypes.html#HValue"><span class="hs-identifier hs-type">HValue</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#parseExpr"><span class="hs-identifier hs-var">parseExpr</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#compileParsedExpr"><span class="hs-identifier hs-var">compileParsedExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-129"></a><span>        </span><a href="InteractiveEval.html#compileExpr"><span class="hs-identifier hs-var">InteractiveEval</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">compileExpr</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#dynCompileExpr"><span class="hs-identifier hs-var">dynCompileExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-130"></a><span>        </span><a href="../ghci-8.1/src/%{MODULE/./-}.html#%{NAME}/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a><span class="hs-special">,</span><span>
</span><a name="line-131"></a><span>        </span><a href="InteractiveEval.html#compileExprRemote"><span class="hs-identifier hs-var">compileExprRemote</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#compileParsedExprRemote"><span class="hs-identifier hs-var">compileParsedExprRemote</span></a><span class="hs-special">,</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span>        </span><span class="hs-comment">-- ** Other</span><span>
</span><a name="line-134"></a><span>        </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- Desired by some clients (Trac #8878)</span><span>
</span><a name="line-135"></a><span>        </span><a href="InteractiveEval.html#isStmt"><span class="hs-identifier hs-var">isStmt</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#hasImport"><span class="hs-identifier hs-var">hasImport</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#isImport"><span class="hs-identifier hs-var">isImport</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#isDecl"><span class="hs-identifier hs-var">isDecl</span></a><span class="hs-special">,</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span>        </span><span class="hs-comment">-- ** The debugger</span><span>
</span><a name="line-138"></a><span>        </span><a href="InteractiveEvalTypes.html#SingleStep"><span class="hs-identifier hs-type">SingleStep</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-139"></a><span>        </span><a href="InteractiveEvalTypes.html#Resume"><span class="hs-identifier hs-type">Resume</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-140"></a><span>        </span><a href="InteractiveEvalTypes.html#History"><span class="hs-identifier hs-type">History</span></a><span class="hs-special">(</span><span class="hs-identifier">historyBreakInfo</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">historyEnclosingDecls</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-141"></a><span>        </span><a href="GHC.html#getHistorySpan"><span class="hs-identifier hs-var">GHC</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">getHistorySpan</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#getHistoryModule"><span class="hs-identifier hs-var">getHistoryModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-142"></a><span>        </span><a href="InteractiveEval.html#abandon"><span class="hs-identifier hs-var">abandon</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#abandonAll"><span class="hs-identifier hs-var">abandonAll</span></a><span class="hs-special">,</span><span>
</span><a name="line-143"></a><span>        </span><a href="InteractiveEval.html#getResumeContext"><span class="hs-identifier hs-var">getResumeContext</span></a><span class="hs-special">,</span><span>
</span><a name="line-144"></a><span>        </span><a href="GHC.html#obtainTermFromId"><span class="hs-identifier hs-var">GHC</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">obtainTermFromId</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#obtainTermFromVal"><span class="hs-identifier hs-var">GHC</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">obtainTermFromVal</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#reconstructType"><span class="hs-identifier hs-var">reconstructType</span></a><span class="hs-special">,</span><span>
</span><a name="line-145"></a><span>        </span><a href="GHC.html#modInfoModBreaks"><span class="hs-identifier hs-var">modInfoModBreaks</span></a><span class="hs-special">,</span><span>
</span><a name="line-146"></a><span>        </span><a href="ByteCodeTypes.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="ByteCodeTypes.html#BreakIndex"><span class="hs-identifier hs-type">BreakIndex</span></a><span class="hs-special">,</span><span>
</span><a name="line-147"></a><span>        </span><a href="InteractiveEvalTypes.html#BreakInfo"><span class="hs-identifier hs-type">BreakInfo</span></a><span class="hs-special">(</span><span class="hs-identifier">breakInfo_number</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">breakInfo_module</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-148"></a><span>        </span><a href="InteractiveEval.html#back"><span class="hs-identifier hs-var">InteractiveEval</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">back</span></a><span class="hs-special">,</span><span>
</span><a name="line-149"></a><span>        </span><a href="InteractiveEval.html#forward"><span class="hs-identifier hs-var">InteractiveEval</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">forward</span></a><span class="hs-special">,</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span>        </span><span class="hs-comment">-- ** Deprecated API</span><span>
</span><a name="line-152"></a><span>        </span><a href="InteractiveEval.html#RunResult"><span class="hs-identifier hs-type">RunResult</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-153"></a><span>        </span><a href="InteractiveEval.html#runStmt"><span class="hs-identifier hs-var">runStmt</span></a><span class="hs-special">,</span><span> </span><a href="InteractiveEval.html#runStmtWithLocation"><span class="hs-identifier hs-var">runStmtWithLocation</span></a><span class="hs-special">,</span><span>
</span><a name="line-154"></a><span>        </span><a href="InteractiveEval.html#resume"><span class="hs-identifier hs-var">resume</span></a><span class="hs-special">,</span><span>
</span><a name="line-155"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>        </span><span class="hs-comment">-- * Abstract syntax elements</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span>        </span><span class="hs-comment">-- ** Packages</span><span>
</span><a name="line-160"></a><span>        </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-161"></a><span>
</span><a name="line-162"></a><span>        </span><span class="hs-comment">-- ** Modules</span><span>
</span><a name="line-163"></a><span>        </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#pprModule"><span class="hs-identifier hs-var">pprModule</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-164"></a><span>        </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a><span class="hs-special">,</span><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span>        </span><span class="hs-comment">-- ** Names</span><span>
</span><a name="line-167"></a><span>        </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span>
</span><a name="line-168"></a><span>        </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#pprParenSymName"><span class="hs-identifier hs-var">pprParenSymName</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a><span class="hs-special">,</span><span>
</span><a name="line-169"></a><span>        </span><a href="Name.html#NamedThing"><span class="hs-identifier hs-type">NamedThing</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-170"></a><span>        </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span class="hs-special">,</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>        </span><span class="hs-comment">-- ** Identifiers</span><span>
</span><a name="line-173"></a><span>        </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span class="hs-special">,</span><span>
</span><a name="line-174"></a><span>        </span><a href="Id.html#isImplicitId"><span class="hs-identifier hs-var">isImplicitId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isDeadBinder"><span class="hs-identifier hs-var">isDeadBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-175"></a><span>        </span><a href="Var.html#isExportedId"><span class="hs-identifier hs-var">isExportedId</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#isLocalId"><span class="hs-identifier hs-var">isLocalId</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#isGlobalId"><span class="hs-identifier hs-var">isGlobalId</span></a><span class="hs-special">,</span><span>
</span><a name="line-176"></a><span>        </span><a href="Id.html#isRecordSelector"><span class="hs-identifier hs-var">isRecordSelector</span></a><span class="hs-special">,</span><span>
</span><a name="line-177"></a><span>        </span><a href="Id.html#isPrimOpId"><span class="hs-identifier hs-var">isPrimOpId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isFCallId"><span class="hs-identifier hs-var">isFCallId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isClassOpId_maybe"><span class="hs-identifier hs-var">isClassOpId_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-178"></a><span>        </span><a href="Id.html#isDataConWorkId"><span class="hs-identifier hs-var">isDataConWorkId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idDataCon"><span class="hs-identifier hs-var">idDataCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-179"></a><span>        </span><a href="Id.html#isBottomingId"><span class="hs-identifier hs-var">isBottomingId</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#isDictonaryId"><span class="hs-identifier hs-var">isDictonaryId</span></a><span class="hs-special">,</span><span>
</span><a name="line-180"></a><span>        </span><a href="Id.html#recordSelectorTyCon"><span class="hs-identifier hs-var">recordSelectorTyCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span>        </span><span class="hs-comment">-- ** Type constructors</span><span>
</span><a name="line-183"></a><span>        </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-184"></a><span>        </span><a href="TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a><span class="hs-special">,</span><span>
</span><a name="line-185"></a><span>        </span><a href="TyCon.html#isClassTyCon"><span class="hs-identifier hs-var">isClassTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#isTypeSynonymTyCon"><span class="hs-identifier hs-var">isTypeSynonymTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-186"></a><span>        </span><a href="TyCon.html#isPrimTyCon"><span class="hs-identifier hs-var">isPrimTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#isFunTyCon"><span class="hs-identifier hs-var">isFunTyCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-187"></a><span>        </span><a href="TyCon.html#isFamilyTyCon"><span class="hs-identifier hs-var">isFamilyTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#isOpenFamilyTyCon"><span class="hs-identifier hs-var">isOpenFamilyTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#isOpenTypeFamilyTyCon"><span class="hs-identifier hs-var">isOpenTypeFamilyTyCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-188"></a><span>        </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-189"></a><span>        </span><a href="TyCon.html#synTyConRhs_maybe"><span class="hs-identifier hs-var">synTyConRhs_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#synTyConDefn_maybe"><span class="hs-identifier hs-var">synTyConDefn_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span>        </span><span class="hs-comment">-- ** Type variables</span><span>
</span><a name="line-192"></a><span>        </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-193"></a><span>        </span><a href="TysPrim.html#alphaTyVars"><span class="hs-identifier hs-var">alphaTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span>        </span><span class="hs-comment">-- ** Data constructors</span><span>
</span><a name="line-196"></a><span>        </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-197"></a><span>        </span><a href="DataCon.html#dataConSig"><span class="hs-identifier hs-var">dataConSig</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#dataConType"><span class="hs-identifier hs-var">dataConType</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a><span class="hs-special">,</span><span>
</span><a name="line-198"></a><span>        </span><a href="DataCon.html#dataConIsInfix"><span class="hs-identifier hs-var">dataConIsInfix</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#isVanillaDataCon"><span class="hs-identifier hs-var">isVanillaDataCon</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#dataConUserType"><span class="hs-identifier hs-var">dataConUserType</span></a><span class="hs-special">,</span><span>
</span><a name="line-199"></a><span>        </span><a href="DataCon.html#dataConSrcBangs"><span class="hs-identifier hs-var">dataConSrcBangs</span></a><span class="hs-special">,</span><span>
</span><a name="line-200"></a><span>        </span><a href="DataCon.html#StrictnessMark"><span class="hs-identifier hs-type">StrictnessMark</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DataCon.html#isMarkedStrict"><span class="hs-identifier hs-var">isMarkedStrict</span></a><span class="hs-special">,</span><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span>        </span><span class="hs-comment">-- ** Classes</span><span>
</span><a name="line-203"></a><span>        </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span>
</span><a name="line-204"></a><span>        </span><a href="Class.html#classMethods"><span class="hs-identifier hs-var">classMethods</span></a><span class="hs-special">,</span><span> </span><a href="Class.html#classSCTheta"><span class="hs-identifier hs-var">classSCTheta</span></a><span class="hs-special">,</span><span> </span><a href="Class.html#classTvsFds"><span class="hs-identifier hs-var">classTvsFds</span></a><span class="hs-special">,</span><span> </span><a href="Class.html#classATs"><span class="hs-identifier hs-var">classATs</span></a><span class="hs-special">,</span><span>
</span><a name="line-205"></a><span>        </span><a href="Class.html#pprFundeps"><span class="hs-identifier hs-var">pprFundeps</span></a><span class="hs-special">,</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span>        </span><span class="hs-comment">-- ** Instances</span><span>
</span><a name="line-208"></a><span>        </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">,</span><span>
</span><a name="line-209"></a><span>        </span><a href="InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a><span class="hs-special">,</span><span>
</span><a name="line-210"></a><span>        </span><a href="InstEnv.html#pprInstance"><span class="hs-identifier hs-var">pprInstance</span></a><span class="hs-special">,</span><span> </span><a href="InstEnv.html#pprInstanceHdr"><span class="hs-identifier hs-var">pprInstanceHdr</span></a><span class="hs-special">,</span><span>
</span><a name="line-211"></a><span>        </span><a href="PprTyThing.html#pprFamInst"><span class="hs-identifier hs-var">pprFamInst</span></a><span class="hs-special">,</span><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span>        </span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span class="hs-special">,</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span>        </span><span class="hs-comment">-- ** Types and Kinds</span><span>
</span><a name="line-216"></a><span>        </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitForAllTys"><span class="hs-identifier hs-var">splitForAllTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#funResultTy"><span class="hs-identifier hs-var">funResultTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-217"></a><span>        </span><a href="TyCoRep.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTypeApp"><span class="hs-identifier hs-var">pprTypeApp</span></a><span class="hs-special">,</span><span>
</span><a name="line-218"></a><span>        </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">,</span><span>
</span><a name="line-219"></a><span>        </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">,</span><span>
</span><a name="line-220"></a><span>        </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprForAll"><span class="hs-identifier hs-var">pprForAll</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprForAllImplicit"><span class="hs-identifier hs-var">pprForAllImplicit</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprThetaArrowTy"><span class="hs-identifier hs-var">pprThetaArrowTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span>        </span><span class="hs-comment">-- ** Entities</span><span>
</span><a name="line-223"></a><span>        </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span>        </span><span class="hs-comment">-- ** Syntax</span><span>
</span><a name="line-226"></a><span>        </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">HsSyn</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ToDo: remove extraneous bits</span><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span>        </span><span class="hs-comment">-- ** Fixities</span><span>
</span><a name="line-229"></a><span>        </span><a href="BasicTypes.html#FixityDirection"><span class="hs-identifier hs-type">FixityDirection</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-230"></a><span>        </span><a href="BasicTypes.html#defaultFixity"><span class="hs-identifier hs-var">defaultFixity</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#maxPrecedence"><span class="hs-identifier hs-var">maxPrecedence</span></a><span class="hs-special">,</span><span>
</span><a name="line-231"></a><span>        </span><a href="BasicTypes.html#negateFixity"><span class="hs-identifier hs-var">negateFixity</span></a><span class="hs-special">,</span><span>
</span><a name="line-232"></a><span>        </span><a href="BasicTypes.html#compareFixity"><span class="hs-identifier hs-var">compareFixity</span></a><span class="hs-special">,</span><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span>        </span><span class="hs-comment">-- ** Source locations</span><span>
</span><a name="line-235"></a><span>        </span><a href="SrcLoc.html#SrcLoc"><span class="hs-identifier hs-type">SrcLoc</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#RealSrcLoc"><span class="hs-identifier hs-type">RealSrcLoc</span></a><span class="hs-special">,</span><span>
</span><a name="line-236"></a><span>        </span><a href="SrcLoc.html#mkSrcLoc"><span class="hs-identifier hs-var">mkSrcLoc</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#noSrcLoc"><span class="hs-identifier hs-var">noSrcLoc</span></a><span class="hs-special">,</span><span>
</span><a name="line-237"></a><span>        </span><a href="SrcLoc.html#srcLocFile"><span class="hs-identifier hs-var">srcLocFile</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#srcLocLine"><span class="hs-identifier hs-var">srcLocLine</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#srcLocCol"><span class="hs-identifier hs-var">srcLocCol</span></a><span class="hs-special">,</span><span>
</span><a name="line-238"></a><span>        </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a><span class="hs-special">,</span><span>
</span><a name="line-239"></a><span>        </span><a href="SrcLoc.html#mkSrcSpan"><span class="hs-identifier hs-var">mkSrcSpan</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#srcLocSpan"><span class="hs-identifier hs-var">srcLocSpan</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#isGoodSrcSpan"><span class="hs-identifier hs-var">isGoodSrcSpan</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a><span class="hs-special">,</span><span>
</span><a name="line-240"></a><span>        </span><a href="SrcLoc.html#srcSpanStart"><span class="hs-identifier hs-var">srcSpanStart</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#srcSpanEnd"><span class="hs-identifier hs-var">srcSpanEnd</span></a><span class="hs-special">,</span><span>
</span><a name="line-241"></a><span>        </span><a href="SrcLoc.html#srcSpanFile"><span class="hs-identifier hs-var">srcSpanFile</span></a><span class="hs-special">,</span><span>
</span><a name="line-242"></a><span>        </span><a href="SrcLoc.html#srcSpanStartLine"><span class="hs-identifier hs-var">srcSpanStartLine</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#srcSpanEndLine"><span class="hs-identifier hs-var">srcSpanEndLine</span></a><span class="hs-special">,</span><span>
</span><a name="line-243"></a><span>        </span><a href="SrcLoc.html#srcSpanStartCol"><span class="hs-identifier hs-var">srcSpanStartCol</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#srcSpanEndCol"><span class="hs-identifier hs-var">srcSpanEndCol</span></a><span class="hs-special">,</span><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>        </span><span class="hs-comment">-- ** Located</span><span>
</span><a name="line-246"></a><span>        </span><a href="SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span class="hs-special">,</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span>        </span><span class="hs-comment">-- *** Constructing Located</span><span>
</span><a name="line-249"></a><span>        </span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#mkGeneralLocated"><span class="hs-identifier hs-var">mkGeneralLocated</span></a><span class="hs-special">,</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>        </span><span class="hs-comment">-- *** Deconstructing Located</span><span>
</span><a name="line-252"></a><span>        </span><a href="SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span class="hs-special">,</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span>        </span><span class="hs-comment">-- *** Combining and comparing Located values</span><span>
</span><a name="line-255"></a><span>        </span><a href="SrcLoc.html#eqLocated"><span class="hs-identifier hs-var">eqLocated</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#cmpLocated"><span class="hs-identifier hs-var">cmpLocated</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#combineLocs"><span class="hs-identifier hs-var">combineLocs</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#addCLoc"><span class="hs-identifier hs-var">addCLoc</span></a><span class="hs-special">,</span><span>
</span><a name="line-256"></a><span>        </span><a href="SrcLoc.html#leftmost_smallest"><span class="hs-identifier hs-var">leftmost_smallest</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#leftmost_largest"><span class="hs-identifier hs-var">leftmost_largest</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#rightmost"><span class="hs-identifier hs-var">rightmost</span></a><span class="hs-special">,</span><span>
</span><a name="line-257"></a><span>        </span><a href="SrcLoc.html#spans"><span class="hs-identifier hs-var">spans</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#isSubspanOf"><span class="hs-identifier hs-var">isSubspanOf</span></a><span class="hs-special">,</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span>        </span><span class="hs-comment">-- * Exceptions</span><span>
</span><a name="line-260"></a><span>        </span><a href="Panic.html#GhcException"><span class="hs-identifier hs-type">GhcException</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Panic.html#showGhcException"><span class="hs-identifier hs-var">showGhcException</span></a><span class="hs-special">,</span><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span>        </span><span class="hs-comment">-- * Token stream manipulations</span><span>
</span><a name="line-263"></a><span>        </span><a href="Lexer.html#Token"><span class="hs-identifier hs-type">Token</span></a><span class="hs-special">,</span><span>
</span><a name="line-264"></a><span>        </span><a href="GHC.html#getTokenStream"><span class="hs-identifier hs-var">getTokenStream</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#getRichTokenStream"><span class="hs-identifier hs-var">getRichTokenStream</span></a><span class="hs-special">,</span><span>
</span><a name="line-265"></a><span>        </span><a href="GHC.html#showRichTokenStream"><span class="hs-identifier hs-var">showRichTokenStream</span></a><span class="hs-special">,</span><span> </span><a href="GHC.html#addSourceToTokens"><span class="hs-identifier hs-var">addSourceToTokens</span></a><span class="hs-special">,</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span>        </span><span class="hs-comment">-- * Pure interface to the parser</span><span>
</span><a name="line-268"></a><span>        </span><a href="GHC.html#parser"><span class="hs-identifier hs-var">parser</span></a><span class="hs-special">,</span><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span>        </span><span class="hs-comment">-- * API Annotations</span><span>
</span><a name="line-271"></a><span>        </span><a href="ApiAnnotation.html#ApiAnns"><span class="hs-identifier hs-type">ApiAnns</span></a><span class="hs-special">,</span><a href="ApiAnnotation.html#AnnKeywordId"><span class="hs-identifier hs-type">AnnKeywordId</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="ApiAnnotation.html#AnnotationComment"><span class="hs-identifier hs-type">AnnotationComment</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-272"></a><span>        </span><a href="ApiAnnotation.html#getAnnotation"><span class="hs-identifier hs-var">getAnnotation</span></a><span class="hs-special">,</span><span> </span><a href="ApiAnnotation.html#getAndRemoveAnnotation"><span class="hs-identifier hs-var">getAndRemoveAnnotation</span></a><span class="hs-special">,</span><span>
</span><a name="line-273"></a><span>        </span><a href="ApiAnnotation.html#getAnnotationComments"><span class="hs-identifier hs-var">getAnnotationComments</span></a><span class="hs-special">,</span><span> </span><a href="ApiAnnotation.html#getAndRemoveAnnotationComments"><span class="hs-identifier hs-var">getAndRemoveAnnotationComments</span></a><span class="hs-special">,</span><span>
</span><a name="line-274"></a><span>        </span><a href="ApiAnnotation.html#unicodeAnn"><span class="hs-identifier hs-var">unicodeAnn</span></a><span class="hs-special">,</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span>        </span><span class="hs-comment">-- * Miscellaneous</span><span>
</span><a name="line-277"></a><span>        </span><span class="hs-comment">--sessionHscEnv,</span><span>
</span><a name="line-278"></a><span>        </span><a href="GhcMake.html#cyclicModuleErr"><span class="hs-identifier hs-var">cyclicModuleErr</span></a><span class="hs-special">,</span><span>
</span><a name="line-279"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-comment">{-
 ToDo:

  * inline bits of HscMain here to simplify layering: hscTcExpr, hscStmt.
  * what StaticFlags should we expose, if any?
-}</span><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-291"></a><span class="hs-keyword">import</span><span> </span><a href="ByteCodeTypes.html"><span class="hs-identifier">ByteCodeTypes</span></a><span>
</span><a name="line-292"></a><span class="hs-keyword">import</span><span> </span><a href="InteractiveEval.html"><span class="hs-identifier">InteractiveEval</span></a><span>
</span><a name="line-293"></a><span class="hs-keyword">import</span><span> </span><a href="InteractiveEvalTypes.html"><span class="hs-identifier">InteractiveEvalTypes</span></a><span>
</span><a name="line-294"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnDriver.html"><span class="hs-identifier">TcRnDriver</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="TcRnDriver.html#runTcInteractive"><span class="hs-identifier hs-var">runTcInteractive</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-295"></a><span class="hs-keyword">import</span><span> </span><a href="GHCi.html"><span class="hs-identifier">GHCi</span></a><span>
</span><a name="line-296"></a><span class="hs-keyword">import</span><span> </span><a href="../ghci-8.1/src/%{MODULE/./-}.html#%{NAME}/GHCi.RemoteTypes.html"><span class="hs-identifier">GHCi</span><span class="hs-operator">.</span><span class="hs-identifier">RemoteTypes</span></a><span>
</span><a name="line-297"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><span class="hs-keyword">import</span><span> </span><a href="PprTyThing.html"><span class="hs-identifier">PprTyThing</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="PprTyThing.html#pprFamInst"><span class="hs-identifier hs-var">pprFamInst</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span class="hs-keyword">import</span><span> </span><a href="HscMain.html"><span class="hs-identifier">HscMain</span></a><span>
</span><a name="line-301"></a><span class="hs-keyword">import</span><span> </span><a href="GhcMake.html"><span class="hs-identifier">GhcMake</span></a><span>
</span><a name="line-302"></a><span class="hs-keyword">import</span><span> </span><a href="DriverPipeline.html"><span class="hs-identifier">DriverPipeline</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="DriverPipeline.html#compileOne%27"><span class="hs-identifier hs-var">compileOne'</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span class="hs-keyword">import</span><span> </span><a href="GhcMonad.html"><span class="hs-identifier">GhcMonad</span></a><span>
</span><a name="line-304"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="TcRnMonad.html#finalSafeMode"><span class="hs-identifier hs-var">finalSafeMode</span></a><span class="hs-special">,</span><span> </span><a href="TcRnMonad.html#fixSafeInstances"><span class="hs-identifier hs-var">fixSafeInstances</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnTypes.html"><span class="hs-identifier">TcRnTypes</span></a><span>
</span><a name="line-306"></a><span class="hs-keyword">import</span><span> </span><a href="Packages.html"><span class="hs-identifier">Packages</span></a><span>
</span><a name="line-307"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-308"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span>
</span><a name="line-309"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-310"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>     </span><span class="hs-keyword">hiding</span><span class="hs-special">(</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-311"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>           </span><span class="hs-keyword">hiding</span><span class="hs-special">(</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-313"></a><span class="hs-keyword">import</span><span> </span><a href="TysPrim.html"><span class="hs-identifier">TysPrim</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="TysPrim.html#alphaTyVars"><span class="hs-identifier hs-var">alphaTyVars</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-314"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-315"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-316"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-317"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>             </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="OccName.html#varName"><span class="hs-identifier hs-var">varName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-318"></a><span class="hs-keyword">import</span><span> </span><a href="Avail.html"><span class="hs-identifier">Avail</span></a><span>
</span><a name="line-319"></a><span class="hs-keyword">import</span><span> </span><a href="InstEnv.html"><span class="hs-identifier">InstEnv</span></a><span>
</span><a name="line-320"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-321"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-322"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>
</span><a name="line-323"></a><span class="hs-keyword">import</span><span> </span><a href="TidyPgm.html"><span class="hs-identifier">TidyPgm</span></a><span>
</span><a name="line-324"></a><span class="hs-keyword">import</span><span> </span><a href="DriverPhases.html"><span class="hs-identifier">DriverPhases</span></a><span>     </span><span class="hs-special">(</span><span> </span><a href="DriverPhases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DriverPhases.html#isHaskellSrcFilename"><span class="hs-identifier hs-var">isHaskellSrcFilename</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-325"></a><span class="hs-keyword">import</span><span> </span><a href="Finder.html"><span class="hs-identifier">Finder</span></a><span>
</span><a name="line-326"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-327"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-328"></a><span class="hs-keyword">import</span><span> </span><a href="StaticFlags.html"><span class="hs-identifier">StaticFlags</span></a><span>
</span><a name="line-329"></a><span class="hs-keyword">import</span><span> </span><a href="SysTools.html"><span class="hs-identifier">SysTools</span></a><span>
</span><a name="line-330"></a><span class="hs-keyword">import</span><span> </span><a href="Annotations.html"><span class="hs-identifier">Annotations</span></a><span>
</span><a name="line-331"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-332"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>
</span><a name="line-333"></a><span class="hs-keyword">import</span><span> </span><a href="Panic.html"><span class="hs-identifier">Panic</span></a><span>
</span><a name="line-334"></a><span class="hs-keyword">import</span><span> </span><a href="Platform.html"><span class="hs-identifier">Platform</span></a><span>
</span><a name="line-335"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>              </span><span class="hs-special">(</span><span> </span><a href="Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-336"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span>
</span><a name="line-337"></a><span class="hs-keyword">import</span><span> </span><a href="MonadUtils.html"><span class="hs-identifier">MonadUtils</span></a><span>
</span><a name="line-338"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-339"></a><span class="hs-keyword">import</span><span> </span><a href="StringBuffer.html"><span class="hs-identifier">StringBuffer</span></a><span>
</span><a name="line-340"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-341"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-342"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>           </span><span class="hs-special">(</span><span> </span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-343"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-344"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Parser.html"><span class="hs-identifier">Parser</span></a><span>
</span><a name="line-345"></a><span class="hs-keyword">import</span><span> </span><a href="Lexer.html"><span class="hs-identifier">Lexer</span></a><span>
</span><a name="line-346"></a><span class="hs-keyword">import</span><span> </span><a href="ApiAnnotation.html"><span class="hs-identifier">ApiAnnotation</span></a><span>
</span><a name="line-347"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../ghc-boot-8.1/src/%{MODULE/./-}.html#%{NAME}/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-keyword">import</span><span> </span><a href="../directory-1.2.5.1/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Directory</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="../directory-1.2.5.1/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-350"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span></a><span>
</span><a name="line-351"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#find"><span class="hs-identifier hs-var">find</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-352"></a><span class="hs-keyword">import</span><span> </span><a href="../time-1.6/src/%{MODULE/./-}.html#%{NAME}/Data.Time.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span></a><span>
</span><a name="line-353"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Typeable.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span></a><span>    </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-354"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Word.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-355"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-356"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Exit.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Exit</span></a><span>      </span><span class="hs-special">(</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Exit.html#exitWith"><span class="hs-identifier hs-var">exitWith</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span class="hs-keyword">import</span><span> </span><a href="Exception.html"><span class="hs-identifier">Exception</span></a><span>
</span><a name="line-358"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span></a><span>
</span><a name="line-359"></a><span class="hs-keyword">import</span><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">FilePath</span></a><span>
</span><a name="line-360"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/System.IO.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span></a><span>
</span><a name="line-361"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Prelude.html"><span class="hs-identifier">Prelude</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#init"><span class="hs-identifier hs-var">init</span></a><span class="hs-special">)</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span>
</span><a name="line-364"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-366"></a><span class="hs-comment">--             Initialisation: exception handlers</span><span>
</span><a name="line-367"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-368"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-comment">-- | Install some default exception handlers and run the inner computation.</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- Unless you want to handle exceptions yourself, you should wrap this around</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- the top level of your program.  The default handlers output the error</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- message(s) to stderr and exit cleanly.</span><span>
</span><a name="line-375"></a><span class="hs-identifier">defaultErrorHandler</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Exception.html#ExceptionMonad"><span class="hs-identifier hs-type">ExceptionMonad</span></a><span> </span><a href="#local-1628316125"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="DynFlags.html#FatalMessager"><span class="hs-identifier hs-type">FatalMessager</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#FlushOut"><span class="hs-identifier hs-type">FlushOut</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316125"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1628316126"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316125"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1628316126"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-377"></a><a name="defaultErrorHandler"><a href="GHC.html#defaultErrorHandler"><span class="hs-identifier">defaultErrorHandler</span></a></a><span> </span><a name="local-1628316127"><a href="#local-1628316127"><span class="hs-identifier">fm</span></a></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#FlushOut"><span class="hs-identifier hs-var">FlushOut</span></a><span> </span><a name="local-1628316128"><a href="#local-1628316128"><span class="hs-identifier">flushOut</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628316129"><a href="#local-1628316129"><span class="hs-identifier">inner</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-378"></a><span>  </span><span class="hs-comment">-- top-level exception handler: any unrecognised exception is a compiler bug.</span><span>
</span><a name="line-379"></a><span>  </span><a href="Exception.html#ghandle"><span class="hs-identifier hs-var">ghandle</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628316130"><a href="#local-1628316130"><span class="hs-identifier">exception</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-380"></a><span>           </span><a href="#local-1628316128"><span class="hs-identifier hs-var">flushOut</span></a><span>
</span><a name="line-381"></a><span>           </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Exception.html#fromException"><span class="hs-identifier hs-var">fromException</span></a><span> </span><a href="#local-1628316130"><span class="hs-identifier hs-var">exception</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-382"></a><span>                </span><span class="hs-comment">-- an IO exception probably isn't our fault, so don't panic</span><span>
</span><a name="line-383"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628316131"><a href="#local-1628316131"><span class="hs-identifier">ioe</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#IOException"><span class="hs-identifier hs-type">IOException</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-384"></a><span>                  </span><a href="ErrUtils.html#fatalErrorMsg%27%27"><span class="hs-identifier hs-var">fatalErrorMsg''</span></a><span> </span><a href="#local-1628316127"><span class="hs-identifier hs-var">fm</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-1628316131"><span class="hs-identifier hs-var">ioe</span></a><span class="hs-special">)</span><span>
</span><a name="line-385"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Exception.html#fromException"><span class="hs-identifier hs-var">fromException</span></a><span> </span><a href="#local-1628316130"><span class="hs-identifier hs-var">exception</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-386"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#UserInterrupt"><span class="hs-identifier hs-var">UserInterrupt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-387"></a><span>                         </span><span class="hs-comment">-- Important to let this one propagate out so our</span><span>
</span><a name="line-388"></a><span>                         </span><span class="hs-comment">-- calling process knows we were interrupted by ^C</span><span>
</span><a name="line-389"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#UserInterrupt"><span class="hs-identifier hs-var">UserInterrupt</span></a><span>
</span><a name="line-390"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#StackOverflow"><span class="hs-identifier hs-var">StackOverflow</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-391"></a><span>                         </span><a href="ErrUtils.html#fatalErrorMsg%27%27"><span class="hs-identifier hs-var">fatalErrorMsg''</span></a><span> </span><a href="#local-1628316127"><span class="hs-identifier hs-var">fm</span></a><span> </span><span class="hs-string">&quot;stack overflow: use +RTS -K&lt;size&gt; to increase it&quot;</span><span>
</span><a name="line-392"></a><span>                     </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Exception.html#fromException"><span class="hs-identifier hs-var">fromException</span></a><span> </span><a href="#local-1628316130"><span class="hs-identifier hs-var">exception</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-393"></a><span>                          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628316132"><a href="#local-1628316132"><span class="hs-identifier">ex</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitCode"><span class="hs-identifier hs-type">ExitCode</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a><span> </span><a href="#local-1628316132"><span class="hs-identifier hs-var">ex</span></a><span>
</span><a name="line-394"></a><span>                          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-395"></a><span>                              </span><a href="ErrUtils.html#fatalErrorMsg%27%27"><span class="hs-identifier hs-var">fatalErrorMsg''</span></a><span> </span><a href="#local-1628316127"><span class="hs-identifier hs-var">fm</span></a><span>
</span><a name="line-396"></a><span>                                  </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#Panic"><span class="hs-identifier hs-var">Panic</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-1628316130"><span class="hs-identifier hs-var">exception</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-397"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Exit.html#exitWith"><span class="hs-identifier hs-var">exitWith</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitFailure"><span class="hs-identifier hs-var">ExitFailure</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-398"></a><span>         </span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span>  </span><span class="hs-comment">-- error messages propagated as exceptions</span><span>
</span><a name="line-401"></a><span>  </span><a href="Panic.html#handleGhcException"><span class="hs-identifier hs-var">handleGhcException</span></a><span>
</span><a name="line-402"></a><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628316133"><a href="#local-1628316133"><span class="hs-identifier">ge</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-403"></a><span>                </span><a href="#local-1628316128"><span class="hs-identifier hs-var">flushOut</span></a><span>
</span><a name="line-404"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628316133"><span class="hs-identifier hs-var">ge</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-405"></a><span>                     </span><a href="Panic.html#Signal"><span class="hs-identifier hs-var">Signal</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Exit.html#exitWith"><span class="hs-identifier hs-var">exitWith</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitFailure"><span class="hs-identifier hs-var">ExitFailure</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-406"></a><span>                     </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="ErrUtils.html#fatalErrorMsg%27%27"><span class="hs-identifier hs-var">fatalErrorMsg''</span></a><span> </span><a href="#local-1628316127"><span class="hs-identifier hs-var">fm</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-1628316133"><span class="hs-identifier hs-var">ge</span></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>                             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/System.Exit.html#exitWith"><span class="hs-identifier hs-var">exitWith</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.Exception.html#ExitFailure"><span class="hs-identifier hs-var">ExitFailure</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span>            </span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-409"></a><span>  </span><a href="#local-1628316129"><span class="hs-identifier hs-var">inner</span></a><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span class="hs-comment">-- | This function is no longer necessary, cleanup is now done by</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- runGhc/runGhcT.</span><span>
</span><a name="line-413"></a><span class="hs-pragma">{-# DEPRECATED defaultCleanupHandler &quot;Cleanup is now done by runGhc/runGhcT&quot; #-}</span><span>
</span><a name="line-414"></a><span class="hs-identifier">defaultCleanupHandler</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Exception.html#ExceptionMonad"><span class="hs-identifier hs-type">ExceptionMonad</span></a><span> </span><a href="#local-1628316123"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316123"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1628316124"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316123"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1628316124"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-415"></a><a name="defaultCleanupHandler"><a href="GHC.html#defaultCleanupHandler"><span class="hs-identifier">defaultCleanupHandler</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628316134"><a href="#local-1628316134"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316134"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-416"></a><span> </span><span class="hs-keyword">where</span><span> </span><a name="local-1628316135"><a href="#local-1628316135"><span class="hs-identifier">_warning_suppression</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316134"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">`</span><a href="Exception.html#gonException"><span class="hs-identifier hs-var">gonException</span></a><span class="hs-special">`</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Err.html#undefined"><span class="hs-identifier hs-var">undefined</span></a><span>
</span><a name="line-417"></a><span>
</span><a name="line-418"></a><span>
</span><a name="line-419"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-420"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-421"></a><span class="hs-comment">--             The Ghc Monad</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span class="hs-comment">-- | Run function for the 'Ghc' monad.</span><span>
</span><a name="line-426"></a><span class="hs-comment">--</span><span>
</span><a name="line-427"></a><span class="hs-comment">-- It initialises the GHC session and warnings via 'initGhcMonad'.  Each call</span><span>
</span><a name="line-428"></a><span class="hs-comment">-- to this function will create a new session which should not be shared among</span><span>
</span><a name="line-429"></a><span class="hs-comment">-- several threads.</span><span>
</span><a name="line-430"></a><span class="hs-comment">--</span><span>
</span><a name="line-431"></a><span class="hs-comment">-- Any errors not handled inside the 'Ghc' action are propagated as IO</span><span>
</span><a name="line-432"></a><span class="hs-comment">-- exceptions.</span><span>
</span><a name="line-433"></a><span>
</span><a name="line-434"></a><span class="hs-identifier">runGhc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>  </span><span class="hs-comment">-- ^ See argument to 'initGhcMonad'.</span><span>
</span><a name="line-435"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GhcMonad.html#Ghc"><span class="hs-identifier hs-type">Ghc</span></a><span> </span><a href="#local-1628316122"><span class="hs-identifier hs-type">a</span></a><span>           </span><span class="hs-comment">-- ^ The action to perform.</span><span>
</span><a name="line-436"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1628316122"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-437"></a><a name="runGhc"><a href="GHC.html#runGhc"><span class="hs-identifier">runGhc</span></a></a><span> </span><a name="local-1628316136"><a href="#local-1628316136"><span class="hs-identifier">mb_top_dir</span></a></a><span> </span><a name="local-1628316137"><a href="#local-1628316137"><span class="hs-identifier">ghc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-438"></a><span>  </span><a name="local-1628316138"><a href="#local-1628316138"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;empty session&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-439"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316139"><a href="#local-1628316139"><span class="hs-identifier">session</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GhcMonad.html#Session"><span class="hs-identifier hs-var">Session</span></a><span> </span><a href="#local-1628316138"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-440"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a><span> </span><span class="hs-identifier">unGhc</span><span> </span><a href="#local-1628316139"><span class="hs-identifier hs-var">session</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-441"></a><span>    </span><a href="GHC.html#initGhcMonad"><span class="hs-identifier hs-var">initGhcMonad</span></a><span> </span><a href="#local-1628316136"><span class="hs-identifier hs-var">mb_top_dir</span></a><span>
</span><a name="line-442"></a><span>    </span><a href="GHC.html#withCleanupSession"><span class="hs-identifier hs-var">withCleanupSession</span></a><span> </span><a href="#local-1628316137"><span class="hs-identifier hs-var">ghc</span></a><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span>  </span><span class="hs-comment">-- XXX: unregister interrupt handlers here?</span><span>
</span><a name="line-445"></a><span>
</span><a name="line-446"></a><span class="hs-comment">-- | Run function for 'GhcT' monad transformer.</span><span>
</span><a name="line-447"></a><span class="hs-comment">--</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- It initialises the GHC session and warnings via 'initGhcMonad'.  Each call</span><span>
</span><a name="line-449"></a><span class="hs-comment">-- to this function will create a new session which should not be shared among</span><span>
</span><a name="line-450"></a><span class="hs-comment">-- several threads.</span><span>
</span><a name="line-451"></a><span>
</span><a name="line-452"></a><span class="hs-identifier">runGhcT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Exception.html#ExceptionMonad"><span class="hs-identifier hs-type">ExceptionMonad</span></a><span> </span><a href="#local-1628316120"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-453"></a><span>           </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span>  </span><span class="hs-comment">-- ^ See argument to 'initGhcMonad'.</span><span>
</span><a name="line-454"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GhcMonad.html#GhcT"><span class="hs-identifier hs-type">GhcT</span></a><span> </span><a href="#local-1628316120"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1628316121"><span class="hs-identifier hs-type">a</span></a><span>        </span><span class="hs-comment">-- ^ The action to perform.</span><span>
</span><a name="line-455"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316120"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1628316121"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-456"></a><a name="runGhcT"><a href="GHC.html#runGhcT"><span class="hs-identifier">runGhcT</span></a></a><span> </span><a name="local-1628316140"><a href="#local-1628316140"><span class="hs-identifier">mb_top_dir</span></a></a><span> </span><a name="local-1628316141"><a href="#local-1628316141"><span class="hs-identifier">ghct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-457"></a><span>  </span><a name="local-1628316142"><a href="#local-1628316142"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;empty session&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-458"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316143"><a href="#local-1628316143"><span class="hs-identifier">session</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GhcMonad.html#Session"><span class="hs-identifier hs-var">Session</span></a><span> </span><a href="#local-1628316142"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-459"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a><span> </span><span class="hs-identifier">unGhcT</span><span> </span><a href="#local-1628316143"><span class="hs-identifier hs-var">session</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-460"></a><span>    </span><a href="GHC.html#initGhcMonad"><span class="hs-identifier hs-var">initGhcMonad</span></a><span> </span><a href="#local-1628316140"><span class="hs-identifier hs-var">mb_top_dir</span></a><span>
</span><a name="line-461"></a><span>    </span><a href="GHC.html#withCleanupSession"><span class="hs-identifier hs-var">withCleanupSession</span></a><span> </span><a href="#local-1628316141"><span class="hs-identifier hs-var">ghct</span></a><span>
</span><a name="line-462"></a><span>
</span><a name="line-463"></a><span class="hs-identifier">withCleanupSession</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316118"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1628316118"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1628316119"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316118"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1628316119"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-464"></a><a name="withCleanupSession"><a href="GHC.html#withCleanupSession"><span class="hs-identifier">withCleanupSession</span></a></a><span> </span><a name="local-1628316144"><a href="#local-1628316144"><span class="hs-identifier">ghc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316144"><span class="hs-identifier hs-var">ghc</span></a><span> </span><span class="hs-special">`</span><a href="Exception.html#gfinally"><span class="hs-identifier hs-var">gfinally</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628316145"><span class="hs-identifier hs-var">cleanup</span></a><span>
</span><a name="line-465"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-466"></a><span>   </span><a name="local-1628316145"><a href="#local-1628316145"><span class="hs-identifier">cleanup</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-467"></a><span>      </span><a name="local-1628316146"><a href="#local-1628316146"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GhcMonad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a><span>
</span><a name="line-468"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316147"><a href="#local-1628316147"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628316146"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-469"></a><span>      </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-470"></a><span>          </span><a href="SysTools.html#cleanTempFiles"><span class="hs-identifier hs-var">cleanTempFiles</span></a><span> </span><a href="#local-1628316147"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-471"></a><span>          </span><a href="SysTools.html#cleanTempDirs"><span class="hs-identifier hs-var">cleanTempDirs</span></a><span> </span><a href="#local-1628316147"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-472"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-473"></a><span>          </span><a href="GHCi.html#stopIServ"><span class="hs-identifier hs-var">stopIServ</span></a><span> </span><a href="#local-1628316146"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><span class="hs-comment">-- shut down the IServ</span><span>
</span><a name="line-474"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-475"></a><span>          </span><span class="hs-comment">--  exceptions will be blocked while we clean the temporary files,</span><span>
</span><a name="line-476"></a><span>          </span><span class="hs-comment">-- so there shouldn't be any difficulty if we receive further</span><span>
</span><a name="line-477"></a><span>          </span><span class="hs-comment">-- signals.</span><span>
</span><a name="line-478"></a><span>
</span><a name="line-479"></a><span class="hs-comment">-- | Initialise a GHC session.</span><span>
</span><a name="line-480"></a><span class="hs-comment">--</span><span>
</span><a name="line-481"></a><span class="hs-comment">-- If you implement a custom 'GhcMonad' you must call this function in the</span><span>
</span><a name="line-482"></a><span class="hs-comment">-- monad run function.  It will initialise the session variable and clear all</span><span>
</span><a name="line-483"></a><span class="hs-comment">-- warnings.</span><span>
</span><a name="line-484"></a><span class="hs-comment">--</span><span>
</span><a name="line-485"></a><span class="hs-comment">-- The first argument should point to the directory where GHC's library files</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- reside.  More precisely, this should be the output of @ghc --print-libdir@</span><span>
</span><a name="line-487"></a><span class="hs-comment">-- of the version of GHC the module using this API is compiled with.  For</span><span>
</span><a name="line-488"></a><span class="hs-comment">-- portability, you should use the @ghc-paths@ package, available at</span><span>
</span><a name="line-489"></a><span class="hs-comment">-- &lt;http://hackage.haskell.org/package/ghc-paths&gt;.</span><span>
</span><a name="line-490"></a><span>
</span><a name="line-491"></a><span class="hs-identifier">initGhcMonad</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316117"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316117"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-492"></a><a name="initGhcMonad"><a href="GHC.html#initGhcMonad"><span class="hs-identifier">initGhcMonad</span></a></a><span> </span><a name="local-1628316148"><a href="#local-1628316148"><span class="hs-identifier">mb_top_dir</span></a></a><span>
</span><a name="line-493"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628316151"><a href="#local-1628316151"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-494"></a><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="Panic.html#installSignalHandlers"><span class="hs-identifier hs-var">installSignalHandlers</span></a><span>  </span><span class="hs-comment">-- catch ^C</span><span>
</span><a name="line-495"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="StaticFlags.html#initStaticOpts"><span class="hs-identifier hs-var">initStaticOpts</span></a><span>
</span><a name="line-496"></a><span>                   </span><span class="hs-special">;</span><span> </span><a name="local-1628316149"><a href="#local-1628316149"><span class="hs-identifier">mySettings</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="SysTools.html#initSysTools"><span class="hs-identifier hs-var">initSysTools</span></a><span> </span><a href="#local-1628316148"><span class="hs-identifier hs-var">mb_top_dir</span></a><span>
</span><a name="line-497"></a><span>                   </span><span class="hs-special">;</span><span> </span><a name="local-1628316150"><a href="#local-1628316150"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#initDynFlags"><span class="hs-identifier hs-var">initDynFlags</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#defaultDynFlags"><span class="hs-identifier hs-var">defaultDynFlags</span></a><span> </span><a href="#local-1628316149"><span class="hs-identifier hs-var">mySettings</span></a><span class="hs-special">)</span><span>
</span><a name="line-498"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="GHC.html#checkBrokenTablesNextToCode"><span class="hs-identifier hs-var">checkBrokenTablesNextToCode</span></a><span> </span><a href="#local-1628316150"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-499"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="DynFlags.html#setUnsafeGlobalDynFlags"><span class="hs-identifier hs-var">setUnsafeGlobalDynFlags</span></a><span> </span><a href="#local-1628316150"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-500"></a><span>                      </span><span class="hs-comment">-- c.f. DynFlags.parseDynamicFlagsFull, which</span><span>
</span><a name="line-501"></a><span>                      </span><span class="hs-comment">-- creates DynFlags and sets the UnsafeGlobalDynFlags</span><span>
</span><a name="line-502"></a><span>                   </span><span class="hs-special">;</span><span> </span><a href="HscMain.html#newHscEnv"><span class="hs-identifier hs-var">newHscEnv</span></a><span> </span><a href="#local-1628316150"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-503"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="GhcMonad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a><span> </span><a href="#local-1628316151"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-504"></a><span>
</span><a name="line-505"></a><span class="hs-comment">-- | The binutils linker on ARM emits unnecessary R_ARM_COPY relocations which</span><span>
</span><a name="line-506"></a><span class="hs-comment">-- breaks tables-next-to-code in dynamically linked modules. This</span><span>
</span><a name="line-507"></a><span class="hs-comment">-- check should be more selective but there is currently no released</span><span>
</span><a name="line-508"></a><span class="hs-comment">-- version where this bug is fixed.</span><span>
</span><a name="line-509"></a><span class="hs-comment">-- See https://sourceware.org/bugzilla/show_bug.cgi?id=16177 and</span><span>
</span><a name="line-510"></a><span class="hs-comment">-- https://ghc.haskell.org/trac/ghc/ticket/4210#comment:29</span><span>
</span><a name="line-511"></a><span class="hs-identifier">checkBrokenTablesNextToCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#MonadIO"><span class="hs-identifier hs-type">MonadIO</span></a><span> </span><a href="#local-1628316116"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316116"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-512"></a><a name="checkBrokenTablesNextToCode"><a href="GHC.html#checkBrokenTablesNextToCode"><span class="hs-identifier">checkBrokenTablesNextToCode</span></a></a><span> </span><a name="local-1628316152"><a href="#local-1628316152"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-513"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-1628316154"><a href="#local-1628316154"><span class="hs-identifier">broken</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.html#checkBrokenTablesNextToCode%27"><span class="hs-identifier hs-var">checkBrokenTablesNextToCode'</span></a><span> </span><a href="#local-1628316152"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-514"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="#local-1628316154"><span class="hs-identifier hs-var">broken</span></a><span>
</span><a name="line-515"></a><span>         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HscTypes.html#mkApiErr"><span class="hs-identifier hs-var">mkApiErr</span></a><span> </span><a href="#local-1628316152"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628316153"><span class="hs-identifier hs-var">invalidLdErr</span></a><span>
</span><a name="line-516"></a><span>              </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fail"><span class="hs-identifier hs-var">fail</span></a><span> </span><span class="hs-string">&quot;unsupported linker&quot;</span><span>
</span><a name="line-517"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-518"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-519"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-520"></a><span>    </span><a name="local-1628316153"><a href="#local-1628316153"><span class="hs-identifier">invalidLdErr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Tables-next-to-code not supported on ARM&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-521"></a><span>                   </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;when using binutils ld (please see:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-522"></a><span>                   </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;https://sourceware.org/bugzilla/show_bug.cgi?id=16177)&quot;</span><span>
</span><a name="line-523"></a><span>
</span><a name="line-524"></a><span class="hs-identifier">checkBrokenTablesNextToCode'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#MonadIO"><span class="hs-identifier hs-type">MonadIO</span></a><span> </span><a href="#local-1628316115"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316115"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-525"></a><a name="checkBrokenTablesNextToCode%27"><a href="GHC.html#checkBrokenTablesNextToCode%27"><span class="hs-identifier">checkBrokenTablesNextToCode'</span></a></a><span> </span><a name="local-1628316155"><a href="#local-1628316155"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-526"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Platform.html#isARM"><span class="hs-identifier hs-var">isARM</span></a><span> </span><a href="#local-1628316157"><span class="hs-identifier hs-var">arch</span></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-527"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#notElem"><span class="hs-identifier hs-var">notElem</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">ways</span><span> </span><a href="#local-1628316155"><span class="hs-identifier hs-var">dflags</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-528"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#tablesNextToCode"><span class="hs-identifier hs-var">tablesNextToCode</span></a><span> </span><a href="#local-1628316155"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-529"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-530"></a><span>    </span><a name="local-1628316158"><a href="#local-1628316158"><span class="hs-identifier">linkerInfo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="SysTools.html#getLinkerInfo"><span class="hs-identifier hs-var">getLinkerInfo</span></a><span> </span><a href="#local-1628316155"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-531"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628316158"><span class="hs-identifier hs-var">linkerInfo</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-532"></a><span>      </span><a href="DynFlags.html#GnuLD"><span class="hs-identifier hs-var">GnuLD</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-533"></a><span>      </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-534"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1628316156"><a href="#local-1628316156"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a><span> </span><a href="#local-1628316155"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-535"></a><span>        </span><a name="local-1628316157"><a href="#local-1628316157"><span class="hs-identifier">arch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">platformArch</span><span> </span><a href="#local-1628316156"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-536"></a><span>
</span><a name="line-537"></a><span>
</span><a name="line-538"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-539"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-540"></a><span class="hs-comment">--             Flags &amp; settings</span><span>
</span><a name="line-541"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-542"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-543"></a><span>
</span><a name="line-544"></a><span class="hs-comment">-- $DynFlags</span><span>
</span><a name="line-545"></a><span class="hs-comment">--</span><span>
</span><a name="line-546"></a><span class="hs-comment">-- The GHC session maintains two sets of 'DynFlags':</span><span>
</span><a name="line-547"></a><span class="hs-comment">--</span><span>
</span><a name="line-548"></a><span class="hs-comment">--   * The &quot;interactive&quot; @DynFlags@, which are used for everything</span><span>
</span><a name="line-549"></a><span class="hs-comment">--     related to interactive evaluation, including 'runStmt',</span><span>
</span><a name="line-550"></a><span class="hs-comment">--     'runDecls', 'exprType', 'lookupName' and so on (everything</span><span>
</span><a name="line-551"></a><span class="hs-comment">--     under \&quot;Interactive evaluation\&quot; in this module).</span><span>
</span><a name="line-552"></a><span class="hs-comment">--</span><span>
</span><a name="line-553"></a><span class="hs-comment">--   * The &quot;program&quot; @DynFlags@, which are used when loading</span><span>
</span><a name="line-554"></a><span class="hs-comment">--     whole modules with 'load'</span><span>
</span><a name="line-555"></a><span class="hs-comment">--</span><span>
</span><a name="line-556"></a><span class="hs-comment">-- 'setInteractiveDynFlags', 'getInteractiveDynFlags' work with the</span><span>
</span><a name="line-557"></a><span class="hs-comment">-- interactive @DynFlags@.</span><span>
</span><a name="line-558"></a><span class="hs-comment">--</span><span>
</span><a name="line-559"></a><span class="hs-comment">-- 'setProgramDynFlags', 'getProgramDynFlags' work with the</span><span>
</span><a name="line-560"></a><span class="hs-comment">-- program @DynFlags@.</span><span>
</span><a name="line-561"></a><span class="hs-comment">--</span><span>
</span><a name="line-562"></a><span class="hs-comment">-- 'setSessionDynFlags' sets both @DynFlags@, and 'getSessionDynFlags'</span><span>
</span><a name="line-563"></a><span class="hs-comment">-- retrieves the program @DynFlags@ (for backwards compatibility).</span><span>
</span><a name="line-564"></a><span>
</span><a name="line-565"></a><span>
</span><a name="line-566"></a><span class="hs-comment">-- | Updates both the interactive and program DynFlags in a Session.</span><span>
</span><a name="line-567"></a><span class="hs-comment">-- This also reads the package database (unless it has already been</span><span>
</span><a name="line-568"></a><span class="hs-comment">-- read), and prepares the compilers knowledge about packages.  It can</span><span>
</span><a name="line-569"></a><span class="hs-comment">-- be called again to load new packages: just add new package flags to</span><span>
</span><a name="line-570"></a><span class="hs-comment">-- (packageFlags dflags).</span><span>
</span><a name="line-571"></a><span class="hs-comment">--</span><span>
</span><a name="line-572"></a><span class="hs-comment">-- Returns a list of new packages that may need to be linked in using</span><span>
</span><a name="line-573"></a><span class="hs-comment">-- the dynamic linker (see 'linkPackages') as a result of new package</span><span>
</span><a name="line-574"></a><span class="hs-comment">-- flags.  If you are not doing linking or doing static linking, you</span><span>
</span><a name="line-575"></a><span class="hs-comment">-- can ignore the list of packages returned.</span><span>
</span><a name="line-576"></a><span class="hs-comment">--</span><span>
</span><a name="line-577"></a><span class="hs-identifier">setSessionDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316114"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316114"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>
</span><a name="line-578"></a><a name="setSessionDynFlags"><a href="GHC.html#setSessionDynFlags"><span class="hs-identifier">setSessionDynFlags</span></a></a><span> </span><a name="local-1628316159"><a href="#local-1628316159"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-579"></a><span>  </span><a name="local-1628316160"><a href="#local-1628316160"><span class="hs-identifier">dflags'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.html#checkNewDynFlags"><span class="hs-identifier hs-var">checkNewDynFlags</span></a><span> </span><a href="#local-1628316159"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-580"></a><span>  </span><span class="hs-special">(</span><a name="local-1628316161"><a href="#local-1628316161"><span class="hs-identifier">dflags''</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628316162"><a href="#local-1628316162"><span class="hs-identifier">preload</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Packages.html#initPackages"><span class="hs-identifier hs-var">initPackages</span></a><span> </span><a href="#local-1628316160"><span class="hs-identifier hs-var">dflags'</span></a><span>
</span><a name="line-581"></a><span>  </span><a href="GhcMonad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628316163"><a href="#local-1628316163"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316163"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316161"><span class="hs-identifier hs-var">dflags''</span></a><span>
</span><a name="line-582"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsc_IC</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_IC</span><span> </span><a href="#local-1628316163"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_dflags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316161"><span class="hs-identifier hs-var">dflags''</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-583"></a><span>  </span><a href="GHC.html#invalidateModSummaryCache"><span class="hs-identifier hs-var">invalidateModSummaryCache</span></a><span>
</span><a name="line-584"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628316162"><span class="hs-identifier hs-var">preload</span></a><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span class="hs-comment">-- | Sets the program 'DynFlags'.</span><span>
</span><a name="line-587"></a><span class="hs-identifier">setProgramDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316113"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316113"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>
</span><a name="line-588"></a><a name="setProgramDynFlags"><a href="GHC.html#setProgramDynFlags"><span class="hs-identifier">setProgramDynFlags</span></a></a><span> </span><a name="local-1628316164"><a href="#local-1628316164"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-589"></a><span>  </span><a name="local-1628316165"><a href="#local-1628316165"><span class="hs-identifier">dflags'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.html#checkNewDynFlags"><span class="hs-identifier hs-var">checkNewDynFlags</span></a><span> </span><a href="#local-1628316164"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-590"></a><span>  </span><span class="hs-special">(</span><a name="local-1628316166"><a href="#local-1628316166"><span class="hs-identifier">dflags''</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628316167"><a href="#local-1628316167"><span class="hs-identifier">preload</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Packages.html#initPackages"><span class="hs-identifier hs-var">initPackages</span></a><span> </span><a href="#local-1628316165"><span class="hs-identifier hs-var">dflags'</span></a><span>
</span><a name="line-591"></a><span>  </span><a href="GhcMonad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628316168"><a href="#local-1628316168"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316168"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316166"><span class="hs-identifier hs-var">dflags''</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-592"></a><span>  </span><a href="GHC.html#invalidateModSummaryCache"><span class="hs-identifier hs-var">invalidateModSummaryCache</span></a><span>
</span><a name="line-593"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628316167"><span class="hs-identifier hs-var">preload</span></a><span>
</span><a name="line-594"></a><span>
</span><a name="line-595"></a><span class="hs-comment">-- When changing the DynFlags, we want the changes to apply to future</span><span>
</span><a name="line-596"></a><span class="hs-comment">-- loads, but without completely discarding the program.  But the</span><span>
</span><a name="line-597"></a><span class="hs-comment">-- DynFlags are cached in each ModSummary in the hsc_mod_graph, so</span><span>
</span><a name="line-598"></a><span class="hs-comment">-- after a change to DynFlags, the changes would apply to new modules</span><span>
</span><a name="line-599"></a><span class="hs-comment">-- but not existing modules; this seems undesirable.</span><span>
</span><a name="line-600"></a><span class="hs-comment">--</span><span>
</span><a name="line-601"></a><span class="hs-comment">-- Furthermore, the GHC API client might expect that changing</span><span>
</span><a name="line-602"></a><span class="hs-comment">-- log_action would affect future compilation messages, but for those</span><span>
</span><a name="line-603"></a><span class="hs-comment">-- modules we have cached ModSummaries for, we'll continue to use the</span><span>
</span><a name="line-604"></a><span class="hs-comment">-- old log_action.  This is definitely wrong (#7478).</span><span>
</span><a name="line-605"></a><span class="hs-comment">--</span><span>
</span><a name="line-606"></a><span class="hs-comment">-- Hence, we invalidate the ModSummary cache after changing the</span><span>
</span><a name="line-607"></a><span class="hs-comment">-- DynFlags.  We do this by tweaking the date on each ModSummary, so</span><span>
</span><a name="line-608"></a><span class="hs-comment">-- that the next downsweep will think that all the files have changed</span><span>
</span><a name="line-609"></a><span class="hs-comment">-- and preprocess them again.  This won't necessarily cause everything</span><span>
</span><a name="line-610"></a><span class="hs-comment">-- to be recompiled, because by the time we check whether we need to</span><span>
</span><a name="line-611"></a><span class="hs-comment">-- recopmile a module, we'll have re-summarised the module and have a</span><span>
</span><a name="line-612"></a><span class="hs-comment">-- correct ModSummary.</span><span>
</span><a name="line-613"></a><span class="hs-comment">--</span><span>
</span><a name="line-614"></a><span class="hs-identifier">invalidateModSummaryCache</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316112"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1628316112"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-615"></a><a name="invalidateModSummaryCache"><a href="GHC.html#invalidateModSummaryCache"><span class="hs-identifier">invalidateModSummaryCache</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-616"></a><span>  </span><a href="GhcMonad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628316183"><a href="#local-1628316183"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316183"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_mod_graph</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628316169"><span class="hs-identifier hs-var">inval</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_mod_graph</span><span> </span><a href="#local-1628316183"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-617"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-618"></a><span>  </span><a name="local-1628316169"><a href="#local-1628316169"><span class="hs-identifier">inval</span></a></a><span> </span><a name="local-1628316170"><a href="#local-1628316170"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316170"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ms_hs_date</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../time-1.6/src/%{MODULE/./-}.html#%{NAME}/Data.Time.Clock.UTCDiff.html#addUTCTime"><span class="hs-identifier hs-var">addUTCTime</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_hs_date</span><span> </span><a href="#local-1628316170"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-619"></a><span>
</span><a name="line-620"></a><span class="hs-comment">-- | Returns the program 'DynFlags'.</span><span>
</span><a name="line-621"></a><span class="hs-identifier">getProgramDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316111"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1628316111"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-622"></a><a name="getProgramDynFlags"><a href="GHC.html#getProgramDynFlags"><span class="hs-identifier">getProgramDynFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GhcMonad.html#getSessionDynFlags"><span class="hs-identifier hs-var">getSessionDynFlags</span></a><span>
</span><a name="line-623"></a><span>
</span><a name="line-624"></a><span class="hs-comment">-- | Set the 'DynFlags' used to evaluate interactive expressions.</span><span>
</span><a name="line-625"></a><span class="hs-comment">-- Note: this cannot be used for changes to packages.  Use</span><span>
</span><a name="line-626"></a><span class="hs-comment">-- 'setSessionDynFlags', or 'setProgramDynFlags' and then copy the</span><span>
</span><a name="line-627"></a><span class="hs-comment">-- 'pkgState' into the interactive @DynFlags@.</span><span>
</span><a name="line-628"></a><span class="hs-identifier">setInteractiveDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316110"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316110"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-629"></a><a name="setInteractiveDynFlags"><a href="GHC.html#setInteractiveDynFlags"><span class="hs-identifier">setInteractiveDynFlags</span></a></a><span> </span><a name="local-1628316184"><a href="#local-1628316184"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-630"></a><span>  </span><a name="local-1628316185"><a href="#local-1628316185"><span class="hs-identifier">dflags'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.html#checkNewDynFlags"><span class="hs-identifier hs-var">checkNewDynFlags</span></a><span> </span><a href="#local-1628316184"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-631"></a><span>  </span><a href="GhcMonad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628316186"><a href="#local-1628316186"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316186"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_IC</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_IC</span><span> </span><a href="#local-1628316186"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_dflags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316185"><span class="hs-identifier hs-var">dflags'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-632"></a><span>
</span><a name="line-633"></a><span class="hs-comment">-- | Get the 'DynFlags' used to evaluate interactive expressions.</span><span>
</span><a name="line-634"></a><span class="hs-identifier">getInteractiveDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316109"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1628316109"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-635"></a><a name="getInteractiveDynFlags"><a href="GHC.html#getInteractiveDynFlags"><span class="hs-identifier">getInteractiveDynFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GhcMonad.html#withSession"><span class="hs-identifier hs-var">withSession</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628316187"><a href="#local-1628316187"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_dflags</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_IC</span><span> </span><a href="#local-1628316187"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-636"></a><span>
</span><a name="line-637"></a><span>
</span><a name="line-638"></a><span class="hs-identifier">parseDynamicFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#MonadIO"><span class="hs-identifier hs-type">MonadIO</span></a><span> </span><a href="#local-1628316108"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-639"></a><span>                     </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span>
</span><a name="line-640"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316108"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-641"></a><a name="parseDynamicFlags"><a href="GHC.html#parseDynamicFlags"><span class="hs-identifier">parseDynamicFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#parseDynamicFlagsCmdLine"><span class="hs-identifier hs-var">parseDynamicFlagsCmdLine</span></a><span>
</span><a name="line-642"></a><span>
</span><a name="line-643"></a><span class="hs-comment">-- | Checks the set of new DynFlags for possibly erroneous option</span><span>
</span><a name="line-644"></a><span class="hs-comment">-- combinations when invoking 'setSessionDynFlags' and friends, and if</span><span>
</span><a name="line-645"></a><span class="hs-comment">-- found, returns a fixed copy (if possible).</span><span>
</span><a name="line-646"></a><span class="hs-identifier">checkNewDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#MonadIO"><span class="hs-identifier hs-type">MonadIO</span></a><span> </span><a href="#local-1628316107"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316107"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-647"></a><a name="checkNewDynFlags"><a href="GHC.html#checkNewDynFlags"><span class="hs-identifier">checkNewDynFlags</span></a></a><span> </span><a name="local-1628316188"><a href="#local-1628316188"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-648"></a><span>  </span><span class="hs-comment">-- See Note [DynFlags consistency]</span><span>
</span><a name="line-649"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628316189"><a href="#local-1628316189"><span class="hs-identifier">dflags'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628316190"><a href="#local-1628316190"><span class="hs-identifier">warnings</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#makeDynFlagsConsistent"><span class="hs-identifier hs-var">makeDynFlagsConsistent</span></a><span> </span><a href="#local-1628316188"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-650"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HscTypes.html#handleFlagWarnings"><span class="hs-identifier hs-var">handleFlagWarnings</span></a><span> </span><a href="#local-1628316188"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628316190"><span class="hs-identifier hs-var">warnings</span></a><span>
</span><a name="line-651"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628316189"><span class="hs-identifier hs-var">dflags'</span></a><span>
</span><a name="line-652"></a><span>
</span><a name="line-653"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-654"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-655"></a><span class="hs-comment">--             Setting, getting, and modifying the targets</span><span>
</span><a name="line-656"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-657"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-658"></a><span>
</span><a name="line-659"></a><span class="hs-comment">-- ToDo: think about relative vs. absolute file paths. And what</span><span>
</span><a name="line-660"></a><span class="hs-comment">-- happens when the current directory changes.</span><span>
</span><a name="line-661"></a><span>
</span><a name="line-662"></a><span class="hs-comment">-- | Sets the targets for this session.  Each target may be a module name</span><span>
</span><a name="line-663"></a><span class="hs-comment">-- or a filename.  The targets correspond to the set of root modules for</span><span>
</span><a name="line-664"></a><span class="hs-comment">-- the program\/library.  Unloading the current program is achieved by</span><span>
</span><a name="line-665"></a><span class="hs-comment">-- setting the current set of targets to be empty, followed by 'load'.</span><span>
</span><a name="line-666"></a><span class="hs-identifier">setTargets</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316106"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#Target"><span class="hs-identifier hs-type">Target</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316106"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-667"></a><a name="setTargets"><a href="GHC.html#setTargets"><span class="hs-identifier">setTargets</span></a></a><span> </span><a name="local-1628316191"><a href="#local-1628316191"><span class="hs-identifier">targets</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GhcMonad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628316192"><a href="#local-1628316192"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316192"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_targets</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316191"><span class="hs-identifier hs-var">targets</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-668"></a><span>
</span><a name="line-669"></a><span class="hs-comment">-- | Returns the current set of targets</span><span>
</span><a name="line-670"></a><span class="hs-identifier">getTargets</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316105"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1628316105"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="HscTypes.html#Target"><span class="hs-identifier hs-type">Target</span></a><span class="hs-special">]</span><span>
</span><a name="line-671"></a><a name="getTargets"><a href="GHC.html#getTargets"><span class="hs-identifier">getTargets</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GhcMonad.html#withSession"><span class="hs-identifier hs-var">withSession</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">hsc_targets</span><span class="hs-special">)</span><span>
</span><a name="line-672"></a><span>
</span><a name="line-673"></a><span class="hs-comment">-- | Add another target.</span><span>
</span><a name="line-674"></a><span class="hs-identifier">addTarget</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316104"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HscTypes.html#Target"><span class="hs-identifier hs-type">Target</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316104"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-675"></a><a name="addTarget"><a href="GHC.html#addTarget"><span class="hs-identifier">addTarget</span></a></a><span> </span><a name="local-1628316193"><a href="#local-1628316193"><span class="hs-identifier">target</span></a></a><span>
</span><a name="line-676"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="GhcMonad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628316194"><a href="#local-1628316194"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316194"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_targets</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316193"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">hsc_targets</span><span> </span><a href="#local-1628316194"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-677"></a><span>
</span><a name="line-678"></a><span class="hs-comment">-- | Remove a target</span><span>
</span><a name="line-679"></a><span class="hs-identifier">removeTarget</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316103"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HscTypes.html#TargetId"><span class="hs-identifier hs-type">TargetId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316103"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-680"></a><a name="removeTarget"><a href="GHC.html#removeTarget"><span class="hs-identifier">removeTarget</span></a></a><span> </span><a name="local-1628316195"><a href="#local-1628316195"><span class="hs-identifier">target_id</span></a></a><span>
</span><a name="line-681"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="GhcMonad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628316200"><a href="#local-1628316200"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316200"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_targets</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316196"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_targets</span><span> </span><a href="#local-1628316200"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-682"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-683"></a><span>   </span><a name="local-1628316196"><a href="#local-1628316196"><span class="hs-identifier">filter</span></a></a><span> </span><a name="local-1628316197"><a href="#local-1628316197"><span class="hs-identifier">targets</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628316198"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628316198"><a href="#local-1628316198"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HscTypes.html#Target"><span class="hs-identifier hs-var">Target</span></a><span> </span><a name="local-1628316199"><a href="#local-1628316199"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628316197"><span class="hs-identifier hs-var">targets</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628316199"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1628316195"><span class="hs-identifier hs-var">target_id</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-684"></a><span>
</span><a name="line-685"></a><span class="hs-comment">-- | Attempts to guess what Target a string refers to.  This function</span><span>
</span><a name="line-686"></a><span class="hs-comment">-- implements the @--make@/GHCi command-line syntax for filenames:</span><span>
</span><a name="line-687"></a><span class="hs-comment">--</span><span>
</span><a name="line-688"></a><span class="hs-comment">--   - if the string looks like a Haskell source filename, then interpret it</span><span>
</span><a name="line-689"></a><span class="hs-comment">--     as such</span><span>
</span><a name="line-690"></a><span class="hs-comment">--</span><span>
</span><a name="line-691"></a><span class="hs-comment">--   - if adding a .hs or .lhs suffix yields the name of an existing file,</span><span>
</span><a name="line-692"></a><span class="hs-comment">--     then use that</span><span>
</span><a name="line-693"></a><span class="hs-comment">--</span><span>
</span><a name="line-694"></a><span class="hs-comment">--   - otherwise interpret the string as a module name</span><span>
</span><a name="line-695"></a><span class="hs-comment">--</span><span>
</span><a name="line-696"></a><span class="hs-identifier">guessTarget</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316102"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="DriverPhases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316102"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="HscTypes.html#Target"><span class="hs-identifier hs-type">Target</span></a><span>
</span><a name="line-697"></a><a name="guessTarget"><a href="GHC.html#guessTarget"><span class="hs-identifier">guessTarget</span></a></a><span> </span><a name="local-1628316201"><a href="#local-1628316201"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628316202"><a href="#local-1628316202"><span class="hs-identifier">phase</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-698"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#Target"><span class="hs-identifier hs-var">Target</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TargetFile"><span class="hs-identifier hs-var">TargetFile</span></a><span> </span><a href="#local-1628316201"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628316202"><span class="hs-identifier hs-var">phase</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-699"></a><span class="hs-identifier">guessTarget</span><span> </span><a name="local-1628316203"><a href="#local-1628316203"><span class="hs-identifier">str</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-700"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="DriverPhases.html#isHaskellSrcFilename"><span class="hs-identifier hs-var">isHaskellSrcFilename</span></a><span> </span><a href="#local-1628316204"><span class="hs-identifier hs-var">file</span></a><span>
</span><a name="line-701"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628316208"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TargetFile"><span class="hs-identifier hs-var">TargetFile</span></a><span> </span><a href="#local-1628316204"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-702"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-703"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628316211"><a href="#local-1628316211"><span class="hs-identifier">exists</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../directory-1.2.5.1/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a><span> </span><a href="#local-1628316206"><span class="hs-identifier hs-var">hs_file</span></a><span>
</span><a name="line-704"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628316211"><span class="hs-identifier hs-var">exists</span></a><span>
</span><a name="line-705"></a><span>           </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628316208"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TargetFile"><span class="hs-identifier hs-var">TargetFile</span></a><span> </span><a href="#local-1628316206"><span class="hs-identifier hs-var">hs_file</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-706"></a><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-707"></a><span>        </span><a name="local-1628316212"><a href="#local-1628316212"><span class="hs-identifier">exists</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../directory-1.2.5.1/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a><span> </span><a href="#local-1628316207"><span class="hs-identifier hs-var">lhs_file</span></a><span>
</span><a name="line-708"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628316212"><span class="hs-identifier hs-var">exists</span></a><span>
</span><a name="line-709"></a><span>           </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628316208"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TargetFile"><span class="hs-identifier hs-var">TargetFile</span></a><span> </span><a href="#local-1628316207"><span class="hs-identifier hs-var">lhs_file</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-710"></a><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-711"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="Util.html#looksLikeModuleName"><span class="hs-identifier hs-var">looksLikeModuleName</span></a><span> </span><a href="#local-1628316204"><span class="hs-identifier hs-var">file</span></a><span>
</span><a name="line-712"></a><span>           </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628316208"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TargetModule"><span class="hs-identifier hs-var">TargetModule</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a><span> </span><a href="#local-1628316204"><span class="hs-identifier hs-var">file</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-713"></a><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-714"></a><span>        </span><a name="local-1628316213"><a href="#local-1628316213"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-715"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a><span>
</span><a name="line-716"></a><span>                 </span><span class="hs-special">(</span><a href="Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a><span> </span><a href="#local-1628316213"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-717"></a><span>                 </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;target&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628316204"><span class="hs-identifier hs-var">file</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-718"></a><span>                 </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is not a module name or a source file&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-719"></a><span>     </span><span class="hs-keyword">where</span><span>
</span><a name="line-720"></a><span>         </span><span class="hs-special">(</span><a name="local-1628316204"><a href="#local-1628316204"><span class="hs-identifier">file</span></a></a><span class="hs-special">,</span><a name="local-1628316205"><a href="#local-1628316205"><span class="hs-identifier">obj_allowed</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-721"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-char">'*'</span><span class="hs-glyph">:</span><a name="local-1628316209"><a href="#local-1628316209"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628316203"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628316209"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-722"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628316203"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-723"></a><span>
</span><a name="line-724"></a><span>         </span><a name="local-1628316206"><a href="#local-1628316206"><span class="hs-identifier">hs_file</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316204"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><span class="hs-string">&quot;hs&quot;</span><span>
</span><a name="line-725"></a><span>         </span><a name="local-1628316207"><a href="#local-1628316207"><span class="hs-identifier">lhs_file</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316204"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><span class="hs-string">&quot;lhs&quot;</span><span>
</span><a name="line-726"></a><span>
</span><a name="line-727"></a><span>         </span><a name="local-1628316208"><a href="#local-1628316208"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-1628316210"><a href="#local-1628316210"><span class="hs-identifier">tid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#Target"><span class="hs-identifier hs-var">Target</span></a><span> </span><a href="#local-1628316210"><span class="hs-identifier hs-var">tid</span></a><span> </span><a href="#local-1628316205"><span class="hs-identifier hs-var">obj_allowed</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-728"></a><span>
</span><a name="line-729"></a><span>
</span><a name="line-730"></a><span class="hs-comment">-- | Inform GHC that the working directory has changed.  GHC will flush</span><span>
</span><a name="line-731"></a><span class="hs-comment">-- its cache of module locations, since it may no longer be valid.</span><span>
</span><a name="line-732"></a><span class="hs-comment">--</span><span>
</span><a name="line-733"></a><span class="hs-comment">-- Note: Before changing the working directory make sure all threads running</span><span>
</span><a name="line-734"></a><span class="hs-comment">-- in the same session have stopped.  If you change the working directory,</span><span>
</span><a name="line-735"></a><span class="hs-comment">-- you should also unload the current program (set targets to empty,</span><span>
</span><a name="line-736"></a><span class="hs-comment">-- followed by load).</span><span>
</span><a name="line-737"></a><span class="hs-identifier">workingDirectoryChanged</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316101"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1628316101"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-738"></a><a name="workingDirectoryChanged"><a href="GHC.html#workingDirectoryChanged"><span class="hs-identifier">workingDirectoryChanged</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GhcMonad.html#withSession"><span class="hs-identifier hs-var">withSession</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Finder.html#flushFinderCaches"><span class="hs-identifier hs-var">flushFinderCaches</span></a><span class="hs-special">)</span><span>
</span><a name="line-739"></a><span>
</span><a name="line-740"></a><span>
</span><a name="line-741"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-742"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-743"></a><span class="hs-comment">--             Running phases one at a time</span><span>
</span><a name="line-744"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-745"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-746"></a><span>
</span><a name="line-747"></a><span class="hs-keyword">class</span><span> </span><a name="ParsedMod"><a href="GHC.html#ParsedMod"><span class="hs-identifier">ParsedMod</span></a></a><span> </span><a name="local-1628316062"><a href="#local-1628316062"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-748"></a><span>  </span><span class="hs-identifier">modSummary</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="#local-1628316062"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span>
</span><a name="line-749"></a><span>  </span><span class="hs-identifier">parsedSource</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1628316062"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.html#ParsedSource"><span class="hs-identifier hs-type">ParsedSource</span></a><span>
</span><a name="line-750"></a><span>
</span><a name="line-751"></a><span class="hs-keyword">class</span><span> </span><a href="GHC.html#ParsedMod"><span class="hs-identifier hs-type">ParsedMod</span></a><span> </span><a href="#local-1628316061"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="TypecheckedMod"><a href="GHC.html#TypecheckedMod"><span class="hs-identifier">TypecheckedMod</span></a></a><span> </span><a name="local-1628316061"><a href="#local-1628316061"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-752"></a><span>  </span><span class="hs-identifier">renamedSource</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="#local-1628316061"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="GHC.html#RenamedSource"><span class="hs-identifier hs-type">RenamedSource</span></a><span>
</span><a name="line-753"></a><span>  </span><span class="hs-identifier">typecheckedSource</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1628316061"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.html#TypecheckedSource"><span class="hs-identifier hs-type">TypecheckedSource</span></a><span>
</span><a name="line-754"></a><span>  </span><span class="hs-identifier">moduleInfo</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="#local-1628316061"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="GHC.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a><span>
</span><a name="line-755"></a><span>  </span><span class="hs-identifier">tm_internals</span><span>      </span><span class="hs-glyph">::</span><span> </span><a href="#local-1628316061"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a><span class="hs-special">)</span><span>
</span><a name="line-756"></a><span>        </span><span class="hs-comment">-- ToDo: improvements that could be made here:</span><span>
</span><a name="line-757"></a><span>        </span><span class="hs-comment">--  if the module succeeded renaming but not typechecking,</span><span>
</span><a name="line-758"></a><span>        </span><span class="hs-comment">--  we can still get back the GlobalRdrEnv and exports, so</span><span>
</span><a name="line-759"></a><span>        </span><span class="hs-comment">--  perhaps the ModuleInfo should be split up into separate</span><span>
</span><a name="line-760"></a><span>        </span><span class="hs-comment">--  fields.</span><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span class="hs-keyword">class</span><span> </span><a href="GHC.html#TypecheckedMod"><span class="hs-identifier hs-type">TypecheckedMod</span></a><span> </span><a href="#local-1628316060"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="DesugaredMod"><a href="GHC.html#DesugaredMod"><span class="hs-identifier">DesugaredMod</span></a></a><span> </span><a name="local-1628316060"><a href="#local-1628316060"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-763"></a><span>  </span><span class="hs-identifier">coreModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1628316060"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span>
</span><a name="line-764"></a><span>
</span><a name="line-765"></a><span class="hs-comment">-- | The result of successful parsing.</span><span>
</span><a name="line-766"></a><span class="hs-keyword">data</span><span> </span><a name="ParsedModule"><a href="GHC.html#ParsedModule"><span class="hs-identifier">ParsedModule</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-767"></a><span>  </span><a name="ParsedModule"><a href="GHC.html#ParsedModule"><span class="hs-identifier">ParsedModule</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="GHC.html#pm_mod_summary"><span class="hs-identifier">pm_mod_summary</span></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span>
</span><a name="line-768"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="GHC.html#pm_parsed_source"><span class="hs-identifier">pm_parsed_source</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.html#ParsedSource"><span class="hs-identifier hs-type">ParsedSource</span></a><span>
</span><a name="line-769"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="GHC.html#pm_extra_src_files"><span class="hs-identifier">pm_extra_src_files</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span class="hs-special">]</span><span>
</span><a name="line-770"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="GHC.html#pm_annotations"><span class="hs-identifier">pm_annotations</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="ApiAnnotation.html#ApiAnns"><span class="hs-identifier hs-type">ApiAnns</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-771"></a><span>               </span><span class="hs-comment">-- See Note [Api annotations] in ApiAnnotation.hs</span><span>
</span><a name="line-772"></a><span>
</span><a name="line-773"></a><span class="hs-keyword">instance</span><span> </span><a href="GHC.html#ParsedMod"><span class="hs-identifier hs-type">ParsedMod</span></a><span> </span><a href="GHC.html#ParsedModule"><span class="hs-identifier hs-type">ParsedModule</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-774"></a><span>  </span><a name="local-1913528655"><a href="GHC.html#modSummary"><span class="hs-identifier">modSummary</span></a></a><span> </span><a name="local-1628316456"><a href="#local-1628316456"><span class="hs-identifier">m</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pm_mod_summary</span><span> </span><a href="#local-1628316456"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-775"></a><span>  </span><a name="local-1913528656"><a href="GHC.html#parsedSource"><span class="hs-identifier">parsedSource</span></a></a><span> </span><a name="local-1628316457"><a href="#local-1628316457"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pm_parsed_source</span><span> </span><a href="#local-1628316457"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-776"></a><span>
</span><a name="line-777"></a><span class="hs-comment">-- | The result of successful typechecking.  It also contains the parser</span><span>
</span><a name="line-778"></a><span class="hs-comment">--   result.</span><span>
</span><a name="line-779"></a><span class="hs-keyword">data</span><span> </span><a name="TypecheckedModule"><a href="GHC.html#TypecheckedModule"><span class="hs-identifier">TypecheckedModule</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-780"></a><span>  </span><a name="TypecheckedModule"><a href="GHC.html#TypecheckedModule"><span class="hs-identifier">TypecheckedModule</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="GHC.html#tm_parsed_module"><span class="hs-identifier">tm_parsed_module</span></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="GHC.html#ParsedModule"><span class="hs-identifier hs-type">ParsedModule</span></a><span>
</span><a name="line-781"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="GHC.html#tm_renamed_source"><span class="hs-identifier">tm_renamed_source</span></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="GHC.html#RenamedSource"><span class="hs-identifier hs-type">RenamedSource</span></a><span>
</span><a name="line-782"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="GHC.html#tm_typechecked_source"><span class="hs-identifier">tm_typechecked_source</span></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="GHC.html#TypecheckedSource"><span class="hs-identifier hs-type">TypecheckedSource</span></a><span>
</span><a name="line-783"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="GHC.html#tm_checked_module_info"><span class="hs-identifier">tm_checked_module_info</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.html#ModuleInfo"><span class="hs-identifier hs-type">ModuleInfo</span></a><span>
</span><a name="line-784"></a><span>                    </span><span class="hs-special">,</span><span> </span><a href="GHC.html#tm_internals_"><span class="hs-identifier">tm_internals_</span></a><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a><span class="hs-special">)</span><span>
</span><a name="line-785"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-786"></a><span>
</span><a name="line-787"></a><span class="hs-keyword">instance</span><span> </span><a href="GHC.html#ParsedMod"><span class="hs-identifier hs-type">ParsedMod</span></a><span> </span><a href="GHC.html#TypecheckedModule"><span class="hs-identifier hs-type">TypecheckedModule</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-788"></a><span>  </span><a name="local-1913528655"><a href="GHC.html#modSummary"><span class="hs-identifier">modSummary</span></a></a><span> </span><a name="local-1628316454"><a href="#local-1628316454"><span class="hs-identifier">m</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#modSummary"><span class="hs-identifier hs-var">modSummary</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tm_parsed_module</span><span> </span><a href="#local-1628316454"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-789"></a><span>  </span><a name="local-1913528656"><a href="GHC.html#parsedSource"><span class="hs-identifier">parsedSource</span></a></a><span> </span><a name="local-1628316455"><a href="#local-1628316455"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#parsedSource"><span class="hs-identifier hs-var">parsedSource</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tm_parsed_module</span><span> </span><a href="#local-1628316455"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-790"></a><span>
</span><a name="line-791"></a><span class="hs-keyword">instance</span><span> </span><a href="GHC.html#TypecheckedMod"><span class="hs-identifier hs-type">TypecheckedMod</span></a><span> </span><a href="GHC.html#TypecheckedModule"><span class="hs-identifier hs-type">TypecheckedModule</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-792"></a><span>  </span><a name="local-1913528650"><a href="GHC.html#renamedSource"><span class="hs-identifier">renamedSource</span></a></a><span> </span><a name="local-1628316450"><a href="#local-1628316450"><span class="hs-identifier">m</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tm_renamed_source</span><span> </span><a href="#local-1628316450"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-793"></a><span>  </span><a name="local-1913528651"><a href="GHC.html#typecheckedSource"><span class="hs-identifier">typecheckedSource</span></a></a><span> </span><a name="local-1628316451"><a href="#local-1628316451"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tm_typechecked_source</span><span> </span><a href="#local-1628316451"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-794"></a><span>  </span><a name="local-1913528652"><a href="GHC.html#moduleInfo"><span class="hs-identifier">moduleInfo</span></a></a><span> </span><a name="local-1628316452"><a href="#local-1628316452"><span class="hs-identifier">m</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tm_checked_module_info</span><span> </span><a href="#local-1628316452"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-795"></a><span>  </span><a name="local-1913528653"><a href="GHC.html#tm_internals"><span class="hs-identifier">tm_internals</span></a></a><span> </span><a name="local-1628316453"><a href="#local-1628316453"><span class="hs-identifier">m</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tm_internals_</span><span> </span><a href="#local-1628316453"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-796"></a><span>
</span><a name="line-797"></a><span class="hs-comment">-- | The result of successful desugaring (i.e., translation to core).  Also</span><span>
</span><a name="line-798"></a><span class="hs-comment">--  contains all the information of a typechecked module.</span><span>
</span><a name="line-799"></a><span class="hs-keyword">data</span><span> </span><a name="DesugaredModule"><a href="GHC.html#DesugaredModule"><span class="hs-identifier">DesugaredModule</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-800"></a><span>  </span><a name="DesugaredModule"><a href="GHC.html#DesugaredModule"><span class="hs-identifier">DesugaredModule</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a href="GHC.html#dm_typechecked_module"><span class="hs-identifier">dm_typechecked_module</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.html#TypecheckedModule"><span class="hs-identifier hs-type">TypecheckedModule</span></a><span>
</span><a name="line-801"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="GHC.html#dm_core_module"><span class="hs-identifier">dm_core_module</span></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span>
</span><a name="line-802"></a><span>             </span><span class="hs-special">}</span><span>
</span><a name="line-803"></a><span>
</span><a name="line-804"></a><span class="hs-keyword">instance</span><span> </span><a href="GHC.html#ParsedMod"><span class="hs-identifier hs-type">ParsedMod</span></a><span> </span><a href="GHC.html#DesugaredModule"><span class="hs-identifier hs-type">DesugaredModule</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-805"></a><span>  </span><a name="local-1913528655"><a href="GHC.html#modSummary"><span class="hs-identifier">modSummary</span></a></a><span> </span><a name="local-1628316448"><a href="#local-1628316448"><span class="hs-identifier">m</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#modSummary"><span class="hs-identifier hs-var">modSummary</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dm_typechecked_module</span><span> </span><a href="#local-1628316448"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-806"></a><span>  </span><a name="local-1913528656"><a href="GHC.html#parsedSource"><span class="hs-identifier">parsedSource</span></a></a><span> </span><a name="local-1628316449"><a href="#local-1628316449"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#parsedSource"><span class="hs-identifier hs-var">parsedSource</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dm_typechecked_module</span><span> </span><a href="#local-1628316449"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span class="hs-keyword">instance</span><span> </span><a href="GHC.html#TypecheckedMod"><span class="hs-identifier hs-type">TypecheckedMod</span></a><span> </span><a href="GHC.html#DesugaredModule"><span class="hs-identifier hs-type">DesugaredModule</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-809"></a><span>  </span><a name="local-1913528650"><a href="GHC.html#renamedSource"><span class="hs-identifier">renamedSource</span></a></a><span> </span><a name="local-1628316444"><a href="#local-1628316444"><span class="hs-identifier">m</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#renamedSource"><span class="hs-identifier hs-var">renamedSource</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dm_typechecked_module</span><span> </span><a href="#local-1628316444"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-810"></a><span>  </span><a name="local-1913528651"><a href="GHC.html#typecheckedSource"><span class="hs-identifier">typecheckedSource</span></a></a><span> </span><a name="local-1628316445"><a href="#local-1628316445"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#typecheckedSource"><span class="hs-identifier hs-var">typecheckedSource</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dm_typechecked_module</span><span> </span><a href="#local-1628316445"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-811"></a><span>  </span><a name="local-1913528652"><a href="GHC.html#moduleInfo"><span class="hs-identifier">moduleInfo</span></a></a><span> </span><a name="local-1628316446"><a href="#local-1628316446"><span class="hs-identifier">m</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#moduleInfo"><span class="hs-identifier hs-var">moduleInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dm_typechecked_module</span><span> </span><a href="#local-1628316446"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-812"></a><span>  </span><a name="local-1913528653"><a href="GHC.html#tm_internals"><span class="hs-identifier">tm_internals</span></a></a><span> </span><a name="local-1628316447"><a href="#local-1628316447"><span class="hs-identifier">m</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tm_internals_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dm_typechecked_module</span><span> </span><a href="#local-1628316447"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-813"></a><span>
</span><a name="line-814"></a><span class="hs-keyword">instance</span><span> </span><a href="GHC.html#DesugaredMod"><span class="hs-identifier hs-type">DesugaredMod</span></a><span> </span><a href="GHC.html#DesugaredModule"><span class="hs-identifier hs-type">DesugaredModule</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-815"></a><span>  </span><a name="local-1913528648"><a href="GHC.html#coreModule"><span class="hs-identifier">coreModule</span></a></a><span> </span><a name="local-1628316443"><a href="#local-1628316443"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dm_core_module</span><span> </span><a href="#local-1628316443"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-816"></a><span>
</span><a name="line-817"></a><span class="hs-keyword">type</span><span> </span><a name="ParsedSource"><a href="GHC.html#ParsedSource"><span class="hs-identifier">ParsedSource</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">(</span><a href="HsSyn.html#HsModule"><span class="hs-identifier hs-type">HsModule</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">)</span><span>
</span><a name="line-818"></a><span class="hs-keyword">type</span><span> </span><a name="RenamedSource"><a href="GHC.html#RenamedSource"><span class="hs-identifier">RenamedSource</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="HsImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">[</span><a href="HsImpExp.html#LIE"><span class="hs-identifier hs-type">LIE</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-819"></a><span>                          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="HsDoc.html#LHsDocString"><span class="hs-identifier hs-type">LHsDocString</span></a><span class="hs-special">)</span><span>
</span><a name="line-820"></a><span class="hs-keyword">type</span><span> </span><a name="TypecheckedSource"><a href="GHC.html#TypecheckedSource"><span class="hs-identifier">TypecheckedSource</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-821"></a><span>
</span><a name="line-822"></a><span class="hs-comment">-- NOTE:</span><span>
</span><a name="line-823"></a><span class="hs-comment">--   - things that aren't in the output of the typechecker right now:</span><span>
</span><a name="line-824"></a><span class="hs-comment">--     - the export list</span><span>
</span><a name="line-825"></a><span class="hs-comment">--     - the imports</span><span>
</span><a name="line-826"></a><span class="hs-comment">--     - type signatures</span><span>
</span><a name="line-827"></a><span class="hs-comment">--     - type/data/newtype declarations</span><span>
</span><a name="line-828"></a><span class="hs-comment">--     - class declarations</span><span>
</span><a name="line-829"></a><span class="hs-comment">--     - instances</span><span>
</span><a name="line-830"></a><span class="hs-comment">--   - extra things in the typechecker's output:</span><span>
</span><a name="line-831"></a><span class="hs-comment">--     - default methods are turned into top-level decls.</span><span>
</span><a name="line-832"></a><span class="hs-comment">--     - dictionary bindings</span><span>
</span><a name="line-833"></a><span>
</span><a name="line-834"></a><span class="hs-comment">-- | Return the 'ModSummary' of a module with the given name.</span><span>
</span><a name="line-835"></a><span class="hs-comment">--</span><span>
</span><a name="line-836"></a><span class="hs-comment">-- The module must be part of the module graph (see 'hsc_mod_graph' and</span><span>
</span><a name="line-837"></a><span class="hs-comment">-- 'ModuleGraph').  If this is not the case, this function will throw a</span><span>
</span><a name="line-838"></a><span class="hs-comment">-- 'GhcApiError'.</span><span>
</span><a name="line-839"></a><span class="hs-comment">--</span><span>
</span><a name="line-840"></a><span class="hs-comment">-- This function ignores boot modules and requires that there is only one</span><span>
</span><a name="line-841"></a><span class="hs-comment">-- non-boot module with the given name.</span><span>
</span><a name="line-842"></a><span class="hs-identifier">getModSummary</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316100"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316100"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span>
</span><a name="line-843"></a><a name="getModSummary"><a href="GHC.html#getModSummary"><span class="hs-identifier">getModSummary</span></a></a><span> </span><a name="local-1628316214"><a href="#local-1628316214"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-844"></a><span>   </span><a name="local-1628316215"><a href="#local-1628316215"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a><span> </span><span class="hs-identifier">hsc_mod_graph</span><span> </span><a href="GhcMonad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a><span>
</span><a name="line-845"></a><span>   </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-1628316216"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628316216"><a href="#local-1628316216"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628316215"><span class="hs-identifier hs-var">mg</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a><span> </span><a href="#local-1628316216"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628316214"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a><span> </span><a href="#local-1628316216"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-846"></a><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628316217"><a href="#local-1628316217"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-847"></a><span>              </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HscTypes.html#mkApiErr"><span class="hs-identifier hs-var">mkApiErr</span></a><span> </span><a href="#local-1628316217"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Module not part of module graph&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-848"></a><span>     </span><span class="hs-special">[</span><a name="local-1628316218"><a href="#local-1628316218"><span class="hs-identifier">ms</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628316218"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-849"></a><span>     </span><a name="local-1628316219"><a href="#local-1628316219"><span class="hs-identifier">multiple</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628316220"><a href="#local-1628316220"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-850"></a><span>                    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HscTypes.html#mkApiErr"><span class="hs-identifier hs-var">mkApiErr</span></a><span> </span><a href="#local-1628316220"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;getModSummary is ambiguous: &quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628316219"><span class="hs-identifier hs-var">multiple</span></a><span class="hs-special">)</span><span>
</span><a name="line-851"></a><span>
</span><a name="line-852"></a><span class="hs-comment">-- | Parse a module.</span><span>
</span><a name="line-853"></a><span class="hs-comment">--</span><span>
</span><a name="line-854"></a><span class="hs-comment">-- Throws a 'SourceError' on parse error.</span><span>
</span><a name="line-855"></a><span class="hs-identifier">parseModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316099"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316099"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="GHC.html#ParsedModule"><span class="hs-identifier hs-type">ParsedModule</span></a><span>
</span><a name="line-856"></a><a name="parseModule"><a href="GHC.html#parseModule"><span class="hs-identifier">parseModule</span></a></a><span> </span><a name="local-1628316221"><a href="#local-1628316221"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-857"></a><span>   </span><a name="local-1628316222"><a href="#local-1628316222"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GhcMonad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a><span>
</span><a name="line-858"></a><span>   </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316223"><a href="#local-1628316223"><span class="hs-identifier">hsc_env_tmp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316222"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ms_hspp_opts</span><span> </span><a href="#local-1628316221"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-859"></a><span>   </span><a name="local-1628316224"><a href="#local-1628316224"><span class="hs-identifier">hpm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HscMain.html#hscParse"><span class="hs-identifier hs-var">hscParse</span></a><span> </span><a href="#local-1628316223"><span class="hs-identifier hs-var">hsc_env_tmp</span></a><span> </span><a href="#local-1628316221"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-860"></a><span>   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="GHC.html#ParsedModule"><span class="hs-identifier hs-var">ParsedModule</span></a><span> </span><a href="#local-1628316221"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hpm_module</span><span> </span><a href="#local-1628316224"><span class="hs-identifier hs-var">hpm</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hpm_src_files</span><span> </span><a href="#local-1628316224"><span class="hs-identifier hs-var">hpm</span></a><span class="hs-special">)</span><span>
</span><a name="line-861"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier">hpm_annotations</span><span> </span><a href="#local-1628316224"><span class="hs-identifier hs-var">hpm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-862"></a><span>               </span><span class="hs-comment">-- See Note [Api annotations] in ApiAnnotation.hs</span><span>
</span><a name="line-863"></a><span>
</span><a name="line-864"></a><span class="hs-comment">-- | Typecheck and rename a parsed module.</span><span>
</span><a name="line-865"></a><span class="hs-comment">--</span><span>
</span><a name="line-866"></a><span class="hs-comment">-- Throws a 'SourceError' if either fails.</span><span>
</span><a name="line-867"></a><span class="hs-identifier">typecheckModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316098"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="GHC.html#ParsedModule"><span class="hs-identifier hs-type">ParsedModule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316098"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="GHC.html#TypecheckedModule"><span class="hs-identifier hs-type">TypecheckedModule</span></a><span>
</span><a name="line-868"></a><a name="typecheckModule"><a href="GHC.html#typecheckModule"><span class="hs-identifier">typecheckModule</span></a></a><span> </span><a name="local-1628316225"><a href="#local-1628316225"><span class="hs-identifier">pmod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-869"></a><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316226"><a href="#local-1628316226"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#modSummary"><span class="hs-identifier hs-var">modSummary</span></a><span> </span><a href="#local-1628316225"><span class="hs-identifier hs-var">pmod</span></a><span>
</span><a name="line-870"></a><span> </span><a name="local-1628316227"><a href="#local-1628316227"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GhcMonad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a><span>
</span><a name="line-871"></a><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316228"><a href="#local-1628316228"><span class="hs-identifier">hsc_env_tmp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316227"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ms_hspp_opts</span><span> </span><a href="#local-1628316226"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-872"></a><span> </span><span class="hs-special">(</span><a name="local-1628316229"><a href="#local-1628316229"><span class="hs-identifier">tc_gbl_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628316230"><a href="#local-1628316230"><span class="hs-identifier">rn_info</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-873"></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HscMain.html#hscTypecheckRename"><span class="hs-identifier hs-var">hscTypecheckRename</span></a><span> </span><a href="#local-1628316228"><span class="hs-identifier hs-var">hsc_env_tmp</span></a><span> </span><a href="#local-1628316226"><span class="hs-identifier hs-var">ms</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-874"></a><span>                      </span><a href="HscTypes.html#HsParsedModule"><span class="hs-identifier hs-var">HsParsedModule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hpm_module</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#parsedSource"><span class="hs-identifier hs-var">parsedSource</span></a><span> </span><a href="#local-1628316225"><span class="hs-identifier hs-var">pmod</span></a><span class="hs-special">,</span><span>
</span><a name="line-875"></a><span>                                       </span><span class="hs-identifier">hpm_src_files</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pm_extra_src_files</span><span> </span><a href="#local-1628316225"><span class="hs-identifier hs-var">pmod</span></a><span class="hs-special">,</span><span>
</span><a name="line-876"></a><span>                                       </span><span class="hs-identifier">hpm_annotations</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pm_annotations</span><span> </span><a href="#local-1628316225"><span class="hs-identifier hs-var">pmod</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-877"></a><span> </span><a name="local-1628316231"><a href="#local-1628316231"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HscMain.html#makeSimpleDetails"><span class="hs-identifier hs-var">makeSimpleDetails</span></a><span> </span><a href="#local-1628316228"><span class="hs-identifier hs-var">hsc_env_tmp</span></a><span> </span><a href="#local-1628316229"><span class="hs-identifier hs-var">tc_gbl_env</span></a><span>
</span><a name="line-878"></a><span> </span><a name="local-1628316232"><a href="#local-1628316232"><span class="hs-identifier">safe</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#finalSafeMode"><span class="hs-identifier hs-var">finalSafeMode</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_hspp_opts</span><span> </span><a href="#local-1628316226"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628316229"><span class="hs-identifier hs-var">tc_gbl_env</span></a><span>
</span><a name="line-879"></a><span>
</span><a name="line-880"></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-881"></a><span>     </span><a href="GHC.html#TypecheckedModule"><span class="hs-identifier hs-var">TypecheckedModule</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-882"></a><span>       </span><span class="hs-identifier">tm_internals_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628316229"><span class="hs-identifier hs-var">tc_gbl_env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628316231"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-883"></a><span>       </span><span class="hs-identifier">tm_parsed_module</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316225"><span class="hs-identifier hs-var">pmod</span></a><span class="hs-special">,</span><span>
</span><a name="line-884"></a><span>       </span><span class="hs-identifier">tm_renamed_source</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316230"><span class="hs-identifier hs-var">rn_info</span></a><span class="hs-special">,</span><span>
</span><a name="line-885"></a><span>       </span><span class="hs-identifier">tm_typechecked_source</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_binds</span><span> </span><a href="#local-1628316229"><span class="hs-identifier hs-var">tc_gbl_env</span></a><span class="hs-special">,</span><span>
</span><a name="line-886"></a><span>       </span><span class="hs-identifier">tm_checked_module_info</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-887"></a><span>         </span><a href="GHC.html#ModuleInfo"><span class="hs-identifier hs-var">ModuleInfo</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-888"></a><span>           </span><span class="hs-identifier">minf_type_env</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">md_types</span><span> </span><a href="#local-1628316231"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">,</span><span>
</span><a name="line-889"></a><span>           </span><span class="hs-identifier">minf_exports</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">md_exports</span><span> </span><a href="#local-1628316231"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">,</span><span>
</span><a name="line-890"></a><span>           </span><span class="hs-identifier">minf_rdr_env</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_rdr_env</span><span> </span><a href="#local-1628316229"><span class="hs-identifier hs-var">tc_gbl_env</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-891"></a><span>           </span><span class="hs-identifier">minf_instances</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#fixSafeInstances"><span class="hs-identifier hs-var">fixSafeInstances</span></a><span> </span><a href="#local-1628316232"><span class="hs-identifier hs-var">safe</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">md_insts</span><span> </span><a href="#local-1628316231"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">,</span><span>
</span><a name="line-892"></a><span>           </span><span class="hs-identifier">minf_iface</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span>
</span><a name="line-893"></a><span>           </span><span class="hs-identifier">minf_safe</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316232"><span class="hs-identifier hs-var">safe</span></a><span>
</span><a name="line-894"></a><span class="hs-cpp">#ifdef GHCI</span><span>
</span><a name="line-895"></a><span>          </span><span class="hs-special">,</span><span class="hs-identifier">minf_modBreaks</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ByteCodeTypes.html#emptyModBreaks"><span class="hs-identifier hs-var">emptyModBreaks</span></a><span>
</span><a name="line-896"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-897"></a><span>         </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-898"></a><span>
</span><a name="line-899"></a><span class="hs-comment">-- | Desugar a typechecked module.</span><span>
</span><a name="line-900"></a><span class="hs-identifier">desugarModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316097"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="GHC.html#TypecheckedModule"><span class="hs-identifier hs-type">TypecheckedModule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316097"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="GHC.html#DesugaredModule"><span class="hs-identifier hs-type">DesugaredModule</span></a><span>
</span><a name="line-901"></a><a name="desugarModule"><a href="GHC.html#desugarModule"><span class="hs-identifier">desugarModule</span></a></a><span> </span><a name="local-1628316233"><a href="#local-1628316233"><span class="hs-identifier">tcm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-902"></a><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316234"><a href="#local-1628316234"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#modSummary"><span class="hs-identifier hs-var">modSummary</span></a><span> </span><a href="#local-1628316233"><span class="hs-identifier hs-var">tcm</span></a><span>
</span><a name="line-903"></a><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628316235"><a href="#local-1628316235"><span class="hs-identifier">tcg</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#tm_internals"><span class="hs-identifier hs-var">tm_internals</span></a><span> </span><a href="#local-1628316233"><span class="hs-identifier hs-var">tcm</span></a><span>
</span><a name="line-904"></a><span> </span><a name="local-1628316236"><a href="#local-1628316236"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GhcMonad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a><span>
</span><a name="line-905"></a><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316237"><a href="#local-1628316237"><span class="hs-identifier">hsc_env_tmp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316236"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ms_hspp_opts</span><span> </span><a href="#local-1628316234"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-906"></a><span> </span><a name="local-1628316238"><a href="#local-1628316238"><span class="hs-identifier">guts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HscMain.html#hscDesugar"><span class="hs-identifier hs-var">hscDesugar</span></a><span> </span><a href="#local-1628316237"><span class="hs-identifier hs-var">hsc_env_tmp</span></a><span> </span><a href="#local-1628316234"><span class="hs-identifier hs-var">ms</span></a><span> </span><a href="#local-1628316235"><span class="hs-identifier hs-var">tcg</span></a><span>
</span><a name="line-907"></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-908"></a><span>     </span><a href="GHC.html#DesugaredModule"><span class="hs-identifier hs-var">DesugaredModule</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-909"></a><span>       </span><span class="hs-identifier">dm_typechecked_module</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316233"><span class="hs-identifier hs-var">tcm</span></a><span class="hs-special">,</span><span>
</span><a name="line-910"></a><span>       </span><span class="hs-identifier">dm_core_module</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628316238"><span class="hs-identifier hs-var">guts</span></a><span>
</span><a name="line-911"></a><span>     </span><span class="hs-special">}</span><span>
</span><a name="line-912"></a><span>
</span><a name="line-913"></a><span class="hs-comment">-- | Load a module.  Input doesn't need to be desugared.</span><span>
</span><a name="line-914"></a><span class="hs-comment">--</span><span>
</span><a name="line-915"></a><span class="hs-comment">-- A module must be loaded before dependent modules can be typechecked.  This</span><span>
</span><a name="line-916"></a><span class="hs-comment">-- always includes generating a 'ModIface' and, depending on the</span><span>
</span><a name="line-917"></a><span class="hs-comment">-- 'DynFlags.hscTarget', may also include code generation.</span><span>
</span><a name="line-918"></a><span class="hs-comment">--</span><span>
</span><a name="line-919"></a><span class="hs-comment">-- This function will always cause recompilation and will always overwrite</span><span>
</span><a name="line-920"></a><span class="hs-comment">-- previous compilation results (potentially files on disk).</span><span>
</span><a name="line-921"></a><span class="hs-comment">--</span><span>
</span><a name="line-922"></a><span class="hs-identifier">loadModule</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="GHC.html#TypecheckedMod"><span class="hs-identifier hs-type">TypecheckedMod</span></a><span> </span><a href="#local-1628316095"><span class="hs-identifier hs-type">mod</span></a><span class="hs-special">,</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316096"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1628316095"><span class="hs-identifier hs-type">mod</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316096"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1628316095"><span class="hs-identifier hs-type">mod</span></a><span>
</span><a name="line-923"></a><a name="loadModule"><a href="GHC.html#loadModule"><span class="hs-identifier">loadModule</span></a></a><span> </span><a name="local-1628316239"><a href="#local-1628316239"><span class="hs-identifier">tcm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-924"></a><span>   </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316240"><a href="#local-1628316240"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#modSummary"><span class="hs-identifier hs-var">modSummary</span></a><span> </span><a href="#local-1628316239"><span class="hs-identifier hs-var">tcm</span></a><span>
</span><a name="line-925"></a><span>   </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316241"><a href="#local-1628316241"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a><span> </span><a href="#local-1628316240"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-926"></a><span>   </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316242"><a href="#local-1628316242"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ms_location</span><span> </span><a href="#local-1628316240"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-927"></a><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1628316243"><a href="#local-1628316243"><span class="hs-identifier">tcg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628316244"><a href="#local-1628316244"><span class="hs-identifier">_details</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#tm_internals"><span class="hs-identifier hs-var">tm_internals</span></a><span> </span><a href="#local-1628316239"><span class="hs-identifier hs-var">tcm</span></a><span>
</span><a name="line-928"></a><span>
</span><a name="line-929"></a><span>   </span><a name="local-1628316248"><a href="#local-1628316248"><span class="hs-identifier">mb_linkable</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">ms_obj_date</span><span> </span><a href="#local-1628316240"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-930"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628316245"><a href="#local-1628316245"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628316245"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-identifier">ms_hs_date</span><span> </span><a href="#local-1628316240"><span class="hs-identifier hs-var">ms</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-931"></a><span>                         </span><a name="local-1628316246"><a href="#local-1628316246"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Finder.html#findObjectLinkable"><span class="hs-identifier hs-var">findObjectLinkable</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_mod</span><span> </span><a href="#local-1628316240"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-932"></a><span>                                                  </span><span class="hs-special">(</span><span class="hs-identifier">ml_obj_file</span><span> </span><a href="#local-1628316242"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628316245"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-933"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628316246"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-934"></a><span>                     </span><a name="local-1628316247"><a href="#local-1628316247"><span class="hs-identifier">_otherwise</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-935"></a><span>
</span><a name="line-936"></a><span>   </span><span class="hs-keyword">let</span><span> </span><a name="local-1628316249"><a href="#local-1628316249"><span class="hs-identifier">source_modified</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a><span> </span><a href="#local-1628316248"><span class="hs-identifier hs-var">mb_linkable</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#SourceModified"><span class="hs-identifier hs-var">SourceModified</span></a><span>
</span><a name="line-937"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#SourceUnmodified"><span class="hs-identifier hs-var">SourceUnmodified</span></a><span>
</span><a name="line-938"></a><span>                       </span><span class="hs-comment">-- we can't determine stability here</span><span>
</span><a name="line-939"></a><span>
</span><a name="line-940"></a><span>   </span><span class="hs-comment">-- compile doesn't change the session</span><span>
</span><a name="line-941"></a><span>   </span><a name="local-1628316250"><a href="#local-1628316250"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GhcMonad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a><span>
</span><a name="line-942"></a><span>   </span><a name="local-1628316251"><a href="#local-1628316251"><span class="hs-identifier">mod_info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="DriverPipeline.html#compileOne%27"><span class="hs-identifier hs-var">compileOne'</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628316243"><span class="hs-identifier hs-var">tcg</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-943"></a><span>                                    </span><a href="#local-1628316250"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628316240"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><a href="#local-1628316248"><span class="hs-identifier hs-var">mb_linkable</span></a><span>
</span><a name="line-944"></a><span>                                    </span><a href="#local-1628316249"><span class="hs-identifier hs-var">source_modified</span></a><span>
</span><a name="line-945"></a><span>
</span><a name="line-946"></a><span>   </span><a href="GhcMonad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628316252"><a href="#local-1628316252"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316252"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_HPT</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#addToUFM"><span class="hs-identifier hs-var">addToUFM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_HPT</span><span> </span><a href="#local-1628316252"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628316241"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-1628316251"><span class="hs-identifier hs-var">mod_info</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-947"></a><span>   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628316239"><span class="hs-identifier hs-var">tcm</span></a><span>
</span><a name="line-948"></a><span>
</span><a name="line-949"></a><span>
</span><a name="line-950"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-951"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-952"></a><span class="hs-comment">--             Dealing with Core</span><span>
</span><a name="line-953"></a><span class="hs-comment">-- %*                                                                      *</span><span>
</span><a name="line-954"></a><span class="hs-comment">-- %************************************************************************</span><span>
</span><a name="line-955"></a><span>
</span><a name="line-956"></a><span class="hs-comment">-- | A CoreModule consists of just the fields of a 'ModGuts' that are needed for</span><span>
</span><a name="line-957"></a><span class="hs-comment">-- the 'GHC.compileToCoreModule' interface.</span><span>
</span><a name="line-958"></a><span class="hs-keyword">data</span><span> </span><a name="CoreModule"><a href="GHC.html#CoreModule"><span class="hs-identifier">CoreModule</span></a></a><span>
</span><a name="line-959"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="CoreModule"><a href="GHC.html#CoreModule"><span class="hs-identifier">CoreModule</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-960"></a><span>      </span><span class="hs-comment">-- | Module name</span><span>
</span><a name="line-961"></a><span>      </span><a href="GHC.html#cm_module"><span class="hs-identifier">cm_module</span></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>
</span><a name="line-962"></a><span>      </span><span class="hs-comment">-- | Type environment for types declared in this module</span><span>
</span><a name="line-963"></a><span>      </span><a href="GHC.html#cm_types"><span class="hs-identifier">cm_types</span></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-964"></a><span>      </span><span class="hs-comment">-- | Declarations</span><span>
</span><a name="line-965"></a><span>      </span><a href="GHC.html#cm_binds"><span class="hs-identifier">cm_binds</span></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a><span class="hs-special">,</span><span>
</span><a name="line-966"></a><span>      </span><span class="hs-comment">-- | Safe Haskell mode</span><span>
</span><a name="line-967"></a><span>      </span><a href="GHC.html#cm_safe"><span class="hs-identifier">cm_safe</span></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a><span>
</span><a name="line-968"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-969"></a><span>
</span><a name="line-970"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="GHC.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-971"></a><span>   </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="GHC.html#CoreModule"><span class="hs-identifier hs-var">CoreModule</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">cm_module</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628316439"><a href="#local-1628316439"><span class="hs-identifier">mn</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cm_types</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628316440"><a href="#local-1628316440"><span class="hs-identifier">te</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cm_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628316441"><a href="#local-1628316441"><span class="hs-identifier">cb</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-972"></a><span>                    </span><span class="hs-identifier">cm_safe</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628316442"><a href="#local-1628316442"><span class="hs-identifier">sf</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-973"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;%module&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628316439"><span class="hs-identifier hs-var">mn</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628316442"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628316440"><span class="hs-identifier hs-var">te</span></a><span>
</span><a name="line-974"></a><span>      </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628316441"><span class="hs-identifier hs-var">cb</span></a><span class="hs-special">)</span><span>
</span><a name="line-975"></a><span>
</span><a name="line-976"></a><span class="hs-comment">-- | This is the way to get access to the Core bindings corresponding</span><span>
</span><a name="line-977"></a><span class="hs-comment">-- to a module. 'compileToCore' parses, typechecks, and</span><span>
</span><a name="line-978"></a><span class="hs-comment">-- desugars the module, then returns the resulting Core module (consisting of</span><span>
</span><a name="line-979"></a><span class="hs-comment">-- the module name, type declarations, and function declarations) if</span><span>
</span><a name="line-980"></a><span class="hs-comment">-- successful.</span><span>
</span><a name="line-981"></a><span class="hs-identifier">compileToCoreModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316094"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316094"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="GHC.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a><span>
</span><a name="line-982"></a><a name="compileToCoreModule"><a href="GHC.html#compileToCoreModule"><span class="hs-identifier">compileToCoreModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#compileCore"><span class="hs-identifier hs-var">compileCore</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-983"></a><span>
</span><a name="line-984"></a><span class="hs-comment">-- | Like compileToCoreModule, but invokes the simplifier, so</span><span>
</span><a name="line-985"></a><span class="hs-comment">-- as to return simplified and tidied Core.</span><span>
</span><a name="line-986"></a><span class="hs-identifier">compileToCoreSimplified</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316093"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316093"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="GHC.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a><span>
</span><a name="line-987"></a><a name="compileToCoreSimplified"><a href="GHC.html#compileToCoreSimplified"><span class="hs-identifier">compileToCoreSimplified</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="GHC.html#compileCore"><span class="hs-identifier hs-var">compileCore</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-988"></a><span>
</span><a name="line-989"></a><span class="hs-identifier">compileCore</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="GhcMonad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a><span> </span><a href="#local-1628316092"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628316092"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="GHC.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a><span>
</span><a name="line-990"></a><a name="compileCore"><a href="GHC.html#compileCore"><span class="hs-identifier">compileCore</span></a></a><span> </span><a name="local-1628316253"><a href="#local-1628316253"><span class="hs-identifier">simplify</span></a></a><span> </span><a name="local-1628316254"><a href="#local-1628316254"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-991"></a><span>   </span><span class="hs-comment">-- First, set the target to the desired filename</span><span>
</span><a name="line-992"></a><span>   </span><a name="local-1628316261"><a href="#local-1628316261"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.html#guessTarget"><span class="hs-identifier hs-var">guessTarget</span></a><span> </span><a href="#local-1628316254"><span class="hs-identifier hs-var">fn</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-993"></a><span>   </span><a href="GHC.html#addTarget"><span class="hs-identifier hs-var">addTarget</span></a><span> </span><a href="#local-1628316261"><span class="hs-identifier hs-var">target</span></a><span>
</span><a name="line-994"></a><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GhcMake.html#load"><span class="hs-identifier hs-var">load</span></a><span> </span><a href="GhcMake.html#LoadAllTargets"><span class="hs-identifier hs-var">LoadAllTargets</span></a><span>
</span><a name="line-995"></a><span>   </span><span class="hs-comment">-- Then find dependencies</span><span>
</span><a name="line-996"></a><span>   </span><a name="local-1628316262"><a href="#local-1628316262"><span class="hs-identifier">modGraph</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GhcMake.html#depanal"><span class="hs-identifier hs-var">depanal</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-997"></a><span>   </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#find"><span class="hs-identifier hs-var">find</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628316254"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="HscTypes.html#msHsFilePath"><span class="hs-identifier hs-var">msHsFilePath</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628316262"><span class="hs-identifier hs-var">modGraph</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-998"></a><span>     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628316263"><a href="#local-1628316263"><span class="hs-identifier">modSummary</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-999"></a><span>       </span><span class="hs-comment">-- Now we have the module name;</span><span>
</span><a name="line-1000"></a><span>       </span><span class="hs-comment">-- parse, typecheck and desugar the module</span><span>
</span><a name="line-1001"></a><span>       </span><a name="local-1628316264"><a href="#local-1628316264"><span class="hs-identifier">mod_guts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GHC.html#coreModule"><span class="hs-identifier hs-var">coreModule</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span class="hs-special">`</span><span>
</span><a name="line-1002"></a><span>                      </span><span class="hs-comment">-- TODO: space leaky: call hsc* directly?</span><span>
</span><a name="line-1003"></a><span>                      </span><span class="hs-special">(</span><a href="GHC.html#desugarModule"><span class="hs-identifier hs-var">desugarModule</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a><span> </span><a href="GHC.html#typecheckModule"><span class="hs-identifier hs-var">typecheckModule</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a><span> </span><a href="GHC.html#parseModule"><span class="hs-identifier hs-var">parseModule</span></a><span> </span><a href="#local-1628316263"><span class="hs-identifier hs-var">modSummary</span></a><span class="hs-special">)</span><span>
</span><a name="line-1004"></a><span>       </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628316255"><span class="hs-identifier hs-var">gutsToCoreModule</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mg_safe_haskell</span><span> </span><a href="#local-1628316264"><span class="hs-identifier hs-var">mod_guts</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1005"></a><span>         </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628316253"><span class="hs-identifier hs-var">simplify</span></a><span>
</span><a name="line-1006"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1007"></a><span>             </span><span class="hs-comment">-- If simplify is true: simplify (hscSimplify), then tidy</span><span>
</span><a name="line-1008"></a><span>             </span><span class="hs-comment">-- (tidyProgram).</span><span>
</span><a name="line-1009"></a><span>             </span><a name="local-1628316265"><a href="#local-1628316265"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="GhcMonad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a><span>
</span><a name="line-1010"></a><span>             </span><a name="local-1628316266"><a href="#local-1628316266"><span class="hs-identifier">simpl_guts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="HscMain.html#hscSimplify"><span class="hs-identifier hs-var">hscSimplify</span></a><span> </span><a href="#local-1628316265"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628316264"><span class="hs-identifier hs-var">mod_guts</span></a><span>
</span><a name="line-1011"></a><span>             </span><a name="local-1628316267"><a href="#local-1628316267"><span class="hs-identifier">tidy_guts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TidyPgm.html#tidyProgram"><span class="hs-identifier hs-var">tidyProgram</span></a><span> </span><a href="#local-1628316265"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628316266"><span class="hs-identifier hs-var">simpl_guts</span></a><span>
</span><a name="line-1012"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><a href="#local-1628316267"><span class="hs-identifier hs-var">tidy_guts</span></a><span>
</span><a name="line-1013"></a><span>          </span><span class="hs-keyword">else</span><span>
</span><a name="line-1014"></a><span>             </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><a href="#local-1628316264"><span class="hs-identifier hs-var">mod_guts</span></a><span>
</span><a name="line-1015"></a><span>
</span><a name="line-1016"></a><span>     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;compileToCoreModule: target FilePath not found in\
                           module dependency graph&quot;
  where -- two versions, based on whether we simplify (thus run tidyProgram,
        -- which returns a (CgGuts, ModDetails) pair, or not (in which case
        -- we just have a ModGuts.
        gutsToCoreModule :: SafeHaskellMode
                         -&gt; Either (CgGuts, ModDetails) ModGuts
                         -&gt; CoreModule
        gutsToCoreModule safe_mode (Left (cg, md)) = CoreModule {
          cm_module = cg_module cg,
          cm_types  = md_types md,
          cm_binds  = cg_binds cg,
          cm_safe   = safe_mode
        }
        gutsToCoreModule safe_mode (Right mg) = CoreModule {
          cm_module  = mg_module mg,
          cm_types   = typeEnvFromEntities (bindersOfBinds (mg_binds mg))
                                           (mg_tcs mg)
                                           (mg_fam_insts mg),
          cm_binds   = mg_binds mg,
          cm_safe    = safe_mode
         }

-- %************************************************************************
-- %*                                                                      *
--             Inspecting the session
-- %*                                                                      *
-- %************************************************************************

-- | Get the module dependency graph.
getModuleGraph :: GhcMonad m =&gt; m ModuleGraph -- ToDo: DiGraph ModSummary
getModuleGraph = liftM hsc_mod_graph getSession

-- | Determines whether a set of modules requires Template Haskell.
--
-- Note that if the session's 'DynFlags' enabled Template Haskell when
-- 'depanal' was called, then each module in the returned module graph will
-- have Template Haskell enabled whether it is actually needed or not.
needsTemplateHaskell :: ModuleGraph -&gt; Bool
needsTemplateHaskell ms =
    any (xopt LangExt.TemplateHaskell . ms_hspp_opts) ms

-- | Return @True@ &lt;==&gt; module is loaded.
isLoaded :: GhcMonad m =&gt; ModuleName -&gt; m Bool
isLoaded m = withSession $ \hsc_env -&gt;
  return $! isJust (lookupUFM (hsc_HPT hsc_env) m)

-- | Return the bindings for the current interactive session.
getBindings :: GhcMonad m =&gt; m [TyThing]
getBindings = withSession $ \hsc_env -&gt;
    return $ icInScopeTTs $ hsc_IC hsc_env

-- | Return the instances for the current interactive session.
getInsts :: GhcMonad m =&gt; m ([ClsInst], [FamInst])
getInsts = withSession $ \hsc_env -&gt;
    return $ ic_instances (hsc_IC hsc_env)

getPrintUnqual :: GhcMonad m =&gt; m PrintUnqualified
getPrintUnqual = withSession $ \hsc_env -&gt;
  return (icPrintUnqual (hsc_dflags hsc_env) (hsc_IC hsc_env))

-- | Container for information about a 'Module'.
data ModuleInfo = ModuleInfo {
        minf_type_env  :: TypeEnv,
        minf_exports   :: [AvailInfo],
        minf_rdr_env   :: Maybe GlobalRdrEnv,   -- Nothing for a compiled/package mod
        minf_instances :: [ClsInst],
        minf_iface     :: Maybe ModIface,
        minf_safe      :: SafeHaskellMode
#ifdef GHCI
       ,minf_modBreaks :: ModBreaks
#endif
  }
        -- We don't want HomeModInfo here, because a ModuleInfo applies
        -- to package modules too.

-- | Request information about a loaded 'Module'
getModuleInfo :: GhcMonad m =&gt; Module -&gt; m (Maybe ModuleInfo)  -- XXX: Maybe X
getModuleInfo mdl = withSession $ \hsc_env -&gt; do
  let mg = hsc_mod_graph hsc_env
  if mdl `elem` map ms_mod mg
        then liftIO $ getHomeModuleInfo hsc_env mdl
        else do
  {- if isHomeModule (hsc_dflags hsc_env) mdl
        then return Nothing
        else -} liftIO $ getPackageModuleInfo hsc_env mdl
   -- ToDo: we don't understand what the following comment means.
   --    (SDM, 19/7/2011)
   -- getPackageModuleInfo will attempt to find the interface, so
   -- we don't want to call it for a home module, just in case there
   -- was a problem loading the module and the interface doesn't
   -- exist... hence the isHomeModule test here.  (ToDo: reinstate)

getPackageModuleInfo :: HscEnv -&gt; Module -&gt; IO (Maybe ModuleInfo)
#ifdef GHCI
getPackageModuleInfo hsc_env mdl
  = do  eps &lt;- hscEPS hsc_env
        iface &lt;- hscGetModuleInterface hsc_env mdl
        let
            avails = mi_exports iface
            pte    = eps_PTE eps
            tys    = [ ty | name &lt;- concatMap availNames avails,
                            Just ty &lt;- [lookupTypeEnv pte name] ]
        --
        return (Just (ModuleInfo {
                        minf_type_env  = mkTypeEnv tys,
                        minf_exports   = avails,
                        minf_rdr_env   = Just $! availsToGlobalRdrEnv (moduleName mdl) avails,
                        minf_instances = error &quot;getModuleInfo: instances for package module unimplemented&quot;,
                        minf_iface     = Just iface,
                        minf_safe      = getSafeMode $ mi_trust iface,
                        minf_modBreaks = emptyModBreaks
                }))
#else
-- bogusly different for non-GHCI (ToDo)
getPackageModuleInfo _hsc_env _mdl = do
  return Nothing
#endif

getHomeModuleInfo :: HscEnv -&gt; Module -&gt; IO (Maybe ModuleInfo)
getHomeModuleInfo hsc_env mdl =
  case lookupUFM (hsc_HPT hsc_env) (moduleName mdl) of
    Nothing  -&gt; return Nothing
    Just hmi -&gt; do
      let details = hm_details hmi
          iface   = hm_iface hmi
      return (Just (ModuleInfo {
                        minf_type_env  = md_types details,
                        minf_exports   = md_exports details,
                        minf_rdr_env   = mi_globals $! hm_iface hmi,
                        minf_instances = md_insts details,
                        minf_iface     = Just iface,
                        minf_safe      = getSafeMode $ mi_trust iface
#ifdef GHCI
                       ,minf_modBreaks = getModBreaks hmi
#endif
                        }))

-- | The list of top-level entities defined in a module
modInfoTyThings :: ModuleInfo -&gt; [TyThing]
modInfoTyThings minf = typeEnvElts (minf_type_env minf)

modInfoTopLevelScope :: ModuleInfo -&gt; Maybe [Name]
modInfoTopLevelScope minf
  = fmap (map gre_name . globalRdrEnvElts) (minf_rdr_env minf)

modInfoExports :: ModuleInfo -&gt; [Name]
modInfoExports minf = concatMap availNames $! minf_exports minf

modInfoExportsWithSelectors :: ModuleInfo -&gt; [Name]
modInfoExportsWithSelectors minf = concatMap availNamesWithSelectors $! minf_exports minf

-- | Returns the instances defined by the specified module.
-- Warning: currently unimplemented for package modules.
modInfoInstances :: ModuleInfo -&gt; [ClsInst]
modInfoInstances = minf_instances

modInfoIsExportedName :: ModuleInfo -&gt; Name -&gt; Bool
modInfoIsExportedName minf name = elemNameSet name (availsToNameSet (minf_exports minf))

mkPrintUnqualifiedForModule :: GhcMonad m =&gt;
                               ModuleInfo
                            -&gt; m (Maybe PrintUnqualified) -- XXX: returns a Maybe X
mkPrintUnqualifiedForModule minf = withSession $ \hsc_env -&gt; do
  return (fmap (mkPrintUnqualified (hsc_dflags hsc_env)) (minf_rdr_env minf))

modInfoLookupName :: GhcMonad m =&gt;
                     ModuleInfo -&gt; Name
                  -&gt; m (Maybe TyThing) -- XXX: returns a Maybe X
modInfoLookupName minf name = withSession $ \hsc_env -&gt; do
   case lookupTypeEnv (minf_type_env minf) name of
     Just tyThing -&gt; return (Just tyThing)
     Nothing      -&gt; do
       eps &lt;- liftIO $ readIORef (hsc_EPS hsc_env)
       return $! lookupType (hsc_dflags hsc_env)
                            (hsc_HPT hsc_env) (eps_PTE eps) name

modInfoIface :: ModuleInfo -&gt; Maybe ModIface
modInfoIface = minf_iface

-- | Retrieve module safe haskell mode
modInfoSafe :: ModuleInfo -&gt; SafeHaskellMode
modInfoSafe = minf_safe

#ifdef GHCI
modInfoModBreaks :: ModuleInfo -&gt; ModBreaks
modInfoModBreaks = minf_modBreaks
#endif

isDictonaryId :: Id -&gt; Bool
isDictonaryId id
  = case tcSplitSigmaTy (idType id) of {
      (_tvs, _theta, tau) -&gt; isDictTy tau }

-- | Looks up a global name: that is, any top-level name in any
-- visible module.  Unlike 'lookupName', lookupGlobalName does not use
-- the interactive context, and therefore does not require a preceding
-- 'setContext'.
lookupGlobalName :: GhcMonad m =&gt; Name -&gt; m (Maybe TyThing)
lookupGlobalName name = withSession $ \hsc_env -&gt; do
   liftIO $ lookupTypeHscEnv hsc_env name

findGlobalAnns :: (GhcMonad m, Typeable a) =&gt; ([Word8] -&gt; a) -&gt; AnnTarget Name -&gt; m [a]
findGlobalAnns deserialize target = withSession $ \hsc_env -&gt; do
    ann_env &lt;- liftIO $ prepareAnnotations hsc_env Nothing
    return (findAnns deserialize ann_env target)

#ifdef GHCI
-- | get the GlobalRdrEnv for a session
getGRE :: GhcMonad m =&gt; m GlobalRdrEnv
getGRE = withSession $ \hsc_env-&gt; return $ ic_rn_gbl_env (hsc_IC hsc_env)
#endif

-- -----------------------------------------------------------------------------

{- ToDo: Move the primary logic here to compiler/main/Packages.hs
-- | Return all /external/ modules available in the package database.
-- Modules from the current session (i.e., from the 'HomePackageTable') are
-- not included.  This includes module names which are reexported by packages.
packageDbModules :: GhcMonad m =&gt;
                    Bool  -- ^ Only consider exposed packages.
                 -&gt; m [Module]
packageDbModules only_exposed = do
   dflags &lt;- getSessionDynFlags
   let pkgs = eltsUFM (pkgIdMap (pkgState dflags))
   return $
     [ mkModule pid modname
     | p &lt;- pkgs
     , not only_exposed || exposed p
     , let pid = packageConfigId p
     , modname &lt;- exposedModules p
               ++ map exportName (reexportedModules p) ]
               -}

-- -----------------------------------------------------------------------------
-- Misc exported utils

dataConType :: DataCon -&gt; Type
dataConType dc = idType (dataConWrapId dc)

-- | print a 'NamedThing', adding parentheses if the name is an operator.
pprParenSymName :: NamedThing a =&gt; a -&gt; SDoc
pprParenSymName a = parenSymOcc (getOccName a) (ppr (getName a))

-- ----------------------------------------------------------------------------

#if 0

-- ToDo:
--   - Data and Typeable instances for HsSyn.

-- ToDo: check for small transformations that happen to the syntax in
-- the typechecker (eg. -e ==&gt; negate e, perhaps for fromIntegral)

-- ToDo: maybe use TH syntax instead of IfaceSyn?  There's already a way
-- to get from TyCons, Ids etc. to TH syntax (reify).

-- :browse will use either lm_toplev or inspect lm_interface, depending
-- on whether the module is interpreted or not.

#endif

-- Extract the filename, stringbuffer content and dynflags associed to a module
--
-- XXX: Explain pre-conditions
getModuleSourceAndFlags :: GhcMonad m =&gt; Module -&gt; m (String, StringBuffer, DynFlags)
getModuleSourceAndFlags mod = do
  m &lt;- getModSummary (moduleName mod)
  case ml_hs_file $ ms_location m of
    Nothing -&gt; do dflags &lt;- getDynFlags
                  liftIO $ throwIO $ mkApiErr dflags (text &quot;No source available for module &quot; &lt;+&gt; ppr mod)
    Just sourceFile -&gt; do
        source &lt;- liftIO $ hGetStringBuffer sourceFile
        return (sourceFile, source, ms_hspp_opts m)


-- | Return module source as token stream, including comments.
--
-- The module must be in the module graph and its source must be available.
-- Throws a 'HscTypes.SourceError' on parse error.
getTokenStream :: GhcMonad m =&gt; Module -&gt; m [Located Token]
getTokenStream mod = do
  (sourceFile, source, flags) &lt;- getModuleSourceAndFlags mod
  let startLoc = mkRealSrcLoc (mkFastString sourceFile) 1 1
  case lexTokenStream source startLoc flags of
    POk _ ts  -&gt; return ts
    PFailed span err -&gt;
        do dflags &lt;- getDynFlags
           liftIO $ throwIO $ mkSrcErr (unitBag $ mkPlainErrMsg dflags span err)

-- | Give even more information on the source than 'getTokenStream'
-- This function allows reconstructing the source completely with
-- 'showRichTokenStream'.
getRichTokenStream :: GhcMonad m =&gt; Module -&gt; m [(Located Token, String)]
getRichTokenStream mod = do
  (sourceFile, source, flags) &lt;- getModuleSourceAndFlags mod
  let startLoc = mkRealSrcLoc (mkFastString sourceFile) 1 1
  case lexTokenStream source startLoc flags of
    POk _ ts -&gt; return $ addSourceToTokens startLoc source ts
    PFailed span err -&gt;
        do dflags &lt;- getDynFlags
           liftIO $ throwIO $ mkSrcErr (unitBag $ mkPlainErrMsg dflags span err)

-- | Given a source location and a StringBuffer corresponding to this
-- location, return a rich token stream with the source associated to the
-- tokens.
addSourceToTokens :: RealSrcLoc -&gt; StringBuffer -&gt; [Located Token]
                  -&gt; [(Located Token, String)]
addSourceToTokens _ _ [] = []
addSourceToTokens loc buf (t@(L span _) : ts)
    = case span of
      UnhelpfulSpan _ -&gt; (t,&quot;&quot;) : addSourceToTokens loc buf ts
      RealSrcSpan s   -&gt; (t,str) : addSourceToTokens newLoc newBuf ts
        where
          (newLoc, newBuf, str) = go &quot;&quot; loc buf
          start = realSrcSpanStart s
          end = realSrcSpanEnd s
          go acc loc buf | loc &lt; start = go acc nLoc nBuf
                         | start &lt;= loc &amp;&amp; loc &lt; end = go (ch:acc) nLoc nBuf
                         | otherwise = (loc, buf, reverse acc)
              where (ch, nBuf) = nextChar buf
                    nLoc = advanceSrcLoc loc ch


-- | Take a rich token stream such as produced from 'getRichTokenStream' and
-- return source code almost identical to the original code (except for
-- insignificant whitespace.)
showRichTokenStream :: [(Located Token, String)] -&gt; String
showRichTokenStream ts = go startLoc ts &quot;&quot;
    where sourceFile = getFile $ map (getLoc . fst) ts
          getFile [] = panic &quot;showRichTokenStream: No source file found&quot;
          getFile (UnhelpfulSpan _ : xs) = getFile xs
          getFile (RealSrcSpan s : _) = srcSpanFile s
          startLoc = mkRealSrcLoc sourceFile 1 1
          go _ [] = id
          go loc ((L span _, str):ts)
              = case span of
                UnhelpfulSpan _ -&gt; go loc ts
                RealSrcSpan s
                 | locLine == tokLine -&gt; ((replicate (tokCol - locCol) ' ') ++)
                                       . (str ++)
                                       . go tokEnd ts
                 | otherwise -&gt; ((replicate (tokLine - locLine) '\n') ++)
                               . ((replicate (tokCol - 1) ' ') ++)
                              . (str ++)
                              . go tokEnd ts
                  where (locLine, locCol) = (srcLocLine loc, srcLocCol loc)
                        (tokLine, tokCol) = (srcSpanStartLine s, srcSpanStartCol s)
                        tokEnd = realSrcSpanEnd s

-- -----------------------------------------------------------------------------
-- Interactive evaluation

-- | Takes a 'ModuleName' and possibly a 'UnitId', and consults the
-- filesystem and package database to find the corresponding 'Module',
-- using the algorithm that is used for an @import@ declaration.
findModule :: GhcMonad m =&gt; ModuleName -&gt; Maybe FastString -&gt; m Module
findModule mod_name maybe_pkg = withSession $ \hsc_env -&gt; do
  let
    dflags   = hsc_dflags hsc_env
    this_pkg = thisPackage dflags
  --
  case maybe_pkg of
    Just pkg | fsToUnitId pkg /= this_pkg &amp;&amp; pkg /= fsLit &quot;this&quot; -&gt; liftIO $ do
      res &lt;- findImportedModule hsc_env mod_name maybe_pkg
      case res of
        Found _ m -&gt; return m
        err       -&gt; throwOneError $ noModError dflags noSrcSpan mod_name err
    _otherwise -&gt; do
      home &lt;- lookupLoadedHomeModule mod_name
      case home of
        Just m  -&gt; return m
        Nothing -&gt; liftIO $ do
           res &lt;- findImportedModule hsc_env mod_name maybe_pkg
           case res of
             Found loc m | moduleUnitId m /= this_pkg -&gt; return m
                         | otherwise -&gt; modNotLoadedError dflags m loc
             err -&gt; throwOneError $ noModError dflags noSrcSpan mod_name err

modNotLoadedError :: DynFlags -&gt; Module -&gt; ModLocation -&gt; IO a
modNotLoadedError dflags m loc = throwGhcExceptionIO $ CmdLineError $ showSDoc dflags $
   text &quot;module is not loaded:&quot; &lt;+&gt;
   quotes (ppr (moduleName m)) &lt;+&gt;
   parens (text (expectJust &quot;modNotLoadedError&quot; (ml_hs_file loc)))

-- | Like 'findModule', but differs slightly when the module refers to
-- a source file, and the file has not been loaded via 'load'.  In
-- this case, 'findModule' will throw an error (module not loaded),
-- but 'lookupModule' will check to see whether the module can also be
-- found in a package, and if so, that package 'Module' will be
-- returned.  If not, the usual module-not-found error will be thrown.
--
lookupModule :: GhcMonad m =&gt; ModuleName -&gt; Maybe FastString -&gt; m Module
lookupModule mod_name (Just pkg) = findModule mod_name (Just pkg)
lookupModule mod_name Nothing = withSession $ \hsc_env -&gt; do
  home &lt;- lookupLoadedHomeModule mod_name
  case home of
    Just m  -&gt; return m
    Nothing -&gt; liftIO $ do
      res &lt;- findExposedPackageModule hsc_env mod_name Nothing
      case res of
        Found _ m -&gt; return m
        err       -&gt; throwOneError $ noModError (hsc_dflags hsc_env) noSrcSpan mod_name err

lookupLoadedHomeModule :: GhcMonad m =&gt; ModuleName -&gt; m (Maybe Module)
lookupLoadedHomeModule mod_name = withSession $ \hsc_env -&gt;
  case lookupUFM (hsc_HPT hsc_env) mod_name of
    Just mod_info      -&gt; return (Just (mi_module (hm_iface mod_info)))
    _not_a_home_module -&gt; return Nothing

#ifdef GHCI
-- | Check that a module is safe to import (according to Safe Haskell).
--
-- We return True to indicate the import is safe and False otherwise
-- although in the False case an error may be thrown first.
isModuleTrusted :: GhcMonad m =&gt; Module -&gt; m Bool
isModuleTrusted m = withSession $ \hsc_env -&gt;
    liftIO $ hscCheckSafe hsc_env m noSrcSpan

-- | Return if a module is trusted and the pkgs it depends on to be trusted.
moduleTrustReqs :: GhcMonad m =&gt; Module -&gt; m (Bool, [UnitId])
moduleTrustReqs m = withSession $ \hsc_env -&gt;
    liftIO $ hscGetSafe hsc_env m noSrcSpan

-- | Set the monad GHCi lifts user statements into.
--
-- Checks that a type (in string form) is an instance of the
-- @GHC.GHCi.GHCiSandboxIO@ type class. Sets it to be the GHCi monad if it is,
-- throws an error otherwise.
setGHCiMonad :: GhcMonad m =&gt; String -&gt; m ()
setGHCiMonad name = withSession $ \hsc_env -&gt; do
    ty &lt;- liftIO $ hscIsGHCiMonad hsc_env name
    modifySession $ \s -&gt;
        let ic = (hsc_IC s) { ic_monad = ty }
        in s { hsc_IC = ic }

-- | Get the monad GHCi lifts user statements into.
getGHCiMonad :: GhcMonad m =&gt; m Name
getGHCiMonad = fmap (ic_monad . hsc_IC) getSession

getHistorySpan :: GhcMonad m =&gt; History -&gt; m SrcSpan
getHistorySpan h = withSession $ \hsc_env -&gt;
    return $ InteractiveEval.getHistorySpan hsc_env h

obtainTermFromVal :: GhcMonad m =&gt; Int -&gt;  Bool -&gt; Type -&gt; a -&gt; m Term
obtainTermFromVal bound force ty a = withSession $ \hsc_env -&gt;
    liftIO $ InteractiveEval.obtainTermFromVal hsc_env bound force ty a

obtainTermFromId :: GhcMonad m =&gt; Int -&gt; Bool -&gt; Id -&gt; m Term
obtainTermFromId bound force id = withSession $ \hsc_env -&gt;
    liftIO $ InteractiveEval.obtainTermFromId hsc_env bound force id

#endif

-- | Returns the 'TyThing' for a 'Name'.  The 'Name' may refer to any
-- entity known to GHC, including 'Name's defined using 'runStmt'.
lookupName :: GhcMonad m =&gt; Name -&gt; m (Maybe TyThing)
lookupName name =
     withSession $ \hsc_env -&gt;
       liftIO $ hscTcRcLookupName hsc_env name

-- -----------------------------------------------------------------------------
-- Pure API

-- | A pure interface to the module parser.
--
parser :: String         -- ^ Haskell module source text (full Unicode is supported)
       -&gt; DynFlags       -- ^ the flags
       -&gt; FilePath       -- ^ the filename (for source locations)
       -&gt; Either ErrorMessages (WarningMessages, Located (HsModule RdrName))

parser str dflags filename =
   let
       loc  = mkRealSrcLoc (mkFastString filename) 1 1
       buf  = stringToStringBuffer str
   in
   case unP Parser.parseModule (mkPState dflags buf loc) of

     PFailed span err   -&gt;
         Left (unitBag (mkPlainErrMsg dflags span err))

     POk pst rdr_module -&gt;
         let (warns,_) = getMessages pst in
         Right (warns, rdr_module)
</span></pre></body></html>