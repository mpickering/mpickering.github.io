<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006-2008
(c) The GRASP/AQUA Project, Glasgow University, 1993-1998
-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE CPP, NondecreasingIndentation #-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-comment">-- | Module for constructing @ModIface@ values (interface files),</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- writing them to disk and comparing two versions to see if</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- recompilation is required.</span><span>
</span><a name="line-11"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">MkIface</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-12"></a><span>        </span><a href="MkIface.html#mkIface"><span class="hs-identifier hs-var">mkIface</span></a><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- Build a ModIface from a ModGuts,</span><span>
</span><a name="line-13"></a><span>                        </span><span class="hs-comment">-- including computing version information</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span>        </span><a href="MkIface.html#mkIfaceTc"><span class="hs-identifier hs-var">mkIfaceTc</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>        </span><a href="MkIface.html#writeIfaceFile"><span class="hs-identifier hs-var">writeIfaceFile</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Write the interface file</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span>        </span><a href="MkIface.html#checkOldIface"><span class="hs-identifier hs-var">checkOldIface</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- See if recompilation is required, by</span><span>
</span><a name="line-20"></a><span>                        </span><span class="hs-comment">-- comparing version information</span><span>
</span><a name="line-21"></a><span>        </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="MkIface.html#recompileRequired"><span class="hs-identifier hs-var">recompileRequired</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span>        </span><a href="MkIface.html#tyThingToIfaceDecl"><span class="hs-identifier hs-var">tyThingToIfaceDecl</span></a><span> </span><span class="hs-comment">-- Converting things to their Iface equivalents</span><span>
</span><a name="line-24"></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-comment">{-
  -----------------------------------------------
          Recompilation checking
  -----------------------------------------------

A complete description of how recompilation checking works can be
found in the wiki commentary:

 http://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/RecompilationAvoidance

Please read the above page for a top-down description of how this all
works.  Notes below cover specific issues related to the implementation.

Basic idea:

  * In the mi_usages information in an interface, we record the
    fingerprint of each free variable of the module

  * In mkIface, we compute the fingerprint of each exported thing A.f.
    For each external thing that A.f refers to, we include the fingerprint
    of the external reference when computing the fingerprint of A.f.  So
    if anything that A.f depends on changes, then A.f's fingerprint will
    change.
    Also record any dependent files added with
      * addDependentFile
      * #include
      * -optP-include

  * In checkOldIface we compare the mi_usages for the module with
    the actual fingerprint for all each thing recorded in mi_usages
-}</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="IfaceSyn.html"><span class="hs-identifier">IfaceSyn</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="LoadIface.html"><span class="hs-identifier">LoadIface</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="FlagChecker.html"><span class="hs-identifier">FlagChecker</span></a><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="Desugar.html"><span class="hs-identifier">Desugar</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Desugar.html#mkUsageInfo"><span class="hs-identifier hs-var">mkUsageInfo</span></a><span class="hs-special">,</span><span> </span><a href="Desugar.html#mkUsedNames"><span class="hs-identifier hs-var">mkUsedNames</span></a><span class="hs-special">,</span><span> </span><a href="Desugar.html#mkDependencies"><span class="hs-identifier hs-var">mkDependencies</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="IdInfo.html"><span class="hs-identifier">IdInfo</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="Demand.html"><span class="hs-identifier">Demand</span></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="Annotations.html"><span class="hs-identifier">Annotations</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="CoAxiom.html"><span class="hs-identifier">CoAxiom</span></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><a href="ConLike.html"><span class="hs-identifier">ConLike</span></a><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="PatSyn.html"><span class="hs-identifier">PatSyn</span></a><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><a href="InstEnv.html"><span class="hs-identifier">InstEnv</span></a><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><a href="Finder.html"><span class="hs-identifier">Finder</span></a><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><a href="Avail.html"><span class="hs-identifier">Avail</span></a><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><a href="BinIface.html"><span class="hs-identifier">BinIface</span></a><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><a href="Digraph.html"><span class="hs-identifier">Digraph</span></a><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>       </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="BasicTypes.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>             </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="Util.html#eqListBy"><span class="hs-identifier hs-var">eqListBy</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span> </span><a href="FastStringEnv.html"><span class="hs-identifier">FastStringEnv</span></a><span>
</span><a name="line-105"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-106"></a><span class="hs-keyword">import</span><span> </span><a href="Binary.html"><span class="hs-identifier">Binary</span></a><span>
</span><a name="line-107"></a><span class="hs-keyword">import</span><span> </span><a href="Fingerprint.html"><span class="hs-identifier">Fingerprint</span></a><span>
</span><a name="line-108"></a><span class="hs-keyword">import</span><span> </span><a href="Exception.html"><span class="hs-identifier">Exception</span></a><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span></a><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Function.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Function</span></a><span>
</span><a name="line-112"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.List.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span></a><span>
</span><a name="line-113"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-114"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Ord.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Ord</span></a><span>
</span><a name="line-115"></a><span class="hs-keyword">import</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.IORef.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span></a><span>
</span><a name="line-116"></a><span class="hs-keyword">import</span><span> </span><a href="../directory-1.2.5.1/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Directory</span></a><span>
</span><a name="line-117"></a><span class="hs-keyword">import</span><span> </span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">FilePath</span></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Completing an interface}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-identifier">mkIface</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-128"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span>    </span><span class="hs-comment">-- The old fingerprint, if we have it</span><span>
</span><a name="line-129"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a><span>           </span><span class="hs-comment">-- The trimmed, tidied interface</span><span>
</span><a name="line-130"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span>              </span><span class="hs-comment">-- Usages, deprecations, etc</span><span>
</span><a name="line-131"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- The new one</span><span>
</span><a name="line-132"></a><span>               </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- True &lt;=&gt; there was an old Iface, and the</span><span>
</span><a name="line-133"></a><span>                         </span><span class="hs-comment">--          new one is identical, so no need</span><span>
</span><a name="line-134"></a><span>                         </span><span class="hs-comment">--          to write it</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><a name="mkIface"><a href="MkIface.html#mkIface"><span class="hs-identifier">mkIface</span></a></a><span> </span><a name="local-1628236738"><a href="#local-1628236738"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628236739"><a href="#local-1628236739"><span class="hs-identifier">maybe_old_fingerprint</span></a></a><span> </span><a name="local-1628236740"><a href="#local-1628236740"><span class="hs-identifier">mod_details</span></a></a><span>
</span><a name="line-137"></a><span>         </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-var">ModGuts</span></a><span class="hs-special">{</span><span>     </span><span class="hs-identifier">mg_module</span><span>       </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236741"><a href="#local-1628236741"><span class="hs-identifier">this_mod</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-138"></a><span>                      </span><span class="hs-identifier">mg_hsc_src</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236742"><a href="#local-1628236742"><span class="hs-identifier">hsc_src</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-139"></a><span>                      </span><span class="hs-identifier">mg_usages</span><span>       </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236743"><a href="#local-1628236743"><span class="hs-identifier">usages</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-140"></a><span>                      </span><span class="hs-identifier">mg_used_th</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236744"><a href="#local-1628236744"><span class="hs-identifier">used_th</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-141"></a><span>                      </span><span class="hs-identifier">mg_deps</span><span>         </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236745"><a href="#local-1628236745"><span class="hs-identifier">deps</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-142"></a><span>                      </span><span class="hs-identifier">mg_rdr_env</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236746"><a href="#local-1628236746"><span class="hs-identifier">rdr_env</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-143"></a><span>                      </span><span class="hs-identifier">mg_fix_env</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236747"><a href="#local-1628236747"><span class="hs-identifier">fix_env</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-144"></a><span>                      </span><span class="hs-identifier">mg_warns</span><span>        </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236748"><a href="#local-1628236748"><span class="hs-identifier">warns</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-145"></a><span>                      </span><span class="hs-identifier">mg_hpc_info</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236749"><a href="#local-1628236749"><span class="hs-identifier">hpc_info</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-146"></a><span>                      </span><span class="hs-identifier">mg_safe_haskell</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236750"><a href="#local-1628236750"><span class="hs-identifier">safe_mode</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-147"></a><span>                      </span><span class="hs-identifier">mg_trust_pkg</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236751"><a href="#local-1628236751"><span class="hs-identifier">self_trust</span></a></a><span>
</span><a name="line-148"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-149"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#mkIface_"><span class="hs-identifier hs-var">mkIface_</span></a><span> </span><a href="#local-1628236738"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628236739"><span class="hs-identifier hs-var">maybe_old_fingerprint</span></a><span>
</span><a name="line-150"></a><span>                   </span><a href="#local-1628236741"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><a href="#local-1628236742"><span class="hs-identifier hs-var">hsc_src</span></a><span> </span><a href="#local-1628236744"><span class="hs-identifier hs-var">used_th</span></a><span> </span><a href="#local-1628236745"><span class="hs-identifier hs-var">deps</span></a><span> </span><a href="#local-1628236746"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-1628236747"><span class="hs-identifier hs-var">fix_env</span></a><span>
</span><a name="line-151"></a><span>                   </span><a href="#local-1628236748"><span class="hs-identifier hs-var">warns</span></a><span> </span><a href="#local-1628236749"><span class="hs-identifier hs-var">hpc_info</span></a><span> </span><a href="#local-1628236751"><span class="hs-identifier hs-var">self_trust</span></a><span>
</span><a name="line-152"></a><span>                   </span><a href="#local-1628236750"><span class="hs-identifier hs-var">safe_mode</span></a><span> </span><a href="#local-1628236743"><span class="hs-identifier hs-var">usages</span></a><span> </span><a href="#local-1628236740"><span class="hs-identifier hs-var">mod_details</span></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-comment">-- | make an interface from the results of typechecking only.  Useful</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- for non-optimising compilation, or where we aren't generating any</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- object code at all ('HscNothing').</span><span>
</span><a name="line-157"></a><span class="hs-identifier">mkIfaceTc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-158"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span>  </span><span class="hs-comment">-- The old fingerprint, if we have it</span><span>
</span><a name="line-159"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a><span>    </span><span class="hs-comment">-- The safe haskell mode</span><span>
</span><a name="line-160"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a><span>         </span><span class="hs-comment">-- gotten from mkBootModDetails, probably</span><span>
</span><a name="line-161"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>           </span><span class="hs-comment">-- Usages, deprecations, etc</span><span>
</span><a name="line-162"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-163"></a><a name="mkIfaceTc"><a href="MkIface.html#mkIfaceTc"><span class="hs-identifier">mkIfaceTc</span></a></a><span> </span><a name="local-1628236752"><a href="#local-1628236752"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628236753"><a href="#local-1628236753"><span class="hs-identifier">maybe_old_fingerprint</span></a></a><span> </span><a name="local-1628236754"><a href="#local-1628236754"><span class="hs-identifier">safe_mode</span></a></a><span> </span><a name="local-1628236755"><a href="#local-1628236755"><span class="hs-identifier">mod_details</span></a></a><span>
</span><a name="line-164"></a><span>  </span><a name="local-1628236756"><a href="#local-1628236756"><span class="hs-identifier">tc_result</span></a></a><span class="hs-glyph">@</span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-var">TcGblEnv</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcg_mod</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236757"><a href="#local-1628236757"><span class="hs-identifier">this_mod</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-165"></a><span>                      </span><span class="hs-identifier">tcg_src</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236758"><a href="#local-1628236758"><span class="hs-identifier">hsc_src</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-166"></a><span>                      </span><span class="hs-identifier">tcg_imports</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236759"><a href="#local-1628236759"><span class="hs-identifier">imports</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-167"></a><span>                      </span><span class="hs-identifier">tcg_rdr_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236760"><a href="#local-1628236760"><span class="hs-identifier">rdr_env</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-168"></a><span>                      </span><span class="hs-identifier">tcg_fix_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236761"><a href="#local-1628236761"><span class="hs-identifier">fix_env</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-169"></a><span>                      </span><span class="hs-identifier">tcg_warns</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236762"><a href="#local-1628236762"><span class="hs-identifier">warns</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-170"></a><span>                      </span><span class="hs-identifier">tcg_hpc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236763"><a href="#local-1628236763"><span class="hs-identifier">other_hpc_info</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-171"></a><span>                      </span><span class="hs-identifier">tcg_th_splice_used</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236764"><a href="#local-1628236764"><span class="hs-identifier">tc_splice_used</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-172"></a><span>                      </span><span class="hs-identifier">tcg_dependent_files</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236765"><a href="#local-1628236765"><span class="hs-identifier">dependent_files</span></a></a><span>
</span><a name="line-173"></a><span>                    </span><span class="hs-special">}</span><span>
</span><a name="line-174"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-175"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236766"><a href="#local-1628236766"><span class="hs-identifier">used_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Desugar.html#mkUsedNames"><span class="hs-identifier hs-var">mkUsedNames</span></a><span> </span><a href="#local-1628236756"><span class="hs-identifier hs-var">tc_result</span></a><span>
</span><a name="line-176"></a><span>          </span><a name="local-1628236767"><a href="#local-1628236767"><span class="hs-identifier">deps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Desugar.html#mkDependencies"><span class="hs-identifier hs-var">mkDependencies</span></a><span> </span><a href="#local-1628236756"><span class="hs-identifier hs-var">tc_result</span></a><span>
</span><a name="line-177"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236768"><a href="#local-1628236768"><span class="hs-identifier">hpc_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#emptyHpcInfo"><span class="hs-identifier hs-var">emptyHpcInfo</span></a><span> </span><a href="#local-1628236763"><span class="hs-identifier hs-var">other_hpc_info</span></a><span>
</span><a name="line-178"></a><span>          </span><a name="local-1628236769"><a href="#local-1628236769"><span class="hs-identifier">used_th</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-1628236764"><span class="hs-identifier hs-var">tc_splice_used</span></a><span>
</span><a name="line-179"></a><span>          </span><a name="local-1628236770"><a href="#local-1628236770"><span class="hs-identifier">dep_files</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a><span> </span><a href="#local-1628236765"><span class="hs-identifier hs-var">dependent_files</span></a><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>          </span><a name="local-1628236771"><a href="#local-1628236771"><span class="hs-identifier">usages</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Desugar.html#mkUsageInfo"><span class="hs-identifier hs-var">mkUsageInfo</span></a><span> </span><a href="#local-1628236752"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628236757"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">imp_mods</span><span> </span><a href="#local-1628236759"><span class="hs-identifier hs-var">imports</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628236766"><span class="hs-identifier hs-var">used_names</span></a><span> </span><a href="#local-1628236770"><span class="hs-identifier hs-var">dep_files</span></a><span>
</span><a name="line-181"></a><span>          </span><a href="MkIface.html#mkIface_"><span class="hs-identifier hs-var">mkIface_</span></a><span> </span><a href="#local-1628236752"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628236753"><span class="hs-identifier hs-var">maybe_old_fingerprint</span></a><span>
</span><a name="line-182"></a><span>                   </span><a href="#local-1628236757"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><a href="#local-1628236758"><span class="hs-identifier hs-var">hsc_src</span></a><span>
</span><a name="line-183"></a><span>                   </span><a href="#local-1628236769"><span class="hs-identifier hs-var">used_th</span></a><span> </span><a href="#local-1628236767"><span class="hs-identifier hs-var">deps</span></a><span> </span><a href="#local-1628236760"><span class="hs-identifier hs-var">rdr_env</span></a><span>
</span><a name="line-184"></a><span>                   </span><a href="#local-1628236761"><span class="hs-identifier hs-var">fix_env</span></a><span> </span><a href="#local-1628236762"><span class="hs-identifier hs-var">warns</span></a><span> </span><a href="#local-1628236768"><span class="hs-identifier hs-var">hpc_info</span></a><span>
</span><a name="line-185"></a><span>                   </span><span class="hs-special">(</span><span class="hs-identifier">imp_trust_own_pkg</span><span> </span><a href="#local-1628236759"><span class="hs-identifier hs-var">imports</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628236754"><span class="hs-identifier hs-var">safe_mode</span></a><span> </span><a href="#local-1628236771"><span class="hs-identifier hs-var">usages</span></a><span> </span><a href="#local-1628236755"><span class="hs-identifier hs-var">mod_details</span></a><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-identifier">mkIface_</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span>
</span><a name="line-189"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-190"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="HscTypes.html#FixItem"><span class="hs-identifier hs-type">FixItem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HpcInfo"><span class="hs-identifier hs-type">HpcInfo</span></a><span>
</span><a name="line-191"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-192"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a><span>
</span><a name="line-193"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#Usage"><span class="hs-identifier hs-type">Usage</span></a><span class="hs-special">]</span><span>
</span><a name="line-194"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a><span>
</span><a name="line-195"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><a name="mkIface_"><a href="MkIface.html#mkIface_"><span class="hs-identifier">mkIface_</span></a></a><span> </span><a name="local-1628236772"><a href="#local-1628236772"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628236773"><a href="#local-1628236773"><span class="hs-identifier">maybe_old_fingerprint</span></a></a><span>
</span><a name="line-197"></a><span>         </span><a name="local-1628236774"><a href="#local-1628236774"><span class="hs-identifier">this_mod</span></a></a><span> </span><a name="local-1628236775"><a href="#local-1628236775"><span class="hs-identifier">hsc_src</span></a></a><span> </span><a name="local-1628236776"><a href="#local-1628236776"><span class="hs-identifier">used_th</span></a></a><span> </span><a name="local-1628236777"><a href="#local-1628236777"><span class="hs-identifier">deps</span></a></a><span> </span><a name="local-1628236778"><a href="#local-1628236778"><span class="hs-identifier">rdr_env</span></a></a><span> </span><a name="local-1628236779"><a href="#local-1628236779"><span class="hs-identifier">fix_env</span></a></a><span> </span><a name="local-1628236780"><a href="#local-1628236780"><span class="hs-identifier">src_warns</span></a></a><span>
</span><a name="line-198"></a><span>         </span><a name="local-1628236781"><a href="#local-1628236781"><span class="hs-identifier">hpc_info</span></a></a><span> </span><a name="local-1628236782"><a href="#local-1628236782"><span class="hs-identifier">pkg_trust_req</span></a></a><span> </span><a name="local-1628236783"><a href="#local-1628236783"><span class="hs-identifier">safe_mode</span></a></a><span> </span><a name="local-1628236784"><a href="#local-1628236784"><span class="hs-identifier">usages</span></a></a><span>
</span><a name="line-199"></a><span>         </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-var">ModDetails</span></a><span class="hs-special">{</span><span>  </span><span class="hs-identifier">md_insts</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236785"><a href="#local-1628236785"><span class="hs-identifier">insts</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-200"></a><span>                      </span><span class="hs-identifier">md_fam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236786"><a href="#local-1628236786"><span class="hs-identifier">fam_insts</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-201"></a><span>                      </span><span class="hs-identifier">md_rules</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236787"><a href="#local-1628236787"><span class="hs-identifier">rules</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-202"></a><span>                      </span><span class="hs-identifier">md_anns</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236788"><a href="#local-1628236788"><span class="hs-identifier">anns</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-203"></a><span>                      </span><span class="hs-identifier">md_vect_info</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236789"><a href="#local-1628236789"><span class="hs-identifier">vect_info</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-204"></a><span>                      </span><span class="hs-identifier">md_types</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236790"><a href="#local-1628236790"><span class="hs-identifier">type_env</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-205"></a><span>                      </span><span class="hs-identifier">md_exports</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236791"><a href="#local-1628236791"><span class="hs-identifier">exports</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-206"></a><span class="hs-comment">-- NB:  notice that mkIface does not look at the bindings</span><span>
</span><a name="line-207"></a><span class="hs-comment">--      only at the TypeEnv.  The previous Tidy phase has</span><span>
</span><a name="line-208"></a><span class="hs-comment">--      put exactly the info into the TypeEnv that we want</span><span>
</span><a name="line-209"></a><span class="hs-comment">--      to expose in the interface</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236813"><a href="#local-1628236813"><span class="hs-identifier">entities</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#typeEnvElts"><span class="hs-identifier hs-var">typeEnvElts</span></a><span> </span><a href="#local-1628236790"><span class="hs-identifier hs-var">type_env</span></a><span>
</span><a name="line-213"></a><span>        </span><a name="local-1628236814"><a href="#local-1628236814"><span class="hs-identifier">decls</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="MkIface.html#tyThingToIfaceDecl"><span class="hs-identifier hs-var">tyThingToIfaceDecl</span></a><span> </span><a href="#local-1628236825"><span class="hs-identifier hs-var">entity</span></a><span>
</span><a name="line-214"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a name="local-1628236825"><a href="#local-1628236825"><span class="hs-identifier">entity</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628236813"><span class="hs-identifier hs-var">entities</span></a><span class="hs-special">,</span><span>
</span><a name="line-215"></a><span>                   </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236826"><a href="#local-1628236826"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-1628236825"><span class="hs-identifier hs-var">entity</span></a><span class="hs-special">,</span><span>
</span><a name="line-216"></a><span>                   </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#isImplicitTyThing"><span class="hs-identifier hs-var">isImplicitTyThing</span></a><span> </span><a href="#local-1628236825"><span class="hs-identifier hs-var">entity</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-217"></a><span>                      </span><span class="hs-comment">-- No implicit Ids and class tycons in the interface file</span><span>
</span><a name="line-218"></a><span>                   </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Name.html#isWiredInName"><span class="hs-identifier hs-var">isWiredInName</span></a><span> </span><a href="#local-1628236826"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-219"></a><span>                      </span><span class="hs-comment">-- Nor wired-in things; the compiler knows about them anyhow</span><span>
</span><a name="line-220"></a><span>                   </span><a href="Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a><span> </span><a href="#local-1628236774"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><a href="#local-1628236826"><span class="hs-identifier hs-var">name</span></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-221"></a><span>                      </span><span class="hs-comment">-- Sigh: see Note [Root-main Id] in TcRnDriver</span><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span>        </span><a name="local-1628236815"><a href="#local-1628236815"><span class="hs-identifier">fixities</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1628236827"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">,</span><a href="#local-1628236828"><span class="hs-identifier hs-var">fix</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="HscTypes.html#FixItem"><span class="hs-identifier hs-var">FixItem</span></a><span> </span><a name="local-1628236827"><a href="#local-1628236827"><span class="hs-identifier">occ</span></a></a><span> </span><a name="local-1628236828"><a href="#local-1628236828"><span class="hs-identifier">fix</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NameEnv.html#nameEnvElts"><span class="hs-identifier hs-var">nameEnvElts</span></a><span> </span><a href="#local-1628236779"><span class="hs-identifier hs-var">fix_env</span></a><span class="hs-special">]</span><span>
</span><a name="line-225"></a><span>          </span><span class="hs-comment">-- The order of fixities returned from nameEnvElts is not</span><span>
</span><a name="line-226"></a><span>          </span><span class="hs-comment">-- deterministic, so we sort by OccName to canonicalize it.</span><span>
</span><a name="line-227"></a><span>          </span><span class="hs-comment">-- See Note [Deterministic UniqFM] in UniqDFM for more details.</span><span>
</span><a name="line-228"></a><span>        </span><a name="local-1628236816"><a href="#local-1628236816"><span class="hs-identifier">warns</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236780"><span class="hs-identifier hs-var">src_warns</span></a><span>
</span><a name="line-229"></a><span>        </span><a name="local-1628236817"><a href="#local-1628236817"><span class="hs-identifier">iface_rules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#coreRuleToIfaceRule"><span class="hs-identifier hs-var">coreRuleToIfaceRule</span></a><span> </span><a href="#local-1628236787"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-230"></a><span>        </span><a name="local-1628236818"><a href="#local-1628236818"><span class="hs-identifier">iface_insts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#instanceToIfaceInst"><span class="hs-identifier hs-var">instanceToIfaceInst</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="TcRnMonad.html#fixSafeInstances"><span class="hs-identifier hs-var">fixSafeInstances</span></a><span> </span><a href="#local-1628236783"><span class="hs-identifier hs-var">safe_mode</span></a><span> </span><a href="#local-1628236785"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-231"></a><span>        </span><a name="local-1628236819"><a href="#local-1628236819"><span class="hs-identifier">iface_fam_insts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#famInstToIfaceFamInst"><span class="hs-identifier hs-var">famInstToIfaceFamInst</span></a><span> </span><a href="#local-1628236786"><span class="hs-identifier hs-var">fam_insts</span></a><span>
</span><a name="line-232"></a><span>        </span><a name="local-1628236820"><a href="#local-1628236820"><span class="hs-identifier">iface_vect_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236799"><span class="hs-identifier hs-var">flattenVectInfo</span></a><span> </span><a href="#local-1628236789"><span class="hs-identifier hs-var">vect_info</span></a><span>
</span><a name="line-233"></a><span>        </span><a name="local-1628236821"><a href="#local-1628236821"><span class="hs-identifier">trust_info</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#setSafeMode"><span class="hs-identifier hs-var">setSafeMode</span></a><span> </span><a href="#local-1628236783"><span class="hs-identifier hs-var">safe_mode</span></a><span>
</span><a name="line-234"></a><span>        </span><a name="local-1628236822"><a href="#local-1628236822"><span class="hs-identifier">annotations</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#mkIfaceAnnotation"><span class="hs-identifier hs-var">mkIfaceAnnotation</span></a><span> </span><a href="#local-1628236788"><span class="hs-identifier hs-var">anns</span></a><span>
</span><a name="line-235"></a><span>        </span><a name="local-1628236823"><a href="#local-1628236823"><span class="hs-identifier">sig_of</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#getSigOf"><span class="hs-identifier hs-var">getSigOf</span></a><span> </span><a href="#local-1628236795"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-1628236774"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span>        </span><a name="local-1628236824"><a href="#local-1628236824"><span class="hs-identifier">intermediate_iface</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-var">ModIface</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-238"></a><span>              </span><span class="hs-identifier">mi_module</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236774"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">,</span><span>
</span><a name="line-239"></a><span>              </span><span class="hs-identifier">mi_sig_of</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236823"><span class="hs-identifier hs-var">sig_of</span></a><span class="hs-special">,</span><span>
</span><a name="line-240"></a><span>              </span><span class="hs-identifier">mi_hsc_src</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236775"><span class="hs-identifier hs-var">hsc_src</span></a><span class="hs-special">,</span><span>
</span><a name="line-241"></a><span>              </span><span class="hs-identifier">mi_deps</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236777"><span class="hs-identifier hs-var">deps</span></a><span class="hs-special">,</span><span>
</span><a name="line-242"></a><span>              </span><span class="hs-identifier">mi_usages</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236784"><span class="hs-identifier hs-var">usages</span></a><span class="hs-special">,</span><span>
</span><a name="line-243"></a><span>              </span><span class="hs-identifier">mi_exports</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#mkIfaceExports"><span class="hs-identifier hs-var">mkIfaceExports</span></a><span> </span><a href="#local-1628236791"><span class="hs-identifier hs-var">exports</span></a><span class="hs-special">,</span><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>              </span><span class="hs-comment">-- Sort these lexicographically, so that</span><span>
</span><a name="line-246"></a><span>              </span><span class="hs-comment">-- the result is stable across compilations</span><span>
</span><a name="line-247"></a><span>              </span><span class="hs-identifier">mi_insts</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><a href="#local-1628236793"><span class="hs-identifier hs-var">cmp_inst</span></a><span>     </span><a href="#local-1628236818"><span class="hs-identifier hs-var">iface_insts</span></a><span class="hs-special">,</span><span>
</span><a name="line-248"></a><span>              </span><span class="hs-identifier">mi_fam_insts</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><a href="#local-1628236794"><span class="hs-identifier hs-var">cmp_fam_inst</span></a><span> </span><a href="#local-1628236819"><span class="hs-identifier hs-var">iface_fam_insts</span></a><span class="hs-special">,</span><span>
</span><a name="line-249"></a><span>              </span><span class="hs-identifier">mi_rules</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><a href="#local-1628236792"><span class="hs-identifier hs-var">cmp_rule</span></a><span>     </span><a href="#local-1628236817"><span class="hs-identifier hs-var">iface_rules</span></a><span class="hs-special">,</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>              </span><span class="hs-identifier">mi_vect_info</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236820"><span class="hs-identifier hs-var">iface_vect_info</span></a><span class="hs-special">,</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span>              </span><span class="hs-identifier">mi_fixities</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236815"><span class="hs-identifier hs-var">fixities</span></a><span class="hs-special">,</span><span>
</span><a name="line-254"></a><span>              </span><span class="hs-identifier">mi_warns</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236816"><span class="hs-identifier hs-var">warns</span></a><span class="hs-special">,</span><span>
</span><a name="line-255"></a><span>              </span><span class="hs-identifier">mi_anns</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236822"><span class="hs-identifier hs-var">annotations</span></a><span class="hs-special">,</span><span>
</span><a name="line-256"></a><span>              </span><span class="hs-identifier">mi_globals</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236796"><span class="hs-identifier hs-var">maybeGlobalRdrEnv</span></a><span> </span><a href="#local-1628236778"><span class="hs-identifier hs-var">rdr_env</span></a><span class="hs-special">,</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span>              </span><span class="hs-comment">-- Left out deliberately: filled in by addFingerprints</span><span>
</span><a name="line-259"></a><span>              </span><span class="hs-identifier">mi_iface_hash</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.html#fingerprint0"><span class="hs-identifier hs-var">fingerprint0</span></a><span class="hs-special">,</span><span>
</span><a name="line-260"></a><span>              </span><span class="hs-identifier">mi_mod_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.html#fingerprint0"><span class="hs-identifier hs-var">fingerprint0</span></a><span class="hs-special">,</span><span>
</span><a name="line-261"></a><span>              </span><span class="hs-identifier">mi_flag_hash</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.html#fingerprint0"><span class="hs-identifier hs-var">fingerprint0</span></a><span class="hs-special">,</span><span>
</span><a name="line-262"></a><span>              </span><span class="hs-identifier">mi_exp_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.html#fingerprint0"><span class="hs-identifier hs-var">fingerprint0</span></a><span class="hs-special">,</span><span>
</span><a name="line-263"></a><span>              </span><span class="hs-identifier">mi_used_th</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236776"><span class="hs-identifier hs-var">used_th</span></a><span class="hs-special">,</span><span>
</span><a name="line-264"></a><span>              </span><span class="hs-identifier">mi_orphan_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.html#fingerprint0"><span class="hs-identifier hs-var">fingerprint0</span></a><span class="hs-special">,</span><span>
</span><a name="line-265"></a><span>              </span><span class="hs-identifier">mi_orphan</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Always set by addFingerprints, but</span><span>
</span><a name="line-266"></a><span>                                      </span><span class="hs-comment">-- it's a strict field, so we can't omit it.</span><span>
</span><a name="line-267"></a><span>              </span><span class="hs-identifier">mi_finsts</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Ditto</span><span>
</span><a name="line-268"></a><span>              </span><span class="hs-identifier">mi_decls</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236797"><span class="hs-identifier hs-var">deliberatelyOmitted</span></a><span> </span><span class="hs-string">&quot;decls&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-269"></a><span>              </span><span class="hs-identifier">mi_hash_fn</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236797"><span class="hs-identifier hs-var">deliberatelyOmitted</span></a><span> </span><span class="hs-string">&quot;hash_fn&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-270"></a><span>              </span><span class="hs-identifier">mi_hpc</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#isHpcUsed"><span class="hs-identifier hs-var">isHpcUsed</span></a><span> </span><a href="#local-1628236781"><span class="hs-identifier hs-var">hpc_info</span></a><span class="hs-special">,</span><span>
</span><a name="line-271"></a><span>              </span><span class="hs-identifier">mi_trust</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236821"><span class="hs-identifier hs-var">trust_info</span></a><span class="hs-special">,</span><span>
</span><a name="line-272"></a><span>              </span><span class="hs-identifier">mi_trust_pkg</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236782"><span class="hs-identifier hs-var">pkg_trust_req</span></a><span class="hs-special">,</span><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span>              </span><span class="hs-comment">-- And build the cached values</span><span>
</span><a name="line-275"></a><span>              </span><span class="hs-identifier">mi_warn_fn</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#mkIfaceWarnCache"><span class="hs-identifier hs-var">mkIfaceWarnCache</span></a><span> </span><a href="#local-1628236816"><span class="hs-identifier hs-var">warns</span></a><span class="hs-special">,</span><span>
</span><a name="line-276"></a><span>              </span><span class="hs-identifier">mi_fix_fn</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#mkIfaceFixCache"><span class="hs-identifier hs-var">mkIfaceFixCache</span></a><span> </span><a href="#local-1628236815"><span class="hs-identifier hs-var">fixities</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span>    </span><span class="hs-special">(</span><a name="local-1628236829"><a href="#local-1628236829"><span class="hs-identifier">new_iface</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628236830"><a href="#local-1628236830"><span class="hs-identifier">no_change_at_all</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC &quot;versioninfo&quot; #-}</span><span>
</span><a name="line-280"></a><span>                   </span><a href="MkIface.html#addFingerprints"><span class="hs-identifier hs-var">addFingerprints</span></a><span> </span><a href="#local-1628236772"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628236773"><span class="hs-identifier hs-var">maybe_old_fingerprint</span></a><span>
</span><a name="line-281"></a><span>                                   </span><a href="#local-1628236824"><span class="hs-identifier hs-var">intermediate_iface</span></a><span> </span><a href="#local-1628236814"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span>    </span><span class="hs-comment">-- Debug printing</span><span>
</span><a name="line-284"></a><span>    </span><a href="ErrUtils.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a><span> </span><a href="#local-1628236795"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#Opt_D_dump_hi"><span class="hs-identifier hs-var">Opt_D_dump_hi</span></a><span> </span><span class="hs-string">&quot;FINAL INTERFACE&quot;</span><span>
</span><a name="line-285"></a><span>                  </span><span class="hs-special">(</span><a href="LoadIface.html#pprModIface"><span class="hs-identifier hs-var">pprModIface</span></a><span> </span><a href="#local-1628236829"><span class="hs-identifier hs-var">new_iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span>    </span><span class="hs-comment">-- bug #1617: on reload we weren't updating the PrintUnqualified</span><span>
</span><a name="line-288"></a><span>    </span><span class="hs-comment">-- correctly.  This stems from the fact that the interface had</span><span>
</span><a name="line-289"></a><span>    </span><span class="hs-comment">-- not changed, so addFingerprints returns the old ModIface</span><span>
</span><a name="line-290"></a><span>    </span><span class="hs-comment">-- with the old GlobalRdrEnv (mi_globals).</span><span>
</span><a name="line-291"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236831"><a href="#local-1628236831"><span class="hs-identifier">final_iface</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236829"><span class="hs-identifier hs-var">new_iface</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">mi_globals</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236796"><span class="hs-identifier hs-var">maybeGlobalRdrEnv</span></a><span> </span><a href="#local-1628236778"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span>    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236831"><span class="hs-identifier hs-var">final_iface</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236830"><span class="hs-identifier hs-var">no_change_at_all</span></a><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-295"></a><span>     </span><a name="local-1628236792"><a href="#local-1628236792"><span class="hs-identifier">cmp_rule</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a><span> </span><span class="hs-identifier">ifRuleName</span><span>
</span><a name="line-296"></a><span>     </span><span class="hs-comment">-- Compare these lexicographically by OccName, *not* by unique,</span><span>
</span><a name="line-297"></a><span>     </span><span class="hs-comment">-- because the latter is not stable across compilations:</span><span>
</span><a name="line-298"></a><span>     </span><a name="local-1628236793"><a href="#local-1628236793"><span class="hs-identifier">cmp_inst</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">ifDFun</span><span class="hs-special">)</span><span>
</span><a name="line-299"></a><span>     </span><a name="local-1628236794"><a href="#local-1628236794"><span class="hs-identifier">cmp_fam_inst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1628236798"><span class="hs-identifier hs-var">ifFamInstTcName</span></a><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span>     </span><a name="local-1628236795"><a href="#local-1628236795"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628236772"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span>     </span><span class="hs-comment">-- We only fill in mi_globals if the module was compiled to byte</span><span>
</span><a name="line-304"></a><span>     </span><span class="hs-comment">-- code.  Otherwise, the compiler may not have retained all the</span><span>
</span><a name="line-305"></a><span>     </span><span class="hs-comment">-- top-level bindings and they won't be in the TypeEnv (see</span><span>
</span><a name="line-306"></a><span>     </span><span class="hs-comment">-- Desugar.addExportFlagsAndRules).  The mi_globals field is used</span><span>
</span><a name="line-307"></a><span>     </span><span class="hs-comment">-- by GHCi to decide whether the module has its full top-level</span><span>
</span><a name="line-308"></a><span>     </span><span class="hs-comment">-- scope available. (#5534)</span><span>
</span><a name="line-309"></a><span>     </span><span class="hs-identifier">maybeGlobalRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-310"></a><span>     </span><a name="local-1628236796"><a href="#local-1628236796"><span class="hs-identifier">maybeGlobalRdrEnv</span></a></a><span> </span><a name="local-1628236801"><a href="#local-1628236801"><span class="hs-identifier">rdr_env</span></a></a><span>
</span><a name="line-311"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#targetRetainsAllBindings"><span class="hs-identifier hs-var">targetRetainsAllBindings</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hscTarget</span><span> </span><a href="#local-1628236795"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628236801"><span class="hs-identifier hs-var">rdr_env</span></a><span>
</span><a name="line-312"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                                   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span>     </span><span class="hs-identifier">deliberatelyOmitted</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628236800"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-315"></a><span>     </span><a name="local-1628236797"><a href="#local-1628236797"><span class="hs-identifier">deliberatelyOmitted</span></a></a><span> </span><a name="local-1628236802"><a href="#local-1628236802"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Deliberately omitted: &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628236802"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span>     </span><a name="local-1628236798"><a href="#local-1628236798"><span class="hs-identifier">ifFamInstTcName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ifFamInstFam</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span>     </span><a name="local-1628236799"><a href="#local-1628236799"><span class="hs-identifier">flattenVectInfo</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#VectInfo"><span class="hs-identifier hs-var">VectInfo</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">vectInfoVar</span><span>            </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236803"><a href="#local-1628236803"><span class="hs-identifier">vVar</span></a></a><span>
</span><a name="line-320"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vectInfoTyCon</span><span>          </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236804"><a href="#local-1628236804"><span class="hs-identifier">vTyCon</span></a></a><span>
</span><a name="line-321"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vectInfoParallelVars</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236805"><a href="#local-1628236805"><span class="hs-identifier">vParallelVars</span></a></a><span>
</span><a name="line-322"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vectInfoParallelTyCons</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236806"><a href="#local-1628236806"><span class="hs-identifier">vParallelTyCons</span></a></a><span>
</span><a name="line-323"></a><span>                               </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-324"></a><span>       </span><a href="HscTypes.html#IfaceVectInfo"><span class="hs-identifier hs-var">IfaceVectInfo</span></a><span>
</span><a name="line-325"></a><span>       </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifaceVectInfoVar</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Var</span><span class="hs-operator">.</span><span class="hs-identifier">varName</span><span> </span><a href="#local-1628236807"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628236807"><a href="#local-1628236807"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="VarEnv.html#varEnvElts"><span class="hs-identifier hs-var">varEnvElts</span></a><span>  </span><a href="#local-1628236803"><span class="hs-identifier hs-var">vVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-326"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaceVectInfoTyCon</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-1628236808"><span class="hs-identifier hs-var">t</span></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628236808"><a href="#local-1628236808"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628236809"><a href="#local-1628236809"><span class="hs-identifier">t_v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NameEnv.html#nameEnvElts"><span class="hs-identifier hs-var">nameEnvElts</span></a><span> </span><a href="#local-1628236804"><span class="hs-identifier hs-var">vTyCon</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236808"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1628236809"><span class="hs-identifier hs-var">t_v</span></a><span class="hs-special">]</span><span>
</span><a name="line-327"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaceVectInfoTyConReuse</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-1628236810"><span class="hs-identifier hs-var">t</span></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628236810"><a href="#local-1628236810"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628236811"><a href="#local-1628236811"><span class="hs-identifier">t_v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NameEnv.html#nameEnvElts"><span class="hs-identifier hs-var">nameEnvElts</span></a><span> </span><a href="#local-1628236804"><span class="hs-identifier hs-var">vTyCon</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236810"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628236811"><span class="hs-identifier hs-var">t_v</span></a><span class="hs-special">]</span><span>
</span><a name="line-328"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaceVectInfoParallelVars</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Var</span><span class="hs-operator">.</span><span class="hs-identifier">varName</span><span> </span><a href="#local-1628236812"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628236812"><a href="#local-1628236812"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="VarSet.html#varSetElems"><span class="hs-identifier hs-var">varSetElems</span></a><span> </span><a href="#local-1628236805"><span class="hs-identifier hs-var">vParallelVars</span></a><span class="hs-special">]</span><span>
</span><a name="line-329"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaceVectInfoParallelTyCons</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#nameSetElems"><span class="hs-identifier hs-var">nameSetElems</span></a><span> </span><a href="#local-1628236806"><span class="hs-identifier hs-var">vParallelTyCons</span></a><span>
</span><a name="line-330"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-comment">-----------------------------</span><span>
</span><a name="line-333"></a><span class="hs-identifier">writeIfaceFile</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-334"></a><a name="writeIfaceFile"><a href="MkIface.html#writeIfaceFile"><span class="hs-identifier">writeIfaceFile</span></a></a><span> </span><a name="local-1628236832"><a href="#local-1628236832"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-1628236833"><a href="#local-1628236833"><span class="hs-identifier">hi_file_path</span></a></a><span> </span><a name="local-1628236834"><a href="#local-1628236834"><span class="hs-identifier">new_iface</span></a></a><span>
</span><a name="line-335"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="../directory-1.2.5.1/src/%{MODULE/./-}.html#%{NAME}/System.Directory.html#createDirectoryIfMissing"><span class="hs-identifier hs-var">createDirectoryIfMissing</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="../filepath-1.4.1.0/src/%{MODULE/./-}.html#%{NAME}/System.FilePath.Posix.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a><span> </span><a href="#local-1628236833"><span class="hs-identifier hs-var">hi_file_path</span></a><span class="hs-special">)</span><span>
</span><a name="line-336"></a><span>         </span><a href="BinIface.html#writeBinIface"><span class="hs-identifier hs-var">writeBinIface</span></a><span> </span><a href="#local-1628236832"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628236833"><span class="hs-identifier hs-var">hi_file_path</span></a><span> </span><a href="#local-1628236834"><span class="hs-identifier hs-var">new_iface</span></a><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- Look up parents and versions of Names</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-comment">-- This is like a global version of the mi_hash_fn field in each ModIface.</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- Given a Name, it finds the ModIface, and then uses mi_hash_fn to get</span><span>
</span><a name="line-344"></a><span class="hs-comment">-- the parent and version info.</span><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span class="hs-identifier">mkHashFun</span><span>
</span><a name="line-347"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>                       </span><span class="hs-comment">-- needed to look up versions</span><span>
</span><a name="line-348"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a><span>         </span><span class="hs-comment">-- ditto</span><span>
</span><a name="line-349"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">)</span><span>
</span><a name="line-350"></a><a name="mkHashFun"><a href="MkIface.html#mkHashFun"><span class="hs-identifier">mkHashFun</span></a></a><span> </span><a name="local-1628236835"><a href="#local-1628236835"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628236836"><a href="#local-1628236836"><span class="hs-identifier">eps</span></a></a><span>
</span><a name="line-351"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-1628236840"><a href="#local-1628236840"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-352"></a><span>      </span><span class="hs-keyword">let</span><span>
</span><a name="line-353"></a><span>        </span><a name="local-1628236841"><a href="#local-1628236841"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">nameModule</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-354"></a><span>        </span><a name="local-1628236842"><a href="#local-1628236842"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1628236840"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-355"></a><span>        </span><a name="local-1628236843"><a href="#local-1628236843"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#lookupIfaceByModule"><span class="hs-identifier hs-var">lookupIfaceByModule</span></a><span> </span><a href="#local-1628236837"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628236838"><span class="hs-identifier hs-var">hpt</span></a><span> </span><a href="#local-1628236839"><span class="hs-identifier hs-var">pit</span></a><span> </span><a href="#local-1628236841"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span>
</span><a name="line-356"></a><span>                   </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;lookupVers2&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628236841"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628236842"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span>      </span><span class="hs-keyword">in</span><span>
</span><a name="line-358"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_hash_fn</span><span> </span><a href="#local-1628236843"><span class="hs-identifier hs-var">iface</span></a><span> </span><a href="#local-1628236842"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span>
</span><a name="line-359"></a><span>                  </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;lookupVers1&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628236841"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628236842"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-360"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-361"></a><span>      </span><a name="local-1628236837"><a href="#local-1628236837"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628236835"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-362"></a><span>      </span><a name="local-1628236838"><a href="#local-1628236838"><span class="hs-identifier">hpt</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_HPT</span><span> </span><a href="#local-1628236835"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-363"></a><span>      </span><a name="local-1628236839"><a href="#local-1628236839"><span class="hs-identifier">pit</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">eps_PIT</span><span> </span><a href="#local-1628236836"><span class="hs-identifier hs-var">eps</span></a><span>
</span><a name="line-364"></a><span>
</span><a name="line-365"></a><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><a name="line-366"></a><span class="hs-comment">-- Compute fingerprints for the interface</span><span>
</span><a name="line-367"></a><span>
</span><a name="line-368"></a><span class="hs-identifier">addFingerprints</span><span>
</span><a name="line-369"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-370"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span> </span><span class="hs-comment">-- the old fingerprint, if any</span><span>
</span><a name="line-371"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span>          </span><span class="hs-comment">-- The new interface (lacking decls)</span><span>
</span><a name="line-372"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- The new decls</span><span>
</span><a name="line-373"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Updated interface</span><span>
</span><a name="line-374"></a><span>               </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- True &lt;=&gt; no changes at all;</span><span>
</span><a name="line-375"></a><span>                             </span><span class="hs-comment">-- no need to write Iface</span><span>
</span><a name="line-376"></a><span>
</span><a name="line-377"></a><a name="addFingerprints"><a href="MkIface.html#addFingerprints"><span class="hs-identifier">addFingerprints</span></a></a><span> </span><a name="local-1628236844"><a href="#local-1628236844"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628236845"><a href="#local-1628236845"><span class="hs-identifier">mb_old_fingerprint</span></a></a><span> </span><a name="local-1628236846"><a href="#local-1628236846"><span class="hs-identifier">iface0</span></a></a><span> </span><a name="local-1628236847"><a href="#local-1628236847"><span class="hs-identifier">new_decls</span></a></a><span>
</span><a name="line-378"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-379"></a><span>   </span><a name="local-1628236859"><a href="#local-1628236859"><span class="hs-identifier">eps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a><span> </span><a href="#local-1628236844"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-380"></a><span>   </span><span class="hs-keyword">let</span><span>
</span><a name="line-381"></a><span>        </span><span class="hs-comment">-- The ABI of a declaration represents everything that is made</span><span>
</span><a name="line-382"></a><span>        </span><span class="hs-comment">-- visible about the declaration that a client can depend on.</span><span>
</span><a name="line-383"></a><span>        </span><span class="hs-comment">-- see IfaceDeclABI below.</span><span>
</span><a name="line-384"></a><span>       </span><span class="hs-identifier">declABI</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#IfaceDeclABI"><span class="hs-identifier hs-type">IfaceDeclABI</span></a><span>
</span><a name="line-385"></a><span>       </span><a name="local-1628236860"><a href="#local-1628236860"><span class="hs-identifier">declABI</span></a></a><span> </span><a name="local-1628236870"><a href="#local-1628236870"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628236848"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236870"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236871"><span class="hs-identifier hs-var">extras</span></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-1628236871"><a href="#local-1628236871"><span class="hs-identifier">extras</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#declExtras"><span class="hs-identifier hs-var">declExtras</span></a><span> </span><a href="#local-1628236857"><span class="hs-identifier hs-var">fix_fn</span></a><span> </span><a href="#local-1628236858"><span class="hs-identifier hs-var">ann_fn</span></a><span> </span><a href="#local-1628236853"><span class="hs-identifier hs-var">non_orph_rules</span></a><span> </span><a href="#local-1628236851"><span class="hs-identifier hs-var">non_orph_insts</span></a><span>
</span><a name="line-387"></a><span>                                  </span><a href="#local-1628236855"><span class="hs-identifier hs-var">non_orph_fis</span></a><span> </span><a href="#local-1628236870"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span>       </span><span class="hs-identifier">edges</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="MkIface.html#IfaceDeclABI"><span class="hs-identifier hs-type">IfaceDeclABI</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-390"></a><span>       </span><a name="local-1628236861"><a href="#local-1628236861"><span class="hs-identifier">edges</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-1628236873"><span class="hs-identifier hs-var">abi</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ifName</span><span> </span><a href="#local-1628236872"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1628236874"><span class="hs-identifier hs-var">out</span></a><span class="hs-special">)</span><span>
</span><a name="line-391"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a name="local-1628236872"><a href="#local-1628236872"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628236847"><span class="hs-identifier hs-var">new_decls</span></a><span>
</span><a name="line-392"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236873"><a href="#local-1628236873"><span class="hs-identifier">abi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236860"><span class="hs-identifier hs-var">declABI</span></a><span> </span><a href="#local-1628236872"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-393"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236874"><a href="#local-1628236874"><span class="hs-identifier">out</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236863"><span class="hs-identifier hs-var">localOccs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="MkIface.html#freeNamesDeclABI"><span class="hs-identifier hs-var">freeNamesDeclABI</span></a><span> </span><a href="#local-1628236873"><span class="hs-identifier hs-var">abi</span></a><span>
</span><a name="line-394"></a><span>               </span><span class="hs-special">]</span><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span>       </span><a name="local-1628236862"><a href="#local-1628236862"><span class="hs-identifier">name_module</span></a></a><span> </span><a name="local-1628236875"><a href="#local-1628236875"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">nameModule</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-397"></a><span>       </span><a name="local-1628236863"><a href="#local-1628236863"><span class="hs-identifier">localOccs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1628236876"><span class="hs-identifier hs-var">getParent</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span class="hs-special">)</span><span>
</span><a name="line-398"></a><span>                        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628236848"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="#local-1628236862"><span class="hs-identifier hs-var">name_module</span></a><span class="hs-special">)</span><span>
</span><a name="line-399"></a><span>                        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="NameSet.html#nameSetElems"><span class="hs-identifier hs-var">nameSetElems</span></a><span>
</span><a name="line-400"></a><span>          </span><span class="hs-keyword">where</span><span> </span><a name="local-1628236876"><a href="#local-1628236876"><span class="hs-identifier">getParent</span></a></a><span> </span><a name="local-1628236877"><a href="#local-1628236877"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-1628236864"><span class="hs-identifier hs-var">parent_map</span></a><span> </span><a href="#local-1628236877"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628236877"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-401"></a><span>
</span><a name="line-402"></a><span>        </span><span class="hs-comment">-- maps OccNames to their parents in the current module.</span><span>
</span><a name="line-403"></a><span>        </span><span class="hs-comment">-- e.g. a reference to a constructor must be turned into a reference</span><span>
</span><a name="line-404"></a><span>        </span><span class="hs-comment">-- to the TyCon for the purposes of calculating dependencies.</span><span>
</span><a name="line-405"></a><span>       </span><span class="hs-identifier">parent_map</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-406"></a><span>       </span><a name="local-1628236864"><a href="#local-1628236864"><span class="hs-identifier">parent_map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><a href="#local-1628236878"><span class="hs-identifier hs-var">extend</span></a><span> </span><a href="OccName.html#emptyOccEnv"><span class="hs-identifier hs-var">emptyOccEnv</span></a><span> </span><a href="#local-1628236847"><span class="hs-identifier hs-var">new_decls</span></a><span>
</span><a name="line-407"></a><span>          </span><span class="hs-keyword">where</span><span> </span><a name="local-1628236878"><a href="#local-1628236878"><span class="hs-identifier">extend</span></a></a><span> </span><a name="local-1628236879"><a href="#local-1628236879"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-1628236880"><a href="#local-1628236880"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-408"></a><span>                  </span><a href="OccName.html#extendOccEnvList"><span class="hs-identifier hs-var">extendOccEnvList</span></a><span> </span><a href="#local-1628236880"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-1628236882"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><a href="#local-1628236881"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628236882"><a href="#local-1628236882"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IfaceSyn.html#ifaceDeclImplicitBndrs"><span class="hs-identifier hs-var">ifaceDeclImplicitBndrs</span></a><span> </span><a href="#local-1628236879"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-409"></a><span>                  </span><span class="hs-keyword">where</span><span> </span><a name="local-1628236881"><a href="#local-1628236881"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ifName</span><span> </span><a href="#local-1628236879"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span>        </span><span class="hs-comment">-- strongly-connected groups of declarations, in dependency order</span><span>
</span><a name="line-412"></a><span>       </span><a name="local-1628236865"><a href="#local-1628236865"><span class="hs-identifier">groups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#stronglyConnCompFromEdgedVertices"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVertices</span></a><span> </span><a href="#local-1628236861"><span class="hs-identifier hs-var">edges</span></a><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span>       </span><a name="local-1628236866"><a href="#local-1628236866"><span class="hs-identifier">global_hash_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#mkHashFun"><span class="hs-identifier hs-var">mkHashFun</span></a><span> </span><a href="#local-1628236844"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628236859"><span class="hs-identifier hs-var">eps</span></a><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span>        </span><span class="hs-comment">-- how to output Names when generating the data to fingerprint.</span><span>
</span><a name="line-417"></a><span>        </span><span class="hs-comment">-- Here we want to output the fingerprint for each top-level</span><span>
</span><a name="line-418"></a><span>        </span><span class="hs-comment">-- Name, whether it comes from the current module or another</span><span>
</span><a name="line-419"></a><span>        </span><span class="hs-comment">-- module.  In this way, the fingerprint for a declaration will</span><span>
</span><a name="line-420"></a><span>        </span><span class="hs-comment">-- change if the fingerprint for anything it refers to (transitively)</span><span>
</span><a name="line-421"></a><span>        </span><span class="hs-comment">-- changes.</span><span>
</span><a name="line-422"></a><span>       </span><span class="hs-identifier">mk_put_name</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Binary.html#BinHandle"><span class="hs-identifier hs-type">BinHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span>  </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-424"></a><span>       </span><a name="local-1628236867"><a href="#local-1628236867"><span class="hs-identifier">mk_put_name</span></a></a><span> </span><a name="local-1628236883"><a href="#local-1628236883"><span class="hs-identifier">local_env</span></a></a><span> </span><a name="local-1628236884"><a href="#local-1628236884"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-1628236885"><a href="#local-1628236885"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-425"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="Name.html#isWiredInName"><span class="hs-identifier hs-var">isWiredInName</span></a><span> </span><a href="#local-1628236885"><span class="hs-identifier hs-var">name</span></a><span>  </span><span class="hs-glyph">=</span><span>  </span><a href="MkIface.html#putNameLiterally"><span class="hs-identifier hs-var">putNameLiterally</span></a><span> </span><a href="#local-1628236884"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628236885"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-426"></a><span>           </span><span class="hs-comment">-- wired-in names don't have fingerprints</span><span>
</span><a name="line-427"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-428"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-429"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236886"><a href="#local-1628236886"><span class="hs-identifier">hash</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a><span> </span><a href="#local-1628236885"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1628236848"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-1628236866"><span class="hs-identifier hs-var">global_hash_fn</span></a><span> </span><a href="#local-1628236885"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-430"></a><span>                     </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-1628236883"><span class="hs-identifier hs-var">local_env</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628236885"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>                           </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;urk! lookup local fingerprint&quot;</span><span>
</span><a name="line-432"></a><span>                                       </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628236885"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (undefined,fingerprint0))</span><span>
</span><a name="line-433"></a><span>                </span><span class="hs-comment">-- This panic indicates that we got the dependency</span><span>
</span><a name="line-434"></a><span>                </span><span class="hs-comment">-- analysis wrong, because we needed a fingerprint for</span><span>
</span><a name="line-435"></a><span>                </span><span class="hs-comment">-- an entity that wasn't in the environment.  To debug</span><span>
</span><a name="line-436"></a><span>                </span><span class="hs-comment">-- it, turn the panic into a trace, uncomment the</span><span>
</span><a name="line-437"></a><span>                </span><span class="hs-comment">-- pprTraces below, run the compile again, and inspect</span><span>
</span><a name="line-438"></a><span>                </span><span class="hs-comment">-- the output and the generated .hi file with</span><span>
</span><a name="line-439"></a><span>                </span><span class="hs-comment">-- --show-iface.</span><span>
</span><a name="line-440"></a><span>            </span><span class="hs-keyword">in</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628236884"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628236886"><span class="hs-identifier hs-var">hash</span></a><span>
</span><a name="line-441"></a><span>
</span><a name="line-442"></a><span>        </span><span class="hs-comment">-- take a strongly-connected group of declarations and compute</span><span>
</span><a name="line-443"></a><span>        </span><span class="hs-comment">-- its fingerprint.</span><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span>       </span><span class="hs-identifier">fingerprint_group</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-446"></a><span>                             </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">,</span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-447"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a><span> </span><a href="MkIface.html#IfaceDeclABI"><span class="hs-identifier hs-type">IfaceDeclABI</span></a><span>
</span><a name="line-448"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-449"></a><span>                                </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">,</span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-450"></a><span>
</span><a name="line-451"></a><span>       </span><a name="local-1628236868"><a href="#local-1628236868"><span class="hs-identifier">fingerprint_group</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628236887"><a href="#local-1628236887"><span class="hs-identifier">local_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628236888"><a href="#local-1628236888"><span class="hs-identifier">decls_w_hashes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-var">AcyclicSCC</span></a><span> </span><a name="local-1628236889"><a href="#local-1628236889"><span class="hs-identifier">abi</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-452"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236890"><a href="#local-1628236890"><span class="hs-identifier">hash_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236867"><span class="hs-identifier hs-var">mk_put_name</span></a><span> </span><a href="#local-1628236887"><span class="hs-identifier hs-var">local_env</span></a><span>
</span><a name="line-453"></a><span>                   </span><a name="local-1628236891"><a href="#local-1628236891"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#abiDecl"><span class="hs-identifier hs-var">abiDecl</span></a><span> </span><a href="#local-1628236889"><span class="hs-identifier hs-var">abi</span></a><span>
</span><a name="line-454"></a><span>               </span><span class="hs-comment">--pprTrace &quot;fingerprinting&quot; (ppr (ifName decl) ) $ do</span><span>
</span><a name="line-455"></a><span>               </span><a name="local-1628236892"><a href="#local-1628236892"><span class="hs-identifier">hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#computeFingerprint"><span class="hs-identifier hs-var">computeFingerprint</span></a><span> </span><a href="#local-1628236890"><span class="hs-identifier hs-var">hash_fn</span></a><span> </span><a href="#local-1628236889"><span class="hs-identifier hs-var">abi</span></a><span>
</span><a name="line-456"></a><span>               </span><a name="local-1628236893"><a href="#local-1628236893"><span class="hs-identifier">env'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628236869"><span class="hs-identifier hs-var">extend_hash_env</span></a><span> </span><a href="#local-1628236887"><span class="hs-identifier hs-var">local_env</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236892"><span class="hs-identifier hs-var">hash</span></a><span class="hs-special">,</span><a href="#local-1628236891"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span>
</span><a name="line-457"></a><span>               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236893"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1628236892"><span class="hs-identifier hs-var">hash</span></a><span class="hs-special">,</span><a href="#local-1628236891"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1628236888"><span class="hs-identifier hs-var">decls_w_hashes</span></a><span class="hs-special">)</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span>       </span><span class="hs-identifier">fingerprint_group</span><span> </span><span class="hs-special">(</span><a name="local-1628236894"><a href="#local-1628236894"><span class="hs-identifier">local_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628236895"><a href="#local-1628236895"><span class="hs-identifier">decls_w_hashes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-var">CyclicSCC</span></a><span> </span><a name="local-1628236896"><a href="#local-1628236896"><span class="hs-identifier">abis</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-460"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236897"><a href="#local-1628236897"><span class="hs-identifier">decls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#abiDecl"><span class="hs-identifier hs-var">abiDecl</span></a><span> </span><a href="#local-1628236896"><span class="hs-identifier hs-var">abis</span></a><span>
</span><a name="line-461"></a><span>               </span><a name="local-1628236898"><a href="#local-1628236898"><span class="hs-identifier">local_env1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span> </span><a href="#local-1628236869"><span class="hs-identifier hs-var">extend_hash_env</span></a><span> </span><a href="#local-1628236894"><span class="hs-identifier hs-var">local_env</span></a><span>
</span><a name="line-462"></a><span>                                   </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.html#fingerprint0"><span class="hs-identifier hs-var">fingerprint0</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628236897"><span class="hs-identifier hs-var">decls</span></a><span class="hs-special">)</span><span>
</span><a name="line-463"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236899"><a href="#local-1628236899"><span class="hs-identifier">hash_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236867"><span class="hs-identifier hs-var">mk_put_name</span></a><span> </span><a href="#local-1628236898"><span class="hs-identifier hs-var">local_env1</span></a><span>
</span><a name="line-464"></a><span>               </span><span class="hs-comment">-- pprTrace &quot;fingerprinting&quot; (ppr (map ifName decls) ) $ do</span><span>
</span><a name="line-465"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236900"><a href="#local-1628236900"><span class="hs-identifier">stable_abis</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><a href="MkIface.html#cmp_abiNames"><span class="hs-identifier hs-var">cmp_abiNames</span></a><span> </span><a href="#local-1628236896"><span class="hs-identifier hs-var">abis</span></a><span>
</span><a name="line-466"></a><span>                </span><span class="hs-comment">-- put the cycle in a canonical order</span><span>
</span><a name="line-467"></a><span>               </span><a name="local-1628236901"><a href="#local-1628236901"><span class="hs-identifier">hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#computeFingerprint"><span class="hs-identifier hs-var">computeFingerprint</span></a><span> </span><a href="#local-1628236899"><span class="hs-identifier hs-var">hash_fn</span></a><span> </span><a href="#local-1628236900"><span class="hs-identifier hs-var">stable_abis</span></a><span>
</span><a name="line-468"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236902"><a href="#local-1628236902"><span class="hs-identifier">pairs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a><span> </span><a href="#local-1628236901"><span class="hs-identifier hs-var">hash</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628236897"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-469"></a><span>               </span><a name="local-1628236903"><a href="#local-1628236903"><span class="hs-identifier">local_env2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span> </span><a href="#local-1628236869"><span class="hs-identifier hs-var">extend_hash_env</span></a><span> </span><a href="#local-1628236894"><span class="hs-identifier hs-var">local_env</span></a><span> </span><a href="#local-1628236902"><span class="hs-identifier hs-var">pairs</span></a><span>
</span><a name="line-470"></a><span>               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236903"><span class="hs-identifier hs-var">local_env2</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236902"><span class="hs-identifier hs-var">pairs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="#local-1628236895"><span class="hs-identifier hs-var">decls_w_hashes</span></a><span class="hs-special">)</span><span>
</span><a name="line-471"></a><span>
</span><a name="line-472"></a><span>       </span><span class="hs-comment">-- we have fingerprinted the whole declaration, but we now need</span><span>
</span><a name="line-473"></a><span>       </span><span class="hs-comment">-- to assign fingerprints to all the OccNames that it binds, to</span><span>
</span><a name="line-474"></a><span>       </span><span class="hs-comment">-- use when referencing those OccNames in later declarations.</span><span>
</span><a name="line-475"></a><span>       </span><span class="hs-comment">--</span><span>
</span><a name="line-476"></a><span>       </span><span class="hs-identifier">extend_hash_env</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">)</span><span>
</span><a name="line-477"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">,</span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span class="hs-special">)</span><span>
</span><a name="line-478"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span>       </span><a name="local-1628236869"><a href="#local-1628236869"><span class="hs-identifier">extend_hash_env</span></a></a><span> </span><a name="local-1628236904"><a href="#local-1628236904"><span class="hs-identifier">env0</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628236905"><a href="#local-1628236905"><span class="hs-identifier">hash</span></a></a><span class="hs-special">,</span><a name="local-1628236906"><a href="#local-1628236906"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-480"></a><span>          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1628236907"><a href="#local-1628236907"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><a name="local-1628236908"><a href="#local-1628236908"><span class="hs-identifier">fp</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628236909"><a href="#local-1628236909"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#extendOccEnv"><span class="hs-identifier hs-var">extendOccEnv</span></a><span> </span><a href="#local-1628236909"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628236907"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236907"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><a href="#local-1628236908"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628236904"><span class="hs-identifier hs-var">env0</span></a><span>
</span><a name="line-481"></a><span>                 </span><span class="hs-special">(</span><a href="IfaceSyn.html#ifaceDeclFingerprints"><span class="hs-identifier hs-var">ifaceDeclFingerprints</span></a><span> </span><a href="#local-1628236905"><span class="hs-identifier hs-var">hash</span></a><span> </span><a href="#local-1628236906"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-482"></a><span>
</span><a name="line-483"></a><span>   </span><span class="hs-comment">--</span><span>
</span><a name="line-484"></a><span>   </span><span class="hs-special">(</span><a name="local-1628236910"><a href="#local-1628236910"><span class="hs-identifier">local_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628236911"><a href="#local-1628236911"><span class="hs-identifier">decls_w_hashes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-485"></a><span>       </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span> </span><a href="#local-1628236868"><span class="hs-identifier hs-var">fingerprint_group</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#emptyOccEnv"><span class="hs-identifier hs-var">emptyOccEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-1628236865"><span class="hs-identifier hs-var">groups</span></a><span>
</span><a name="line-486"></a><span>
</span><a name="line-487"></a><span>   </span><span class="hs-comment">-- when calculating fingerprints, we always need to use canonical</span><span>
</span><a name="line-488"></a><span>   </span><span class="hs-comment">-- ordering for lists of things.  In particular, the mi_deps has various</span><span>
</span><a name="line-489"></a><span>   </span><span class="hs-comment">-- lists of modules and suchlike, so put these all in canonical order:</span><span>
</span><a name="line-490"></a><span>   </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236912"><a href="#local-1628236912"><span class="hs-identifier">sorted_deps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#sortDependencies"><span class="hs-identifier hs-var">sortDependencies</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_deps</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">)</span><span>
</span><a name="line-491"></a><span>
</span><a name="line-492"></a><span>   </span><span class="hs-comment">-- the export hash of a module depends on the orphan hashes of the</span><span>
</span><a name="line-493"></a><span>   </span><span class="hs-comment">-- orphan modules below us in the dependency tree.  This is the way</span><span>
</span><a name="line-494"></a><span>   </span><span class="hs-comment">-- that changes in orphans get propagated all the way up the</span><span>
</span><a name="line-495"></a><span>   </span><span class="hs-comment">-- dependency tree.  We only care about orphan modules in the current</span><span>
</span><a name="line-496"></a><span>   </span><span class="hs-comment">-- package, because changes to orphans outside this package will be</span><span>
</span><a name="line-497"></a><span>   </span><span class="hs-comment">-- tracked by the usage on the ABI hash of package modules that we import.</span><span>
</span><a name="line-498"></a><span>   </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236913"><a href="#local-1628236913"><span class="hs-identifier">orph_mods</span></a></a><span>
</span><a name="line-499"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1628236848"><span class="hs-identifier hs-var">this_mod</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Note [Do not update EPS with your own hi-boot]</span><span>
</span><a name="line-500"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628236850"><span class="hs-identifier hs-var">this_pkg</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">moduleUnitId</span><span class="hs-special">)</span><span>
</span><a name="line-501"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">dep_orphs</span><span> </span><a href="#local-1628236912"><span class="hs-identifier hs-var">sorted_deps</span></a><span>
</span><a name="line-502"></a><span>   </span><a name="local-1628236914"><a href="#local-1628236914"><span class="hs-identifier">dep_orphan_hashes</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MkIface.html#getOrphanHashes"><span class="hs-identifier hs-var">getOrphanHashes</span></a><span> </span><a href="#local-1628236844"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628236913"><span class="hs-identifier hs-var">orph_mods</span></a><span>
</span><a name="line-503"></a><span>
</span><a name="line-504"></a><span>   </span><span class="hs-comment">-- Note [Do not update EPS with your own hi-boot]</span><span>
</span><a name="line-505"></a><span>   </span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-506"></a><span>   </span><span class="hs-comment">-- (See also Trac #10182).  When your hs-boot file includes an orphan</span><span>
</span><a name="line-507"></a><span>   </span><span class="hs-comment">-- instance declaration, you may find that the dep_orphs of a module you</span><span>
</span><a name="line-508"></a><span>   </span><span class="hs-comment">-- import contains reference to yourself.  DO NOT actually load this module</span><span>
</span><a name="line-509"></a><span>   </span><span class="hs-comment">-- or add it to the orphan hashes: you're going to provide the orphan</span><span>
</span><a name="line-510"></a><span>   </span><span class="hs-comment">-- instances yourself, no need to consult hs-boot; if you do load the</span><span>
</span><a name="line-511"></a><span>   </span><span class="hs-comment">-- interface into EPS, you will see a duplicate orphan instance.</span><span>
</span><a name="line-512"></a><span>
</span><a name="line-513"></a><span>   </span><a name="local-1628236915"><a href="#local-1628236915"><span class="hs-identifier">orphan_hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#computeFingerprint"><span class="hs-identifier hs-var">computeFingerprint</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236867"><span class="hs-identifier hs-var">mk_put_name</span></a><span> </span><a href="#local-1628236910"><span class="hs-identifier hs-var">local_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-514"></a><span>                      </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">ifDFun</span><span> </span><a href="#local-1628236852"><span class="hs-identifier hs-var">orph_insts</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236854"><span class="hs-identifier hs-var">orph_rules</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236856"><span class="hs-identifier hs-var">orph_fis</span></a><span class="hs-special">)</span><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span>   </span><span class="hs-comment">-- the export list hash doesn't depend on the fingerprints of</span><span>
</span><a name="line-517"></a><span>   </span><span class="hs-comment">-- the Names it mentions, only the Names themselves, hence putNameLiterally.</span><span>
</span><a name="line-518"></a><span>   </span><a name="local-1628236916"><a href="#local-1628236916"><span class="hs-identifier">export_hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#computeFingerprint"><span class="hs-identifier hs-var">computeFingerprint</span></a><span> </span><a href="MkIface.html#putNameLiterally"><span class="hs-identifier hs-var">putNameLiterally</span></a><span>
</span><a name="line-519"></a><span>                      </span><span class="hs-special">(</span><span class="hs-identifier">mi_exports</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">,</span><span>
</span><a name="line-520"></a><span>                       </span><a href="#local-1628236915"><span class="hs-identifier hs-var">orphan_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-521"></a><span>                       </span><a href="#local-1628236914"><span class="hs-identifier hs-var">dep_orphan_hashes</span></a><span class="hs-special">,</span><span>
</span><a name="line-522"></a><span>                       </span><span class="hs-identifier">dep_pkgs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_deps</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-523"></a><span>                        </span><span class="hs-comment">-- dep_pkgs: see &quot;Package Version Changes&quot; on</span><span>
</span><a name="line-524"></a><span>                        </span><span class="hs-comment">-- wiki/Commentary/Compiler/RecompilationAvoidance</span><span>
</span><a name="line-525"></a><span>                       </span><span class="hs-identifier">mi_trust</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">)</span><span>
</span><a name="line-526"></a><span>                        </span><span class="hs-comment">-- Make sure change of Safe Haskell mode causes recomp.</span><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span>   </span><span class="hs-comment">-- put the declarations in a canonical order, sorted by OccName</span><span>
</span><a name="line-529"></a><span>   </span><span class="hs-keyword">let</span><span> </span><a name="local-1628236917"><a href="#local-1628236917"><span class="hs-identifier">sorted_decls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#elems"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../containers-0.5.7.1/src/%{MODULE/./-}.html#%{NAME}/Data.Map.Base.html#fromList"><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-530"></a><span>                          </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">ifName</span><span> </span><a href="#local-1628236919"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236918"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628236918"><a href="#local-1628236918"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628236919"><a href="#local-1628236919"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628236911"><span class="hs-identifier hs-var">decls_w_hashes</span></a><span class="hs-special">]</span><span>
</span><a name="line-531"></a><span>
</span><a name="line-532"></a><span>   </span><span class="hs-comment">-- the flag hash depends on:</span><span>
</span><a name="line-533"></a><span>   </span><span class="hs-comment">--   - (some of) dflags</span><span>
</span><a name="line-534"></a><span>   </span><span class="hs-comment">-- it returns two hashes, one that shouldn't change</span><span>
</span><a name="line-535"></a><span>   </span><span class="hs-comment">-- the abi hash and one that should</span><span>
</span><a name="line-536"></a><span>   </span><a name="local-1628236920"><a href="#local-1628236920"><span class="hs-identifier">flag_hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="FlagChecker.html#fingerprintDynFlags"><span class="hs-identifier hs-var">fingerprintDynFlags</span></a><span> </span><a href="#local-1628236849"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628236848"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><a href="MkIface.html#putNameLiterally"><span class="hs-identifier hs-var">putNameLiterally</span></a><span>
</span><a name="line-537"></a><span>
</span><a name="line-538"></a><span>   </span><span class="hs-comment">-- the ABI hash depends on:</span><span>
</span><a name="line-539"></a><span>   </span><span class="hs-comment">--   - decls</span><span>
</span><a name="line-540"></a><span>   </span><span class="hs-comment">--   - export list</span><span>
</span><a name="line-541"></a><span>   </span><span class="hs-comment">--   - orphans</span><span>
</span><a name="line-542"></a><span>   </span><span class="hs-comment">--   - deprecations</span><span>
</span><a name="line-543"></a><span>   </span><span class="hs-comment">--   - vect info</span><span>
</span><a name="line-544"></a><span>   </span><span class="hs-comment">--   - flag abi hash</span><span>
</span><a name="line-545"></a><span>   </span><a name="local-1628236921"><a href="#local-1628236921"><span class="hs-identifier">mod_hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#computeFingerprint"><span class="hs-identifier hs-var">computeFingerprint</span></a><span> </span><a href="MkIface.html#putNameLiterally"><span class="hs-identifier hs-var">putNameLiterally</span></a><span>
</span><a name="line-546"></a><span>                      </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1628236917"><span class="hs-identifier hs-var">sorted_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-547"></a><span>                       </span><a href="#local-1628236916"><span class="hs-identifier hs-var">export_hash</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- includes orphan_hash</span><span>
</span><a name="line-548"></a><span>                       </span><span class="hs-identifier">mi_warns</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">,</span><span>
</span><a name="line-549"></a><span>                       </span><span class="hs-identifier">mi_vect_info</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">)</span><span>
</span><a name="line-550"></a><span>
</span><a name="line-551"></a><span>   </span><span class="hs-comment">-- The interface hash depends on:</span><span>
</span><a name="line-552"></a><span>   </span><span class="hs-comment">--   - the ABI hash, plus</span><span>
</span><a name="line-553"></a><span>   </span><span class="hs-comment">--   - the module level annotations,</span><span>
</span><a name="line-554"></a><span>   </span><span class="hs-comment">--   - usages</span><span>
</span><a name="line-555"></a><span>   </span><span class="hs-comment">--   - deps (home and external packages, dependent files)</span><span>
</span><a name="line-556"></a><span>   </span><span class="hs-comment">--   - hpc</span><span>
</span><a name="line-557"></a><span>   </span><a name="local-1628236922"><a href="#local-1628236922"><span class="hs-identifier">iface_hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#computeFingerprint"><span class="hs-identifier hs-var">computeFingerprint</span></a><span> </span><a href="MkIface.html#putNameLiterally"><span class="hs-identifier hs-var">putNameLiterally</span></a><span>
</span><a name="line-558"></a><span>                      </span><span class="hs-special">(</span><a href="#local-1628236921"><span class="hs-identifier hs-var">mod_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-559"></a><span>                       </span><a href="#local-1628236858"><span class="hs-identifier hs-var">ann_fn</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkVarOcc"><span class="hs-identifier hs-var">mkVarOcc</span></a><span> </span><span class="hs-string">&quot;module&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- See mkIfaceAnnCache</span><span>
</span><a name="line-560"></a><span>                       </span><span class="hs-identifier">mi_usages</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">,</span><span>
</span><a name="line-561"></a><span>                       </span><a href="#local-1628236912"><span class="hs-identifier hs-var">sorted_deps</span></a><span class="hs-special">,</span><span>
</span><a name="line-562"></a><span>                       </span><span class="hs-identifier">mi_hpc</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">)</span><span>
</span><a name="line-563"></a><span>
</span><a name="line-564"></a><span>   </span><span class="hs-keyword">let</span><span>
</span><a name="line-565"></a><span>    </span><a name="local-1628236923"><a href="#local-1628236923"><span class="hs-identifier">no_change_at_all</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628236922"><span class="hs-identifier hs-var">iface_hash</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628236845"><span class="hs-identifier hs-var">mb_old_fingerprint</span></a><span>
</span><a name="line-566"></a><span>
</span><a name="line-567"></a><span>    </span><a name="local-1628236924"><a href="#local-1628236924"><span class="hs-identifier">final_iface</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-568"></a><span>                </span><span class="hs-identifier">mi_mod_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236921"><span class="hs-identifier hs-var">mod_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-569"></a><span>                </span><span class="hs-identifier">mi_iface_hash</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236922"><span class="hs-identifier hs-var">iface_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-570"></a><span>                </span><span class="hs-identifier">mi_exp_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236916"><span class="hs-identifier hs-var">export_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-571"></a><span>                </span><span class="hs-identifier">mi_orphan_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236915"><span class="hs-identifier hs-var">orphan_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-572"></a><span>                </span><span class="hs-identifier">mi_flag_hash</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236920"><span class="hs-identifier hs-var">flag_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-573"></a><span>                </span><span class="hs-identifier">mi_orphan</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span>   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a><span> </span><span class="hs-identifier">ifRuleAuto</span><span> </span><a href="#local-1628236854"><span class="hs-identifier hs-var">orph_rules</span></a><span>
</span><a name="line-574"></a><span>                                           </span><span class="hs-comment">-- See Note [Orphans and auto-generated rules]</span><span>
</span><a name="line-575"></a><span>                                      </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628236852"><span class="hs-identifier hs-var">orph_insts</span></a><span>
</span><a name="line-576"></a><span>                                      </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="#local-1628236856"><span class="hs-identifier hs-var">orph_fis</span></a><span>
</span><a name="line-577"></a><span>                                      </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="HscTypes.html#isNoIfaceVectInfo"><span class="hs-identifier hs-var">isNoIfaceVectInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_vect_info</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-578"></a><span>                </span><span class="hs-identifier">mi_finsts</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">mi_fam_insts</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">,</span><span>
</span><a name="line-579"></a><span>                </span><span class="hs-identifier">mi_decls</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236917"><span class="hs-identifier hs-var">sorted_decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-580"></a><span>                </span><span class="hs-identifier">mi_hash_fn</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-1628236910"><span class="hs-identifier hs-var">local_env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-581"></a><span>   </span><span class="hs-comment">--</span><span>
</span><a name="line-582"></a><span>   </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236924"><span class="hs-identifier hs-var">final_iface</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236923"><span class="hs-identifier hs-var">no_change_at_all</span></a><span class="hs-special">)</span><span>
</span><a name="line-583"></a><span>
</span><a name="line-584"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-585"></a><span>    </span><a name="local-1628236848"><a href="#local-1628236848"><span class="hs-identifier">this_mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mi_module</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span>
</span><a name="line-586"></a><span>    </span><a name="local-1628236849"><a href="#local-1628236849"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628236844"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-587"></a><span>    </span><a name="local-1628236850"><a href="#local-1628236850"><span class="hs-identifier">this_pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">thisPackage</span><span> </span><a href="#local-1628236849"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-588"></a><span>    </span><span class="hs-special">(</span><a name="local-1628236851"><a href="#local-1628236851"><span class="hs-identifier">non_orph_insts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628236852"><a href="#local-1628236852"><span class="hs-identifier">orph_insts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#mkOrphMap"><span class="hs-identifier hs-var">mkOrphMap</span></a><span> </span><span class="hs-identifier">ifInstOrph</span><span>    </span><span class="hs-special">(</span><span class="hs-identifier">mi_insts</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">)</span><span>
</span><a name="line-589"></a><span>    </span><span class="hs-special">(</span><a name="local-1628236853"><a href="#local-1628236853"><span class="hs-identifier">non_orph_rules</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628236854"><a href="#local-1628236854"><span class="hs-identifier">orph_rules</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#mkOrphMap"><span class="hs-identifier hs-var">mkOrphMap</span></a><span> </span><span class="hs-identifier">ifRuleOrph</span><span>    </span><span class="hs-special">(</span><span class="hs-identifier">mi_rules</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>    </span><span class="hs-special">(</span><a name="local-1628236855"><a href="#local-1628236855"><span class="hs-identifier">non_orph_fis</span></a></a><span class="hs-special">,</span><span>   </span><a name="local-1628236856"><a href="#local-1628236856"><span class="hs-identifier">orph_fis</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#mkOrphMap"><span class="hs-identifier hs-var">mkOrphMap</span></a><span> </span><span class="hs-identifier">ifFamInstOrph</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_fam_insts</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">)</span><span>
</span><a name="line-591"></a><span>    </span><a name="local-1628236857"><a href="#local-1628236857"><span class="hs-identifier">fix_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mi_fix_fn</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span>
</span><a name="line-592"></a><span>    </span><a name="local-1628236858"><a href="#local-1628236858"><span class="hs-identifier">ann_fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#mkIfaceAnnCache"><span class="hs-identifier hs-var">mkIfaceAnnCache</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_anns</span><span> </span><a href="#local-1628236846"><span class="hs-identifier hs-var">iface0</span></a><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>
</span><a name="line-594"></a><span class="hs-identifier">getOrphanHashes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">]</span><span>
</span><a name="line-595"></a><a name="getOrphanHashes"><a href="MkIface.html#getOrphanHashes"><span class="hs-identifier">getOrphanHashes</span></a></a><span> </span><a name="local-1628236925"><a href="#local-1628236925"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628236926"><a href="#local-1628236926"><span class="hs-identifier">mods</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-596"></a><span>  </span><a name="local-1628236927"><a href="#local-1628236927"><span class="hs-identifier">eps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a><span> </span><a href="#local-1628236925"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-597"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-598"></a><span>    </span><a name="local-1628236928"><a href="#local-1628236928"><span class="hs-identifier">hpt</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_HPT</span><span> </span><a href="#local-1628236925"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-599"></a><span>    </span><a name="local-1628236929"><a href="#local-1628236929"><span class="hs-identifier">pit</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">eps_PIT</span><span> </span><a href="#local-1628236927"><span class="hs-identifier hs-var">eps</span></a><span>
</span><a name="line-600"></a><span>    </span><a name="local-1628236930"><a href="#local-1628236930"><span class="hs-identifier">dflags</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628236925"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-601"></a><span>    </span><a name="local-1628236931"><a href="#local-1628236931"><span class="hs-identifier">get_orph_hash</span></a></a><span> </span><a name="local-1628236932"><a href="#local-1628236932"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-602"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="HscTypes.html#lookupIfaceByModule"><span class="hs-identifier hs-var">lookupIfaceByModule</span></a><span> </span><a href="#local-1628236930"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-1628236928"><span class="hs-identifier hs-var">hpt</span></a><span> </span><a href="#local-1628236929"><span class="hs-identifier hs-var">pit</span></a><span> </span><a href="#local-1628236932"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-603"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;moduleOrphanHash&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628236932"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-604"></a><span>            </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628236933"><a href="#local-1628236933"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">mi_orphan_hash</span><span> </span><a href="#local-1628236933"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-605"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-606"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628236931"><span class="hs-identifier hs-var">get_orph_hash</span></a><span> </span><a href="#local-1628236926"><span class="hs-identifier hs-var">mods</span></a><span class="hs-special">)</span><span>
</span><a name="line-607"></a><span>
</span><a name="line-608"></a><span>
</span><a name="line-609"></a><span class="hs-identifier">sortDependencies</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a><span>
</span><a name="line-610"></a><a name="sortDependencies"><a href="MkIface.html#sortDependencies"><span class="hs-identifier">sortDependencies</span></a></a><span> </span><a name="local-1628236934"><a href="#local-1628236934"><span class="hs-identifier">d</span></a></a><span>
</span><a name="line-611"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#Deps"><span class="hs-identifier hs-var">Deps</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dep_mods</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Function.html#on"><span class="hs-identifier hs-var">on</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Module.html#moduleNameFS"><span class="hs-identifier hs-var">moduleNameFS</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_mods</span><span> </span><a href="#local-1628236934"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-612"></a><span>          </span><span class="hs-identifier">dep_pkgs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#stableUnitIdCmp"><span class="hs-identifier hs-var">stableUnitIdCmp</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Function.html#on"><span class="hs-identifier hs-var">on</span></a><span class="hs-special">`</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_pkgs</span><span> </span><a href="#local-1628236934"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-613"></a><span>          </span><span class="hs-identifier">dep_orphs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><a href="Module.html#stableModuleCmp"><span class="hs-identifier hs-var">stableModuleCmp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_orphs</span><span> </span><a href="#local-1628236934"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-614"></a><span>          </span><span class="hs-identifier">dep_finsts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><a href="Module.html#stableModuleCmp"><span class="hs-identifier hs-var">stableModuleCmp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_finsts</span><span> </span><a href="#local-1628236934"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-615"></a><span>
</span><a name="line-616"></a><span class="hs-comment">-- | Creates cached lookup for the 'mi_anns' field of ModIface</span><span>
</span><a name="line-617"></a><span class="hs-comment">-- Hackily, we use &quot;module&quot; as the OccName for any module-level annotations</span><span>
</span><a name="line-618"></a><span class="hs-identifier">mkIfaceAnnCache</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="IfaceSyn.html#IfaceAnnotation"><span class="hs-identifier hs-type">IfaceAnnotation</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Annotations.html#AnnPayload"><span class="hs-identifier hs-type">AnnPayload</span></a><span class="hs-special">]</span><span>
</span><a name="line-619"></a><a name="mkIfaceAnnCache"><a href="MkIface.html#mkIfaceAnnCache"><span class="hs-identifier">mkIfaceAnnCache</span></a></a><span> </span><a name="local-1628236935"><a href="#local-1628236935"><span class="hs-identifier">anns</span></a></a><span>
</span><a name="line-620"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-1628236941"><a href="#local-1628236941"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-1628236937"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628236941"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-621"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-622"></a><span>    </span><a name="local-1628236936"><a href="#local-1628236936"><span class="hs-identifier">pair</span></a></a><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#IfaceAnnotation"><span class="hs-identifier hs-var">IfaceAnnotation</span></a><span> </span><a name="local-1628236938"><a href="#local-1628236938"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-1628236939"><a href="#local-1628236939"><span class="hs-identifier">value</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-623"></a><span>      </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-1628236938"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-624"></a><span>          </span><a href="Annotations.html#NamedTarget"><span class="hs-identifier hs-var">NamedTarget</span></a><span> </span><a name="local-1628236940"><a href="#local-1628236940"><span class="hs-identifier">occn</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628236940"><span class="hs-identifier hs-var">occn</span></a><span>
</span><a name="line-625"></a><span>          </span><a href="Annotations.html#ModuleTarget"><span class="hs-identifier hs-var">ModuleTarget</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#mkVarOcc"><span class="hs-identifier hs-var">mkVarOcc</span></a><span> </span><span class="hs-string">&quot;module&quot;</span><span>
</span><a name="line-626"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-1628236939"><span class="hs-identifier hs-var">value</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-627"></a><span>    </span><span class="hs-comment">-- flipping (++), so the first argument is always short</span><span>
</span><a name="line-628"></a><span>    </span><a name="local-1628236937"><a href="#local-1628236937"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#mkOccEnv_C"><span class="hs-identifier hs-var">mkOccEnv_C</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628236936"><span class="hs-identifier hs-var">pair</span></a><span> </span><a href="#local-1628236935"><span class="hs-identifier hs-var">anns</span></a><span class="hs-special">)</span><span>
</span><a name="line-629"></a><span>
</span><a name="line-630"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
          The ABI of an IfaceDecl
*                                                                      *
************************************************************************

Note [The ABI of an IfaceDecl]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The ABI of a declaration consists of:

   (a) the full name of the identifier (inc. module and package,
       because these are used to construct the symbol name by which
       the identifier is known externally).

   (b) the declaration itself, as exposed to clients.  That is, the
       definition of an Id is included in the fingerprint only if
       it is made available as an unfolding in the interface.

   (c) the fixity of the identifier (if it exists)
   (d) for Ids: rules
   (e) for classes: instances, fixity &amp; rules for methods
   (f) for datatypes: instances, fixity &amp; rules for constrs

Items (c)-(f) are not stored in the IfaceDecl, but instead appear
elsewhere in the interface file.  But they are *fingerprinted* with
the declaration itself. This is done by grouping (c)-(f) in IfaceDeclExtras,
and fingerprinting that as part of the declaration.
-}</span><span>
</span><a name="line-659"></a><span>
</span><a name="line-660"></a><span class="hs-keyword">type</span><span> </span><a name="IfaceDeclABI"><a href="MkIface.html#IfaceDeclABI"><span class="hs-identifier">IfaceDeclABI</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span class="hs-special">,</span><span> </span><a href="MkIface.html#IfaceDeclExtras"><span class="hs-identifier hs-type">IfaceDeclExtras</span></a><span class="hs-special">)</span><span>
</span><a name="line-661"></a><span>
</span><a name="line-662"></a><span class="hs-keyword">data</span><span> </span><a name="IfaceDeclExtras"><a href="MkIface.html#IfaceDeclExtras"><span class="hs-identifier">IfaceDeclExtras</span></a></a><span>
</span><a name="line-663"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IfaceIdExtras"><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier">IfaceIdExtras</span></a></a><span> </span><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier hs-type">IfaceIdExtras</span></a><span>
</span><a name="line-664"></a><span>
</span><a name="line-665"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IfaceDataExtras"><a href="MkIface.html#IfaceDataExtras"><span class="hs-identifier">IfaceDataExtras</span></a></a><span>
</span><a name="line-666"></a><span>       </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- Fixity of the tycon itself (if it exists)</span><span>
</span><a name="line-667"></a><span>       </span><span class="hs-special">[</span><a href="MkIface.html#IfaceInstABI"><span class="hs-identifier hs-type">IfaceInstABI</span></a><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- Local class and family instances of this tycon</span><span>
</span><a name="line-668"></a><span>                                </span><span class="hs-comment">-- See Note [Orphans] in InstEnv</span><span>
</span><a name="line-669"></a><span>       </span><span class="hs-special">[</span><a href="Annotations.html#AnnPayload"><span class="hs-identifier hs-type">AnnPayload</span></a><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- Annotations of the type itself</span><span>
</span><a name="line-670"></a><span>       </span><span class="hs-special">[</span><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier hs-type">IfaceIdExtras</span></a><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- For each constructor: fixity, RULES and annotations</span><span>
</span><a name="line-671"></a><span>
</span><a name="line-672"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IfaceClassExtras"><a href="MkIface.html#IfaceClassExtras"><span class="hs-identifier">IfaceClassExtras</span></a></a><span>
</span><a name="line-673"></a><span>       </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- Fixity of the class itself (if it exists)</span><span>
</span><a name="line-674"></a><span>       </span><span class="hs-special">[</span><a href="MkIface.html#IfaceInstABI"><span class="hs-identifier hs-type">IfaceInstABI</span></a><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- Local instances of this class *or*</span><span>
</span><a name="line-675"></a><span>                                </span><span class="hs-comment">--   of its associated data types</span><span>
</span><a name="line-676"></a><span>                                </span><span class="hs-comment">-- See Note [Orphans] in InstEnv</span><span>
</span><a name="line-677"></a><span>       </span><span class="hs-special">[</span><a href="Annotations.html#AnnPayload"><span class="hs-identifier hs-type">AnnPayload</span></a><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- Annotations of the type itself</span><span>
</span><a name="line-678"></a><span>       </span><span class="hs-special">[</span><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier hs-type">IfaceIdExtras</span></a><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- For each class method: fixity, RULES and annotations</span><span>
</span><a name="line-679"></a><span>
</span><a name="line-680"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IfaceSynonymExtras"><a href="MkIface.html#IfaceSynonymExtras"><span class="hs-identifier">IfaceSynonymExtras</span></a></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="Annotations.html#AnnPayload"><span class="hs-identifier hs-type">AnnPayload</span></a><span class="hs-special">]</span><span>
</span><a name="line-681"></a><span>
</span><a name="line-682"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IfaceFamilyExtras"><a href="MkIface.html#IfaceFamilyExtras"><span class="hs-identifier">IfaceFamilyExtras</span></a></a><span>   </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="MkIface.html#IfaceInstABI"><span class="hs-identifier hs-type">IfaceInstABI</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="Annotations.html#AnnPayload"><span class="hs-identifier hs-type">AnnPayload</span></a><span class="hs-special">]</span><span>
</span><a name="line-683"></a><span>
</span><a name="line-684"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IfaceOtherDeclExtras"><a href="MkIface.html#IfaceOtherDeclExtras"><span class="hs-identifier">IfaceOtherDeclExtras</span></a></a><span>
</span><a name="line-685"></a><span>
</span><a name="line-686"></a><span class="hs-keyword">data</span><span> </span><a name="IfaceIdExtras"><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier">IfaceIdExtras</span></a></a><span>
</span><a name="line-687"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IdExtras"><a href="MkIface.html#IdExtras"><span class="hs-identifier">IdExtras</span></a></a><span>
</span><a name="line-688"></a><span>       </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- Fixity of the Id (if it exists)</span><span>
</span><a name="line-689"></a><span>       </span><span class="hs-special">[</span><a href="IfaceSyn.html#IfaceRule"><span class="hs-identifier hs-type">IfaceRule</span></a><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- Rules for the Id</span><span>
</span><a name="line-690"></a><span>       </span><span class="hs-special">[</span><a href="Annotations.html#AnnPayload"><span class="hs-identifier hs-type">AnnPayload</span></a><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- Annotations for the Id</span><span>
</span><a name="line-691"></a><span>
</span><a name="line-692"></a><span class="hs-comment">-- When hashing a class or family instance, we hash only the</span><span>
</span><a name="line-693"></a><span class="hs-comment">-- DFunId or CoAxiom, because that depends on all the</span><span>
</span><a name="line-694"></a><span class="hs-comment">-- information about the instance.</span><span>
</span><a name="line-695"></a><span class="hs-comment">--</span><span>
</span><a name="line-696"></a><span class="hs-keyword">type</span><span> </span><a name="IfaceInstABI"><a href="MkIface.html#IfaceInstABI"><span class="hs-identifier">IfaceInstABI</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#IfExtName"><span class="hs-identifier hs-type">IfExtName</span></a><span>   </span><span class="hs-comment">-- Name of DFunId or CoAxiom that is evidence for the instance</span><span>
</span><a name="line-697"></a><span>
</span><a name="line-698"></a><span class="hs-identifier">abiDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MkIface.html#IfaceDeclABI"><span class="hs-identifier hs-type">IfaceDeclABI</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span>
</span><a name="line-699"></a><a name="abiDecl"><a href="MkIface.html#abiDecl"><span class="hs-identifier">abiDecl</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628236942"><a href="#local-1628236942"><span class="hs-identifier">decl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236942"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-700"></a><span>
</span><a name="line-701"></a><span class="hs-identifier">cmp_abiNames</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MkIface.html#IfaceDeclABI"><span class="hs-identifier hs-type">IfaceDeclABI</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#IfaceDeclABI"><span class="hs-identifier hs-type">IfaceDeclABI</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-702"></a><a name="cmp_abiNames"><a href="MkIface.html#cmp_abiNames"><span class="hs-identifier">cmp_abiNames</span></a></a><span> </span><a name="local-1628236943"><a href="#local-1628236943"><span class="hs-identifier">abi1</span></a></a><span> </span><a name="local-1628236944"><a href="#local-1628236944"><span class="hs-identifier">abi2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ifName</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#abiDecl"><span class="hs-identifier hs-var">abiDecl</span></a><span> </span><a href="#local-1628236943"><span class="hs-identifier hs-var">abi1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span>
</span><a name="line-703"></a><span>                         </span><span class="hs-identifier">ifName</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#abiDecl"><span class="hs-identifier hs-var">abiDecl</span></a><span> </span><a href="#local-1628236944"><span class="hs-identifier hs-var">abi2</span></a><span class="hs-special">)</span><span>
</span><a name="line-704"></a><span>
</span><a name="line-705"></a><span class="hs-identifier">freeNamesDeclABI</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MkIface.html#IfaceDeclABI"><span class="hs-identifier hs-type">IfaceDeclABI</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-706"></a><a name="freeNamesDeclABI"><a href="MkIface.html#freeNamesDeclABI"><span class="hs-identifier">freeNamesDeclABI</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628236945"><a href="#local-1628236945"><span class="hs-identifier">_mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628236946"><a href="#local-1628236946"><span class="hs-identifier">decl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628236947"><a href="#local-1628236947"><span class="hs-identifier">extras</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-707"></a><span>  </span><a href="IfaceSyn.html#freeNamesIfDecl"><span class="hs-identifier hs-var">freeNamesIfDecl</span></a><span> </span><a href="#local-1628236946"><span class="hs-identifier hs-var">decl</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="MkIface.html#freeNamesDeclExtras"><span class="hs-identifier hs-var">freeNamesDeclExtras</span></a><span> </span><a href="#local-1628236947"><span class="hs-identifier hs-var">extras</span></a><span>
</span><a name="line-708"></a><span>
</span><a name="line-709"></a><span class="hs-identifier">freeNamesDeclExtras</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MkIface.html#IfaceDeclExtras"><span class="hs-identifier hs-type">IfaceDeclExtras</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-710"></a><a name="freeNamesDeclExtras"><a href="MkIface.html#freeNamesDeclExtras"><span class="hs-identifier">freeNamesDeclExtras</span></a></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier hs-var">IfaceIdExtras</span></a><span> </span><a name="local-1628236948"><a href="#local-1628236948"><span class="hs-identifier">id_extras</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-711"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#freeNamesIdExtras"><span class="hs-identifier hs-var">freeNamesIdExtras</span></a><span> </span><a href="#local-1628236948"><span class="hs-identifier hs-var">id_extras</span></a><span>
</span><a name="line-712"></a><span class="hs-identifier">freeNamesDeclExtras</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceDataExtras"><span class="hs-identifier hs-var">IfaceDataExtras</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><a name="local-1628236949"><a href="#local-1628236949"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628236950"><a href="#local-1628236950"><span class="hs-identifier">subs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-713"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#unionNameSets"><span class="hs-identifier hs-var">unionNameSets</span></a><span> </span><span class="hs-special">(</span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-1628236949"><span class="hs-identifier hs-var">insts</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#freeNamesIdExtras"><span class="hs-identifier hs-var">freeNamesIdExtras</span></a><span> </span><a href="#local-1628236950"><span class="hs-identifier hs-var">subs</span></a><span class="hs-special">)</span><span>
</span><a name="line-714"></a><span class="hs-identifier">freeNamesDeclExtras</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceClassExtras"><span class="hs-identifier hs-var">IfaceClassExtras</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628236951"><a href="#local-1628236951"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628236952"><a href="#local-1628236952"><span class="hs-identifier">subs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-715"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#unionNameSets"><span class="hs-identifier hs-var">unionNameSets</span></a><span> </span><span class="hs-special">(</span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-1628236951"><span class="hs-identifier hs-var">insts</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#freeNamesIdExtras"><span class="hs-identifier hs-var">freeNamesIdExtras</span></a><span> </span><a href="#local-1628236952"><span class="hs-identifier hs-var">subs</span></a><span class="hs-special">)</span><span>
</span><a name="line-716"></a><span class="hs-identifier">freeNamesDeclExtras</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceSynonymExtras"><span class="hs-identifier hs-var">IfaceSynonymExtras</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-717"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span>
</span><a name="line-718"></a><span class="hs-identifier">freeNamesDeclExtras</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceFamilyExtras"><span class="hs-identifier hs-var">IfaceFamilyExtras</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628236953"><a href="#local-1628236953"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-719"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span> </span><a href="#local-1628236953"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-720"></a><span class="hs-identifier">freeNamesDeclExtras</span><span> </span><a href="MkIface.html#IfaceOtherDeclExtras"><span class="hs-identifier hs-var">IfaceOtherDeclExtras</span></a><span>
</span><a name="line-721"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span>
</span><a name="line-722"></a><span>
</span><a name="line-723"></a><span class="hs-identifier">freeNamesIdExtras</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier hs-type">IfaceIdExtras</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-724"></a><a name="freeNamesIdExtras"><a href="MkIface.html#freeNamesIdExtras"><span class="hs-identifier">freeNamesIdExtras</span></a></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#IdExtras"><span class="hs-identifier hs-var">IdExtras</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628236954"><a href="#local-1628236954"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#unionNameSets"><span class="hs-identifier hs-var">unionNameSets</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="IfaceSyn.html#freeNamesIfRule"><span class="hs-identifier hs-var">freeNamesIfRule</span></a><span> </span><a href="#local-1628236954"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">)</span><span>
</span><a name="line-725"></a><span>
</span><a name="line-726"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="MkIface.html#IfaceDeclExtras"><span class="hs-identifier hs-type">IfaceDeclExtras</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-727"></a><span>  </span><a name="local-1912686315"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="MkIface.html#IfaceOtherDeclExtras"><span class="hs-identifier hs-var">IfaceOtherDeclExtras</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-728"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier hs-var">IfaceIdExtras</span></a><span>  </span><a name="local-1628237389"><a href="#local-1628237389"><span class="hs-identifier">extras</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#ppr_id_extras"><span class="hs-identifier hs-var">ppr_id_extras</span></a><span> </span><a href="#local-1628237389"><span class="hs-identifier hs-var">extras</span></a><span>
</span><a name="line-729"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceSynonymExtras"><span class="hs-identifier hs-var">IfaceSynonymExtras</span></a><span> </span><a name="local-1628237390"><a href="#local-1628237390"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-1628237391"><a href="#local-1628237391"><span class="hs-identifier">anns</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237390"><span class="hs-identifier hs-var">fix</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237391"><span class="hs-identifier hs-var">anns</span></a><span class="hs-special">]</span><span>
</span><a name="line-730"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceFamilyExtras"><span class="hs-identifier hs-var">IfaceFamilyExtras</span></a><span> </span><a name="local-1628237392"><a href="#local-1628237392"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-1628237393"><a href="#local-1628237393"><span class="hs-identifier">finsts</span></a></a><span> </span><a name="local-1628237394"><a href="#local-1628237394"><span class="hs-identifier">anns</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237392"><span class="hs-identifier hs-var">fix</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237393"><span class="hs-identifier hs-var">finsts</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237394"><span class="hs-identifier hs-var">anns</span></a><span class="hs-special">]</span><span>
</span><a name="line-731"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceDataExtras"><span class="hs-identifier hs-var">IfaceDataExtras</span></a><span> </span><a name="local-1628237395"><a href="#local-1628237395"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-1628237396"><a href="#local-1628237396"><span class="hs-identifier">insts</span></a></a><span> </span><a name="local-1628237397"><a href="#local-1628237397"><span class="hs-identifier">anns</span></a></a><span> </span><a name="local-1628237398"><a href="#local-1628237398"><span class="hs-identifier">stuff</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237395"><span class="hs-identifier hs-var">fix</span></a><span class="hs-special">,</span><span> </span><a href="MkIface.html#ppr_insts"><span class="hs-identifier hs-var">ppr_insts</span></a><span> </span><a href="#local-1628237396"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237397"><span class="hs-identifier hs-var">anns</span></a><span class="hs-special">,</span><span>
</span><a name="line-732"></a><span>                                                </span><a href="MkIface.html#ppr_id_extras_s"><span class="hs-identifier hs-var">ppr_id_extras_s</span></a><span> </span><a href="#local-1628237398"><span class="hs-identifier hs-var">stuff</span></a><span class="hs-special">]</span><span>
</span><a name="line-733"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceClassExtras"><span class="hs-identifier hs-var">IfaceClassExtras</span></a><span> </span><a name="local-1628237399"><a href="#local-1628237399"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-1628237400"><a href="#local-1628237400"><span class="hs-identifier">insts</span></a></a><span> </span><a name="local-1628237401"><a href="#local-1628237401"><span class="hs-identifier">anns</span></a></a><span> </span><a name="local-1628237402"><a href="#local-1628237402"><span class="hs-identifier">stuff</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237399"><span class="hs-identifier hs-var">fix</span></a><span class="hs-special">,</span><span> </span><a href="MkIface.html#ppr_insts"><span class="hs-identifier hs-var">ppr_insts</span></a><span> </span><a href="#local-1628237400"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237401"><span class="hs-identifier hs-var">anns</span></a><span class="hs-special">,</span><span>
</span><a name="line-734"></a><span>                                                 </span><a href="MkIface.html#ppr_id_extras_s"><span class="hs-identifier hs-var">ppr_id_extras_s</span></a><span> </span><a href="#local-1628237402"><span class="hs-identifier hs-var">stuff</span></a><span class="hs-special">]</span><span>
</span><a name="line-735"></a><span>
</span><a name="line-736"></a><span class="hs-identifier">ppr_insts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="MkIface.html#IfaceInstABI"><span class="hs-identifier hs-type">IfaceInstABI</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-737"></a><a name="ppr_insts"><a href="MkIface.html#ppr_insts"><span class="hs-identifier">ppr_insts</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;&lt;insts&gt;&quot;</span><span>
</span><a name="line-738"></a><span>
</span><a name="line-739"></a><span class="hs-identifier">ppr_id_extras_s</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier hs-type">IfaceIdExtras</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-740"></a><a name="ppr_id_extras_s"><a href="MkIface.html#ppr_id_extras_s"><span class="hs-identifier">ppr_id_extras_s</span></a></a><span> </span><a name="local-1628236955"><a href="#local-1628236955"><span class="hs-identifier">stuff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#ppr_id_extras"><span class="hs-identifier hs-var">ppr_id_extras</span></a><span> </span><a href="#local-1628236955"><span class="hs-identifier hs-var">stuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span class="hs-identifier">ppr_id_extras</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier hs-type">IfaceIdExtras</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-743"></a><a name="ppr_id_extras"><a href="MkIface.html#ppr_id_extras"><span class="hs-identifier">ppr_id_extras</span></a></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#IdExtras"><span class="hs-identifier hs-var">IdExtras</span></a><span> </span><a name="local-1628236956"><a href="#local-1628236956"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-1628236957"><a href="#local-1628236957"><span class="hs-identifier">rules</span></a></a><span> </span><a name="local-1628236958"><a href="#local-1628236958"><span class="hs-identifier">anns</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628236956"><span class="hs-identifier hs-var">fix</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628236957"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628236958"><span class="hs-identifier hs-var">anns</span></a><span class="hs-special">)</span><span>
</span><a name="line-744"></a><span>
</span><a name="line-745"></a><span class="hs-comment">-- This instance is used only to compute fingerprints</span><span>
</span><a name="line-746"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="MkIface.html#IfaceDeclExtras"><span class="hs-identifier hs-type">IfaceDeclExtras</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-747"></a><span>  </span><a name="local-1912728502"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-1628237368"><a href="#local-1628237368"><span class="hs-identifier">_bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;no get for IfaceDeclExtras&quot;</span><span>
</span><a name="line-748"></a><span>  </span><a name="local-1912728500"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-1628237369"><a href="#local-1628237369"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier hs-var">IfaceIdExtras</span></a><span> </span><a name="local-1628237370"><a href="#local-1628237370"><span class="hs-identifier">extras</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-749"></a><span>   </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-1628237369"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237369"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237370"><span class="hs-identifier hs-var">extras</span></a><span>
</span><a name="line-750"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-1628237371"><a href="#local-1628237371"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceDataExtras"><span class="hs-identifier hs-var">IfaceDataExtras</span></a><span> </span><a name="local-1628237372"><a href="#local-1628237372"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-1628237373"><a href="#local-1628237373"><span class="hs-identifier">insts</span></a></a><span> </span><a name="local-1628237374"><a href="#local-1628237374"><span class="hs-identifier">anns</span></a></a><span> </span><a name="local-1628237375"><a href="#local-1628237375"><span class="hs-identifier">cons</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-751"></a><span>   </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-1628237371"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">2</span><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237371"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237372"><span class="hs-identifier hs-var">fix</span></a><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237371"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237373"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237371"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237374"><span class="hs-identifier hs-var">anns</span></a><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237371"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237375"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-752"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-1628237376"><a href="#local-1628237376"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceClassExtras"><span class="hs-identifier hs-var">IfaceClassExtras</span></a><span> </span><a name="local-1628237377"><a href="#local-1628237377"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-1628237378"><a href="#local-1628237378"><span class="hs-identifier">insts</span></a></a><span> </span><a name="local-1628237379"><a href="#local-1628237379"><span class="hs-identifier">anns</span></a></a><span> </span><a name="local-1628237380"><a href="#local-1628237380"><span class="hs-identifier">methods</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-753"></a><span>   </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-1628237376"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">3</span><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237376"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237377"><span class="hs-identifier hs-var">fix</span></a><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237376"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237378"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237376"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237379"><span class="hs-identifier hs-var">anns</span></a><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237376"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237380"><span class="hs-identifier hs-var">methods</span></a><span>
</span><a name="line-754"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-1628237381"><a href="#local-1628237381"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceSynonymExtras"><span class="hs-identifier hs-var">IfaceSynonymExtras</span></a><span> </span><a name="local-1628237382"><a href="#local-1628237382"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-1628237383"><a href="#local-1628237383"><span class="hs-identifier">anns</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-755"></a><span>   </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-1628237381"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">4</span><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237381"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237382"><span class="hs-identifier hs-var">fix</span></a><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237381"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237383"><span class="hs-identifier hs-var">anns</span></a><span>
</span><a name="line-756"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-1628237384"><a href="#local-1628237384"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#IfaceFamilyExtras"><span class="hs-identifier hs-var">IfaceFamilyExtras</span></a><span> </span><a name="local-1628237385"><a href="#local-1628237385"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-1628237386"><a href="#local-1628237386"><span class="hs-identifier">finsts</span></a></a><span> </span><a name="local-1628237387"><a href="#local-1628237387"><span class="hs-identifier">anns</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-757"></a><span>   </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-1628237384"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">5</span><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237384"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237385"><span class="hs-identifier hs-var">fix</span></a><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237384"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237386"><span class="hs-identifier hs-var">finsts</span></a><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237384"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237387"><span class="hs-identifier hs-var">anns</span></a><span>
</span><a name="line-758"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-1628237388"><a href="#local-1628237388"><span class="hs-identifier">bh</span></a></a><span> </span><a href="MkIface.html#IfaceOtherDeclExtras"><span class="hs-identifier hs-var">IfaceOtherDeclExtras</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-1628237388"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">6</span><span>
</span><a name="line-759"></a><span>
</span><a name="line-760"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier hs-type">IfaceIdExtras</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-761"></a><span>  </span><a name="local-1912728502"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-1628237363"><a href="#local-1628237363"><span class="hs-identifier">_bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;no get for IfaceIdExtras&quot;</span><span>
</span><a name="line-762"></a><span>  </span><a name="local-1912728500"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-1628237364"><a href="#local-1628237364"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#IdExtras"><span class="hs-identifier hs-var">IdExtras</span></a><span> </span><a name="local-1628237365"><a href="#local-1628237365"><span class="hs-identifier">fix</span></a></a><span> </span><a name="local-1628237366"><a href="#local-1628237366"><span class="hs-identifier">rules</span></a></a><span> </span><a name="local-1628237367"><a href="#local-1628237367"><span class="hs-identifier">anns</span></a></a><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237364"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237365"><span class="hs-identifier hs-var">fix</span></a><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237364"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237366"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628237364"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-1628237367"><span class="hs-identifier hs-var">anns</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-763"></a><span>
</span><a name="line-764"></a><span class="hs-identifier">declExtras</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span class="hs-special">)</span><span>
</span><a name="line-765"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Annotations.html#AnnPayload"><span class="hs-identifier hs-type">AnnPayload</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-766"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><span class="hs-special">[</span><a href="IfaceSyn.html#IfaceRule"><span class="hs-identifier hs-type">IfaceRule</span></a><span class="hs-special">]</span><span>
</span><a name="line-767"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><span class="hs-special">[</span><a href="IfaceSyn.html#IfaceClsInst"><span class="hs-identifier hs-type">IfaceClsInst</span></a><span class="hs-special">]</span><span>
</span><a name="line-768"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><span class="hs-special">[</span><a href="IfaceSyn.html#IfaceFamInst"><span class="hs-identifier hs-type">IfaceFamInst</span></a><span class="hs-special">]</span><span>
</span><a name="line-769"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span>
</span><a name="line-770"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#IfaceDeclExtras"><span class="hs-identifier hs-type">IfaceDeclExtras</span></a><span>
</span><a name="line-771"></a><span>
</span><a name="line-772"></a><a name="declExtras"><a href="MkIface.html#declExtras"><span class="hs-identifier">declExtras</span></a></a><span> </span><a name="local-1628236959"><a href="#local-1628236959"><span class="hs-identifier">fix_fn</span></a></a><span> </span><a name="local-1628236960"><a href="#local-1628236960"><span class="hs-identifier">ann_fn</span></a></a><span> </span><a name="local-1628236961"><a href="#local-1628236961"><span class="hs-identifier">rule_env</span></a></a><span> </span><a name="local-1628236962"><a href="#local-1628236962"><span class="hs-identifier">inst_env</span></a></a><span> </span><a name="local-1628236963"><a href="#local-1628236963"><span class="hs-identifier">fi_env</span></a></a><span> </span><a name="local-1628236964"><a href="#local-1628236964"><span class="hs-identifier">decl</span></a></a><span>
</span><a name="line-773"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628236964"><span class="hs-identifier hs-var">decl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-774"></a><span>      </span><a href="IfaceSyn.html#IfaceId"><span class="hs-identifier hs-var">IfaceId</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#IfaceIdExtras"><span class="hs-identifier hs-var">IfaceIdExtras</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236966"><span class="hs-identifier hs-var">id_extras</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-775"></a><span>      </span><a href="IfaceSyn.html#IfaceData"><span class="hs-identifier hs-var">IfaceData</span></a><span class="hs-special">{</span><span class="hs-identifier">ifCons</span><span class="hs-glyph">=</span><a name="local-1628236970"><a href="#local-1628236970"><span class="hs-identifier">cons</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-776"></a><span>                     </span><a href="MkIface.html#IfaceDataExtras"><span class="hs-identifier hs-var">IfaceDataExtras</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236959"><span class="hs-identifier hs-var">fix_fn</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>                        </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">ifFamInstAxiom</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#lookupOccEnvL"><span class="hs-identifier hs-var">lookupOccEnvL</span></a><span> </span><a href="#local-1628236963"><span class="hs-identifier hs-var">fi_env</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-778"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">ifDFun</span><span>         </span><span class="hs-special">(</span><a href="MkIface.html#lookupOccEnvL"><span class="hs-identifier hs-var">lookupOccEnvL</span></a><span> </span><a href="#local-1628236962"><span class="hs-identifier hs-var">inst_env</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-779"></a><span>                        </span><span class="hs-special">(</span><a href="#local-1628236960"><span class="hs-identifier hs-var">ann_fn</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-780"></a><span>                        </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236966"><span class="hs-identifier hs-var">id_extras</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">ifConOcc</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#visibleIfConDecls"><span class="hs-identifier hs-var">visibleIfConDecls</span></a><span> </span><a href="#local-1628236970"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-781"></a><span>      </span><a href="IfaceSyn.html#IfaceClass"><span class="hs-identifier hs-var">IfaceClass</span></a><span class="hs-special">{</span><span class="hs-identifier">ifSigs</span><span class="hs-glyph">=</span><a name="local-1628236971"><a href="#local-1628236971"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifATs</span><span class="hs-glyph">=</span><a name="local-1628236972"><a href="#local-1628236972"><span class="hs-identifier">ats</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-782"></a><span>                     </span><a href="MkIface.html#IfaceClassExtras"><span class="hs-identifier hs-var">IfaceClassExtras</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236959"><span class="hs-identifier hs-var">fix_fn</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-783"></a><span>                        </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">ifDFun</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a><span> </span><a href="#local-1628236967"><span class="hs-identifier hs-var">at_extras</span></a><span> </span><a href="#local-1628236972"><span class="hs-identifier hs-var">ats</span></a><span class="hs-special">)</span><span>
</span><a name="line-784"></a><span>                                    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="MkIface.html#lookupOccEnvL"><span class="hs-identifier hs-var">lookupOccEnvL</span></a><span> </span><a href="#local-1628236962"><span class="hs-identifier hs-var">inst_env</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-785"></a><span>                           </span><span class="hs-comment">-- Include instances of the associated types</span><span>
</span><a name="line-786"></a><span>                           </span><span class="hs-comment">-- as well as instances of the class (Trac #5147)</span><span>
</span><a name="line-787"></a><span>                        </span><span class="hs-special">(</span><a href="#local-1628236960"><span class="hs-identifier hs-var">ann_fn</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-788"></a><span>                        </span><span class="hs-special">[</span><a href="#local-1628236966"><span class="hs-identifier hs-var">id_extras</span></a><span> </span><a href="#local-1628236973"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="IfaceSyn.html#IfaceClassOp"><span class="hs-identifier hs-var">IfaceClassOp</span></a><span> </span><a name="local-1628236973"><a href="#local-1628236973"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628236971"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">]</span><span>
</span><a name="line-789"></a><span>      </span><a href="IfaceSyn.html#IfaceSynonym"><span class="hs-identifier hs-var">IfaceSynonym</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#IfaceSynonymExtras"><span class="hs-identifier hs-var">IfaceSynonymExtras</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236959"><span class="hs-identifier hs-var">fix_fn</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-790"></a><span>                                           </span><span class="hs-special">(</span><a href="#local-1628236960"><span class="hs-identifier hs-var">ann_fn</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-791"></a><span>      </span><a href="IfaceSyn.html#IfaceFamily"><span class="hs-identifier hs-var">IfaceFamily</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#IfaceFamilyExtras"><span class="hs-identifier hs-var">IfaceFamilyExtras</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236959"><span class="hs-identifier hs-var">fix_fn</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-792"></a><span>                        </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">ifFamInstAxiom</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#lookupOccEnvL"><span class="hs-identifier hs-var">lookupOccEnvL</span></a><span> </span><a href="#local-1628236963"><span class="hs-identifier hs-var">fi_env</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-793"></a><span>                        </span><span class="hs-special">(</span><a href="#local-1628236960"><span class="hs-identifier hs-var">ann_fn</span></a><span> </span><a href="#local-1628236965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-794"></a><span>      </span><a name="local-1628236974"><a href="#local-1628236974"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#IfaceOtherDeclExtras"><span class="hs-identifier hs-var">IfaceOtherDeclExtras</span></a><span>
</span><a name="line-795"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-796"></a><span>        </span><a name="local-1628236965"><a href="#local-1628236965"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ifName</span><span> </span><a href="#local-1628236964"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-797"></a><span>        </span><a name="local-1628236966"><a href="#local-1628236966"><span class="hs-identifier">id_extras</span></a></a><span> </span><a name="local-1628236968"><a href="#local-1628236968"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#IdExtras"><span class="hs-identifier hs-var">IdExtras</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236959"><span class="hs-identifier hs-var">fix_fn</span></a><span> </span><a href="#local-1628236968"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#lookupOccEnvL"><span class="hs-identifier hs-var">lookupOccEnvL</span></a><span> </span><a href="#local-1628236961"><span class="hs-identifier hs-var">rule_env</span></a><span> </span><a href="#local-1628236968"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628236960"><span class="hs-identifier hs-var">ann_fn</span></a><span> </span><a href="#local-1628236968"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-798"></a><span>        </span><a name="local-1628236967"><a href="#local-1628236967"><span class="hs-identifier">at_extras</span></a></a><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#IfaceAT"><span class="hs-identifier hs-var">IfaceAT</span></a><span> </span><a name="local-1628236969"><a href="#local-1628236969"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#lookupOccEnvL"><span class="hs-identifier hs-var">lookupOccEnvL</span></a><span> </span><a href="#local-1628236962"><span class="hs-identifier hs-var">inst_env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ifName</span><span> </span><a href="#local-1628236969"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span>
</span><a name="line-799"></a><span>
</span><a name="line-800"></a><span>
</span><a name="line-801"></a><span class="hs-identifier">lookupOccEnvL</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628236737"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1628236737"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">]</span><span>
</span><a name="line-802"></a><a name="lookupOccEnvL"><a href="MkIface.html#lookupOccEnvL"><span class="hs-identifier">lookupOccEnvL</span></a></a><span> </span><a name="local-1628236975"><a href="#local-1628236975"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1628236976"><a href="#local-1628236976"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-1628236975"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628236976"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-803"></a><span>
</span><a name="line-804"></a><span class="hs-comment">-- used when we want to fingerprint a structure without depending on the</span><span>
</span><a name="line-805"></a><span class="hs-comment">-- fingerprints of external Names that it refers to.</span><span>
</span><a name="line-806"></a><span class="hs-identifier">putNameLiterally</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Binary.html#BinHandle"><span class="hs-identifier hs-type">BinHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-807"></a><a name="putNameLiterally"><a href="MkIface.html#putNameLiterally"><span class="hs-identifier">putNameLiterally</span></a></a><span> </span><a name="local-1628236977"><a href="#local-1628236977"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-1628236978"><a href="#local-1628236978"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-808"></a><span>  </span><span class="hs-keyword">do</span><span>
</span><a name="line-809"></a><span>    </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628236977"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a><span> </span><a href="#local-1628236978"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-810"></a><span>    </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-1628236977"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1628236978"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-811"></a><span>
</span><a name="line-812"></a><span class="hs-comment">{-
-- for testing: use the md5sum command to generate fingerprints and
-- compare the results against our built-in version.
  fp' &lt;- oldMD5 dflags bh
  if fp /= fp' then pprPanic &quot;computeFingerprint&quot; (ppr fp &lt;+&gt; ppr fp')
               else return fp

oldMD5 dflags bh = do
  tmp &lt;- newTempName dflags &quot;bin&quot;
  writeBinMem bh tmp
  tmp2 &lt;- newTempName dflags &quot;md5&quot;
  let cmd = &quot;md5sum &quot; ++ tmp ++ &quot; &gt;&quot; ++ tmp2
  r &lt;- system cmd
  case r of
    ExitFailure _ -&gt; throwGhcExceptionIO (PhaseFailed cmd r)
    ExitSuccess -&gt; do
        hash_str &lt;- readFile tmp2
        return $! readHexFingerprint hash_str
-}</span><span>
</span><a name="line-831"></a><span>
</span><a name="line-832"></a><span class="hs-comment">----------------------</span><span>
</span><a name="line-833"></a><span class="hs-comment">-- mkOrphMap partitions instance decls or rules into</span><span>
</span><a name="line-834"></a><span class="hs-comment">--      (a) an OccEnv for ones that are not orphans,</span><span>
</span><a name="line-835"></a><span class="hs-comment">--          mapping the local OccName to a list of its decls</span><span>
</span><a name="line-836"></a><span class="hs-comment">--      (b) a list of orphan decls</span><span>
</span><a name="line-837"></a><span class="hs-identifier">mkOrphMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1628236736"><span class="hs-identifier hs-type">decl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#IsOrphan"><span class="hs-identifier hs-type">IsOrphan</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Extract orphan status from decl</span><span>
</span><a name="line-838"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1628236736"><span class="hs-identifier hs-type">decl</span></a><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- Sorted into canonical order</span><span>
</span><a name="line-839"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628236736"><span class="hs-identifier hs-type">decl</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Non-orphan decls associated with their key;</span><span>
</span><a name="line-840"></a><span>                                </span><span class="hs-comment">--      each sublist in canonical order</span><span>
</span><a name="line-841"></a><span>              </span><span class="hs-special">[</span><a href="#local-1628236736"><span class="hs-identifier hs-type">decl</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- Orphan decls; in canonical order</span><span>
</span><a name="line-842"></a><a name="mkOrphMap"><a href="MkIface.html#mkOrphMap"><span class="hs-identifier">mkOrphMap</span></a></a><span> </span><a name="local-1628236979"><a href="#local-1628236979"><span class="hs-identifier">get_key</span></a></a><span> </span><a name="local-1628236980"><a href="#local-1628236980"><span class="hs-identifier">decls</span></a></a><span>
</span><a name="line-843"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a><span> </span><a href="#local-1628236981"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#emptyOccEnv"><span class="hs-identifier hs-var">emptyOccEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-1628236980"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-844"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-845"></a><span>    </span><a name="local-1628236981"><a href="#local-1628236981"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628236982"><a href="#local-1628236982"><span class="hs-identifier">non_orphs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628236983"><a href="#local-1628236983"><span class="hs-identifier">orphs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628236984"><a href="#local-1628236984"><span class="hs-identifier">d</span></a></a><span>
</span><a name="line-846"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="CoreSyn.html#NotOrphan"><span class="hs-identifier hs-var">NotOrphan</span></a><span> </span><a name="local-1628236985"><a href="#local-1628236985"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628236979"><span class="hs-identifier hs-var">get_key</span></a><span> </span><a href="#local-1628236984"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-847"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="OccName.html#extendOccEnv_Acc"><span class="hs-identifier hs-var">extendOccEnv_Acc</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><a href="Util.html#singleton"><span class="hs-identifier hs-var">singleton</span></a><span> </span><a href="#local-1628236982"><span class="hs-identifier hs-var">non_orphs</span></a><span> </span><a href="#local-1628236985"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-1628236984"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236983"><span class="hs-identifier hs-var">orphs</span></a><span class="hs-special">)</span><span>
</span><a name="line-848"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628236982"><span class="hs-identifier hs-var">non_orphs</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628236984"><span class="hs-identifier hs-var">d</span></a><span class="hs-glyph">:</span><a href="#local-1628236983"><span class="hs-identifier hs-var">orphs</span></a><span class="hs-special">)</span><span>
</span><a name="line-849"></a><span>
</span><a name="line-850"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
       Keeping track of what we've slurped, and fingerprints
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-857"></a><span>
</span><a name="line-858"></a><span>
</span><a name="line-859"></a><span class="hs-identifier">mkIfaceAnnotation</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceAnnotation"><span class="hs-identifier hs-type">IfaceAnnotation</span></a><span>
</span><a name="line-860"></a><a name="mkIfaceAnnotation"><a href="MkIface.html#mkIfaceAnnotation"><span class="hs-identifier">mkIfaceAnnotation</span></a></a><span> </span><span class="hs-special">(</span><a href="Annotations.html#Annotation"><span class="hs-identifier hs-var">Annotation</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ann_target</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236986"><a href="#local-1628236986"><span class="hs-identifier">target</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ann_value</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628236987"><a href="#local-1628236987"><span class="hs-identifier">payload</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-861"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceAnnotation"><span class="hs-identifier hs-var">IfaceAnnotation</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-862"></a><span>        </span><span class="hs-identifier">ifAnnotatedTarget</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1628236986"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">,</span><span>
</span><a name="line-863"></a><span>        </span><span class="hs-identifier">ifAnnotatedValue</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628236987"><span class="hs-identifier hs-var">payload</span></a><span>
</span><a name="line-864"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-865"></a><span>
</span><a name="line-866"></a><span class="hs-identifier">mkIfaceExports</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#IfaceExport"><span class="hs-identifier hs-type">IfaceExport</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Sort to make canonical</span><span>
</span><a name="line-867"></a><a name="mkIfaceExports"><a href="MkIface.html#mkIfaceExports"><span class="hs-identifier">mkIfaceExports</span></a></a><span> </span><a name="local-1628236988"><a href="#local-1628236988"><span class="hs-identifier">exports</span></a></a><span>
</span><a name="line-868"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><a href="Avail.html#stableAvailCmp"><span class="hs-identifier hs-var">stableAvailCmp</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628236989"><span class="hs-identifier hs-var">sort_subs</span></a><span> </span><a href="#local-1628236988"><span class="hs-identifier hs-var">exports</span></a><span class="hs-special">)</span><span>
</span><a name="line-869"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-870"></a><span>    </span><span class="hs-identifier">sort_subs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span>
</span><a name="line-871"></a><span>    </span><a name="local-1628236989"><a href="#local-1628236989"><span class="hs-identifier">sort_subs</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-1628236991"><a href="#local-1628236991"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1628236992"><a href="#local-1628236992"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a href="#local-1628236991"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-1628236992"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-872"></a><span>    </span><span class="hs-identifier">sort_subs</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-1628236993"><a href="#local-1628236993"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-1628236994"><a href="#local-1628236994"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-1628236993"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="#local-1628236990"><span class="hs-identifier hs-var">sort_flds</span></a><span> </span><a href="#local-1628236994"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-873"></a><span>    </span><span class="hs-identifier">sort_subs</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-1628236995"><a href="#local-1628236995"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628236996"><a href="#local-1628236996"><span class="hs-identifier">m</span></a></a><span class="hs-glyph">:</span><a name="local-1628236997"><a href="#local-1628236997"><span class="hs-identifier">ms</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628236998"><a href="#local-1628236998"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-874"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628236995"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">==</span><a href="#local-1628236996"><span class="hs-identifier hs-var">m</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-1628236995"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236996"><span class="hs-identifier hs-var">m</span></a><span class="hs-glyph">:</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><a href="Name.html#stableNameCmp"><span class="hs-identifier hs-var">stableNameCmp</span></a><span> </span><a href="#local-1628236997"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628236990"><span class="hs-identifier hs-var">sort_flds</span></a><span> </span><a href="#local-1628236998"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-875"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-1628236995"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><a href="Name.html#stableNameCmp"><span class="hs-identifier hs-var">stableNameCmp</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628236996"><span class="hs-identifier hs-var">m</span></a><span class="hs-glyph">:</span><a href="#local-1628236997"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628236990"><span class="hs-identifier hs-var">sort_flds</span></a><span> </span><a href="#local-1628236998"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-876"></a><span>       </span><span class="hs-comment">-- Maintain the AvailTC Invariant</span><span>
</span><a name="line-877"></a><span>
</span><a name="line-878"></a><span>    </span><a name="local-1628236990"><a href="#local-1628236990"><span class="hs-identifier">sort_flds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#stableNameCmp"><span class="hs-identifier hs-var">stableNameCmp</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Function.html#on"><span class="hs-identifier hs-var">on</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">flSelector</span><span class="hs-special">)</span><span>
</span><a name="line-879"></a><span>
</span><a name="line-880"></a><span class="hs-comment">{-
Note [Orignal module]
~~~~~~~~~~~~~~~~~~~~~
Consider this:
        module X where { data family T }
        module Y( T(..) ) where { import X; data instance T Int = MkT Int }
The exported Avail from Y will look like
        X.T{X.T, Y.MkT}
That is, in Y,
  - only MkT is brought into scope by the data instance;
  - but the parent (used for grouping and naming in T(..) exports) is X.T
  - and in this case we export X.T too

In the result of MkIfaceExports, the names are grouped by defining module,
so we may need to split up a single Avail into multiple ones.

Note [Internal used_names]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Most of the used_names are External Names, but we can have Internal
Names too: see Note [Binders in Template Haskell] in Convert, and
Trac #5362 for an example.  Such Names are always
  - Such Names are always for locally-defined things, for which we
    don't gather usage info, so we can just ignore them in ent_map
  - They are always System Names, hence the assert, just as a double check.


************************************************************************
*                                                                      *
        Load the old interface file for this module (unless
        we have it already), and check whether it is up to date
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-913"></a><span>
</span><a name="line-914"></a><span class="hs-keyword">data</span><span> </span><a name="RecompileRequired"><a href="MkIface.html#RecompileRequired"><span class="hs-identifier">RecompileRequired</span></a></a><span>
</span><a name="line-915"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="UpToDate"><a href="MkIface.html#UpToDate"><span class="hs-identifier">UpToDate</span></a></a><span>
</span><a name="line-916"></a><span>       </span><span class="hs-comment">-- ^ everything is up to date, recompilation is not required</span><span>
</span><a name="line-917"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MustCompile"><a href="MkIface.html#MustCompile"><span class="hs-identifier">MustCompile</span></a></a><span>
</span><a name="line-918"></a><span>       </span><span class="hs-comment">-- ^ The .hs file has been touched, or the .o/.hi file does not exist</span><span>
</span><a name="line-919"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RecompBecause"><a href="MkIface.html#RecompBecause"><span class="hs-identifier">RecompBecause</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>
</span><a name="line-920"></a><span>       </span><span class="hs-comment">-- ^ The .o/.hi files are up to date, but something else has changed</span><span>
</span><a name="line-921"></a><span>       </span><span class="hs-comment">-- to force recompilation; the String says what (one-line summary)</span><span>
</span><a name="line-922"></a><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Eq</span><span>
</span><a name="line-923"></a><span>
</span><a name="line-924"></a><span class="hs-identifier">recompileRequired</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-925"></a><a name="recompileRequired"><a href="MkIface.html#recompileRequired"><span class="hs-identifier">recompileRequired</span></a></a><span> </span><a href="MkIface.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-926"></a><span class="hs-identifier">recompileRequired</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-927"></a><span>
</span><a name="line-928"></a><span>
</span><a name="line-929"></a><span>
</span><a name="line-930"></a><span class="hs-comment">-- | Top level function to check if the version of an old interface file</span><span>
</span><a name="line-931"></a><span class="hs-comment">-- is equivalent to the current source file the user asked us to compile.</span><span>
</span><a name="line-932"></a><span class="hs-comment">-- If the same, we can avoid recompilation. We return a tuple where the</span><span>
</span><a name="line-933"></a><span class="hs-comment">-- first element is a bool saying if we should recompile the object file</span><span>
</span><a name="line-934"></a><span class="hs-comment">-- and the second is maybe the interface file, where Nothng means to</span><span>
</span><a name="line-935"></a><span class="hs-comment">-- rebuild the interface file not use the exisitng one.</span><span>
</span><a name="line-936"></a><span class="hs-identifier">checkOldIface</span><span>
</span><a name="line-937"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-938"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span>
</span><a name="line-939"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#SourceModified"><span class="hs-identifier hs-type">SourceModified</span></a><span>
</span><a name="line-940"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span>         </span><span class="hs-comment">-- Old interface from compilation manager, if any</span><span>
</span><a name="line-941"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span class="hs-special">)</span><span>
</span><a name="line-942"></a><span>
</span><a name="line-943"></a><a name="checkOldIface"><a href="MkIface.html#checkOldIface"><span class="hs-identifier">checkOldIface</span></a></a><span> </span><a name="local-1628236999"><a href="#local-1628236999"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628237000"><a href="#local-1628237000"><span class="hs-identifier">mod_summary</span></a></a><span> </span><a name="local-1628237001"><a href="#local-1628237001"><span class="hs-identifier">source_modified</span></a></a><span> </span><a name="local-1628237002"><a href="#local-1628237002"><span class="hs-identifier">maybe_iface</span></a></a><span>
</span><a name="line-944"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1628237003"><a href="#local-1628237003"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628236999"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-945"></a><span>        </span><a href="ErrUtils.html#showPass"><span class="hs-identifier hs-var">showPass</span></a><span> </span><a href="#local-1628237003"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-946"></a><span>            </span><span class="hs-string">&quot;Checking old interface for &quot;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-947"></a><span>              </span><span class="hs-special">(</span><a href="Outputable.html#showPpr"><span class="hs-identifier hs-var">showPpr</span></a><span> </span><a href="#local-1628237003"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">ms_mod</span><span> </span><a href="#local-1628237000"><span class="hs-identifier hs-var">mod_summary</span></a><span class="hs-special">)</span><span>
</span><a name="line-948"></a><span>        </span><a href="TcRnMonad.html#initIfaceCheck"><span class="hs-identifier hs-var">initIfaceCheck</span></a><span> </span><a href="#local-1628236999"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-949"></a><span>            </span><a href="MkIface.html#check_old_iface"><span class="hs-identifier hs-var">check_old_iface</span></a><span> </span><a href="#local-1628236999"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628237000"><span class="hs-identifier hs-var">mod_summary</span></a><span> </span><a href="#local-1628237001"><span class="hs-identifier hs-var">source_modified</span></a><span> </span><a href="#local-1628237002"><span class="hs-identifier hs-var">maybe_iface</span></a><span>
</span><a name="line-950"></a><span>
</span><a name="line-951"></a><span class="hs-identifier">check_old_iface</span><span>
</span><a name="line-952"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-953"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span>
</span><a name="line-954"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#SourceModified"><span class="hs-identifier hs-type">SourceModified</span></a><span>
</span><a name="line-955"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span>
</span><a name="line-956"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span class="hs-special">)</span><span>
</span><a name="line-957"></a><span>
</span><a name="line-958"></a><a name="check_old_iface"><a href="MkIface.html#check_old_iface"><span class="hs-identifier">check_old_iface</span></a></a><span> </span><a name="local-1628237004"><a href="#local-1628237004"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628237005"><a href="#local-1628237005"><span class="hs-identifier">mod_summary</span></a></a><span> </span><a name="local-1628237006"><a href="#local-1628237006"><span class="hs-identifier">src_modified</span></a></a><span> </span><a name="local-1628237007"><a href="#local-1628237007"><span class="hs-identifier">maybe_iface</span></a></a><span>
</span><a name="line-959"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1628237008"><a href="#local-1628237008"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628237004"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-960"></a><span>        </span><a name="local-1628237009"><a href="#local-1628237009"><span class="hs-identifier">getIface</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-961"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237007"><span class="hs-identifier hs-var">maybe_iface</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-962"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-963"></a><span>                    </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;We already have the old interface for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-964"></a><span>                      </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_mod</span><span> </span><a href="#local-1628237005"><span class="hs-identifier hs-var">mod_summary</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-965"></a><span>                    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628237007"><span class="hs-identifier hs-var">maybe_iface</span></a><span>
</span><a name="line-966"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628237010"><span class="hs-identifier hs-var">loadIface</span></a><span>
</span><a name="line-967"></a><span>
</span><a name="line-968"></a><span>        </span><a name="local-1628237010"><a href="#local-1628237010"><span class="hs-identifier">loadIface</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-969"></a><span>             </span><span class="hs-keyword">let</span><span> </span><a name="local-1628237012"><a href="#local-1628237012"><span class="hs-identifier">iface_path</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#msHiFilePath"><span class="hs-identifier hs-var">msHiFilePath</span></a><span> </span><a href="#local-1628237005"><span class="hs-identifier hs-var">mod_summary</span></a><span>
</span><a name="line-970"></a><span>             </span><a name="local-1628237013"><a href="#local-1628237013"><span class="hs-identifier">read_result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LoadIface.html#readIface"><span class="hs-identifier hs-var">readIface</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_mod</span><span> </span><a href="#local-1628237005"><span class="hs-identifier hs-var">mod_summary</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628237012"><span class="hs-identifier hs-var">iface_path</span></a><span>
</span><a name="line-971"></a><span>             </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237013"><span class="hs-identifier hs-var">read_result</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-972"></a><span>                 </span><a href="Maybes.html#Failed"><span class="hs-identifier hs-var">Failed</span></a><span> </span><a name="local-1628237014"><a href="#local-1628237014"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-973"></a><span>                     </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;FYI: cannot read old interface file:&quot;</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">4</span><span> </span><a href="#local-1628237014"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span>
</span><a name="line-974"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-975"></a><span>                 </span><a href="Maybes.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a><span> </span><a name="local-1628237015"><a href="#local-1628237015"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-976"></a><span>                     </span><a href="TcRnMonad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Read the interface file&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-1628237012"><span class="hs-identifier hs-var">iface_path</span></a><span class="hs-special">)</span><span>
</span><a name="line-977"></a><span>                     </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628237015"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-978"></a><span>
</span><a name="line-979"></a><span>        </span><a name="local-1628237011"><a href="#local-1628237011"><span class="hs-identifier">src_changed</span></a></a><span>
</span><a name="line-980"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_ForceRecomp"><span class="hs-identifier hs-var">Opt_ForceRecomp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628237004"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-981"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="HscTypes.html#SourceModified"><span class="hs-identifier hs-var">SourceModified</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628237006"><span class="hs-identifier hs-var">src_modified</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-982"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-983"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-984"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="#local-1628237011"><span class="hs-identifier hs-var">src_changed</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-985"></a><span>            </span><a href="TcRnMonad.html#traceHiDiffs"><span class="hs-identifier hs-var">traceHiDiffs</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">4</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Source file changed or recompilation check turned off&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-986"></a><span>
</span><a name="line-987"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237011"><span class="hs-identifier hs-var">src_changed</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-988"></a><span>            </span><span class="hs-comment">-- If the source has changed and we're in interactive mode,</span><span>
</span><a name="line-989"></a><span>            </span><span class="hs-comment">-- avoid reading an interface; just return the one we might</span><span>
</span><a name="line-990"></a><span>            </span><span class="hs-comment">-- have been supplied with.</span><span>
</span><a name="line-991"></a><span>            </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#isObjectTarget"><span class="hs-identifier hs-var">isObjectTarget</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-identifier">hscTarget</span><span> </span><a href="#local-1628237008"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-992"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#MustCompile"><span class="hs-identifier hs-var">MustCompile</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628237007"><span class="hs-identifier hs-var">maybe_iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-993"></a><span>
</span><a name="line-994"></a><span>            </span><span class="hs-comment">-- Try and read the old interface for the current module</span><span>
</span><a name="line-995"></a><span>            </span><span class="hs-comment">-- from the .hi file left from the last time we compiled it</span><span>
</span><a name="line-996"></a><span>            </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-997"></a><span>                </span><a name="local-1628237016"><a href="#local-1628237016"><span class="hs-identifier">maybe_iface'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628237009"><span class="hs-identifier hs-var">getIface</span></a><span>
</span><a name="line-998"></a><span>                </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#MustCompile"><span class="hs-identifier hs-var">MustCompile</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628237016"><span class="hs-identifier hs-var">maybe_iface'</span></a><span class="hs-special">)</span><span>
</span><a name="line-999"></a><span>
</span><a name="line-1000"></a><span>            </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1001"></a><span>                </span><a name="local-1628237017"><a href="#local-1628237017"><span class="hs-identifier">maybe_iface'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628237009"><span class="hs-identifier hs-var">getIface</span></a><span>
</span><a name="line-1002"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237017"><span class="hs-identifier hs-var">maybe_iface'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1003"></a><span>                    </span><span class="hs-comment">-- We can't retrieve the iface</span><span>
</span><a name="line-1004"></a><span>                    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#MustCompile"><span class="hs-identifier hs-var">MustCompile</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1005"></a><span>
</span><a name="line-1006"></a><span>                    </span><span class="hs-comment">-- We have got the old iface; check its versions</span><span>
</span><a name="line-1007"></a><span>                    </span><span class="hs-comment">-- even in the SourceUnmodifiedAndStable case we</span><span>
</span><a name="line-1008"></a><span>                    </span><span class="hs-comment">-- should check versions because some packages</span><span>
</span><a name="line-1009"></a><span>                    </span><span class="hs-comment">-- might have changed or gone away.</span><span>
</span><a name="line-1010"></a><span>                    </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237018"><a href="#local-1628237018"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#checkVersions"><span class="hs-identifier hs-var">checkVersions</span></a><span> </span><a href="#local-1628237004"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628237005"><span class="hs-identifier hs-var">mod_summary</span></a><span> </span><a href="#local-1628237018"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-1011"></a><span>
</span><a name="line-1012"></a><span class="hs-comment">-- | Check if a module is still the same 'version'.</span><span>
</span><a name="line-1013"></a><span class="hs-comment">--</span><span>
</span><a name="line-1014"></a><span class="hs-comment">-- This function is called in the recompilation checker after we have</span><span>
</span><a name="line-1015"></a><span class="hs-comment">-- determined that the module M being checked hasn't had any changes</span><span>
</span><a name="line-1016"></a><span class="hs-comment">-- to its source file since we last compiled M. So at this point in general</span><span>
</span><a name="line-1017"></a><span class="hs-comment">-- two things may have changed that mean we should recompile M:</span><span>
</span><a name="line-1018"></a><span class="hs-comment">--   * The interface export by a dependency of M has changed.</span><span>
</span><a name="line-1019"></a><span class="hs-comment">--   * The compiler flags specified this time for M have changed</span><span>
</span><a name="line-1020"></a><span class="hs-comment">--     in a manner that is significant for recompilaiton.</span><span>
</span><a name="line-1021"></a><span class="hs-comment">-- We return not just if we should recompile the object file but also</span><span>
</span><a name="line-1022"></a><span class="hs-comment">-- if we should rebuild the interface file.</span><span>
</span><a name="line-1023"></a><span class="hs-identifier">checkVersions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-1024"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span>
</span><a name="line-1025"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span>       </span><span class="hs-comment">-- Old interface</span><span>
</span><a name="line-1026"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span class="hs-special">)</span><span>
</span><a name="line-1027"></a><a name="checkVersions"><a href="MkIface.html#checkVersions"><span class="hs-identifier">checkVersions</span></a></a><span> </span><a name="local-1628237019"><a href="#local-1628237019"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628237020"><a href="#local-1628237020"><span class="hs-identifier">mod_summary</span></a></a><span> </span><a name="local-1628237021"><a href="#local-1628237021"><span class="hs-identifier">iface</span></a></a><span>
</span><a name="line-1028"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceHiDiffs"><span class="hs-identifier hs-var">traceHiDiffs</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Considering whether compilation is required for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-1029"></a><span>                        </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_module</span><span> </span><a href="#local-1628237021"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">)</span><span>
</span><a name="line-1030"></a><span>
</span><a name="line-1031"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628237024"><a href="#local-1628237024"><span class="hs-identifier">recomp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MkIface.html#checkFlagHash"><span class="hs-identifier hs-var">checkFlagHash</span></a><span> </span><a href="#local-1628237019"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628237021"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-1032"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="MkIface.html#recompileRequired"><span class="hs-identifier hs-var">recompileRequired</span></a><span> </span><a href="#local-1628237024"><span class="hs-identifier hs-var">recomp</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628237024"><span class="hs-identifier hs-var">recomp</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1033"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="DynFlags.html#getSigOf"><span class="hs-identifier hs-var">getSigOf</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628237019"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_module</span><span> </span><a href="#local-1628237021"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1034"></a><span>                </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier">mi_sig_of</span><span> </span><a href="#local-1628237021"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-1035"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#RecompBecause"><span class="hs-identifier hs-var">RecompBecause</span></a><span> </span><span class="hs-string">&quot;sig-of changed&quot;</span><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1036"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628237025"><a href="#local-1628237025"><span class="hs-identifier">recomp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MkIface.html#checkDependencies"><span class="hs-identifier hs-var">checkDependencies</span></a><span> </span><a href="#local-1628237019"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628237020"><span class="hs-identifier hs-var">mod_summary</span></a><span> </span><a href="#local-1628237021"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-1037"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="MkIface.html#recompileRequired"><span class="hs-identifier hs-var">recompileRequired</span></a><span> </span><a href="#local-1628237025"><span class="hs-identifier hs-var">recomp</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628237025"><span class="hs-identifier hs-var">recomp</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628237021"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1038"></a><span>
</span><a name="line-1039"></a><span>       </span><span class="hs-comment">-- Source code unchanged and no errors yet... carry on</span><span>
</span><a name="line-1040"></a><span>       </span><span class="hs-comment">--</span><span>
</span><a name="line-1041"></a><span>       </span><span class="hs-comment">-- First put the dependent-module info, read from the old</span><span>
</span><a name="line-1042"></a><span>       </span><span class="hs-comment">-- interface, into the envt, so that when we look for</span><span>
</span><a name="line-1043"></a><span>       </span><span class="hs-comment">-- interfaces we look for the right one (.hi or .hi-boot)</span><span>
</span><a name="line-1044"></a><span>       </span><span class="hs-comment">--</span><span>
</span><a name="line-1045"></a><span>       </span><span class="hs-comment">-- It's just temporary because either the usage check will succeed</span><span>
</span><a name="line-1046"></a><span>       </span><span class="hs-comment">-- (in which case we are done with this module) or it'll fail (in which</span><span>
</span><a name="line-1047"></a><span>       </span><span class="hs-comment">-- case we'll compile the module from scratch anyhow).</span><span>
</span><a name="line-1048"></a><span>       </span><span class="hs-comment">--</span><span>
</span><a name="line-1049"></a><span>       </span><span class="hs-comment">-- We do this regardless of compilation mode, although in --make mode</span><span>
</span><a name="line-1050"></a><span>       </span><span class="hs-comment">-- all the dependent modules should be in the HPT already, so it's</span><span>
</span><a name="line-1051"></a><span>       </span><span class="hs-comment">-- quite redundant</span><span>
</span><a name="line-1052"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#updateEps_"><span class="hs-identifier hs-var">updateEps_</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628237026"><a href="#local-1628237026"><span class="hs-identifier">eps</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628237026"><span class="hs-identifier hs-var">eps</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eps_is_boot</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237023"><span class="hs-identifier hs-var">mod_deps</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1053"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-1628237028"><a href="#local-1628237028"><span class="hs-identifier">recomp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MkIface.html#checkList"><span class="hs-identifier hs-var">checkList</span></a><span> </span><span class="hs-special">[</span><a href="MkIface.html#checkModUsage"><span class="hs-identifier hs-var">checkModUsage</span></a><span> </span><a href="#local-1628237022"><span class="hs-identifier hs-var">this_pkg</span></a><span> </span><a href="#local-1628237027"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-1628237027"><a href="#local-1628237027"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mi_usages</span><span> </span><a href="#local-1628237021"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">]</span><span>
</span><a name="line-1054"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628237028"><span class="hs-identifier hs-var">recomp</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="#local-1628237021"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-1055"></a><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1056"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1057"></a><span>    </span><a name="local-1628237022"><a href="#local-1628237022"><span class="hs-identifier">this_pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">thisPackage</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628237019"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1058"></a><span>    </span><span class="hs-comment">-- This is a bit of a hack really</span><span>
</span><a name="line-1059"></a><span>    </span><span class="hs-identifier">mod_deps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleNameEnv"><span class="hs-identifier hs-type">ModuleNameEnv</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span>
</span><a name="line-1060"></a><span>    </span><a name="local-1628237023"><a href="#local-1628237023"><span class="hs-identifier">mod_deps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#mkModDeps"><span class="hs-identifier hs-var">mkModDeps</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_mods</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_deps</span><span> </span><a href="#local-1628237021"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1061"></a><span>
</span><a name="line-1062"></a><span class="hs-comment">-- | Check the flags haven't changed</span><span>
</span><a name="line-1063"></a><span class="hs-identifier">checkFlagHash</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span>
</span><a name="line-1064"></a><a name="checkFlagHash"><a href="MkIface.html#checkFlagHash"><span class="hs-identifier">checkFlagHash</span></a></a><span> </span><a name="local-1628237029"><a href="#local-1628237029"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628237030"><a href="#local-1628237030"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1065"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628237031"><a href="#local-1628237031"><span class="hs-identifier">old_hash</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mi_flag_hash</span><span> </span><a href="#local-1628237030"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-1066"></a><span>    </span><a name="local-1628237032"><a href="#local-1628237032"><span class="hs-identifier">new_hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="FlagChecker.html#fingerprintDynFlags"><span class="hs-identifier hs-var">fingerprintDynFlags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628237029"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1067"></a><span>                                             </span><span class="hs-special">(</span><span class="hs-identifier">mi_module</span><span> </span><a href="#local-1628237030"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-1068"></a><span>                                             </span><a href="MkIface.html#putNameLiterally"><span class="hs-identifier hs-var">putNameLiterally</span></a><span>
</span><a name="line-1069"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237031"><span class="hs-identifier hs-var">old_hash</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628237032"><span class="hs-identifier hs-var">new_hash</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1070"></a><span>        </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#up_to_date"><span class="hs-identifier hs-var">up_to_date</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Module flags unchanged&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1071"></a><span>        </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#out_of_date_hash"><span class="hs-identifier hs-var">out_of_date_hash</span></a><span> </span><span class="hs-string">&quot;flags changed&quot;</span><span>
</span><a name="line-1072"></a><span>                     </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;  Module flags have changed&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1073"></a><span>                     </span><a href="#local-1628237031"><span class="hs-identifier hs-var">old_hash</span></a><span> </span><a href="#local-1628237032"><span class="hs-identifier hs-var">new_hash</span></a><span>
</span><a name="line-1074"></a><span>
</span><a name="line-1075"></a><span class="hs-comment">-- If the direct imports of this module are resolved to targets that</span><span>
</span><a name="line-1076"></a><span class="hs-comment">-- are not among the dependencies of the previous interface file,</span><span>
</span><a name="line-1077"></a><span class="hs-comment">-- then we definitely need to recompile.  This catches cases like</span><span>
</span><a name="line-1078"></a><span class="hs-comment">--   - an exposed package has been upgraded</span><span>
</span><a name="line-1079"></a><span class="hs-comment">--   - we are compiling with different package flags</span><span>
</span><a name="line-1080"></a><span class="hs-comment">--   - a home module that was shadowing a package module has been removed</span><span>
</span><a name="line-1081"></a><span class="hs-comment">--   - a new home module has been added that shadows a package module</span><span>
</span><a name="line-1082"></a><span class="hs-comment">-- See bug #1372.</span><span>
</span><a name="line-1083"></a><span class="hs-comment">--</span><span>
</span><a name="line-1084"></a><span class="hs-comment">-- Returns True if recompilation is required.</span><span>
</span><a name="line-1085"></a><span class="hs-identifier">checkDependencies</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span>
</span><a name="line-1086"></a><a name="checkDependencies"><a href="MkIface.html#checkDependencies"><span class="hs-identifier">checkDependencies</span></a></a><span> </span><a name="local-1628237033"><a href="#local-1628237033"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-1628237034"><a href="#local-1628237034"><span class="hs-identifier">summary</span></a></a><span> </span><a name="local-1628237035"><a href="#local-1628237035"><span class="hs-identifier">iface</span></a></a><span>
</span><a name="line-1087"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#checkList"><span class="hs-identifier hs-var">checkList</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628237039"><span class="hs-identifier hs-var">dep_missing</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ms_imps"><span class="hs-identifier hs-var">ms_imps</span></a><span> </span><a href="#local-1628237034"><span class="hs-identifier hs-var">summary</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-identifier">ms_srcimps</span><span> </span><a href="#local-1628237034"><span class="hs-identifier hs-var">summary</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1088"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1089"></a><span>   </span><a name="local-1628237036"><a href="#local-1628237036"><span class="hs-identifier">prev_dep_mods</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dep_mods</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_deps</span><span> </span><a href="#local-1628237035"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-1090"></a><span>   </span><a name="local-1628237037"><a href="#local-1628237037"><span class="hs-identifier">prev_dep_pkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dep_pkgs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_deps</span><span> </span><a href="#local-1628237035"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-1091"></a><span>
</span><a name="line-1092"></a><span>   </span><a name="local-1628237038"><a href="#local-1628237038"><span class="hs-identifier">this_pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">thisPackage</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-1628237033"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1093"></a><span>
</span><a name="line-1094"></a><span>   </span><a name="local-1628237039"><a href="#local-1628237039"><span class="hs-identifier">dep_missing</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628237040"><a href="#local-1628237040"><span class="hs-identifier">mb_pkg</span></a></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628237041"><a href="#local-1628237041"><span class="hs-identifier">mod</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1095"></a><span>     </span><a name="local-1628237042"><a href="#local-1628237042"><span class="hs-identifier">find_res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="Finder.html#findImportedModule"><span class="hs-identifier hs-var">findImportedModule</span></a><span> </span><a href="#local-1628237033"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-1628237041"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628237040"><span class="hs-identifier hs-var">mb_pkg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1096"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-1628237043"><a href="#local-1628237043"><span class="hs-identifier">reason</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a><span> </span><a href="#local-1628237041"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; changed&quot;</span><span>
</span><a name="line-1097"></a><span>     </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237042"><span class="hs-identifier hs-var">find_res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1098"></a><span>        </span><a href="HscTypes.html#Found"><span class="hs-identifier hs-var">Found</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628237044"><a href="#local-1628237044"><span class="hs-identifier">mod</span></a></a><span>
</span><a name="line-1099"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628237045"><span class="hs-identifier hs-var">pkg</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628237038"><span class="hs-identifier hs-var">this_pkg</span></a><span>
</span><a name="line-1100"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-1628237044"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#notElem"><span class="hs-identifier hs-var">notElem</span></a><span class="hs-special">`</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1628237036"><span class="hs-identifier hs-var">prev_dep_mods</span></a><span>
</span><a name="line-1101"></a><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="TcRnMonad.html#traceHiDiffs"><span class="hs-identifier hs-var">traceHiDiffs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1102"></a><span>                           </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;imported module &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237044"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-1103"></a><span>                           </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot; not among previous dependencies&quot;</span><span>
</span><a name="line-1104"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#RecompBecause"><span class="hs-identifier hs-var">RecompBecause</span></a><span> </span><a href="#local-1628237043"><span class="hs-identifier hs-var">reason</span></a><span class="hs-special">)</span><span>
</span><a name="line-1105"></a><span>                 </span><span class="hs-keyword">else</span><span>
</span><a name="line-1106"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="MkIface.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a><span>
</span><a name="line-1107"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1108"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1628237045"><span class="hs-identifier hs-var">pkg</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#notElem"><span class="hs-identifier hs-var">notElem</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1628237037"><span class="hs-identifier hs-var">prev_dep_pkgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1109"></a><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="TcRnMonad.html#traceHiDiffs"><span class="hs-identifier hs-var">traceHiDiffs</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1110"></a><span>                           </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;imported module &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237044"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-1111"></a><span>                           </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot; is from package &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237045"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-1112"></a><span>                           </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;, which is not among previous dependencies&quot;</span><span>
</span><a name="line-1113"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#RecompBecause"><span class="hs-identifier hs-var">RecompBecause</span></a><span> </span><a href="#local-1628237043"><span class="hs-identifier hs-var">reason</span></a><span class="hs-special">)</span><span>
</span><a name="line-1114"></a><span>                 </span><span class="hs-keyword">else</span><span>
</span><a name="line-1115"></a><span>                         </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="MkIface.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a><span>
</span><a name="line-1116"></a><span>           </span><span class="hs-keyword">where</span><span> </span><a name="local-1628237045"><a href="#local-1628237045"><span class="hs-identifier">pkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-1628237044"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-1117"></a><span>        </span><a name="local-1628237046"><a href="#local-1628237046"><span class="hs-identifier">_otherwise</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#RecompBecause"><span class="hs-identifier hs-var">RecompBecause</span></a><span> </span><a href="#local-1628237043"><span class="hs-identifier hs-var">reason</span></a><span class="hs-special">)</span><span>
</span><a name="line-1118"></a><span>
</span><a name="line-1119"></a><span class="hs-identifier">needInterface</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span class="hs-special">)</span><span>
</span><a name="line-1120"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span>
</span><a name="line-1121"></a><a name="needInterface"><a href="MkIface.html#needInterface"><span class="hs-identifier">needInterface</span></a></a><span> </span><a name="local-1628237047"><a href="#local-1628237047"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-1628237048"><a href="#local-1628237048"><span class="hs-identifier">continue</span></a></a><span>
</span><a name="line-1122"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-comment">-- Load the imported interface if possible</span><span>
</span><a name="line-1123"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628237049"><a href="#local-1628237049"><span class="hs-identifier">doc_str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;need version info for&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237047"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">]</span><span>
</span><a name="line-1124"></a><span>    </span><a href="TcRnMonad.html#traceHiDiffs"><span class="hs-identifier hs-var">traceHiDiffs</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Checking usages for module&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237047"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-1125"></a><span>
</span><a name="line-1126"></a><span>    </span><a name="local-1628237050"><a href="#local-1628237050"><span class="hs-identifier">mb_iface</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="LoadIface.html#loadInterface"><span class="hs-identifier hs-var">loadInterface</span></a><span> </span><a href="#local-1628237049"><span class="hs-identifier hs-var">doc_str</span></a><span> </span><a href="#local-1628237047"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="TcRnTypes.html#ImportBySystem"><span class="hs-identifier hs-var">ImportBySystem</span></a><span>
</span><a name="line-1127"></a><span>        </span><span class="hs-comment">-- Load the interface, but don't complain on failure;</span><span>
</span><a name="line-1128"></a><span>        </span><span class="hs-comment">-- Instead, get an Either back which we can test</span><span>
</span><a name="line-1129"></a><span>
</span><a name="line-1130"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237050"><span class="hs-identifier hs-var">mb_iface</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1131"></a><span>      </span><a href="Maybes.html#Failed"><span class="hs-identifier hs-var">Failed</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1132"></a><span>        </span><a href="TcRnMonad.html#traceHiDiffs"><span class="hs-identifier hs-var">traceHiDiffs</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Couldn't load interface for module&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1133"></a><span>                           </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237047"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1134"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="MkIface.html#MustCompile"><span class="hs-identifier hs-var">MustCompile</span></a><span>
</span><a name="line-1135"></a><span>                  </span><span class="hs-comment">-- Couldn't find or parse a module mentioned in the</span><span>
</span><a name="line-1136"></a><span>                  </span><span class="hs-comment">-- old interface file.  Don't complain: it might</span><span>
</span><a name="line-1137"></a><span>                  </span><span class="hs-comment">-- just be that the current module doesn't need that</span><span>
</span><a name="line-1138"></a><span>                  </span><span class="hs-comment">-- import and it's been deleted</span><span>
</span><a name="line-1139"></a><span>      </span><a href="Maybes.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a><span> </span><a name="local-1628237051"><a href="#local-1628237051"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1628237048"><span class="hs-identifier hs-var">continue</span></a><span> </span><a href="#local-1628237051"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-1140"></a><span>
</span><a name="line-1141"></a><span>
</span><a name="line-1142"></a><span class="hs-comment">-- | Given the usage information extracted from the old</span><span>
</span><a name="line-1143"></a><span class="hs-comment">-- M.hi file for the module being compiled, figure out</span><span>
</span><a name="line-1144"></a><span class="hs-comment">-- whether M needs to be recompiled.</span><span>
</span><a name="line-1145"></a><span class="hs-identifier">checkModUsage</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#Usage"><span class="hs-identifier hs-type">Usage</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span>
</span><a name="line-1146"></a><a name="checkModUsage"><a href="MkIface.html#checkModUsage"><span class="hs-identifier">checkModUsage</span></a></a><span> </span><a name="local-1628237052"><a href="#local-1628237052"><span class="hs-identifier">_this_pkg</span></a></a><span> </span><a href="HscTypes.html#UsagePackageModule"><span class="hs-identifier hs-var">UsagePackageModule</span></a><span class="hs-special">{</span><span>
</span><a name="line-1147"></a><span>                                </span><span class="hs-identifier">usg_mod</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237053"><a href="#local-1628237053"><span class="hs-identifier">mod</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1148"></a><span>                                </span><span class="hs-identifier">usg_mod_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237054"><a href="#local-1628237054"><span class="hs-identifier">old_mod_hash</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1149"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#needInterface"><span class="hs-identifier hs-var">needInterface</span></a><span> </span><a href="#local-1628237053"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628237055"><a href="#local-1628237055"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1150"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628237056"><a href="#local-1628237056"><span class="hs-identifier">reason</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-1628237053"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; changed&quot;</span><span>
</span><a name="line-1151"></a><span>    </span><a href="MkIface.html#checkModuleFingerprint"><span class="hs-identifier hs-var">checkModuleFingerprint</span></a><span> </span><a href="#local-1628237056"><span class="hs-identifier hs-var">reason</span></a><span> </span><a href="#local-1628237054"><span class="hs-identifier hs-var">old_mod_hash</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_mod_hash</span><span> </span><a href="#local-1628237055"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span>
</span><a name="line-1152"></a><span>        </span><span class="hs-comment">-- We only track the ABI hash of package modules, rather than</span><span>
</span><a name="line-1153"></a><span>        </span><span class="hs-comment">-- individual entity usages, so if the ABI hash changes we must</span><span>
</span><a name="line-1154"></a><span>        </span><span class="hs-comment">-- recompile.  This is safe but may entail more recompilation when</span><span>
</span><a name="line-1155"></a><span>        </span><span class="hs-comment">-- a dependent package has changed.</span><span>
</span><a name="line-1156"></a><span>
</span><a name="line-1157"></a><span class="hs-identifier">checkModUsage</span><span> </span><a name="local-1628237057"><a href="#local-1628237057"><span class="hs-identifier">this_pkg</span></a></a><span> </span><a href="HscTypes.html#UsageHomeModule"><span class="hs-identifier hs-var">UsageHomeModule</span></a><span class="hs-special">{</span><span>
</span><a name="line-1158"></a><span>                                </span><span class="hs-identifier">usg_mod_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237058"><a href="#local-1628237058"><span class="hs-identifier">mod_name</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1159"></a><span>                                </span><span class="hs-identifier">usg_mod_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237059"><a href="#local-1628237059"><span class="hs-identifier">old_mod_hash</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1160"></a><span>                                </span><span class="hs-identifier">usg_exports</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237060"><a href="#local-1628237060"><span class="hs-identifier">maybe_old_export_hash</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1161"></a><span>                                </span><span class="hs-identifier">usg_entities</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237061"><a href="#local-1628237061"><span class="hs-identifier">old_decl_hash</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1162"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1163"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1628237062"><a href="#local-1628237062"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span> </span><a href="#local-1628237057"><span class="hs-identifier hs-var">this_pkg</span></a><span> </span><a href="#local-1628237058"><span class="hs-identifier hs-var">mod_name</span></a><span>
</span><a name="line-1164"></a><span>    </span><a href="MkIface.html#needInterface"><span class="hs-identifier hs-var">needInterface</span></a><span> </span><a href="#local-1628237062"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a name="local-1628237063"><a href="#local-1628237063"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1165"></a><span>
</span><a name="line-1166"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-1167"></a><span>        </span><a name="local-1628237064"><a href="#local-1628237064"><span class="hs-identifier">new_mod_hash</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mi_mod_hash</span><span>    </span><a href="#local-1628237063"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-1168"></a><span>        </span><a name="local-1628237065"><a href="#local-1628237065"><span class="hs-identifier">new_decl_hash</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mi_hash_fn</span><span>     </span><a href="#local-1628237063"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-1169"></a><span>        </span><a name="local-1628237066"><a href="#local-1628237066"><span class="hs-identifier">new_export_hash</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mi_exp_hash</span><span>    </span><a href="#local-1628237063"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-1170"></a><span>
</span><a name="line-1171"></a><span>        </span><a name="local-1628237067"><a href="#local-1628237067"><span class="hs-identifier">reason</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a><span> </span><a href="#local-1628237058"><span class="hs-identifier hs-var">mod_name</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; changed&quot;</span><span>
</span><a name="line-1172"></a><span>
</span><a name="line-1173"></a><span>        </span><span class="hs-comment">-- CHECK MODULE</span><span>
</span><a name="line-1174"></a><span>    </span><a name="local-1628237068"><a href="#local-1628237068"><span class="hs-identifier">recompile</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MkIface.html#checkModuleFingerprint"><span class="hs-identifier hs-var">checkModuleFingerprint</span></a><span> </span><a href="#local-1628237067"><span class="hs-identifier hs-var">reason</span></a><span> </span><a href="#local-1628237059"><span class="hs-identifier hs-var">old_mod_hash</span></a><span> </span><a href="#local-1628237064"><span class="hs-identifier hs-var">new_mod_hash</span></a><span>
</span><a name="line-1175"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#recompileRequired"><span class="hs-identifier hs-var">recompileRequired</span></a><span> </span><a href="#local-1628237068"><span class="hs-identifier hs-var">recompile</span></a><span class="hs-special">)</span><span>
</span><a name="line-1176"></a><span>      </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="MkIface.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a><span>
</span><a name="line-1177"></a><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1178"></a><span>
</span><a name="line-1179"></a><span>        </span><span class="hs-comment">-- CHECK EXPORT LIST</span><span>
</span><a name="line-1180"></a><span>        </span><a href="MkIface.html#checkMaybeHash"><span class="hs-identifier hs-var">checkMaybeHash</span></a><span> </span><a href="#local-1628237067"><span class="hs-identifier hs-var">reason</span></a><span> </span><a href="#local-1628237060"><span class="hs-identifier hs-var">maybe_old_export_hash</span></a><span> </span><a href="#local-1628237066"><span class="hs-identifier hs-var">new_export_hash</span></a><span>
</span><a name="line-1181"></a><span>            </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;  Export list changed&quot;</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1182"></a><span>
</span><a name="line-1183"></a><span>        </span><span class="hs-comment">-- CHECK ITEMS ONE BY ONE</span><span>
</span><a name="line-1184"></a><span>        </span><a name="local-1628237070"><a href="#local-1628237070"><span class="hs-identifier">recompile</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MkIface.html#checkList"><span class="hs-identifier hs-var">checkList</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="MkIface.html#checkEntityUsage"><span class="hs-identifier hs-var">checkEntityUsage</span></a><span> </span><a href="#local-1628237067"><span class="hs-identifier hs-var">reason</span></a><span> </span><a href="#local-1628237065"><span class="hs-identifier hs-var">new_decl_hash</span></a><span> </span><a href="#local-1628237069"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-1185"></a><span>                               </span><span class="hs-glyph">|</span><span> </span><a name="local-1628237069"><a href="#local-1628237069"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628237061"><span class="hs-identifier hs-var">old_decl_hash</span></a><span class="hs-special">]</span><span>
</span><a name="line-1186"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="MkIface.html#recompileRequired"><span class="hs-identifier hs-var">recompileRequired</span></a><span> </span><a href="#local-1628237070"><span class="hs-identifier hs-var">recompile</span></a><span>
</span><a name="line-1187"></a><span>          </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628237070"><span class="hs-identifier hs-var">recompile</span></a><span>     </span><span class="hs-comment">-- This one failed, so just bail out now</span><span>
</span><a name="line-1188"></a><span>          </span><span class="hs-keyword">else</span><span> </span><a href="MkIface.html#up_to_date"><span class="hs-identifier hs-var">up_to_date</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;  Great!  The bits I use are up to date&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1189"></a><span>
</span><a name="line-1190"></a><span>
</span><a name="line-1191"></a><span class="hs-identifier">checkModUsage</span><span> </span><a name="local-1628237071"><a href="#local-1628237071"><span class="hs-identifier">_this_pkg</span></a></a><span> </span><a href="HscTypes.html#UsageFile"><span class="hs-identifier hs-var">UsageFile</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">usg_file_path</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237072"><a href="#local-1628237072"><span class="hs-identifier">file</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1192"></a><span>                                   </span><span class="hs-identifier">usg_file_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237073"><a href="#local-1628237073"><span class="hs-identifier">old_hash</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1193"></a><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1194"></a><span>    </span><a href="Exception.html#handleIO"><span class="hs-identifier hs-var">handleIO</span></a><span> </span><a href="#local-1628237075"><span class="hs-identifier hs-var">handle</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1195"></a><span>      </span><a name="local-1628237077"><a href="#local-1628237077"><span class="hs-identifier">new_hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.html#getFileHash"><span class="hs-identifier hs-var">getFileHash</span></a><span> </span><a href="#local-1628237072"><span class="hs-identifier hs-var">file</span></a><span>
</span><a name="line-1196"></a><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-1628237073"><span class="hs-identifier hs-var">old_hash</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1628237077"><span class="hs-identifier hs-var">new_hash</span></a><span class="hs-special">)</span><span>
</span><a name="line-1197"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628237074"><span class="hs-identifier hs-var">recomp</span></a><span>
</span><a name="line-1198"></a><span>         </span><span class="hs-keyword">else</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="MkIface.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a><span>
</span><a name="line-1199"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1200"></a><span>   </span><a name="local-1628237074"><a href="#local-1628237074"><span class="hs-identifier">recomp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#RecompBecause"><span class="hs-identifier hs-var">RecompBecause</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628237072"><span class="hs-identifier hs-var">file</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot; changed&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1201"></a><span>   </span><a name="local-1628237075"><a href="#local-1628237075"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1202"></a><span class="hs-cpp">#ifdef DEBUG</span><span>
</span><a name="line-1203"></a><span>       </span><span class="hs-glyph">\</span><a name="local-1628237076"><a href="#local-1628237076"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprTrace"><span class="hs-identifier hs-var">pprTrace</span></a><span> </span><span class="hs-string">&quot;UsageFile&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-1628237076"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628237074"><span class="hs-identifier hs-var">recomp</span></a><span>
</span><a name="line-1204"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-1205"></a><span>       </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">recomp</span><span> </span><span class="hs-comment">-- if we can't find the file, just recompile, don't fail</span><span>
</span><a name="line-1206"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1207"></a><span>
</span><a name="line-1208"></a><span class="hs-comment">------------------------</span><span>
</span><a name="line-1209"></a><span class="hs-identifier">checkModuleFingerprint</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span>
</span><a name="line-1210"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span>
</span><a name="line-1211"></a><a name="checkModuleFingerprint"><a href="MkIface.html#checkModuleFingerprint"><span class="hs-identifier">checkModuleFingerprint</span></a></a><span> </span><a name="local-1628237078"><a href="#local-1628237078"><span class="hs-identifier">reason</span></a></a><span> </span><a name="local-1628237079"><a href="#local-1628237079"><span class="hs-identifier">old_mod_hash</span></a></a><span> </span><a name="local-1628237080"><a href="#local-1628237080"><span class="hs-identifier">new_mod_hash</span></a></a><span>
</span><a name="line-1212"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628237080"><span class="hs-identifier hs-var">new_mod_hash</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628237079"><span class="hs-identifier hs-var">old_mod_hash</span></a><span>
</span><a name="line-1213"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#up_to_date"><span class="hs-identifier hs-var">up_to_date</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Module fingerprint unchanged&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1214"></a><span>
</span><a name="line-1215"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1216"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#out_of_date_hash"><span class="hs-identifier hs-var">out_of_date_hash</span></a><span> </span><a href="#local-1628237078"><span class="hs-identifier hs-var">reason</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;  Module fingerprint has changed&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><span>                     </span><a href="#local-1628237079"><span class="hs-identifier hs-var">old_mod_hash</span></a><span> </span><a href="#local-1628237080"><span class="hs-identifier hs-var">new_mod_hash</span></a><span>
</span><a name="line-1218"></a><span>
</span><a name="line-1219"></a><span class="hs-comment">------------------------</span><span>
</span><a name="line-1220"></a><span class="hs-identifier">checkMaybeHash</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1221"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span>
</span><a name="line-1222"></a><a name="checkMaybeHash"><a href="MkIface.html#checkMaybeHash"><span class="hs-identifier">checkMaybeHash</span></a></a><span> </span><a name="local-1628237081"><a href="#local-1628237081"><span class="hs-identifier">reason</span></a></a><span> </span><a name="local-1628237082"><a href="#local-1628237082"><span class="hs-identifier">maybe_old_hash</span></a></a><span> </span><a name="local-1628237083"><a href="#local-1628237083"><span class="hs-identifier">new_hash</span></a></a><span> </span><a name="local-1628237084"><a href="#local-1628237084"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-1628237085"><a href="#local-1628237085"><span class="hs-identifier">continue</span></a></a><span>
</span><a name="line-1223"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237086"><a href="#local-1628237086"><span class="hs-identifier">hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628237082"><span class="hs-identifier hs-var">maybe_old_hash</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628237086"><span class="hs-identifier hs-var">hash</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-1628237083"><span class="hs-identifier hs-var">new_hash</span></a><span>
</span><a name="line-1224"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#out_of_date_hash"><span class="hs-identifier hs-var">out_of_date_hash</span></a><span> </span><a href="#local-1628237081"><span class="hs-identifier hs-var">reason</span></a><span> </span><a href="#local-1628237084"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-1628237086"><span class="hs-identifier hs-var">hash</span></a><span> </span><a href="#local-1628237083"><span class="hs-identifier hs-var">new_hash</span></a><span>
</span><a name="line-1225"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1226"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237085"><span class="hs-identifier hs-var">continue</span></a><span>
</span><a name="line-1227"></a><span>
</span><a name="line-1228"></a><span class="hs-comment">------------------------</span><span>
</span><a name="line-1229"></a><span class="hs-identifier">checkEntityUsage</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span>
</span><a name="line-1230"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1231"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span class="hs-special">)</span><span>
</span><a name="line-1232"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span>
</span><a name="line-1233"></a><a name="checkEntityUsage"><a href="MkIface.html#checkEntityUsage"><span class="hs-identifier">checkEntityUsage</span></a></a><span> </span><a name="local-1628237087"><a href="#local-1628237087"><span class="hs-identifier">reason</span></a></a><span> </span><a name="local-1628237088"><a href="#local-1628237088"><span class="hs-identifier">new_hash</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628237089"><a href="#local-1628237089"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><a name="local-1628237090"><a href="#local-1628237090"><span class="hs-identifier">old_hash</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1234"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237088"><span class="hs-identifier hs-var">new_hash</span></a><span> </span><a href="#local-1628237089"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1235"></a><span>
</span><a name="line-1236"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span>        </span><span class="hs-comment">-- We used it before, but it ain't there now</span><span>
</span><a name="line-1237"></a><span>                          </span><a href="MkIface.html#out_of_date"><span class="hs-identifier hs-var">out_of_date</span></a><span> </span><a href="#local-1628237087"><span class="hs-identifier hs-var">reason</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;No longer exported:&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237089"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1238"></a><span>
</span><a name="line-1239"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628237091"><a href="#local-1628237091"><span class="hs-identifier">new_hash</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- It's there, but is it up to date?</span><span>
</span><a name="line-1240"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628237091"><span class="hs-identifier hs-var">new_hash</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-1628237090"><span class="hs-identifier hs-var">old_hash</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="TcRnMonad.html#traceHiDiffs"><span class="hs-identifier hs-var">traceHiDiffs</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;  Up to date&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237089"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237091"><span class="hs-identifier hs-var">new_hash</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1241"></a><span>                                       </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="MkIface.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a><span>
</span><a name="line-1242"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#out_of_date_hash"><span class="hs-identifier hs-var">out_of_date_hash</span></a><span> </span><a href="#local-1628237087"><span class="hs-identifier hs-var">reason</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;  Out of date:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237089"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1243"></a><span>                                                     </span><a href="#local-1628237090"><span class="hs-identifier hs-var">old_hash</span></a><span> </span><a href="#local-1628237091"><span class="hs-identifier hs-var">new_hash</span></a><span>
</span><a name="line-1244"></a><span>
</span><a name="line-1245"></a><span class="hs-identifier">up_to_date</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span>
</span><a name="line-1246"></a><a name="up_to_date"><a href="MkIface.html#up_to_date"><span class="hs-identifier">up_to_date</span></a></a><span>  </span><a name="local-1628237092"><a href="#local-1628237092"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#traceHiDiffs"><span class="hs-identifier hs-var">traceHiDiffs</span></a><span> </span><a href="#local-1628237092"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="MkIface.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a><span>
</span><a name="line-1247"></a><span>
</span><a name="line-1248"></a><span class="hs-identifier">out_of_date</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span>
</span><a name="line-1249"></a><a name="out_of_date"><a href="MkIface.html#out_of_date"><span class="hs-identifier">out_of_date</span></a></a><span> </span><a name="local-1628237093"><a href="#local-1628237093"><span class="hs-identifier">reason</span></a></a><span> </span><a name="local-1628237094"><a href="#local-1628237094"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#traceHiDiffs"><span class="hs-identifier hs-var">traceHiDiffs</span></a><span> </span><a href="#local-1628237094"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#RecompBecause"><span class="hs-identifier hs-var">RecompBecause</span></a><span> </span><a href="#local-1628237093"><span class="hs-identifier hs-var">reason</span></a><span class="hs-special">)</span><span>
</span><a name="line-1250"></a><span>
</span><a name="line-1251"></a><span class="hs-identifier">out_of_date_hash</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span>
</span><a name="line-1252"></a><a name="out_of_date_hash"><a href="MkIface.html#out_of_date_hash"><span class="hs-identifier">out_of_date_hash</span></a></a><span> </span><a name="local-1628237095"><a href="#local-1628237095"><span class="hs-identifier">reason</span></a></a><span> </span><a name="local-1628237096"><a href="#local-1628237096"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-1628237097"><a href="#local-1628237097"><span class="hs-identifier">old_hash</span></a></a><span> </span><a name="local-1628237098"><a href="#local-1628237098"><span class="hs-identifier">new_hash</span></a></a><span>
</span><a name="line-1253"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#out_of_date"><span class="hs-identifier hs-var">out_of_date</span></a><span> </span><a href="#local-1628237095"><span class="hs-identifier hs-var">reason</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628237096"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237097"><span class="hs-identifier hs-var">old_hash</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;-&gt;&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237098"><span class="hs-identifier hs-var">new_hash</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1254"></a><span>
</span><a name="line-1255"></a><span class="hs-comment">----------------------</span><span>
</span><a name="line-1256"></a><span class="hs-identifier">checkList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="MkIface.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a><span>
</span><a name="line-1257"></a><span class="hs-comment">-- This helper is used in two places</span><span>
</span><a name="line-1258"></a><a name="checkList"><a href="MkIface.html#checkList"><span class="hs-identifier">checkList</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="MkIface.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a><span>
</span><a name="line-1259"></a><span class="hs-identifier">checkList</span><span> </span><span class="hs-special">(</span><a name="local-1628237099"><a href="#local-1628237099"><span class="hs-identifier">check</span></a></a><span class="hs-glyph">:</span><a name="local-1628237100"><a href="#local-1628237100"><span class="hs-identifier">checks</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-1628237101"><a href="#local-1628237101"><span class="hs-identifier">recompile</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628237099"><span class="hs-identifier hs-var">check</span></a><span>
</span><a name="line-1260"></a><span>                              </span><span class="hs-keyword">if</span><span> </span><a href="MkIface.html#recompileRequired"><span class="hs-identifier hs-var">recompileRequired</span></a><span> </span><a href="#local-1628237101"><span class="hs-identifier hs-var">recompile</span></a><span>
</span><a name="line-1261"></a><span>                                </span><span class="hs-keyword">then</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-1628237101"><span class="hs-identifier hs-var">recompile</span></a><span>
</span><a name="line-1262"></a><span>                                </span><span class="hs-keyword">else</span><span> </span><a href="MkIface.html#checkList"><span class="hs-identifier hs-var">checkList</span></a><span> </span><a href="#local-1628237100"><span class="hs-identifier hs-var">checks</span></a><span>
</span><a name="line-1263"></a><span>
</span><a name="line-1264"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Converting things to their Iface equivalents
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1271"></a><span>
</span><a name="line-1272"></a><span class="hs-identifier">tyThingToIfaceDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span>
</span><a name="line-1273"></a><a name="tyThingToIfaceDecl"><a href="MkIface.html#tyThingToIfaceDecl"><span class="hs-identifier">tyThingToIfaceDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-1628237102"><a href="#local-1628237102"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#idToIfaceDecl"><span class="hs-identifier hs-var">idToIfaceDecl</span></a><span> </span><a href="#local-1628237102"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-1274"></a><span class="hs-identifier">tyThingToIfaceDecl</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-1628237103"><a href="#local-1628237103"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#tyConToIfaceDecl"><span class="hs-identifier hs-var">tyConToIfaceDecl</span></a><span> </span><a href="VarEnv.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a><span> </span><a href="#local-1628237103"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-1275"></a><span class="hs-identifier">tyThingToIfaceDecl</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">ACoAxiom</span></a><span> </span><a name="local-1628237104"><a href="#local-1628237104"><span class="hs-identifier">ax</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#coAxiomToIfaceDecl"><span class="hs-identifier hs-var">coAxiomToIfaceDecl</span></a><span> </span><a href="#local-1628237104"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-1276"></a><span class="hs-identifier">tyThingToIfaceDecl</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><a name="local-1628237105"><a href="#local-1628237105"><span class="hs-identifier">cl</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237105"><span class="hs-identifier hs-var">cl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1277"></a><span>    </span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a name="local-1628237106"><a href="#local-1628237106"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#dataConToIfaceDecl"><span class="hs-identifier hs-var">dataConToIfaceDecl</span></a><span> </span><a href="#local-1628237106"><span class="hs-identifier hs-var">dc</span></a><span> </span><span class="hs-comment">-- for ppr purposes only</span><span>
</span><a name="line-1278"></a><span>    </span><a href="ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a><span> </span><a name="local-1628237107"><a href="#local-1628237107"><span class="hs-identifier">ps</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#patSynToIfaceDecl"><span class="hs-identifier hs-var">patSynToIfaceDecl</span></a><span> </span><a href="#local-1628237107"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-1279"></a><span>
</span><a name="line-1280"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1281"></a><span class="hs-identifier">idToIfaceDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span>
</span><a name="line-1282"></a><span class="hs-comment">-- The Id is already tidied, so that locally-bound names</span><span>
</span><a name="line-1283"></a><span class="hs-comment">-- (lambdas, for-alls) already have non-clashing OccNames</span><span>
</span><a name="line-1284"></a><span class="hs-comment">-- We can't tidy it here, locally, because it may have</span><span>
</span><a name="line-1285"></a><span class="hs-comment">-- free variables in its type or IdInfo</span><span>
</span><a name="line-1286"></a><a name="idToIfaceDecl"><a href="MkIface.html#idToIfaceDecl"><span class="hs-identifier">idToIfaceDecl</span></a></a><span> </span><a name="local-1628237108"><a href="#local-1628237108"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-1287"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceId"><span class="hs-identifier hs-var">IfaceId</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifName</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628237108"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span>
</span><a name="line-1288"></a><span>              </span><span class="hs-identifier">ifType</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#toIfaceType"><span class="hs-identifier hs-var">toIfaceType</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628237108"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1289"></a><span>              </span><span class="hs-identifier">ifIdDetails</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#toIfaceIdDetails"><span class="hs-identifier hs-var">toIfaceIdDetails</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a><span> </span><a href="#local-1628237108"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1290"></a><span>              </span><span class="hs-identifier">ifIdInfo</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#toIfaceIdInfo"><span class="hs-identifier hs-var">toIfaceIdInfo</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-1628237108"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1291"></a><span>
</span><a name="line-1292"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1293"></a><span class="hs-identifier">dataConToIfaceDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span>
</span><a name="line-1294"></a><a name="dataConToIfaceDecl"><a href="MkIface.html#dataConToIfaceDecl"><span class="hs-identifier">dataConToIfaceDecl</span></a></a><span> </span><a name="local-1628237109"><a href="#local-1628237109"><span class="hs-identifier">dataCon</span></a></a><span>
</span><a name="line-1295"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceId"><span class="hs-identifier hs-var">IfaceId</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifName</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628237109"><span class="hs-identifier hs-var">dataCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1296"></a><span>              </span><span class="hs-identifier">ifType</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#toIfaceType"><span class="hs-identifier hs-var">toIfaceType</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConUserType"><span class="hs-identifier hs-var">dataConUserType</span></a><span> </span><a href="#local-1628237109"><span class="hs-identifier hs-var">dataCon</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1297"></a><span>              </span><span class="hs-identifier">ifIdDetails</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfVanillaId"><span class="hs-identifier hs-var">IfVanillaId</span></a><span class="hs-special">,</span><span>
</span><a name="line-1298"></a><span>              </span><span class="hs-identifier">ifIdInfo</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1299"></a><span>
</span><a name="line-1300"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1301"></a><span class="hs-identifier">patSynToIfaceDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span>
</span><a name="line-1302"></a><a name="patSynToIfaceDecl"><a href="MkIface.html#patSynToIfaceDecl"><span class="hs-identifier">patSynToIfaceDecl</span></a></a><span> </span><a name="local-1628237110"><a href="#local-1628237110"><span class="hs-identifier">ps</span></a></a><span>
</span><a name="line-1303"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfacePatSyn"><span class="hs-identifier hs-var">IfacePatSyn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifName</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="#local-1628237110"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-1304"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatMatcher</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237121"><span class="hs-identifier hs-var">to_if_pr</span></a><span> </span><span class="hs-special">(</span><a href="PatSyn.html#patSynMatcher"><span class="hs-identifier hs-var">patSynMatcher</span></a><span> </span><a href="#local-1628237110"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1305"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatBuilder</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="#local-1628237121"><span class="hs-identifier hs-var">to_if_pr</span></a><span> </span><span class="hs-special">(</span><a href="PatSyn.html#patSynBuilder"><span class="hs-identifier hs-var">patSynBuilder</span></a><span> </span><a href="#local-1628237110"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1306"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatIsInfix</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PatSyn.html#patSynIsInfix"><span class="hs-identifier hs-var">patSynIsInfix</span></a><span> </span><a href="#local-1628237110"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-1307"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatUnivTvs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#toIfaceTvBndrs"><span class="hs-identifier hs-var">toIfaceTvBndrs</span></a><span> </span><a href="#local-1628237118"><span class="hs-identifier hs-var">univ_tvs'</span></a><span>
</span><a name="line-1308"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatExTvs</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#toIfaceTvBndrs"><span class="hs-identifier hs-var">toIfaceTvBndrs</span></a><span> </span><a href="#local-1628237120"><span class="hs-identifier hs-var">ex_tvs'</span></a><span>
</span><a name="line-1309"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatProvCtxt</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyToIfaceContext"><span class="hs-identifier hs-var">tidyToIfaceContext</span></a><span> </span><a href="#local-1628237119"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-1628237114"><span class="hs-identifier hs-var">prov_theta</span></a><span>
</span><a name="line-1310"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatReqCtxt</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyToIfaceContext"><span class="hs-identifier hs-var">tidyToIfaceContext</span></a><span> </span><a href="#local-1628237119"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-1628237112"><span class="hs-identifier hs-var">req_theta</span></a><span>
</span><a name="line-1311"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatArgs</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier hs-var">tidyToIfaceType</span></a><span> </span><a href="#local-1628237119"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628237115"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1312"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifPatTy</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier hs-var">tidyToIfaceType</span></a><span> </span><a href="#local-1628237119"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-1628237116"><span class="hs-identifier hs-var">rhs_ty</span></a><span>
</span><a name="line-1313"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifFieldLabels</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="PatSyn.html#patSynFieldLabels"><span class="hs-identifier hs-var">patSynFieldLabels</span></a><span> </span><a href="#local-1628237110"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1314"></a><span>                </span><span class="hs-special">}</span><span>
</span><a name="line-1315"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1316"></a><span>    </span><span class="hs-special">(</span><a name="local-1628237111"><a href="#local-1628237111"><span class="hs-identifier">univ_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237112"><a href="#local-1628237112"><span class="hs-identifier">req_theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237113"><a href="#local-1628237113"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237114"><a href="#local-1628237114"><span class="hs-identifier">prov_theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237115"><a href="#local-1628237115"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237116"><a href="#local-1628237116"><span class="hs-identifier">rhs_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PatSyn.html#patSynSig"><span class="hs-identifier hs-var">patSynSig</span></a><span> </span><a href="#local-1628237110"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-1317"></a><span>    </span><span class="hs-special">(</span><a name="local-1628237117"><a href="#local-1628237117"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237118"><a href="#local-1628237118"><span class="hs-identifier">univ_tvs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyTyCoVarBndrs"><span class="hs-identifier hs-var">tidyTyCoVarBndrs</span></a><span> </span><a href="VarEnv.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a><span> </span><a href="#local-1628237111"><span class="hs-identifier hs-var">univ_tvs</span></a><span>
</span><a name="line-1318"></a><span>    </span><span class="hs-special">(</span><a name="local-1628237119"><a href="#local-1628237119"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237120"><a href="#local-1628237120"><span class="hs-identifier">ex_tvs'</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyTyCoVarBndrs"><span class="hs-identifier hs-var">tidyTyCoVarBndrs</span></a><span> </span><a href="#local-1628237117"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-1628237113"><span class="hs-identifier hs-var">ex_tvs</span></a><span>
</span><a name="line-1319"></a><span>    </span><a name="local-1628237121"><a href="#local-1628237121"><span class="hs-identifier">to_if_pr</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628237122"><a href="#local-1628237122"><span class="hs-identifier">id</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237123"><a href="#local-1628237123"><span class="hs-identifier">needs_dummy</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628237122"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628237123"><span class="hs-identifier hs-var">needs_dummy</span></a><span class="hs-special">)</span><span>
</span><a name="line-1320"></a><span>
</span><a name="line-1321"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1322"></a><span class="hs-identifier">coAxiomToIfaceDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="#local-1628236735"><span class="hs-identifier hs-type">br</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span>
</span><a name="line-1323"></a><span class="hs-comment">-- We *do* tidy Axioms, because they are not (and cannot</span><span>
</span><a name="line-1324"></a><span class="hs-comment">-- conveniently be) built in tidy form</span><span>
</span><a name="line-1325"></a><a name="coAxiomToIfaceDecl"><a href="MkIface.html#coAxiomToIfaceDecl"><span class="hs-identifier">coAxiomToIfaceDecl</span></a></a><span> </span><a name="local-1628237124"><a href="#local-1628237124"><span class="hs-identifier">ax</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-var">CoAxiom</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">co_ax_tc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237125"><a href="#local-1628237125"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">co_ax_branches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237126"><a href="#local-1628237126"><span class="hs-identifier">branches</span></a></a><span>
</span><a name="line-1326"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">co_ax_role</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237127"><a href="#local-1628237127"><span class="hs-identifier">role</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1327"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceAxiom"><span class="hs-identifier hs-var">IfaceAxiom</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifName</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237129"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1328"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifTyCon</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#toIfaceTyCon"><span class="hs-identifier hs-var">toIfaceTyCon</span></a><span> </span><a href="#local-1628237125"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1329"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifRole</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237127"><span class="hs-identifier hs-var">role</span></a><span>
</span><a name="line-1330"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifAxBranches</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#coAxBranchToIfaceBranch"><span class="hs-identifier hs-var">coAxBranchToIfaceBranch</span></a><span> </span><a href="#local-1628237125"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1331"></a><span>                                     </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="CoAxiom.html#coAxBranchLHS"><span class="hs-identifier hs-var">coAxBranchLHS</span></a><span> </span><a href="#local-1628237128"><span class="hs-identifier hs-var">branch_list</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1332"></a><span>                                   </span><a href="#local-1628237128"><span class="hs-identifier hs-var">branch_list</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1333"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1334"></a><span>   </span><a name="local-1628237128"><a href="#local-1628237128"><span class="hs-identifier">branch_list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#fromBranches"><span class="hs-identifier hs-var">fromBranches</span></a><span> </span><a href="#local-1628237126"><span class="hs-identifier hs-var">branches</span></a><span>
</span><a name="line-1335"></a><span>   </span><a name="local-1628237129"><a href="#local-1628237129"><span class="hs-identifier">name</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628237124"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-1336"></a><span>
</span><a name="line-1337"></a><span class="hs-comment">-- 2nd parameter is the list of branch LHSs, for conversion from incompatible branches</span><span>
</span><a name="line-1338"></a><span class="hs-comment">-- to incompatible indices</span><span>
</span><a name="line-1339"></a><span class="hs-comment">-- See Note [Storing compatibility] in CoAxiom</span><span>
</span><a name="line-1340"></a><span class="hs-identifier">coAxBranchToIfaceBranch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceAxBranch"><span class="hs-identifier hs-type">IfaceAxBranch</span></a><span>
</span><a name="line-1341"></a><a name="coAxBranchToIfaceBranch"><a href="MkIface.html#coAxBranchToIfaceBranch"><span class="hs-identifier">coAxBranchToIfaceBranch</span></a></a><span> </span><a name="local-1628237130"><a href="#local-1628237130"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1628237131"><a href="#local-1628237131"><span class="hs-identifier">lhs_s</span></a></a><span>
</span><a name="line-1342"></a><span>                        </span><a name="local-1628237132"><a href="#local-1628237132"><span class="hs-identifier">branch</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoAxiom.html#CoAxBranch"><span class="hs-identifier hs-var">CoAxBranch</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cab_incomps</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237133"><a href="#local-1628237133"><span class="hs-identifier">incomps</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1343"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#coAxBranchToIfaceBranch%27"><span class="hs-identifier hs-var">coAxBranchToIfaceBranch'</span></a><span> </span><a href="#local-1628237130"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1628237132"><span class="hs-identifier hs-var">branch</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifaxbIncomps</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237134"><span class="hs-identifier hs-var">iface_incomps</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1344"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1345"></a><span>    </span><a name="local-1628237134"><a href="#local-1628237134"><span class="hs-identifier">iface_incomps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-string">&quot;iface_incomps&quot;</span><span>
</span><a name="line-1346"></a><span>                        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#findIndex"><span class="hs-identifier hs-var">findIndex</span></a><span> </span><a href="#local-1628237131"><span class="hs-identifier hs-var">lhs_s</span></a><span>
</span><a name="line-1347"></a><span>                          </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="Type.html#eqTypes"><span class="hs-identifier hs-var">eqTypes</span></a><span class="hs-special">)</span><span>
</span><a name="line-1348"></a><span>                        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="CoAxiom.html#coAxBranchLHS"><span class="hs-identifier hs-var">coAxBranchLHS</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628237133"><span class="hs-identifier hs-var">incomps</span></a><span>
</span><a name="line-1349"></a><span>
</span><a name="line-1350"></a><span class="hs-comment">-- use this one for standalone branches without incompatibles</span><span>
</span><a name="line-1351"></a><span class="hs-identifier">coAxBranchToIfaceBranch'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceAxBranch"><span class="hs-identifier hs-type">IfaceAxBranch</span></a><span>
</span><a name="line-1352"></a><a name="coAxBranchToIfaceBranch%27"><a href="MkIface.html#coAxBranchToIfaceBranch%27"><span class="hs-identifier">coAxBranchToIfaceBranch'</span></a></a><span> </span><a name="local-1628237135"><a href="#local-1628237135"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#CoAxBranch"><span class="hs-identifier hs-var">CoAxBranch</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cab_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237136"><a href="#local-1628237136"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_cvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237137"><a href="#local-1628237137"><span class="hs-identifier">cvs</span></a></a><span>
</span><a name="line-1353"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237138"><a href="#local-1628237138"><span class="hs-identifier">lhs</span></a></a><span>
</span><a name="line-1354"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_roles</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237139"><a href="#local-1628237139"><span class="hs-identifier">roles</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cab_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237140"><a href="#local-1628237140"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1355"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceAxBranch"><span class="hs-identifier hs-var">IfaceAxBranch</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifaxbTyVars</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#toIfaceTvBndrs"><span class="hs-identifier hs-var">toIfaceTvBndrs</span></a><span> </span><a href="#local-1628237142"><span class="hs-identifier hs-var">tv_bndrs</span></a><span>
</span><a name="line-1356"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaxbCoVars</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="IfaceType.html#toIfaceIdBndr"><span class="hs-identifier hs-var">toIfaceIdBndr</span></a><span> </span><a href="#local-1628237137"><span class="hs-identifier hs-var">cvs</span></a><span>
</span><a name="line-1357"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaxbLHS</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyToIfaceTcArgs"><span class="hs-identifier hs-var">tidyToIfaceTcArgs</span></a><span> </span><a href="#local-1628237141"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-1628237135"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1628237138"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-1358"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaxbRoles</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237139"><span class="hs-identifier hs-var">roles</span></a><span>
</span><a name="line-1359"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaxbRHS</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier hs-var">tidyToIfaceType</span></a><span> </span><a href="#local-1628237141"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-1628237140"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1360"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifaxbIncomps</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1361"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1362"></a><span>
</span><a name="line-1363"></a><span>    </span><span class="hs-special">(</span><a name="local-1628237141"><a href="#local-1628237141"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237142"><a href="#local-1628237142"><span class="hs-identifier">tv_bndrs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyTyClTyCoVarBndrs"><span class="hs-identifier hs-var">tidyTyClTyCoVarBndrs</span></a><span> </span><a href="VarEnv.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a><span> </span><a href="#local-1628237136"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-1364"></a><span>    </span><span class="hs-comment">-- Don't re-bind in-scope tyvars</span><span>
</span><a name="line-1365"></a><span>    </span><span class="hs-comment">-- See Note [CoAxBranch type variables] in CoAxiom</span><span>
</span><a name="line-1366"></a><span>
</span><a name="line-1367"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-1368"></a><span class="hs-identifier">tyConToIfaceDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1369"></a><span class="hs-comment">-- We *do* tidy TyCons, because they are not (and cannot</span><span>
</span><a name="line-1370"></a><span class="hs-comment">-- conveniently be) built in tidy form</span><span>
</span><a name="line-1371"></a><span class="hs-comment">-- The returned TidyEnv is the one after tidying the tyConTyVars</span><span>
</span><a name="line-1372"></a><a name="tyConToIfaceDecl"><a href="MkIface.html#tyConToIfaceDecl"><span class="hs-identifier">tyConToIfaceDecl</span></a></a><span> </span><a name="local-1628237143"><a href="#local-1628237143"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1628237144"><a href="#local-1628237144"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-1373"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237190"><a href="#local-1628237190"><span class="hs-identifier">clas</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1374"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#classToIfaceDecl"><span class="hs-identifier hs-var">classToIfaceDecl</span></a><span> </span><a href="#local-1628237143"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628237190"><span class="hs-identifier hs-var">clas</span></a><span>
</span><a name="line-1375"></a><span>
</span><a name="line-1376"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237191"><a href="#local-1628237191"><span class="hs-identifier">syn_rhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#synTyConRhs_maybe"><span class="hs-identifier hs-var">synTyConRhs_maybe</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1377"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628237145"><span class="hs-identifier hs-var">tc_env1</span></a><span>
</span><a name="line-1378"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="IfaceSyn.html#IfaceSynonym"><span class="hs-identifier hs-var">IfaceSynonym</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifName</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1379"></a><span>                     </span><span class="hs-identifier">ifRoles</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1380"></a><span>                     </span><span class="hs-identifier">ifSynRhs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237149"><span class="hs-identifier hs-var">if_syn_type</span></a><span> </span><a href="#local-1628237191"><span class="hs-identifier hs-var">syn_rhs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1381"></a><span>                     </span><span class="hs-identifier">ifBinders</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237147"><span class="hs-identifier hs-var">if_binders</span></a><span class="hs-special">,</span><span>
</span><a name="line-1382"></a><span>                     </span><span class="hs-identifier">ifResKind</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237148"><span class="hs-identifier hs-var">if_res_kind</span></a><span>
</span><a name="line-1383"></a><span>                   </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1384"></a><span>
</span><a name="line-1385"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237192"><a href="#local-1628237192"><span class="hs-identifier">fam_flav</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#famTyConFlav_maybe"><span class="hs-identifier hs-var">famTyConFlav_maybe</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1386"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628237145"><span class="hs-identifier hs-var">tc_env1</span></a><span>
</span><a name="line-1387"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="IfaceSyn.html#IfaceFamily"><span class="hs-identifier hs-var">IfaceFamily</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifName</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1388"></a><span>                    </span><span class="hs-identifier">ifResVar</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237150"><span class="hs-identifier hs-var">if_res_var</span></a><span class="hs-special">,</span><span>
</span><a name="line-1389"></a><span>                    </span><span class="hs-identifier">ifFamFlav</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237156"><span class="hs-identifier hs-var">to_if_fam_flav</span></a><span> </span><a href="#local-1628237192"><span class="hs-identifier hs-var">fam_flav</span></a><span class="hs-special">,</span><span>
</span><a name="line-1390"></a><span>                    </span><span class="hs-identifier">ifBinders</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237147"><span class="hs-identifier hs-var">if_binders</span></a><span class="hs-special">,</span><span>
</span><a name="line-1391"></a><span>                    </span><span class="hs-identifier">ifResKind</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237148"><span class="hs-identifier hs-var">if_res_kind</span></a><span class="hs-special">,</span><span>
</span><a name="line-1392"></a><span>                    </span><span class="hs-identifier">ifFamInj</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#familyTyConInjectivityInfo"><span class="hs-identifier hs-var">familyTyConInjectivityInfo</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1393"></a><span>                  </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1394"></a><span>
</span><a name="line-1395"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1396"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628237145"><span class="hs-identifier hs-var">tc_env1</span></a><span>
</span><a name="line-1397"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="IfaceSyn.html#IfaceData"><span class="hs-identifier hs-var">IfaceData</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifName</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1398"></a><span>                  </span><span class="hs-identifier">ifBinders</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237147"><span class="hs-identifier hs-var">if_binders</span></a><span class="hs-special">,</span><span>
</span><a name="line-1399"></a><span>                  </span><span class="hs-identifier">ifResKind</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237148"><span class="hs-identifier hs-var">if_res_kind</span></a><span class="hs-special">,</span><span>
</span><a name="line-1400"></a><span>                  </span><span class="hs-identifier">ifCType</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConCType</span><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1401"></a><span>                  </span><span class="hs-identifier">ifRoles</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1402"></a><span>                  </span><span class="hs-identifier">ifCtxt</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyToIfaceContext"><span class="hs-identifier hs-var">tidyToIfaceContext</span></a><span> </span><a href="#local-1628237145"><span class="hs-identifier hs-var">tc_env1</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1403"></a><span>                  </span><span class="hs-identifier">ifCons</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237157"><span class="hs-identifier hs-var">ifaceConDecls</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#algTyConRhs"><span class="hs-identifier hs-var">algTyConRhs</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">algTcFields</span><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1404"></a><span>                  </span><span class="hs-identifier">ifRec</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#boolToRecFlag"><span class="hs-identifier hs-var">boolToRecFlag</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#isRecursiveTyCon"><span class="hs-identifier hs-var">isRecursiveTyCon</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1405"></a><span>                  </span><span class="hs-identifier">ifGadtSyntax</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#isGadtSyntaxTyCon"><span class="hs-identifier hs-var">isGadtSyntaxTyCon</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1406"></a><span>                  </span><span class="hs-identifier">ifParent</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237155"><span class="hs-identifier hs-var">parent</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1407"></a><span>
</span><a name="line-1408"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>  </span><span class="hs-comment">-- FunTyCon, PrimTyCon, promoted TyCon/DataCon</span><span>
</span><a name="line-1409"></a><span>  </span><span class="hs-comment">-- For pretty printing purposes only.</span><span>
</span><a name="line-1410"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628237143"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-1411"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="IfaceSyn.html#IfaceData"><span class="hs-identifier hs-var">IfaceData</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifName</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1412"></a><span>                  </span><span class="hs-identifier">ifBinders</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237153"><span class="hs-identifier hs-var">if_degenerate_binders</span></a><span class="hs-special">,</span><span>
</span><a name="line-1413"></a><span>                  </span><span class="hs-identifier">ifResKind</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237154"><span class="hs-identifier hs-var">if_degenerate_res_kind</span></a><span class="hs-special">,</span><span>
</span><a name="line-1414"></a><span>                    </span><span class="hs-comment">-- These don't have `tyConTyVars`, hence &quot;degenerate&quot;</span><span>
</span><a name="line-1415"></a><span>                  </span><span class="hs-identifier">ifCType</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">,</span><span>
</span><a name="line-1416"></a><span>                  </span><span class="hs-identifier">ifRoles</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1417"></a><span>                  </span><span class="hs-identifier">ifCtxt</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1418"></a><span>                  </span><span class="hs-identifier">ifCons</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfDataTyCon"><span class="hs-identifier hs-var">IfDataTyCon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1419"></a><span>                  </span><span class="hs-identifier">ifRec</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#boolToRecFlag"><span class="hs-identifier hs-var">boolToRecFlag</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-1420"></a><span>                  </span><span class="hs-identifier">ifGadtSyntax</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-1421"></a><span>                  </span><span class="hs-identifier">ifParent</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfNoParent"><span class="hs-identifier hs-var">IfNoParent</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1422"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1423"></a><span>    </span><span class="hs-comment">-- NOTE: Not all TyCons have `tyConTyVars` field. Forcing this when `tycon`</span><span>
</span><a name="line-1424"></a><span>    </span><span class="hs-comment">-- is one of these TyCons (FunTyCon, PrimTyCon, PromotedDataCon) will cause</span><span>
</span><a name="line-1425"></a><span>    </span><span class="hs-comment">-- an error.</span><span>
</span><a name="line-1426"></a><span>    </span><span class="hs-special">(</span><a name="local-1628237145"><a href="#local-1628237145"><span class="hs-identifier">tc_env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237146"><a href="#local-1628237146"><span class="hs-identifier">tc_tyvars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyTyClTyCoVarBndrs"><span class="hs-identifier hs-var">tidyTyClTyCoVarBndrs</span></a><span> </span><a href="#local-1628237143"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-1427"></a><span>    </span><a name="local-1628237147"><a href="#local-1628237147"><span class="hs-identifier">if_binders</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#zipIfaceBinders"><span class="hs-identifier hs-var">zipIfaceBinders</span></a><span> </span><a href="#local-1628237146"><span class="hs-identifier hs-var">tc_tyvars</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConBinders</span><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-1428"></a><span>    </span><a name="local-1628237148"><a href="#local-1628237148"><span class="hs-identifier">if_res_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier hs-var">tidyToIfaceType</span></a><span> </span><a href="#local-1628237145"><span class="hs-identifier hs-var">tc_env1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConResKind</span><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-1429"></a><span>    </span><a name="local-1628237149"><a href="#local-1628237149"><span class="hs-identifier">if_syn_type</span></a></a><span> </span><a name="local-1628237161"><a href="#local-1628237161"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier hs-var">tidyToIfaceType</span></a><span> </span><a href="#local-1628237145"><span class="hs-identifier hs-var">tc_env1</span></a><span> </span><a href="#local-1628237161"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1430"></a><span>    </span><a name="local-1628237150"><a href="#local-1628237150"><span class="hs-identifier">if_res_var</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#getFS"><span class="hs-identifier hs-var">getFS</span></a><span> </span><span class="hs-special">`</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span class="hs-special">`</span><span> </span><a href="TyCon.html#tyConFamilyResVar_maybe"><span class="hs-identifier hs-var">tyConFamilyResVar_maybe</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1431"></a><span>
</span><a name="line-1432"></a><span>      </span><span class="hs-comment">-- use these when you don't have tyConTyVars</span><span>
</span><a name="line-1433"></a><span>    </span><span class="hs-special">(</span><a name="local-1628237151"><a href="#local-1628237151"><span class="hs-identifier">degenerate_binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237152"><a href="#local-1628237152"><span class="hs-identifier">degenerate_res_kind</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1434"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1628237143"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1435"></a><span>    </span><a name="local-1628237153"><a href="#local-1628237153"><span class="hs-identifier">if_degenerate_binders</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#toDegenerateBinders"><span class="hs-identifier hs-var">toDegenerateBinders</span></a><span> </span><a href="#local-1628237151"><span class="hs-identifier hs-var">degenerate_binders</span></a><span>
</span><a name="line-1436"></a><span>    </span><a name="local-1628237154"><a href="#local-1628237154"><span class="hs-identifier">if_degenerate_res_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#toIfaceType"><span class="hs-identifier hs-var">toIfaceType</span></a><span> </span><a href="#local-1628237152"><span class="hs-identifier hs-var">degenerate_res_kind</span></a><span>
</span><a name="line-1437"></a><span>
</span><a name="line-1438"></a><span>    </span><a name="local-1628237155"><a href="#local-1628237155"><span class="hs-identifier">parent</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TyCon.html#tyConFamInstSig_maybe"><span class="hs-identifier hs-var">tyConFamInstSig_maybe</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1439"></a><span>               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a name="local-1628237162"><a href="#local-1628237162"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237163"><a href="#local-1628237163"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237164"><a href="#local-1628237164"><span class="hs-identifier">ax</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfDataInstance"><span class="hs-identifier hs-var">IfDataInstance</span></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#coAxiomName"><span class="hs-identifier hs-var">coAxiomName</span></a><span> </span><a href="#local-1628237164"><span class="hs-identifier hs-var">ax</span></a><span class="hs-special">)</span><span>
</span><a name="line-1440"></a><span>                                                   </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceTyCon"><span class="hs-identifier hs-var">toIfaceTyCon</span></a><span> </span><a href="#local-1628237162"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1441"></a><span>                                                   </span><span class="hs-special">(</span><a href="MkIface.html#tidyToIfaceTcArgs"><span class="hs-identifier hs-var">tidyToIfaceTcArgs</span></a><span> </span><a href="#local-1628237145"><span class="hs-identifier hs-var">tc_env1</span></a><span> </span><a href="#local-1628237162"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-1628237163"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1442"></a><span>               </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfNoParent"><span class="hs-identifier hs-var">IfNoParent</span></a><span>
</span><a name="line-1443"></a><span>
</span><a name="line-1444"></a><span>    </span><a name="local-1628237156"><a href="#local-1628237156"><span class="hs-identifier">to_if_fam_flav</span></a></a><span> </span><a href="TyCon.html#OpenSynFamilyTyCon"><span class="hs-identifier hs-var">OpenSynFamilyTyCon</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceOpenSynFamilyTyCon"><span class="hs-identifier hs-var">IfaceOpenSynFamilyTyCon</span></a><span>
</span><a name="line-1445"></a><span>    </span><span class="hs-identifier">to_if_fam_flav</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-var">ClosedSynFamilyTyCon</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237165"><a href="#local-1628237165"><span class="hs-identifier">ax</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1446"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceClosedSynFamilyTyCon"><span class="hs-identifier hs-var">IfaceClosedSynFamilyTyCon</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628237168"><span class="hs-identifier hs-var">axn</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628237167"><span class="hs-identifier hs-var">ibr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1447"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-1628237166"><a href="#local-1628237166"><span class="hs-identifier">defs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#fromBranches"><span class="hs-identifier hs-var">fromBranches</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoAxiom.html#coAxiomBranches"><span class="hs-identifier hs-var">coAxiomBranches</span></a><span> </span><a href="#local-1628237165"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-1448"></a><span>            </span><a name="local-1628237167"><a href="#local-1628237167"><span class="hs-identifier">ibr</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#coAxBranchToIfaceBranch%27"><span class="hs-identifier hs-var">coAxBranchToIfaceBranch'</span></a><span> </span><a href="#local-1628237144"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628237166"><span class="hs-identifier hs-var">defs</span></a><span>
</span><a name="line-1449"></a><span>            </span><a name="local-1628237168"><a href="#local-1628237168"><span class="hs-identifier">axn</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxiomName"><span class="hs-identifier hs-var">coAxiomName</span></a><span> </span><a href="#local-1628237165"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-1450"></a><span>    </span><span class="hs-identifier">to_if_fam_flav</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-var">ClosedSynFamilyTyCon</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1451"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceClosedSynFamilyTyCon"><span class="hs-identifier hs-var">IfaceClosedSynFamilyTyCon</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1452"></a><span>    </span><span class="hs-identifier">to_if_fam_flav</span><span> </span><a href="TyCon.html#AbstractClosedSynFamilyTyCon"><span class="hs-identifier hs-var">AbstractClosedSynFamilyTyCon</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceAbstractClosedSynFamilyTyCon"><span class="hs-identifier hs-var">IfaceAbstractClosedSynFamilyTyCon</span></a><span>
</span><a name="line-1453"></a><span>    </span><span class="hs-identifier">to_if_fam_flav</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#DataFamilyTyCon"><span class="hs-identifier hs-var">DataFamilyTyCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceDataFamilyTyCon"><span class="hs-identifier hs-var">IfaceDataFamilyTyCon</span></a><span>
</span><a name="line-1454"></a><span>    </span><span class="hs-identifier">to_if_fam_flav</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#BuiltInSynFamTyCon"><span class="hs-identifier hs-var">BuiltInSynFamTyCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceBuiltInSynFamTyCon"><span class="hs-identifier hs-var">IfaceBuiltInSynFamTyCon</span></a><span>
</span><a name="line-1455"></a><span>
</span><a name="line-1456"></a><span>
</span><a name="line-1457"></a><span>
</span><a name="line-1458"></a><span>    </span><a name="local-1628237157"><a href="#local-1628237157"><span class="hs-identifier">ifaceConDecls</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#NewTyCon"><span class="hs-identifier hs-var">NewTyCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">data_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237169"><a href="#local-1628237169"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><a name="local-1628237170"><a href="#local-1628237170"><span class="hs-identifier">flds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfNewTyCon"><span class="hs-identifier hs-var">IfNewTyCon</span></a><span>  </span><span class="hs-special">(</span><a href="#local-1628237158"><span class="hs-identifier hs-var">ifaceConDecl</span></a><span> </span><a href="#local-1628237169"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628237159"><span class="hs-identifier hs-var">ifaceOverloaded</span></a><span> </span><a href="#local-1628237170"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628237160"><span class="hs-identifier hs-var">ifaceFields</span></a><span> </span><a href="#local-1628237170"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1459"></a><span>    </span><span class="hs-identifier">ifaceConDecls</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#DataTyCon"><span class="hs-identifier hs-var">DataTyCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">data_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237171"><a href="#local-1628237171"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-1628237172"><a href="#local-1628237172"><span class="hs-identifier">flds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfDataTyCon"><span class="hs-identifier hs-var">IfDataTyCon</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628237158"><span class="hs-identifier hs-var">ifaceConDecl</span></a><span> </span><a href="#local-1628237171"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628237159"><span class="hs-identifier hs-var">ifaceOverloaded</span></a><span> </span><a href="#local-1628237172"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1628237160"><span class="hs-identifier hs-var">ifaceFields</span></a><span> </span><a href="#local-1628237172"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1460"></a><span>    </span><span class="hs-identifier">ifaceConDecls</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TupleTyCon"><span class="hs-identifier hs-var">TupleTyCon</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">data_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237173"><a href="#local-1628237173"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfDataTyCon"><span class="hs-identifier hs-var">IfDataTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628237158"><span class="hs-identifier hs-var">ifaceConDecl</span></a><span> </span><a href="#local-1628237173"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1461"></a><span>    </span><span class="hs-identifier">ifaceConDecls</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#AbstractTyCon"><span class="hs-identifier hs-var">AbstractTyCon</span></a><span> </span><a name="local-1628237174"><a href="#local-1628237174"><span class="hs-identifier">distinct</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfAbstractTyCon"><span class="hs-identifier hs-var">IfAbstractTyCon</span></a><span> </span><a href="#local-1628237174"><span class="hs-identifier hs-var">distinct</span></a><span>
</span><a name="line-1462"></a><span>        </span><span class="hs-comment">-- The AbstractTyCon case happens when a TyCon has been trimmed</span><span>
</span><a name="line-1463"></a><span>        </span><span class="hs-comment">-- during tidying.</span><span>
</span><a name="line-1464"></a><span>        </span><span class="hs-comment">-- Furthermore, tyThingToIfaceDecl is also used in TcRnDriver</span><span>
</span><a name="line-1465"></a><span>        </span><span class="hs-comment">-- for GHCi, when browsing a module, in which case the</span><span>
</span><a name="line-1466"></a><span>        </span><span class="hs-comment">-- AbstractTyCon and TupleTyCon cases are perfectly sensible.</span><span>
</span><a name="line-1467"></a><span>        </span><span class="hs-comment">-- (Tuple declarations are not serialised into interface files.)</span><span>
</span><a name="line-1468"></a><span>
</span><a name="line-1469"></a><span>    </span><a name="local-1628237158"><a href="#local-1628237158"><span class="hs-identifier">ifaceConDecl</span></a></a><span> </span><a name="local-1628237175"><a href="#local-1628237175"><span class="hs-identifier">data_con</span></a></a><span>
</span><a name="line-1470"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfCon"><span class="hs-identifier hs-var">IfCon</span></a><span>   </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifConOcc</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a><span> </span><a href="#local-1628237175"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1471"></a><span>                    </span><span class="hs-identifier">ifConInfix</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#dataConIsInfix"><span class="hs-identifier hs-var">dataConIsInfix</span></a><span> </span><a href="#local-1628237175"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">,</span><span>
</span><a name="line-1472"></a><span>                    </span><span class="hs-identifier">ifConWrapper</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConWrapId_maybe"><span class="hs-identifier hs-var">dataConWrapId_maybe</span></a><span> </span><a href="#local-1628237175"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1473"></a><span>                    </span><span class="hs-identifier">ifConExTvs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#toIfaceTvBndrs"><span class="hs-identifier hs-var">toIfaceTvBndrs</span></a><span> </span><a href="#local-1628237183"><span class="hs-identifier hs-var">ex_tvs'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1474"></a><span>                    </span><span class="hs-identifier">ifConEqSpec</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628237184"><span class="hs-identifier hs-var">to_eq_spec</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="DataCon.html#eqSpecPair"><span class="hs-identifier hs-var">eqSpecPair</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628237178"><span class="hs-identifier hs-var">eq_spec</span></a><span class="hs-special">,</span><span>
</span><a name="line-1475"></a><span>                    </span><span class="hs-identifier">ifConCtxt</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyToIfaceContext"><span class="hs-identifier hs-var">tidyToIfaceContext</span></a><span> </span><a href="#local-1628237182"><span class="hs-identifier hs-var">con_env2</span></a><span> </span><a href="#local-1628237179"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">,</span><span>
</span><a name="line-1476"></a><span>                    </span><span class="hs-identifier">ifConArgTys</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier hs-var">tidyToIfaceType</span></a><span> </span><a href="#local-1628237182"><span class="hs-identifier hs-var">con_env2</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628237180"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">,</span><span>
</span><a name="line-1477"></a><span>                    </span><span class="hs-identifier">ifConFields</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><span class="hs-identifier">flSelector</span><span class="hs-special">)</span><span>
</span><a name="line-1478"></a><span>                                       </span><span class="hs-special">(</span><a href="DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a><span> </span><a href="#local-1628237175"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1479"></a><span>                    </span><span class="hs-identifier">ifConStricts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceBang"><span class="hs-identifier hs-var">toIfaceBang</span></a><span> </span><a href="#local-1628237182"><span class="hs-identifier hs-var">con_env2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1480"></a><span>                                       </span><span class="hs-special">(</span><a href="DataCon.html#dataConImplBangs"><span class="hs-identifier hs-var">dataConImplBangs</span></a><span> </span><a href="#local-1628237175"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1481"></a><span>                    </span><span class="hs-identifier">ifConSrcStricts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#toIfaceSrcBang"><span class="hs-identifier hs-var">toIfaceSrcBang</span></a><span>
</span><a name="line-1482"></a><span>                                          </span><span class="hs-special">(</span><a href="DataCon.html#dataConSrcBangs"><span class="hs-identifier hs-var">dataConSrcBangs</span></a><span> </span><a href="#local-1628237175"><span class="hs-identifier hs-var">data_con</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-1483"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-1484"></a><span>          </span><span class="hs-special">(</span><a name="local-1628237176"><a href="#local-1628237176"><span class="hs-identifier">univ_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237177"><a href="#local-1628237177"><span class="hs-identifier">ex_tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237178"><a href="#local-1628237178"><span class="hs-identifier">eq_spec</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237179"><a href="#local-1628237179"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237180"><a href="#local-1628237180"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1485"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a><span> </span><a href="#local-1628237175"><span class="hs-identifier hs-var">data_con</span></a><span>
</span><a name="line-1486"></a><span>
</span><a name="line-1487"></a><span>          </span><span class="hs-comment">-- Tidy the univ_tvs of the data constructor to be identical</span><span>
</span><a name="line-1488"></a><span>          </span><span class="hs-comment">-- to the tyConTyVars of the type constructor.  This means</span><span>
</span><a name="line-1489"></a><span>          </span><span class="hs-comment">-- (a) we don't need to redundantly put them into the interface file</span><span>
</span><a name="line-1490"></a><span>          </span><span class="hs-comment">-- (b) when pretty-printing an Iface data declaration in H98-style syntax,</span><span>
</span><a name="line-1491"></a><span>          </span><span class="hs-comment">--     we know that the type variables will line up</span><span>
</span><a name="line-1492"></a><span>          </span><span class="hs-comment">-- The latter (b) is important because we pretty-print type constructors</span><span>
</span><a name="line-1493"></a><span>          </span><span class="hs-comment">-- by converting to IfaceSyn and pretty-printing that</span><span>
</span><a name="line-1494"></a><span>          </span><a name="local-1628237181"><a href="#local-1628237181"><span class="hs-identifier">con_env1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span> </span><a href="#local-1628237145"><span class="hs-identifier hs-var">tc_env1</span></a><span class="hs-special">,</span><span> </span><a href="VarEnv.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a><span> </span><span class="hs-special">(</span><a href="Util.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a><span> </span><span class="hs-string">&quot;ifaceConDecl&quot;</span><span> </span><a href="#local-1628237176"><span class="hs-identifier hs-var">univ_tvs</span></a><span> </span><a href="#local-1628237146"><span class="hs-identifier hs-var">tc_tyvars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1495"></a><span>                     </span><span class="hs-comment">-- A bit grimy, perhaps, but it's simple!</span><span>
</span><a name="line-1496"></a><span>
</span><a name="line-1497"></a><span>          </span><span class="hs-special">(</span><a name="local-1628237182"><a href="#local-1628237182"><span class="hs-identifier">con_env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237183"><a href="#local-1628237183"><span class="hs-identifier">ex_tvs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyTyCoVarBndrs"><span class="hs-identifier hs-var">tidyTyCoVarBndrs</span></a><span> </span><a href="#local-1628237181"><span class="hs-identifier hs-var">con_env1</span></a><span> </span><a href="#local-1628237177"><span class="hs-identifier hs-var">ex_tvs</span></a><span>
</span><a name="line-1498"></a><span>          </span><a name="local-1628237184"><a href="#local-1628237184"><span class="hs-identifier">to_eq_spec</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628237185"><a href="#local-1628237185"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><a name="local-1628237186"><a href="#local-1628237186"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceTyVar"><span class="hs-identifier hs-var">toIfaceTyVar</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#tidyTyVar"><span class="hs-identifier hs-var">tidyTyVar</span></a><span> </span><a href="#local-1628237182"><span class="hs-identifier hs-var">con_env2</span></a><span> </span><a href="#local-1628237185"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier hs-var">tidyToIfaceType</span></a><span> </span><a href="#local-1628237182"><span class="hs-identifier hs-var">con_env2</span></a><span> </span><a href="#local-1628237186"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1499"></a><span>
</span><a name="line-1500"></a><span>    </span><a name="local-1628237159"><a href="#local-1628237159"><span class="hs-identifier">ifaceOverloaded</span></a></a><span> </span><a name="local-1628237187"><a href="#local-1628237187"><span class="hs-identifier">flds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="FastStringEnv.html#fsEnvElts"><span class="hs-identifier hs-var">fsEnvElts</span></a><span> </span><a href="#local-1628237187"><span class="hs-identifier hs-var">flds</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1501"></a><span>                             </span><a name="local-1628237188"><a href="#local-1628237188"><span class="hs-identifier">fl</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">flIsOverloaded</span><span> </span><a href="#local-1628237188"><span class="hs-identifier hs-var">fl</span></a><span>
</span><a name="line-1502"></a><span>                             </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1503"></a><span>    </span><a name="local-1628237160"><a href="#local-1628237160"><span class="hs-identifier">ifaceFields</span></a></a><span> </span><a name="local-1628237189"><a href="#local-1628237189"><span class="hs-identifier">flds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.OldList.html#sort"><span class="hs-identifier hs-var">sort</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-identifier">flLabel</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="FastStringEnv.html#fsEnvElts"><span class="hs-identifier hs-var">fsEnvElts</span></a><span> </span><a href="#local-1628237189"><span class="hs-identifier hs-var">flds</span></a><span>
</span><a name="line-1504"></a><span>                       </span><span class="hs-comment">-- We need to sort the labels because they come out</span><span>
</span><a name="line-1505"></a><span>                       </span><span class="hs-comment">-- of FastStringEnv in arbitrary order, because</span><span>
</span><a name="line-1506"></a><span>                       </span><span class="hs-comment">-- FastStringEnv is keyed on Uniques.</span><span>
</span><a name="line-1507"></a><span>                       </span><span class="hs-comment">-- Sorting FastString is ok here, because Uniques</span><span>
</span><a name="line-1508"></a><span>                       </span><span class="hs-comment">-- are only used for equality checks in the Ord</span><span>
</span><a name="line-1509"></a><span>                       </span><span class="hs-comment">-- instance for FastString.</span><span>
</span><a name="line-1510"></a><span>                       </span><span class="hs-comment">-- See Note [Unique Determinism] in Unique.</span><span>
</span><a name="line-1511"></a><span>
</span><a name="line-1512"></a><span class="hs-identifier">toIfaceBang</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataCon.html#HsImplBang"><span class="hs-identifier hs-type">HsImplBang</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceBang"><span class="hs-identifier hs-type">IfaceBang</span></a><span>
</span><a name="line-1513"></a><a name="toIfaceBang"><a href="MkIface.html#toIfaceBang"><span class="hs-identifier">toIfaceBang</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><a href="DataCon.html#HsLazy"><span class="hs-identifier hs-var">HsLazy</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfNoBang"><span class="hs-identifier hs-var">IfNoBang</span></a><span>
</span><a name="line-1514"></a><span class="hs-identifier">toIfaceBang</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">(</span><a href="DataCon.html#HsUnpack"><span class="hs-identifier hs-var">HsUnpack</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfUnpack"><span class="hs-identifier hs-var">IfUnpack</span></a><span>
</span><a name="line-1515"></a><span class="hs-identifier">toIfaceBang</span><span> </span><a name="local-1628237193"><a href="#local-1628237193"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#HsUnpack"><span class="hs-identifier hs-var">HsUnpack</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237194"><a href="#local-1628237194"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfUnpackCo"><span class="hs-identifier hs-var">IfUnpackCo</span></a><span> </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceCoercion"><span class="hs-identifier hs-var">toIfaceCoercion</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyCo"><span class="hs-identifier hs-var">tidyCo</span></a><span> </span><a href="#local-1628237193"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628237194"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1516"></a><span class="hs-identifier">toIfaceBang</span><span> </span><span class="hs-identifier">_</span><span>   </span><a href="DataCon.html#HsStrict"><span class="hs-identifier hs-var">HsStrict</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfStrict"><span class="hs-identifier hs-var">IfStrict</span></a><span>
</span><a name="line-1517"></a><span>
</span><a name="line-1518"></a><span class="hs-identifier">toIfaceSrcBang</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceSrcBang"><span class="hs-identifier hs-type">IfaceSrcBang</span></a><span>
</span><a name="line-1519"></a><a name="toIfaceSrcBang"><a href="MkIface.html#toIfaceSrcBang"><span class="hs-identifier">toIfaceSrcBang</span></a></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#HsSrcBang"><span class="hs-identifier hs-var">HsSrcBang</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1628237195"><a href="#local-1628237195"><span class="hs-identifier">unpk</span></a></a><span> </span><a name="local-1628237196"><a href="#local-1628237196"><span class="hs-identifier">bang</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfSrcBang"><span class="hs-identifier hs-var">IfSrcBang</span></a><span> </span><a href="#local-1628237195"><span class="hs-identifier hs-var">unpk</span></a><span> </span><a href="#local-1628237196"><span class="hs-identifier hs-var">bang</span></a><span>
</span><a name="line-1520"></a><span>
</span><a name="line-1521"></a><span class="hs-identifier">classToIfaceDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1522"></a><a name="classToIfaceDecl"><a href="MkIface.html#classToIfaceDecl"><span class="hs-identifier">classToIfaceDecl</span></a></a><span> </span><a name="local-1628237197"><a href="#local-1628237197"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1628237198"><a href="#local-1628237198"><span class="hs-identifier">clas</span></a></a><span>
</span><a name="line-1523"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-1628237205"><span class="hs-identifier hs-var">env1</span></a><span>
</span><a name="line-1524"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="IfaceSyn.html#IfaceClass"><span class="hs-identifier hs-var">IfaceClass</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifCtxt</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tidyToIfaceContext"><span class="hs-identifier hs-var">tidyToIfaceContext</span></a><span> </span><a href="#local-1628237205"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-1628237201"><span class="hs-identifier hs-var">sc_theta</span></a><span class="hs-special">,</span><span>
</span><a name="line-1525"></a><span>                   </span><span class="hs-identifier">ifName</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628237204"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">,</span><span>
</span><a name="line-1526"></a><span>                   </span><span class="hs-identifier">ifRoles</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-1628237198"><span class="hs-identifier hs-var">clas</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1527"></a><span>                   </span><span class="hs-identifier">ifBinders</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237207"><span class="hs-identifier hs-var">binders</span></a><span class="hs-special">,</span><span>
</span><a name="line-1528"></a><span>                   </span><span class="hs-identifier">ifFDs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628237211"><span class="hs-identifier hs-var">toIfaceFD</span></a><span> </span><a href="#local-1628237200"><span class="hs-identifier hs-var">clas_fds</span></a><span class="hs-special">,</span><span>
</span><a name="line-1529"></a><span>                   </span><span class="hs-identifier">ifATs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628237208"><span class="hs-identifier hs-var">toIfaceAT</span></a><span> </span><a href="#local-1628237202"><span class="hs-identifier hs-var">clas_ats</span></a><span class="hs-special">,</span><span>
</span><a name="line-1530"></a><span>                   </span><span class="hs-identifier">ifSigs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628237209"><span class="hs-identifier hs-var">toIfaceClassOp</span></a><span> </span><a href="#local-1628237203"><span class="hs-identifier hs-var">op_stuff</span></a><span class="hs-special">,</span><span>
</span><a name="line-1531"></a><span>                   </span><span class="hs-identifier">ifMinDef</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="MkIface.html#getFS"><span class="hs-identifier hs-var">getFS</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">classMinimalDef</span><span> </span><a href="#local-1628237198"><span class="hs-identifier hs-var">clas</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1532"></a><span>                   </span><span class="hs-identifier">ifRec</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#boolToRecFlag"><span class="hs-identifier hs-var">boolToRecFlag</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#isRecursiveTyCon"><span class="hs-identifier hs-var">isRecursiveTyCon</span></a><span> </span><a href="#local-1628237204"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1533"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1534"></a><span>    </span><span class="hs-special">(</span><a name="local-1628237199"><a href="#local-1628237199"><span class="hs-identifier">clas_tyvars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237200"><a href="#local-1628237200"><span class="hs-identifier">clas_fds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237201"><a href="#local-1628237201"><span class="hs-identifier">sc_theta</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628237202"><a href="#local-1628237202"><span class="hs-identifier">clas_ats</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237203"><a href="#local-1628237203"><span class="hs-identifier">op_stuff</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1535"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Class.html#classExtraBigSig"><span class="hs-identifier hs-var">classExtraBigSig</span></a><span> </span><a href="#local-1628237198"><span class="hs-identifier hs-var">clas</span></a><span>
</span><a name="line-1536"></a><span>    </span><a name="local-1628237204"><a href="#local-1628237204"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-1628237198"><span class="hs-identifier hs-var">clas</span></a><span>
</span><a name="line-1537"></a><span>
</span><a name="line-1538"></a><span>    </span><span class="hs-special">(</span><a name="local-1628237205"><a href="#local-1628237205"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237206"><a href="#local-1628237206"><span class="hs-identifier">clas_tyvars'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyTyCoVarBndrs"><span class="hs-identifier hs-var">tidyTyCoVarBndrs</span></a><span> </span><a href="#local-1628237197"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628237199"><span class="hs-identifier hs-var">clas_tyvars</span></a><span>
</span><a name="line-1539"></a><span>    </span><a name="local-1628237207"><a href="#local-1628237207"><span class="hs-identifier">binders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#zipIfaceBinders"><span class="hs-identifier hs-var">zipIfaceBinders</span></a><span> </span><a href="#local-1628237206"><span class="hs-identifier hs-var">clas_tyvars'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConBinders</span><span> </span><a href="#local-1628237204"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span>
</span><a name="line-1540"></a><span>
</span><a name="line-1541"></a><span>    </span><span class="hs-identifier">toIfaceAT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#ClassATItem"><span class="hs-identifier hs-type">ClassATItem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceAT"><span class="hs-identifier hs-type">IfaceAT</span></a><span>
</span><a name="line-1542"></a><span>    </span><a name="local-1628237208"><a href="#local-1628237208"><span class="hs-identifier">toIfaceAT</span></a></a><span> </span><span class="hs-special">(</span><a href="Class.html#ATI"><span class="hs-identifier hs-var">ATI</span></a><span> </span><a name="local-1628237212"><a href="#local-1628237212"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1628237213"><a href="#local-1628237213"><span class="hs-identifier">def</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1543"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceAT"><span class="hs-identifier hs-var">IfaceAT</span></a><span> </span><a href="#local-1628237215"><span class="hs-identifier hs-var">if_decl</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier hs-var">tidyToIfaceType</span></a><span> </span><a href="#local-1628237214"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628237213"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span>
</span><a name="line-1544"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1545"></a><span>        </span><span class="hs-special">(</span><a name="local-1628237214"><a href="#local-1628237214"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237215"><a href="#local-1628237215"><span class="hs-identifier">if_decl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#tyConToIfaceDecl"><span class="hs-identifier hs-var">tyConToIfaceDecl</span></a><span> </span><a href="#local-1628237205"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-1628237212"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1546"></a><span>
</span><a name="line-1547"></a><span>    </span><a name="local-1628237209"><a href="#local-1628237209"><span class="hs-identifier">toIfaceClassOp</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628237216"><a href="#local-1628237216"><span class="hs-identifier">sel_id</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237217"><a href="#local-1628237217"><span class="hs-identifier">def_meth</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1548"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier">sel_tyvars</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">clas_tyvars</span><span class="hs-special">)</span><span>
</span><a name="line-1549"></a><span>          </span><a href="IfaceSyn.html#IfaceClassOp"><span class="hs-identifier hs-var">IfaceClassOp</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628237216"><span class="hs-identifier hs-var">sel_id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1550"></a><span>                       </span><span class="hs-special">(</span><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier hs-var">tidyToIfaceType</span></a><span> </span><a href="#local-1628237205"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-1628237220"><span class="hs-identifier hs-var">op_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1551"></a><span>                       </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a><span> </span><a href="#local-1628237210"><span class="hs-identifier hs-var">toDmSpec</span></a><span> </span><a href="#local-1628237217"><span class="hs-identifier hs-var">def_meth</span></a><span class="hs-special">)</span><span>
</span><a name="line-1552"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-1553"></a><span>                </span><span class="hs-comment">-- Be careful when splitting the type, because of things</span><span>
</span><a name="line-1554"></a><span>                </span><span class="hs-comment">-- like         class Foo a where</span><span>
</span><a name="line-1555"></a><span>                </span><span class="hs-comment">--                op :: (?x :: String) =&gt; a -&gt; a</span><span>
</span><a name="line-1556"></a><span>                </span><span class="hs-comment">-- and          class Baz a where</span><span>
</span><a name="line-1557"></a><span>                </span><span class="hs-comment">--                op :: (Ord a) =&gt; a -&gt; a</span><span>
</span><a name="line-1558"></a><span>          </span><span class="hs-special">(</span><a name="local-1628237218"><a href="#local-1628237218"><span class="hs-identifier">sel_tyvars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237219"><a href="#local-1628237219"><span class="hs-identifier">rho_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitForAllTys"><span class="hs-identifier hs-var">splitForAllTys</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628237216"><span class="hs-identifier hs-var">sel_id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1559"></a><span>          </span><a name="local-1628237220"><a href="#local-1628237220"><span class="hs-identifier">op_ty</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#funResultTy"><span class="hs-identifier hs-var">funResultTy</span></a><span> </span><a href="#local-1628237219"><span class="hs-identifier hs-var">rho_ty</span></a><span>
</span><a name="line-1560"></a><span>
</span><a name="line-1561"></a><span>    </span><span class="hs-identifier">toDmSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#DefMethSpec"><span class="hs-identifier hs-type">DefMethSpec</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#DefMethSpec"><span class="hs-identifier hs-type">DefMethSpec</span></a><span> </span><a href="IfaceType.html#IfaceType"><span class="hs-identifier hs-type">IfaceType</span></a><span>
</span><a name="line-1562"></a><span>    </span><a name="local-1628237210"><a href="#local-1628237210"><span class="hs-identifier">toDmSpec</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#VanillaDM"><span class="hs-identifier hs-var">VanillaDM</span></a><span>
</span><a name="line-1563"></a><span>    </span><span class="hs-identifier">toDmSpec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#GenericDM"><span class="hs-identifier hs-var">GenericDM</span></a><span> </span><a name="local-1628237221"><a href="#local-1628237221"><span class="hs-identifier">dm_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#GenericDM"><span class="hs-identifier hs-var">GenericDM</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier hs-var">tidyToIfaceType</span></a><span> </span><a href="#local-1628237205"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-1628237221"><span class="hs-identifier hs-var">dm_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1564"></a><span>
</span><a name="line-1565"></a><span>    </span><a name="local-1628237211"><a href="#local-1628237211"><span class="hs-identifier">toIfaceFD</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628237222"><a href="#local-1628237222"><span class="hs-identifier">tvs1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1628237223"><a href="#local-1628237223"><span class="hs-identifier">tvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#getFS"><span class="hs-identifier hs-var">getFS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="MkIface.html#tidyTyVar"><span class="hs-identifier hs-var">tidyTyVar</span></a><span> </span><a href="#local-1628237205"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628237222"><span class="hs-identifier hs-var">tvs1</span></a><span class="hs-special">,</span><span>
</span><a name="line-1566"></a><span>                              </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#getFS"><span class="hs-identifier hs-var">getFS</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a><span> </span><a href="MkIface.html#tidyTyVar"><span class="hs-identifier hs-var">tidyTyVar</span></a><span> </span><a href="#local-1628237205"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628237223"><span class="hs-identifier hs-var">tvs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1567"></a><span>
</span><a name="line-1568"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1569"></a><span class="hs-identifier">tidyToIfaceType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceType.html#IfaceType"><span class="hs-identifier hs-type">IfaceType</span></a><span>
</span><a name="line-1570"></a><a name="tidyToIfaceType"><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier">tidyToIfaceType</span></a></a><span> </span><a name="local-1628237224"><a href="#local-1628237224"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1628237225"><a href="#local-1628237225"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#toIfaceType"><span class="hs-identifier hs-var">toIfaceType</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span> </span><a href="#local-1628237224"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628237225"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1571"></a><span>
</span><a name="line-1572"></a><span class="hs-identifier">tidyToIfaceTcArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceType.html#IfaceTcArgs"><span class="hs-identifier hs-type">IfaceTcArgs</span></a><span>
</span><a name="line-1573"></a><a name="tidyToIfaceTcArgs"><a href="MkIface.html#tidyToIfaceTcArgs"><span class="hs-identifier">tidyToIfaceTcArgs</span></a></a><span> </span><a name="local-1628237226"><a href="#local-1628237226"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1628237227"><a href="#local-1628237227"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-1628237228"><a href="#local-1628237228"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#toIfaceTcArgs"><span class="hs-identifier hs-var">toIfaceTcArgs</span></a><span> </span><a href="#local-1628237227"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tidyTypes"><span class="hs-identifier hs-var">tidyTypes</span></a><span> </span><a href="#local-1628237226"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628237228"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1574"></a><span>
</span><a name="line-1575"></a><span class="hs-identifier">tidyToIfaceContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceType.html#IfaceContext"><span class="hs-identifier hs-type">IfaceContext</span></a><span>
</span><a name="line-1576"></a><a name="tidyToIfaceContext"><a href="MkIface.html#tidyToIfaceContext"><span class="hs-identifier">tidyToIfaceContext</span></a></a><span> </span><a name="local-1628237229"><a href="#local-1628237229"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1628237230"><a href="#local-1628237230"><span class="hs-identifier">theta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#tidyToIfaceType"><span class="hs-identifier hs-var">tidyToIfaceType</span></a><span> </span><a href="#local-1628237229"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-1628237230"><span class="hs-identifier hs-var">theta</span></a><span>
</span><a name="line-1577"></a><span>
</span><a name="line-1578"></a><span class="hs-identifier">tidyTyClTyCoVarBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1579"></a><a name="tidyTyClTyCoVarBndrs"><a href="MkIface.html#tidyTyClTyCoVarBndrs"><span class="hs-identifier">tidyTyClTyCoVarBndrs</span></a></a><span> </span><a name="local-1628237231"><a href="#local-1628237231"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-1628237232"><a href="#local-1628237232"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a><span> </span><a href="MkIface.html#tidyTyClTyCoVarBndr"><span class="hs-identifier hs-var">tidyTyClTyCoVarBndr</span></a><span> </span><a href="#local-1628237231"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628237232"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-1580"></a><span>
</span><a name="line-1581"></a><span class="hs-identifier">tidyTyClTyCoVarBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-1582"></a><span class="hs-comment">-- If the type variable &quot;binder&quot; is in scope, don't re-bind it</span><span>
</span><a name="line-1583"></a><span class="hs-comment">-- In a class decl, for example, the ATD binders mention</span><span>
</span><a name="line-1584"></a><span class="hs-comment">-- (amd must mention) the class tyvars</span><span>
</span><a name="line-1585"></a><a name="tidyTyClTyCoVarBndr"><a href="MkIface.html#tidyTyClTyCoVarBndr"><span class="hs-identifier">tidyTyClTyCoVarBndr</span></a></a><span> </span><a name="local-1628237233"><a href="#local-1628237233"><span class="hs-identifier">env</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628237234"><a href="#local-1628237234"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628237235"><a href="#local-1628237235"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1586"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237236"><a href="#local-1628237236"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1628237234"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628237235"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1628237233"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628237236"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1587"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                         </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tidyTyCoVarBndr"><span class="hs-identifier hs-var">tidyTyCoVarBndr</span></a><span> </span><a href="#local-1628237233"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-1628237235"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1588"></a><span>
</span><a name="line-1589"></a><span class="hs-identifier">tidyTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-1590"></a><a name="tidyTyVar"><a href="MkIface.html#tidyTyVar"><span class="hs-identifier">tidyTyVar</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1628237237"><a href="#local-1628237237"><span class="hs-identifier">subst</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1628237238"><a href="#local-1628237238"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-1628237237"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-1628237238"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><a href="#local-1628237238"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1591"></a><span>   </span><span class="hs-comment">-- TcType.tidyTyVarOcc messes around with FlatSkols</span><span>
</span><a name="line-1592"></a><span>
</span><a name="line-1593"></a><span class="hs-identifier">getFS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#NamedThing"><span class="hs-identifier hs-type">NamedThing</span></a><span> </span><a href="#local-1628236734"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1628236734"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-1594"></a><a name="getFS"><a href="MkIface.html#getFS"><span class="hs-identifier">getFS</span></a></a><span> </span><a name="local-1628237239"><a href="#local-1628237239"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">occNameFS</span><span> </span><span class="hs-special">(</span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628237239"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1595"></a><span>
</span><a name="line-1596"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1597"></a><span class="hs-identifier">instanceToIfaceInst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceClsInst"><span class="hs-identifier hs-type">IfaceClsInst</span></a><span>
</span><a name="line-1598"></a><a name="instanceToIfaceInst"><a href="MkIface.html#instanceToIfaceInst"><span class="hs-identifier">instanceToIfaceInst</span></a></a><span> </span><span class="hs-special">(</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-var">ClsInst</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">is_dfun</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237240"><a href="#local-1628237240"><span class="hs-identifier">dfun_id</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_flag</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237241"><a href="#local-1628237241"><span class="hs-identifier">oflag</span></a></a><span>
</span><a name="line-1599"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_cls_nm</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237242"><a href="#local-1628237242"><span class="hs-identifier">cls_name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_cls</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237243"><a href="#local-1628237243"><span class="hs-identifier">cls</span></a></a><span>
</span><a name="line-1600"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_tcs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237244"><a href="#local-1628237244"><span class="hs-identifier">mb_tcs</span></a></a><span>
</span><a name="line-1601"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_orphan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237245"><a href="#local-1628237245"><span class="hs-identifier">orph</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1602"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">cls_name</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">className</span><span> </span><span class="hs-identifier">cls</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1603"></a><span>    </span><a href="IfaceSyn.html#IfaceClsInst"><span class="hs-identifier hs-var">IfaceClsInst</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifDFun</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237247"><span class="hs-identifier hs-var">dfun_name</span></a><span class="hs-special">,</span><span>
</span><a name="line-1604"></a><span>                </span><span class="hs-identifier">ifOFlag</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237241"><span class="hs-identifier hs-var">oflag</span></a><span class="hs-special">,</span><span>
</span><a name="line-1605"></a><span>                </span><span class="hs-identifier">ifInstCls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237242"><span class="hs-identifier hs-var">cls_name</span></a><span class="hs-special">,</span><span>
</span><a name="line-1606"></a><span>                </span><span class="hs-identifier">ifInstTys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628237246"><span class="hs-identifier hs-var">do_rough</span></a><span> </span><a href="#local-1628237244"><span class="hs-identifier hs-var">mb_tcs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1607"></a><span>                </span><span class="hs-identifier">ifInstOrph</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237245"><span class="hs-identifier hs-var">orph</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1608"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1609"></a><span>    </span><a name="local-1628237246"><a href="#local-1628237246"><span class="hs-identifier">do_rough</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1610"></a><span>    </span><span class="hs-identifier">do_rough</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237248"><a href="#local-1628237248"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceTyCon_name"><span class="hs-identifier hs-var">toIfaceTyCon_name</span></a><span> </span><a href="#local-1628237248"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1611"></a><span>
</span><a name="line-1612"></a><span>    </span><a name="local-1628237247"><a href="#local-1628237247"><span class="hs-identifier">dfun_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628237240"><span class="hs-identifier hs-var">dfun_id</span></a><span>
</span><a name="line-1613"></a><span>
</span><a name="line-1614"></a><span>
</span><a name="line-1615"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1616"></a><span class="hs-identifier">famInstToIfaceFamInst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceFamInst"><span class="hs-identifier hs-type">IfaceFamInst</span></a><span>
</span><a name="line-1617"></a><a name="famInstToIfaceFamInst"><a href="MkIface.html#famInstToIfaceFamInst"><span class="hs-identifier">famInstToIfaceFamInst</span></a></a><span> </span><span class="hs-special">(</span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-var">FamInst</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fi_axiom</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237249"><a href="#local-1628237249"><span class="hs-identifier">axiom</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1618"></a><span>                                 </span><span class="hs-identifier">fi_fam</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237250"><a href="#local-1628237250"><span class="hs-identifier">fam</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1619"></a><span>                                 </span><span class="hs-identifier">fi_tcs</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237251"><a href="#local-1628237251"><span class="hs-identifier">roughs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1620"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceFamInst"><span class="hs-identifier hs-var">IfaceFamInst</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifFamInstAxiom</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#coAxiomName"><span class="hs-identifier hs-var">coAxiomName</span></a><span> </span><a href="#local-1628237249"><span class="hs-identifier hs-var">axiom</span></a><span>
</span><a name="line-1621"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifFamInstFam</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237250"><span class="hs-identifier hs-var">fam</span></a><span>
</span><a name="line-1622"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifFamInstTys</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628237252"><span class="hs-identifier hs-var">do_rough</span></a><span> </span><a href="#local-1628237251"><span class="hs-identifier hs-var">roughs</span></a><span>
</span><a name="line-1623"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifFamInstOrph</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237257"><span class="hs-identifier hs-var">orph</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1624"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1625"></a><span>    </span><a name="local-1628237252"><a href="#local-1628237252"><span class="hs-identifier">do_rough</span></a></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1626"></a><span>    </span><span class="hs-identifier">do_rough</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237258"><a href="#local-1628237258"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceTyCon_name"><span class="hs-identifier hs-var">toIfaceTyCon_name</span></a><span> </span><a href="#local-1628237258"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1627"></a><span>
</span><a name="line-1628"></a><span>    </span><a name="local-1628237253"><a href="#local-1628237253"><span class="hs-identifier">fam_decl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="CoAxiom.html#coAxiomTyCon"><span class="hs-identifier hs-var">coAxiomTyCon</span></a><span> </span><a href="#local-1628237249"><span class="hs-identifier hs-var">axiom</span></a><span>
</span><a name="line-1629"></a><span>    </span><a name="local-1628237254"><a href="#local-1628237254"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><span class="hs-special">(</span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">coAxiomName</span></a><span> </span><span class="hs-identifier">axiom</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1630"></a><span>          </span><a href="Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#coAxiomName"><span class="hs-identifier hs-var">coAxiomName</span></a><span> </span><a href="#local-1628237249"><span class="hs-identifier hs-var">axiom</span></a><span class="hs-special">)</span><span>
</span><a name="line-1631"></a><span>    </span><a name="local-1628237255"><a href="#local-1628237255"><span class="hs-identifier">is_local</span></a></a><span> </span><a name="local-1628237259"><a href="#local-1628237259"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a><span> </span><a href="#local-1628237254"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-1628237259"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1632"></a><span>
</span><a name="line-1633"></a><span>    </span><a name="local-1628237256"><a href="#local-1628237256"><span class="hs-identifier">lhs_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#filterNameSet"><span class="hs-identifier hs-var">filterNameSet</span></a><span> </span><a href="#local-1628237255"><span class="hs-identifier hs-var">is_local</span></a><span> </span><span class="hs-special">(</span><a href="CoreFVs.html#orphNamesOfCoCon"><span class="hs-identifier hs-var">orphNamesOfCoCon</span></a><span> </span><a href="#local-1628237249"><span class="hs-identifier hs-var">axiom</span></a><span class="hs-special">)</span><span>
</span><a name="line-1634"></a><span>
</span><a name="line-1635"></a><span>    </span><a name="local-1628237257"><a href="#local-1628237257"><span class="hs-identifier">orph</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628237255"><span class="hs-identifier hs-var">is_local</span></a><span> </span><a href="#local-1628237253"><span class="hs-identifier hs-var">fam_decl</span></a><span>
</span><a name="line-1636"></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#NotOrphan"><span class="hs-identifier hs-var">NotOrphan</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-1628237253"><span class="hs-identifier hs-var">fam_decl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1637"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1638"></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#chooseOrphanAnchor"><span class="hs-identifier hs-var">chooseOrphanAnchor</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="NameSet.html#nameSetElems"><span class="hs-identifier hs-var">nameSetElems</span></a><span> </span><a href="#local-1628237256"><span class="hs-identifier hs-var">lhs_names</span></a><span>
</span><a name="line-1639"></a><span>
</span><a name="line-1640"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1641"></a><span class="hs-identifier">toIfaceLetBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceLetBndr"><span class="hs-identifier hs-type">IfaceLetBndr</span></a><span>
</span><a name="line-1642"></a><a name="toIfaceLetBndr"><a href="MkIface.html#toIfaceLetBndr"><span class="hs-identifier">toIfaceLetBndr</span></a></a><span> </span><a name="local-1628237260"><a href="#local-1628237260"><span class="hs-identifier">id</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfLetBndr"><span class="hs-identifier hs-var">IfLetBndr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">occNameFS</span><span> </span><span class="hs-special">(</span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-1628237260"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1643"></a><span>                               </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceType"><span class="hs-identifier hs-var">toIfaceType</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628237260"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1644"></a><span>                               </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceIdInfo"><span class="hs-identifier hs-var">toIfaceIdInfo</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-1628237260"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1645"></a><span>  </span><span class="hs-comment">-- Put into the interface file any IdInfo that CoreTidy.tidyLetBndr</span><span>
</span><a name="line-1646"></a><span>  </span><span class="hs-comment">-- has left on the Id.  See Note [IdInfo on nested let-bindings] in IfaceSyn</span><span>
</span><a name="line-1647"></a><span>
</span><a name="line-1648"></a><span class="hs-comment">--------------------------t</span><span>
</span><a name="line-1649"></a><span class="hs-identifier">toIfaceIdDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdDetails"><span class="hs-identifier hs-type">IdDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceIdDetails"><span class="hs-identifier hs-type">IfaceIdDetails</span></a><span>
</span><a name="line-1650"></a><a name="toIfaceIdDetails"><a href="MkIface.html#toIfaceIdDetails"><span class="hs-identifier">toIfaceIdDetails</span></a></a><span> </span><a href="IdInfo.html#VanillaId"><span class="hs-identifier hs-var">VanillaId</span></a><span>                      </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfVanillaId"><span class="hs-identifier hs-var">IfVanillaId</span></a><span>
</span><a name="line-1651"></a><span class="hs-identifier">toIfaceIdDetails</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#DFunId"><span class="hs-identifier hs-var">DFunId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfDFunId"><span class="hs-identifier hs-var">IfDFunId</span></a><span>
</span><a name="line-1652"></a><span class="hs-identifier">toIfaceIdDetails</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#RecSelId"><span class="hs-identifier hs-var">RecSelId</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sel_naughty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237261"><a href="#local-1628237261"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-1653"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sel_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237262"><a href="#local-1628237262"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span>
</span><a name="line-1654"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1628237263"><a href="#local-1628237263"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237262"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1655"></a><span>                </span><a href="IdInfo.html#RecSelData"><span class="hs-identifier hs-var">RecSelData</span></a><span> </span><a name="local-1628237264"><a href="#local-1628237264"><span class="hs-identifier">ty_con</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a><span> </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceTyCon"><span class="hs-identifier hs-var">toIfaceTyCon</span></a><span> </span><a href="#local-1628237264"><span class="hs-identifier hs-var">ty_con</span></a><span class="hs-special">)</span><span>
</span><a name="line-1656"></a><span>                </span><a href="IdInfo.html#RecSelPatSyn"><span class="hs-identifier hs-var">RecSelPatSyn</span></a><span> </span><a name="local-1628237265"><a href="#local-1628237265"><span class="hs-identifier">pat_syn</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#patSynToIfaceDecl"><span class="hs-identifier hs-var">patSynToIfaceDecl</span></a><span> </span><a href="#local-1628237265"><span class="hs-identifier hs-var">pat_syn</span></a><span class="hs-special">)</span><span>
</span><a name="line-1657"></a><span>  </span><span class="hs-keyword">in</span><span> </span><a href="IfaceSyn.html#IfRecSelId"><span class="hs-identifier hs-var">IfRecSelId</span></a><span> </span><a href="#local-1628237263"><span class="hs-identifier hs-var">iface</span></a><span> </span><a href="#local-1628237261"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1658"></a><span>
</span><a name="line-1659"></a><span>  </span><span class="hs-comment">-- The remaining cases are all &quot;implicit Ids&quot; which don't</span><span>
</span><a name="line-1660"></a><span>  </span><span class="hs-comment">-- appear in interface files at all</span><span>
</span><a name="line-1661"></a><span class="hs-identifier">toIfaceIdDetails</span><span> </span><a name="local-1628237266"><a href="#local-1628237266"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprTrace"><span class="hs-identifier hs-var">pprTrace</span></a><span> </span><span class="hs-string">&quot;toIfaceIdDetails&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237266"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-1662"></a><span>                         </span><a href="IfaceSyn.html#IfVanillaId"><span class="hs-identifier hs-var">IfVanillaId</span></a><span>   </span><span class="hs-comment">-- Unexpected; the other</span><span>
</span><a name="line-1663"></a><span>
</span><a name="line-1664"></a><span class="hs-identifier">toIfaceIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceIdInfo"><span class="hs-identifier hs-type">IfaceIdInfo</span></a><span>
</span><a name="line-1665"></a><a name="toIfaceIdInfo"><a href="MkIface.html#toIfaceIdInfo"><span class="hs-identifier">toIfaceIdInfo</span></a></a><span> </span><a name="local-1628237267"><a href="#local-1628237267"><span class="hs-identifier">id_info</span></a></a><span>
</span><a name="line-1666"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628237269"><span class="hs-identifier hs-var">arity_hsinfo</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628237271"><span class="hs-identifier hs-var">caf_hsinfo</span></a><span class="hs-special">,</span><span> </span><a href="#local-1628237273"><span class="hs-identifier hs-var">strict_hsinfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-1667"></a><span>                    </span><a href="#local-1628237277"><span class="hs-identifier hs-var">inline_hsinfo</span></a><span class="hs-special">,</span><span>  </span><a href="#local-1628237274"><span class="hs-identifier hs-var">unfold_hsinfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1668"></a><span>       </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#NoInfo"><span class="hs-identifier hs-var">NoInfo</span></a><span>
</span><a name="line-1669"></a><span>       </span><a name="local-1628237279"><a href="#local-1628237279"><span class="hs-identifier">infos</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#HasInfo"><span class="hs-identifier hs-var">HasInfo</span></a><span> </span><a href="#local-1628237279"><span class="hs-identifier hs-var">infos</span></a><span>
</span><a name="line-1670"></a><span>               </span><span class="hs-comment">-- NB: strictness and arity must appear in the list before unfolding</span><span>
</span><a name="line-1671"></a><span>               </span><span class="hs-comment">-- See TcIface.tcUnfolding</span><span>
</span><a name="line-1672"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1673"></a><span>    </span><span class="hs-comment">------------  Arity  --------------</span><span>
</span><a name="line-1674"></a><span>    </span><a name="local-1628237268"><a href="#local-1628237268"><span class="hs-identifier">arity_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arityInfo</span><span> </span><a href="#local-1628237267"><span class="hs-identifier hs-var">id_info</span></a><span>
</span><a name="line-1675"></a><span>    </span><a name="local-1628237269"><a href="#local-1628237269"><span class="hs-identifier">arity_hsinfo</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1628237268"><span class="hs-identifier hs-var">arity_info</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1676"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#HsArity"><span class="hs-identifier hs-var">HsArity</span></a><span> </span><a href="#local-1628237268"><span class="hs-identifier hs-var">arity_info</span></a><span class="hs-special">)</span><span>
</span><a name="line-1677"></a><span>
</span><a name="line-1678"></a><span>    </span><span class="hs-comment">------------ Caf Info --------------</span><span>
</span><a name="line-1679"></a><span>    </span><a name="local-1628237270"><a href="#local-1628237270"><span class="hs-identifier">caf_info</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cafInfo</span><span> </span><a href="#local-1628237267"><span class="hs-identifier hs-var">id_info</span></a><span>
</span><a name="line-1680"></a><span>    </span><a name="local-1628237271"><a href="#local-1628237271"><span class="hs-identifier">caf_hsinfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237270"><span class="hs-identifier hs-var">caf_info</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1681"></a><span>                   </span><a href="IdInfo.html#NoCafRefs"><span class="hs-identifier hs-var">NoCafRefs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="IfaceSyn.html#HsNoCafRefs"><span class="hs-identifier hs-var">HsNoCafRefs</span></a><span>
</span><a name="line-1682"></a><span>                   </span><a name="local-1628237278"><a href="#local-1628237278"><span class="hs-identifier">_other</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1683"></a><span>
</span><a name="line-1684"></a><span>    </span><span class="hs-comment">------------  Strictness  --------------</span><span>
</span><a name="line-1685"></a><span>        </span><span class="hs-comment">-- No point in explicitly exporting TopSig</span><span>
</span><a name="line-1686"></a><span>    </span><a name="local-1628237272"><a href="#local-1628237272"><span class="hs-identifier">sig_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">strictnessInfo</span><span> </span><a href="#local-1628237267"><span class="hs-identifier hs-var">id_info</span></a><span>
</span><a name="line-1687"></a><span>    </span><a name="local-1628237273"><a href="#local-1628237273"><span class="hs-identifier">strict_hsinfo</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Demand.html#isNopSig"><span class="hs-identifier hs-var">isNopSig</span></a><span> </span><a href="#local-1628237272"><span class="hs-identifier hs-var">sig_info</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#HsStrictness"><span class="hs-identifier hs-var">HsStrictness</span></a><span> </span><a href="#local-1628237272"><span class="hs-identifier hs-var">sig_info</span></a><span class="hs-special">)</span><span>
</span><a name="line-1688"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1689"></a><span>
</span><a name="line-1690"></a><span>    </span><span class="hs-comment">------------  Unfolding  --------------</span><span>
</span><a name="line-1691"></a><span>    </span><a name="local-1628237274"><a href="#local-1628237274"><span class="hs-identifier">unfold_hsinfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#toIfUnfolding"><span class="hs-identifier hs-var">toIfUnfolding</span></a><span> </span><a href="#local-1628237275"><span class="hs-identifier hs-var">loop_breaker</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unfoldingInfo</span><span> </span><a href="#local-1628237267"><span class="hs-identifier hs-var">id_info</span></a><span class="hs-special">)</span><span>
</span><a name="line-1692"></a><span>    </span><a name="local-1628237275"><a href="#local-1628237275"><span class="hs-identifier">loop_breaker</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#isStrongLoopBreaker"><span class="hs-identifier hs-var">isStrongLoopBreaker</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">occInfo</span><span> </span><a href="#local-1628237267"><span class="hs-identifier hs-var">id_info</span></a><span class="hs-special">)</span><span>
</span><a name="line-1693"></a><span>
</span><a name="line-1694"></a><span>    </span><span class="hs-comment">------------  Inline prag  --------------</span><span>
</span><a name="line-1695"></a><span>    </span><a name="local-1628237276"><a href="#local-1628237276"><span class="hs-identifier">inline_prag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">inlinePragInfo</span><span> </span><a href="#local-1628237267"><span class="hs-identifier hs-var">id_info</span></a><span>
</span><a name="line-1696"></a><span>    </span><a name="local-1628237277"><a href="#local-1628237277"><span class="hs-identifier">inline_hsinfo</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="BasicTypes.html#isDefaultInlinePragma"><span class="hs-identifier hs-var">isDefaultInlinePragma</span></a><span> </span><a href="#local-1628237276"><span class="hs-identifier hs-var">inline_prag</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1697"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#HsInline"><span class="hs-identifier hs-var">HsInline</span></a><span> </span><a href="#local-1628237276"><span class="hs-identifier hs-var">inline_prag</span></a><span class="hs-special">)</span><span>
</span><a name="line-1698"></a><span>
</span><a name="line-1699"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1700"></a><span class="hs-identifier">toIfUnfolding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="IfaceSyn.html#IfaceInfoItem"><span class="hs-identifier hs-type">IfaceInfoItem</span></a><span>
</span><a name="line-1701"></a><a name="toIfUnfolding"><a href="MkIface.html#toIfUnfolding"><span class="hs-identifier">toIfUnfolding</span></a></a><span> </span><a name="local-1628237280"><a href="#local-1628237280"><span class="hs-identifier">lb</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#CoreUnfolding"><span class="hs-identifier hs-var">CoreUnfolding</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">uf_tmpl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237281"><a href="#local-1628237281"><span class="hs-identifier">rhs</span></a></a><span>
</span><a name="line-1702"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">uf_src</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237282"><a href="#local-1628237282"><span class="hs-identifier">src</span></a></a><span>
</span><a name="line-1703"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">uf_guidance</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237283"><a href="#local-1628237283"><span class="hs-identifier">guidance</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1704"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span> </span><a href="IfaceSyn.html#HsUnfold"><span class="hs-identifier hs-var">HsUnfold</span></a><span> </span><a href="#local-1628237280"><span class="hs-identifier hs-var">lb</span></a><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1705"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237282"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1706"></a><span>        </span><a href="CoreSyn.html#InlineStable"><span class="hs-identifier hs-var">InlineStable</span></a><span>
</span><a name="line-1707"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1628237283"><span class="hs-identifier hs-var">guidance</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1708"></a><span>               </span><a href="CoreSyn.html#UnfWhen"><span class="hs-identifier hs-var">UnfWhen</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">ug_arity</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237285"><a href="#local-1628237285"><span class="hs-identifier">arity</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ug_unsat_ok</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237286"><a href="#local-1628237286"><span class="hs-identifier">unsat_ok</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ug_boring_ok</span><span> </span><span class="hs-glyph">=</span><span>  </span><a name="local-1628237287"><a href="#local-1628237287"><span class="hs-identifier">boring_ok</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1709"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfInlineRule"><span class="hs-identifier hs-var">IfInlineRule</span></a><span> </span><a href="#local-1628237285"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="#local-1628237286"><span class="hs-identifier hs-var">unsat_ok</span></a><span> </span><a href="#local-1628237287"><span class="hs-identifier hs-var">boring_ok</span></a><span> </span><a href="#local-1628237284"><span class="hs-identifier hs-var">if_rhs</span></a><span>
</span><a name="line-1710"></a><span>               </span><a name="local-1628237288"><a href="#local-1628237288"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfCoreUnfold"><span class="hs-identifier hs-var">IfCoreUnfold</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-1628237284"><span class="hs-identifier hs-var">if_rhs</span></a><span>
</span><a name="line-1711"></a><span>        </span><a href="CoreSyn.html#InlineCompulsory"><span class="hs-identifier hs-var">InlineCompulsory</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfCompulsory"><span class="hs-identifier hs-var">IfCompulsory</span></a><span> </span><a href="#local-1628237284"><span class="hs-identifier hs-var">if_rhs</span></a><span>
</span><a name="line-1712"></a><span>        </span><a href="CoreSyn.html#InlineRhs"><span class="hs-identifier hs-var">InlineRhs</span></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfCoreUnfold"><span class="hs-identifier hs-var">IfCoreUnfold</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-1628237284"><span class="hs-identifier hs-var">if_rhs</span></a><span>
</span><a name="line-1713"></a><span>        </span><span class="hs-comment">-- Yes, even if guidance is UnfNever, expose the unfolding</span><span>
</span><a name="line-1714"></a><span>        </span><span class="hs-comment">-- If we didn't want to expose the unfolding, TidyPgm would</span><span>
</span><a name="line-1715"></a><span>        </span><span class="hs-comment">-- have stuck in NoUnfolding.  For supercompilation we want</span><span>
</span><a name="line-1716"></a><span>        </span><span class="hs-comment">-- to see that unfolding!</span><span>
</span><a name="line-1717"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1718"></a><span>    </span><a name="local-1628237284"><a href="#local-1628237284"><span class="hs-identifier">if_rhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237281"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1719"></a><span>
</span><a name="line-1720"></a><span class="hs-identifier">toIfUnfolding</span><span> </span><a name="local-1628237289"><a href="#local-1628237289"><span class="hs-identifier">lb</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#DFunUnfolding"><span class="hs-identifier hs-var">DFunUnfolding</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">df_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237290"><a href="#local-1628237290"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">df_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237291"><a href="#local-1628237291"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1721"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#HsUnfold"><span class="hs-identifier hs-var">HsUnfold</span></a><span> </span><a href="#local-1628237289"><span class="hs-identifier hs-var">lb</span></a><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#IfDFunUnfold"><span class="hs-identifier hs-var">IfDFunUnfold</span></a><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="IfaceType.html#toIfaceBndr"><span class="hs-identifier hs-var">toIfaceBndr</span></a><span> </span><a href="#local-1628237290"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237291"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1722"></a><span>      </span><span class="hs-comment">-- No need to serialise the data constructor;</span><span>
</span><a name="line-1723"></a><span>      </span><span class="hs-comment">-- we can recover it from the type of the dfun</span><span>
</span><a name="line-1724"></a><span>
</span><a name="line-1725"></a><span class="hs-identifier">toIfUnfolding</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1726"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1727"></a><span>
</span><a name="line-1728"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-1729"></a><span class="hs-identifier">coreRuleToIfaceRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceRule"><span class="hs-identifier hs-type">IfaceRule</span></a><span>
</span><a name="line-1730"></a><a name="coreRuleToIfaceRule"><a href="MkIface.html#coreRuleToIfaceRule"><span class="hs-identifier">coreRuleToIfaceRule</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237292"><a href="#local-1628237292"><span class="hs-identifier">fn</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1731"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprTrace"><span class="hs-identifier hs-var">pprTrace</span></a><span> </span><span class="hs-string">&quot;toHsRule: builtin&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-1628237292"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">)</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a><span>
</span><a name="line-1732"></a><span>    </span><a href="MkIface.html#bogusIfaceRule"><span class="hs-identifier hs-var">bogusIfaceRule</span></a><span> </span><a href="#local-1628237292"><span class="hs-identifier hs-var">fn</span></a><span>
</span><a name="line-1733"></a><span>
</span><a name="line-1734"></a><span class="hs-identifier">coreRuleToIfaceRule</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Rule"><span class="hs-identifier hs-var">Rule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237293"><a href="#local-1628237293"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237294"><a href="#local-1628237294"><span class="hs-identifier">fn</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1735"></a><span>                            </span><span class="hs-identifier">ru_act</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237295"><a href="#local-1628237295"><span class="hs-identifier">act</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237296"><a href="#local-1628237296"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1736"></a><span>                            </span><span class="hs-identifier">ru_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237297"><a href="#local-1628237297"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237298"><a href="#local-1628237298"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1737"></a><span>                            </span><span class="hs-identifier">ru_orphan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237299"><a href="#local-1628237299"><span class="hs-identifier">orph</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_auto</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1628237300"><a href="#local-1628237300"><span class="hs-identifier">auto</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1738"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceRule"><span class="hs-identifier hs-var">IfaceRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifRuleName</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237293"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifActivation</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237295"><span class="hs-identifier hs-var">act</span></a><span class="hs-special">,</span><span>
</span><a name="line-1739"></a><span>                </span><span class="hs-identifier">ifRuleBndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="IfaceType.html#toIfaceBndr"><span class="hs-identifier hs-var">toIfaceBndr</span></a><span> </span><a href="#local-1628237296"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1740"></a><span>                </span><span class="hs-identifier">ifRuleHead</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237294"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">,</span><span>
</span><a name="line-1741"></a><span>                </span><span class="hs-identifier">ifRuleArgs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="#local-1628237301"><span class="hs-identifier hs-var">do_arg</span></a><span> </span><a href="#local-1628237297"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">,</span><span>
</span><a name="line-1742"></a><span>                </span><span class="hs-identifier">ifRuleRhs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237298"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1743"></a><span>                </span><span class="hs-identifier">ifRuleAuto</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237300"><span class="hs-identifier hs-var">auto</span></a><span class="hs-special">,</span><span>
</span><a name="line-1744"></a><span>                </span><span class="hs-identifier">ifRuleOrph</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237299"><span class="hs-identifier hs-var">orph</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1745"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1746"></a><span>        </span><span class="hs-comment">-- For type args we must remove synonyms from the outermost</span><span>
</span><a name="line-1747"></a><span>        </span><span class="hs-comment">-- level.  Reason: so that when we read it back in we'll</span><span>
</span><a name="line-1748"></a><span>        </span><span class="hs-comment">-- construct the same ru_rough field as we have right now;</span><span>
</span><a name="line-1749"></a><span>        </span><span class="hs-comment">-- see tcIfaceRule</span><span>
</span><a name="line-1750"></a><span>    </span><a name="local-1628237301"><a href="#local-1628237301"><span class="hs-identifier">do_arg</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-1628237302"><a href="#local-1628237302"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceType"><span class="hs-identifier hs-var">IfaceType</span></a><span> </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceType"><span class="hs-identifier hs-var">toIfaceType</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#deNoteType"><span class="hs-identifier hs-var">deNoteType</span></a><span> </span><a href="#local-1628237302"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1751"></a><span>    </span><span class="hs-identifier">do_arg</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Coercion"><span class="hs-identifier hs-var">Coercion</span></a><span> </span><a name="local-1628237303"><a href="#local-1628237303"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceCo"><span class="hs-identifier hs-var">IfaceCo</span></a><span>   </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceCoercion"><span class="hs-identifier hs-var">toIfaceCoercion</span></a><span> </span><a href="#local-1628237303"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1752"></a><span>    </span><span class="hs-identifier">do_arg</span><span> </span><a name="local-1628237304"><a href="#local-1628237304"><span class="hs-identifier">arg</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237304"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1753"></a><span>
</span><a name="line-1754"></a><span class="hs-identifier">bogusIfaceRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceRule"><span class="hs-identifier hs-type">IfaceRule</span></a><span>
</span><a name="line-1755"></a><a name="bogusIfaceRule"><a href="MkIface.html#bogusIfaceRule"><span class="hs-identifier">bogusIfaceRule</span></a></a><span> </span><a name="local-1628237305"><a href="#local-1628237305"><span class="hs-identifier">id_name</span></a></a><span>
</span><a name="line-1756"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceRule"><span class="hs-identifier hs-var">IfaceRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ifRuleName</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;bogus&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifActivation</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#NeverActive"><span class="hs-identifier hs-var">NeverActive</span></a><span class="hs-special">,</span><span>
</span><a name="line-1757"></a><span>        </span><span class="hs-identifier">ifRuleBndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifRuleHead</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237305"><span class="hs-identifier hs-var">id_name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifRuleArgs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1758"></a><span>        </span><span class="hs-identifier">ifRuleRhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceExt"><span class="hs-identifier hs-var">IfaceExt</span></a><span> </span><a href="#local-1628237305"><span class="hs-identifier hs-var">id_name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ifRuleOrph</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#IsOrphan"><span class="hs-identifier hs-var">IsOrphan</span></a><span class="hs-special">,</span><span>
</span><a name="line-1759"></a><span>        </span><span class="hs-identifier">ifRuleAuto</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1760"></a><span>
</span><a name="line-1761"></a><span class="hs-comment">---------------------</span><span>
</span><a name="line-1762"></a><span class="hs-identifier">toIfaceExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceExpr"><span class="hs-identifier hs-type">IfaceExpr</span></a><span>
</span><a name="line-1763"></a><a name="toIfaceExpr"><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier">toIfaceExpr</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-1628237306"><a href="#local-1628237306"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#toIfaceVar"><span class="hs-identifier hs-var">toIfaceVar</span></a><span> </span><a href="#local-1628237306"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1764"></a><span class="hs-identifier">toIfaceExpr</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-1628237307"><a href="#local-1628237307"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceLit"><span class="hs-identifier hs-var">IfaceLit</span></a><span> </span><a href="#local-1628237307"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1765"></a><span class="hs-identifier">toIfaceExpr</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-1628237308"><a href="#local-1628237308"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceType"><span class="hs-identifier hs-var">IfaceType</span></a><span> </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceType"><span class="hs-identifier hs-var">toIfaceType</span></a><span> </span><a href="#local-1628237308"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1766"></a><span class="hs-identifier">toIfaceExpr</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Coercion"><span class="hs-identifier hs-var">Coercion</span></a><span> </span><a name="local-1628237309"><a href="#local-1628237309"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceCo"><span class="hs-identifier hs-var">IfaceCo</span></a><span>   </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceCoercion"><span class="hs-identifier hs-var">toIfaceCoercion</span></a><span> </span><a href="#local-1628237309"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1767"></a><span class="hs-identifier">toIfaceExpr</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lam"><span class="hs-identifier hs-var">Lam</span></a><span> </span><a name="local-1628237310"><a href="#local-1628237310"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1628237311"><a href="#local-1628237311"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceLam"><span class="hs-identifier hs-var">IfaceLam</span></a><span> </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceBndr"><span class="hs-identifier hs-var">toIfaceBndr</span></a><span> </span><a href="#local-1628237310"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="MkIface.html#toIfaceOneShot"><span class="hs-identifier hs-var">toIfaceOneShot</span></a><span> </span><a href="#local-1628237310"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237311"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1768"></a><span class="hs-identifier">toIfaceExpr</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><a name="local-1628237312"><a href="#local-1628237312"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628237313"><a href="#local-1628237313"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#toIfaceApp"><span class="hs-identifier hs-var">toIfaceApp</span></a><span> </span><a href="#local-1628237312"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">[</span><a href="#local-1628237313"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-1769"></a><span class="hs-identifier">toIfaceExpr</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Case"><span class="hs-identifier hs-var">Case</span></a><span> </span><a name="local-1628237314"><a href="#local-1628237314"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1628237315"><a href="#local-1628237315"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1628237316"><a href="#local-1628237316"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-1770"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-keyword">as</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceECase"><span class="hs-identifier hs-var">IfaceECase</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237314"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceType"><span class="hs-identifier hs-var">toIfaceType</span></a><span> </span><a href="#local-1628237316"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1771"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceCase"><span class="hs-identifier hs-var">IfaceCase</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237314"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#getFS"><span class="hs-identifier hs-var">getFS</span></a><span> </span><a href="#local-1628237315"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#toIfaceAlt"><span class="hs-identifier hs-var">toIfaceAlt</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-1772"></a><span class="hs-identifier">toIfaceExpr</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Let"><span class="hs-identifier hs-var">Let</span></a><span> </span><a name="local-1628237318"><a href="#local-1628237318"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1628237319"><a href="#local-1628237319"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceLet"><span class="hs-identifier hs-var">IfaceLet</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceBind"><span class="hs-identifier hs-var">toIfaceBind</span></a><span> </span><a href="#local-1628237318"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237319"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1773"></a><span class="hs-identifier">toIfaceExpr</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a name="local-1628237320"><a href="#local-1628237320"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-1628237321"><a href="#local-1628237321"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceCast"><span class="hs-identifier hs-var">IfaceCast</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237320"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceCoercion"><span class="hs-identifier hs-var">toIfaceCoercion</span></a><span> </span><a href="#local-1628237321"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1774"></a><span class="hs-identifier">toIfaceExpr</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Tick"><span class="hs-identifier hs-var">Tick</span></a><span> </span><a name="local-1628237322"><a href="#local-1628237322"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-1628237323"><a href="#local-1628237323"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1775"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237324"><a href="#local-1628237324"><span class="hs-identifier">t'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MkIface.html#toIfaceTickish"><span class="hs-identifier hs-var">toIfaceTickish</span></a><span> </span><a href="#local-1628237322"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceTick"><span class="hs-identifier hs-var">IfaceTick</span></a><span> </span><a href="#local-1628237324"><span class="hs-identifier hs-var">t'</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237323"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1776"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237323"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1777"></a><span>
</span><a name="line-1778"></a><span class="hs-identifier">toIfaceOneShot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceType.html#IfaceOneShot"><span class="hs-identifier hs-type">IfaceOneShot</span></a><span>
</span><a name="line-1779"></a><a name="toIfaceOneShot"><a href="MkIface.html#toIfaceOneShot"><span class="hs-identifier">toIfaceOneShot</span></a></a><span> </span><a name="local-1628237325"><a href="#local-1628237325"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isId"><span class="hs-identifier hs-var">isId</span></a><span> </span><a href="#local-1628237325"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-1780"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#OneShotLam"><span class="hs-identifier hs-var">OneShotLam</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">oneShotInfo</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-1628237325"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1781"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#IfaceOneShot"><span class="hs-identifier hs-var">IfaceOneShot</span></a><span>
</span><a name="line-1782"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>
</span><a name="line-1783"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceType.html#IfaceNoOneShot"><span class="hs-identifier hs-var">IfaceNoOneShot</span></a><span>
</span><a name="line-1784"></a><span>
</span><a name="line-1785"></a><span class="hs-comment">---------------------</span><span>
</span><a name="line-1786"></a><span class="hs-identifier">toIfaceTickish</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#Tickish"><span class="hs-identifier hs-type">Tickish</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a><span> </span><a href="IfaceSyn.html#IfaceTickish"><span class="hs-identifier hs-type">IfaceTickish</span></a><span>
</span><a name="line-1787"></a><a name="toIfaceTickish"><a href="MkIface.html#toIfaceTickish"><span class="hs-identifier">toIfaceTickish</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#ProfNote"><span class="hs-identifier hs-var">ProfNote</span></a><span> </span><a name="local-1628237326"><a href="#local-1628237326"><span class="hs-identifier">cc</span></a></a><span> </span><a name="local-1628237327"><a href="#local-1628237327"><span class="hs-identifier">tick</span></a></a><span> </span><a name="local-1628237328"><a href="#local-1628237328"><span class="hs-identifier">push</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#IfaceSCC"><span class="hs-identifier hs-var">IfaceSCC</span></a><span> </span><a href="#local-1628237326"><span class="hs-identifier hs-var">cc</span></a><span> </span><a href="#local-1628237327"><span class="hs-identifier hs-var">tick</span></a><span> </span><a href="#local-1628237328"><span class="hs-identifier hs-var">push</span></a><span class="hs-special">)</span><span>
</span><a name="line-1788"></a><span class="hs-identifier">toIfaceTickish</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#HpcTick"><span class="hs-identifier hs-var">HpcTick</span></a><span> </span><a name="local-1628237329"><a href="#local-1628237329"><span class="hs-identifier">modl</span></a></a><span> </span><a name="local-1628237330"><a href="#local-1628237330"><span class="hs-identifier">ix</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#IfaceHpcTick"><span class="hs-identifier hs-var">IfaceHpcTick</span></a><span> </span><a href="#local-1628237329"><span class="hs-identifier hs-var">modl</span></a><span> </span><a href="#local-1628237330"><span class="hs-identifier hs-var">ix</span></a><span class="hs-special">)</span><span>
</span><a name="line-1789"></a><span class="hs-identifier">toIfaceTickish</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#SourceNote"><span class="hs-identifier hs-var">SourceNote</span></a><span> </span><a name="local-1628237331"><a href="#local-1628237331"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-1628237332"><a href="#local-1628237332"><span class="hs-identifier">names</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#IfaceSource"><span class="hs-identifier hs-var">IfaceSource</span></a><span> </span><a href="#local-1628237331"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-1628237332"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span>
</span><a name="line-1790"></a><span class="hs-identifier">toIfaceTickish</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Breakpoint"><span class="hs-identifier hs-var">Breakpoint</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a><span>
</span><a name="line-1791"></a><span>   </span><span class="hs-comment">-- Ignore breakpoints, since they are relevant only to GHCi, and</span><span>
</span><a name="line-1792"></a><span>   </span><span class="hs-comment">-- should not be serialised (Trac #8333)</span><span>
</span><a name="line-1793"></a><span>
</span><a name="line-1794"></a><span class="hs-comment">---------------------</span><span>
</span><a name="line-1795"></a><span class="hs-identifier">toIfaceBind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#Bind"><span class="hs-identifier hs-type">Bind</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceBinding"><span class="hs-identifier hs-type">IfaceBinding</span></a><span>
</span><a name="line-1796"></a><a name="toIfaceBind"><a href="MkIface.html#toIfaceBind"><span class="hs-identifier">toIfaceBind</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a><span> </span><a name="local-1628237333"><a href="#local-1628237333"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1628237334"><a href="#local-1628237334"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceNonRec"><span class="hs-identifier hs-var">IfaceNonRec</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceLetBndr"><span class="hs-identifier hs-var">toIfaceLetBndr</span></a><span> </span><a href="#local-1628237333"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237334"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1797"></a><span class="hs-identifier">toIfaceBind</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Rec"><span class="hs-identifier hs-var">Rec</span></a><span> </span><a name="local-1628237335"><a href="#local-1628237335"><span class="hs-identifier">prs</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceRec"><span class="hs-identifier hs-var">IfaceRec</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="MkIface.html#toIfaceLetBndr"><span class="hs-identifier hs-var">toIfaceLetBndr</span></a><span> </span><a href="#local-1628237336"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237337"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1628237336"><a href="#local-1628237336"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><a name="local-1628237337"><a href="#local-1628237337"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1628237335"><span class="hs-identifier hs-var">prs</span></a><span class="hs-special">]</span><span>
</span><a name="line-1798"></a><span>
</span><a name="line-1799"></a><span class="hs-comment">---------------------</span><span>
</span><a name="line-1800"></a><span class="hs-identifier">toIfaceAlt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1801"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#IfaceConAlt"><span class="hs-identifier hs-type">IfaceConAlt</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="IfaceSyn.html#IfaceExpr"><span class="hs-identifier hs-type">IfaceExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1802"></a><a name="toIfaceAlt"><a href="MkIface.html#toIfaceAlt"><span class="hs-identifier">toIfaceAlt</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1628237338"><a href="#local-1628237338"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><a name="local-1628237339"><a href="#local-1628237339"><span class="hs-identifier">bs</span></a></a><span class="hs-special">,</span><a name="local-1628237340"><a href="#local-1628237340"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceCon"><span class="hs-identifier hs-var">toIfaceCon</span></a><span> </span><a href="#local-1628237338"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#getFS"><span class="hs-identifier hs-var">getFS</span></a><span> </span><a href="#local-1628237339"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237340"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1803"></a><span>
</span><a name="line-1804"></a><span class="hs-comment">---------------------</span><span>
</span><a name="line-1805"></a><span class="hs-identifier">toIfaceCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceConAlt"><span class="hs-identifier hs-type">IfaceConAlt</span></a><span>
</span><a name="line-1806"></a><a name="toIfaceCon"><a href="MkIface.html#toIfaceCon"><span class="hs-identifier">toIfaceCon</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a name="local-1628237341"><a href="#local-1628237341"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceDataAlt"><span class="hs-identifier hs-var">IfaceDataAlt</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-1628237341"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1807"></a><span class="hs-identifier">toIfaceCon</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#LitAlt"><span class="hs-identifier hs-var">LitAlt</span></a><span> </span><a name="local-1628237342"><a href="#local-1628237342"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceLitAlt"><span class="hs-identifier hs-var">IfaceLitAlt</span></a><span> </span><a href="#local-1628237342"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1808"></a><span class="hs-identifier">toIfaceCon</span><span> </span><a href="CoreSyn.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceDefault"><span class="hs-identifier hs-var">IfaceDefault</span></a><span>
</span><a name="line-1809"></a><span>
</span><a name="line-1810"></a><span class="hs-comment">---------------------</span><span>
</span><a name="line-1811"></a><span class="hs-identifier">toIfaceApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceExpr"><span class="hs-identifier hs-type">IfaceExpr</span></a><span>
</span><a name="line-1812"></a><a name="toIfaceApp"><a href="MkIface.html#toIfaceApp"><span class="hs-identifier">toIfaceApp</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><a name="local-1628237343"><a href="#local-1628237343"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628237344"><a href="#local-1628237344"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#toIfaceApp"><span class="hs-identifier hs-var">toIfaceApp</span></a><span> </span><a href="#local-1628237343"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1628237344"><span class="hs-identifier hs-var">a</span></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-1813"></a><span class="hs-identifier">toIfaceApp</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-1628237346"><a href="#local-1628237346"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-1814"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Id.html#isDataConWorkId_maybe"><span class="hs-identifier hs-var">isDataConWorkId_maybe</span></a><span> </span><a href="#local-1628237346"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1815"></a><span>        </span><span class="hs-comment">-- We convert the *worker* for tuples into IfaceTuples</span><span>
</span><a name="line-1816"></a><span>        </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237348"><a href="#local-1628237348"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">|</span><span>  </span><a href="#local-1628237350"><span class="hs-identifier hs-var">saturated</span></a><span>
</span><a name="line-1817"></a><span>                </span><span class="hs-special">,</span><span>  </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237353"><a href="#local-1628237353"><span class="hs-identifier">tup_sort</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConTuple_maybe"><span class="hs-identifier hs-var">tyConTuple_maybe</span></a><span> </span><a href="#local-1628237352"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1818"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceTuple"><span class="hs-identifier hs-var">IfaceTuple</span></a><span> </span><a href="#local-1628237353"><span class="hs-identifier hs-var">tup_sort</span></a><span> </span><a href="#local-1628237351"><span class="hs-identifier hs-var">tup_args</span></a><span>
</span><a name="line-1819"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-1820"></a><span>            </span><a name="local-1628237349"><a href="#local-1628237349"><span class="hs-identifier">val_args</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.List.html#dropWhile"><span class="hs-identifier hs-var">dropWhile</span></a><span> </span><a href="CoreSyn.html#isTypeArg"><span class="hs-identifier hs-var">isTypeArg</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-1821"></a><span>            </span><a name="local-1628237350"><a href="#local-1628237350"><span class="hs-identifier">saturated</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1628237349"><span class="hs-identifier hs-var">val_args</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#lengthIs"><span class="hs-identifier hs-var">lengthIs</span></a><span class="hs-special">`</span><span> </span><a href="Id.html#idArity"><span class="hs-identifier hs-var">idArity</span></a><span> </span><a href="#local-1628237346"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1822"></a><span>            </span><a name="local-1628237351"><a href="#local-1628237351"><span class="hs-identifier">tup_args</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a><span> </span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237349"><span class="hs-identifier hs-var">val_args</span></a><span>
</span><a name="line-1823"></a><span>            </span><a name="local-1628237352"><a href="#local-1628237352"><span class="hs-identifier">tc</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a><span> </span><a href="#local-1628237348"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-1824"></a><span>
</span><a name="line-1825"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MkIface.html#mkIfaceApps"><span class="hs-identifier hs-var">mkIfaceApps</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceVar"><span class="hs-identifier hs-var">toIfaceVar</span></a><span> </span><a href="#local-1628237346"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-1826"></a><span>
</span><a name="line-1827"></a><span class="hs-identifier">toIfaceApp</span><span> </span><a name="local-1628237354"><a href="#local-1628237354"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkIface.html#mkIfaceApps"><span class="hs-identifier hs-var">mkIfaceApps</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237354"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-1828"></a><span>
</span><a name="line-1829"></a><span class="hs-identifier">mkIfaceApps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IfaceSyn.html#IfaceExpr"><span class="hs-identifier hs-type">IfaceExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceExpr"><span class="hs-identifier hs-type">IfaceExpr</span></a><span>
</span><a name="line-1830"></a><a name="mkIfaceApps"><a href="MkIface.html#mkIfaceApps"><span class="hs-identifier">mkIfaceApps</span></a></a><span> </span><a name="local-1628237356"><a href="#local-1628237356"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1628237358"><a href="#local-1628237358"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1628237359"><a href="#local-1628237359"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceApp"><span class="hs-identifier hs-var">IfaceApp</span></a><span> </span><a href="#local-1628237358"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#toIfaceExpr"><span class="hs-identifier hs-var">toIfaceExpr</span></a><span> </span><a href="#local-1628237359"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1628237356"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-1831"></a><span>
</span><a name="line-1832"></a><span class="hs-comment">---------------------</span><span>
</span><a name="line-1833"></a><span class="hs-identifier">toIfaceVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IfaceSyn.html#IfaceExpr"><span class="hs-identifier hs-type">IfaceExpr</span></a><span>
</span><a name="line-1834"></a><a name="toIfaceVar"><a href="MkIface.html#toIfaceVar"><span class="hs-identifier">toIfaceVar</span></a></a><span> </span><a name="local-1628237360"><a href="#local-1628237360"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-1835"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#Just"><span class="hs-identifier hs-var">Just</span></a><span> </span><a name="local-1628237362"><a href="#local-1628237362"><span class="hs-identifier">fcall</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Id.html#isFCallId_maybe"><span class="hs-identifier hs-var">isFCallId_maybe</span></a><span> </span><a href="#local-1628237360"><span class="hs-identifier hs-var">v</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceFCall"><span class="hs-identifier hs-var">IfaceFCall</span></a><span> </span><a href="#local-1628237362"><span class="hs-identifier hs-var">fcall</span></a><span> </span><span class="hs-special">(</span><a href="IfaceType.html#toIfaceType"><span class="hs-identifier hs-var">toIfaceType</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-1628237360"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1836"></a><span>       </span><span class="hs-comment">-- Foreign calls have special syntax</span><span>
</span><a name="line-1837"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a><span> </span><a href="#local-1628237361"><span class="hs-identifier hs-var">name</span></a><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceExt"><span class="hs-identifier hs-var">IfaceExt</span></a><span> </span><a href="#local-1628237361"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1838"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="../base-4.9.0.0/src/%{MODULE/./-}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span>                                  </span><span class="hs-glyph">=</span><span> </span><a href="IfaceSyn.html#IfaceLcl"><span class="hs-identifier hs-var">IfaceLcl</span></a><span> </span><span class="hs-special">(</span><a href="MkIface.html#getFS"><span class="hs-identifier hs-var">getFS</span></a><span> </span><a href="#local-1628237361"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1839"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-1628237361"><a href="#local-1628237361"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-1628237360"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1840"></a></pre></body></html>