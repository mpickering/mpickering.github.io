<a href="Config.hs2441166411174619517.out.html">prev</a></br><a href="failures.html">home</a></br><a href="ConfigInternalVersions.hs13418536351808266298.out.html">next</a></br></br><pre>16c16
<   getPredicate âˆ· DateTime â†’ c â†’ (TodoItem â†’ ğ”¹)
---
>   getPredicate :: DateTime -> c -> (TodoItem -> ğ”¹)
18c18
<   toBaseConfig âˆ· c â†’ BaseConfig
---
>   toBaseConfig :: c -> BaseConfig
22d21
<       outOnlyFirst âˆ· ğ”¹,           -- ^ Output only first matching entry
23c22
<       outColors âˆ· ğ”¹,              -- ^ Show colored output
---
>       outOnlyFirst :: ğ”¹,           -- ^ Output only first matching entry
23a23
>       outColors :: ğ”¹,              -- ^ Show colored output
25d24
<       outHighlight âˆ· ğ”¹,           -- ^ Highlight matching items
26d24
<       sorting âˆ· SortingType,      -- ^ How to sort items
27d24
<       pruneL âˆ· Limit,
28d24
<       minL   âˆ· Limit,
29d24
<       commandToRun âˆ· TodoCommand,
30d24
<       prefix âˆ· Maybe String,      -- ^ Nothing â€” use default parser, Just p â€” use alternate parser with prefix Â«pÂ»
31d24
<       outputFormat âˆ· String,
32d24
<       indentString âˆ· String,      -- ^ String to use for output tree indenting (two spaces by default)
33d24
<       skipStatus âˆ· ğ”¹,             -- ^ Skip status field in input
34d24
<       groupByFile âˆ· ğ”¹,
35d24
<       groupByTag âˆ· ğ”¹,
36d24
<       groupByStatus âˆ· ğ”¹,
37d24
<       forcedStatus âˆ· Maybe String,
38c25
<       topStatus âˆ· Maybe String
---
>       outHighlight :: ğ”¹,           -- ^ Highlight matching items
38a26
>       sorting :: SortingType,      -- ^ How to sort items
38a27
>       pruneL :: Limit,
38a28
>       minL   :: Limit,
38a29
>       commandToRun :: TodoCommand,
38a30
>       prefix :: Maybe String,      -- ^ Nothing â€” use default parser, Just p â€” use alternate parser with prefix Â«pÂ»
38a31
>       outputFormat :: String,
38a32
>       indentString :: String,      -- ^ String to use for output tree indenting (two spaces by default)
38a33
>       skipStatus :: ğ”¹,             -- ^ Skip status field in input
38a34
>       groupByFile :: ğ”¹,
38a35
>       groupByTag :: ğ”¹,
38a36
>       groupByStatus :: ğ”¹,
38a37
>       forcedStatus :: Maybe String,
38a38
>       topStatus :: Maybe String
44d43
<   printConfig âˆ· c,
45d43
<   printStatusColor âˆ·  String â†’ (ANSI.ColorIntensity, ANSI.Color),       -- ^ Color of status field from status
46d43
<   printItemColor âˆ·  TodoItem â†’ Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Color of item name
47d43
<   printHighlightColor âˆ· (ANSI.ColorIntensity, ANSI.Color),              -- ^ Color to use for highlighting
48c44
<   doHighlight âˆ· TodoItem â†’ ğ”¹                                            -- ^ Whether to highlight given item
---
>   printConfig :: c,
48a45
>   printStatusColor ::  String -> (ANSI.ColorIntensity, ANSI.Color),       -- ^ Color of status field from status
48a46
>   printItemColor ::  TodoItem -> Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Color of item name
48a47
>   printHighlightColor :: (ANSI.ColorIntensity, ANSI.Color),              -- ^ Color to use for highlighting
48a48
>   doHighlight :: TodoItem -> ğ”¹                                            -- ^ Whether to highlight given item
53d52
<      parseCommandLine âˆ· DateTime â†’ c â†’ [String] â†’ CmdLineParseResult c,     -- ^ Function to parse command line
54d52
<      filterTodos âˆ· DateTime â†’ c â†’ [Todo] â†’ [Todo],                          -- ^ Any function to be run to transform read TODOs tree
55d52
<      statusConsoleColor âˆ· String â†’ (ANSI.ColorIntensity, ANSI.Color),       -- ^ Function to select a color of item's status field in console output
56d52
<      itemConsoleColor âˆ· TodoItem â†’ Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Function to select a color of item's name in console output
57d52
<      highlightColor âˆ· (ANSI.ColorIntensity, ANSI.Color),                    -- ^ Color to use for highlighting
58d52
<      itemColor âˆ· TodoItem â†’ HSV,                                            -- ^ Function to select color for item's node in DOT output
59d52
<      itemShape âˆ· TodoItem â†’ Shape,                                          -- ^ Function to select shape for item's node in DOT output
60d52
<      printTodos âˆ· PrintConfig c â†’ [Todo] â†’ IO (),                           -- ^ Any function to output TODOs list
61c53
<      nullConfig âˆ· c                                                         -- ^ Default Config (to be used without any options in command line and configs)
---
>      parseCommandLine :: DateTime -> c -> [String] -> CmdLineParseResult c,     -- ^ Function to parse command line
61a54
>      filterTodos :: DateTime -> c -> [Todo] -> [Todo],                          -- ^ Any function to be run to transform read TODOs tree
61a55
>      statusConsoleColor :: String -> (ANSI.ColorIntensity, ANSI.Color),       -- ^ Function to select a color of item's status field in console output
61a56
>      itemConsoleColor :: TodoItem -> Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Function to select a color of item's name in console output
61a57
>      highlightColor :: (ANSI.ColorIntensity, ANSI.Color),                    -- ^ Color to use for highlighting
61a58
>      itemColor :: TodoItem -> HSV,                                            -- ^ Function to select color for item's node in DOT output
61a59
>      itemShape :: TodoItem -> Shape,                                          -- ^ Function to select shape for item's node in DOT output
61a60
>      printTodos :: PrintConfig c -> [Todo] -> IO (),                           -- ^ Any function to output TODOs list
61a61
>      nullConfig :: c                                                         -- ^ Default Config (to be used without any options in command line and configs)
72c72
< askBase âˆ· (RuntimeConfig c) â‡’ (BaseConfig â†’ a) â†’ Reader c a
---
> askBase :: (RuntimeConfig c) => (BaseConfig -> a) -> Reader c a
74a75
> 
</pre></br><h2>original</h2></br><pre>{-# LANGUAGE UnicodeSyntax, MultiParamTypeClasses #-}

module Todos.Config where

import Prelude.Unicode
import Control.Monad.Reader
import Data.Dates

import Todos.Types
import Todos.Dot
import qualified System.Console.ANSI as ANSI

-- | Any user-specified runtime config type should belong to this class
class RuntimeConfig c where
  -- | Does given TODO item match query?
  getPredicate âˆ· DateTime â†’ c â†’ (TodoItem â†’ ğ”¹)
  -- | Get basic configuration
  toBaseConfig âˆ· c â†’ BaseConfig

-- | Any user-specified runtime config type should include at least this properties
data BaseConfig = BConfig {
      outOnlyFirst âˆ· ğ”¹,           -- ^ Output only first matching entry
      outColors âˆ· ğ”¹,              -- ^ Show colored output
      outIds :: ğ”¹,                -- ^ Show IDs
      outHighlight âˆ· ğ”¹,           -- ^ Highlight matching items
      sorting âˆ· SortingType,      -- ^ How to sort items
      pruneL âˆ· Limit,
      minL   âˆ· Limit,
      commandToRun âˆ· TodoCommand,
      prefix âˆ· Maybe String,      -- ^ Nothing â€” use default parser, Just p â€” use alternate parser with prefix Â«pÂ»
      outputFormat âˆ· String,
      indentString âˆ· String,      -- ^ String to use for output tree indenting (two spaces by default)
      skipStatus âˆ· ğ”¹,             -- ^ Skip status field in input
      groupByFile âˆ· ğ”¹,
      groupByTag âˆ· ğ”¹,
      groupByStatus âˆ· ğ”¹,
      forcedStatus âˆ· Maybe String,
      topStatus âˆ· Maybe String
      }
    deriving (Eq, Show)

-- | Configuration for console output. Is generated in runtime from TodosConfig and Config.
data PrintConfig c = PConfig {
  printConfig âˆ· c,
  printStatusColor âˆ·  String â†’ (ANSI.ColorIntensity, ANSI.Color),       -- ^ Color of status field from status
  printItemColor âˆ·  TodoItem â†’ Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Color of item name
  printHighlightColor âˆ· (ANSI.ColorIntensity, ANSI.Color),              -- ^ Color to use for highlighting
  doHighlight âˆ· TodoItem â†’ ğ”¹                                            -- ^ Whether to highlight given item
  }

-- | User Todos config. User can specify it in @~/.config/todos/todos.hs@.
data TodosConfig c = Todos {
     parseCommandLine âˆ· DateTime â†’ c â†’ [String] â†’ CmdLineParseResult c,     -- ^ Function to parse command line
     filterTodos âˆ· DateTime â†’ c â†’ [Todo] â†’ [Todo],                          -- ^ Any function to be run to transform read TODOs tree
     statusConsoleColor âˆ· String â†’ (ANSI.ColorIntensity, ANSI.Color),       -- ^ Function to select a color of item's status field in console output
     itemConsoleColor âˆ· TodoItem â†’ Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Function to select a color of item's name in console output
     highlightColor âˆ· (ANSI.ColorIntensity, ANSI.Color),                    -- ^ Color to use for highlighting
     itemColor âˆ· TodoItem â†’ HSV,                                            -- ^ Function to select color for item's node in DOT output
     itemShape âˆ· TodoItem â†’ Shape,                                          -- ^ Function to select shape for item's node in DOT output
     printTodos âˆ· PrintConfig c â†’ [Todo] â†’ IO (),                           -- ^ Any function to output TODOs list
     nullConfig âˆ· c                                                         -- ^ Default Config (to be used without any options in command line and configs)
}

-- | Result of parsing command line
data CmdLineParseResult c =
     Parsed c [FilePath]       -- ^ Parsed successfully, got Config and list of source files
   | ParseError String         -- ^ Some error occured
   | CmdLineHelp               -- ^ User asked for help
   deriving (Eq,Show)

-- | ask field from BaseConfig
askBase âˆ· (RuntimeConfig c) â‡’ (BaseConfig â†’ a) â†’ Reader c a
askBase field = asks (field âˆ˜ toBaseConfig)

</pre></br><h2>printed</h2></br><pre>{-# LANGUAGE UnicodeSyntax, MultiParamTypeClasses #-}

module Todos.Config where

import Prelude.Unicode
import Control.Monad.Reader
import Data.Dates

import Todos.Types
import Todos.Dot
import qualified System.Console.ANSI as ANSI

-- | Any user-specified runtime config type should belong to this class
class RuntimeConfig c where
  -- | Does given TODO item match query?
  getPredicate :: DateTime -> c -> (TodoItem -> ğ”¹)
  -- | Get basic configuration
  toBaseConfig :: c -> BaseConfig

-- | Any user-specified runtime config type should include at least this properties
data BaseConfig = BConfig {
      outOnlyFirst :: ğ”¹,           -- ^ Output only first matching entry
      outColors :: ğ”¹,              -- ^ Show colored output
      outIds :: ğ”¹,                -- ^ Show IDs
      outHighlight :: ğ”¹,           -- ^ Highlight matching items
      sorting :: SortingType,      -- ^ How to sort items
      pruneL :: Limit,
      minL   :: Limit,
      commandToRun :: TodoCommand,
      prefix :: Maybe String,      -- ^ Nothing â€” use default parser, Just p â€” use alternate parser with prefix Â«pÂ»
      outputFormat :: String,
      indentString :: String,      -- ^ String to use for output tree indenting (two spaces by default)
      skipStatus :: ğ”¹,             -- ^ Skip status field in input
      groupByFile :: ğ”¹,
      groupByTag :: ğ”¹,
      groupByStatus :: ğ”¹,
      forcedStatus :: Maybe String,
      topStatus :: Maybe String
      }
    deriving (Eq, Show)

-- | Configuration for console output. Is generated in runtime from TodosConfig and Config.
data PrintConfig c = PConfig {
  printConfig :: c,
  printStatusColor ::  String -> (ANSI.ColorIntensity, ANSI.Color),       -- ^ Color of status field from status
  printItemColor ::  TodoItem -> Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Color of item name
  printHighlightColor :: (ANSI.ColorIntensity, ANSI.Color),              -- ^ Color to use for highlighting
  doHighlight :: TodoItem -> ğ”¹                                            -- ^ Whether to highlight given item
  }

-- | User Todos config. User can specify it in @~/.config/todos/todos.hs@.
data TodosConfig c = Todos {
     parseCommandLine :: DateTime -> c -> [String] -> CmdLineParseResult c,     -- ^ Function to parse command line
     filterTodos :: DateTime -> c -> [Todo] -> [Todo],                          -- ^ Any function to be run to transform read TODOs tree
     statusConsoleColor :: String -> (ANSI.ColorIntensity, ANSI.Color),       -- ^ Function to select a color of item's status field in console output
     itemConsoleColor :: TodoItem -> Maybe (ANSI.ColorIntensity, ANSI.Color), -- ^ Function to select a color of item's name in console output
     highlightColor :: (ANSI.ColorIntensity, ANSI.Color),                    -- ^ Color to use for highlighting
     itemColor :: TodoItem -> HSV,                                            -- ^ Function to select color for item's node in DOT output
     itemShape :: TodoItem -> Shape,                                          -- ^ Function to select shape for item's node in DOT output
     printTodos :: PrintConfig c -> [Todo] -> IO (),                           -- ^ Any function to output TODOs list
     nullConfig :: c                                                         -- ^ Default Config (to be used without any options in command line and configs)
}

-- | Result of parsing command line
data CmdLineParseResult c =
     Parsed c [FilePath]       -- ^ Parsed successfully, got Config and list of source files
   | ParseError String         -- ^ Some error occured
   | CmdLineHelp               -- ^ User asked for help
   deriving (Eq,Show)

-- | ask field from BaseConfig
askBase :: (RuntimeConfig c) => (BaseConfig -> a) -> Reader c a
askBase field = asks (field âˆ˜ toBaseConfig)


</pre>